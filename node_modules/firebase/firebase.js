!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(E.prototype),E.prototype.clone=function(){return new E(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},E.error=function(){var t=new E(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];E.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new E(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=E,t.fetch=function(n,i){return new Promise(function(r,t){var e=new w(n,i),o=new XMLHttpRequest;o.onload=function(){var t,i,e={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",i=new d,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i)};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var n="response"in o?o.response:o.responseText;r(new E(n,e))},o.onerror=function(){t(new TypeError("Network request failed"))},o.ontimeout=function(){t(new TypeError("Network request failed"))},o.open(e.method,e.url,!0),"include"===e.credentials?o.withCredentials=!0:"omit"===e.credentials&&(o.withCredentials=!1),"responseType"in o&&a&&(o.responseType="blob"),e.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function y(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function m(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function g(t){var e=new FileReader,n=m(e);return e.readAsArrayBuffer(t),n}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=y(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?y(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t,e,n,r=y(this);if(r)return r;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=m(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n,r,i=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=(n=e.method||this.method||"GET",r=n.toUpperCase(),-1<c.indexOf(r)?r:n),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function E(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var r=setTimeout;function i(){}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function a(n,r){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,o._immediateFn(function(){var t=1===n._state?r.onFulfilled:r.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void u(r.promise,t)}s(r.promise,e)}else(1===n._state?s:u)(r.promise,n._value)})):n._deferreds.push(r)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof o)return e._state=3,e._value=t,void c(e);if("function"==typeof n)return void l((r=n,i=t,function(){r.apply(i,arguments)}),e)}e._state=1,e._value=t,c(e)}catch(t){u(e,t)}var r,i}function u(t,e){t._state=2,t._value=e,c(t)}function c(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function h(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function l(t,e){var n=!1;try{t(function(t){n||(n=!0,s(e,t))},function(t){n||(n=!0,u(e,t))})}catch(t){if(n)return;n=!0,u(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new h(t,e,n)),n},o.prototype.finally=n,o.all=function(e){return new o(function(r,i){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var o=Array.prototype.slice.call(e);if(0===o.length)return r([]);var a=o.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},i)}o[e]=t,0==--a&&r(o)}catch(t){i(t)}}for(var t=0;t<o.length;t++)s(t,o[t])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(n){return new o(function(t,e){e(n)})},o.race=function(i){return new o(function(t,e){for(var n=0,r=i.length;n<r;n++)i[n].then(t,e)})},o._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var f=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")}();"Promise"in f?f.Promise.prototype.finally||(f.Promise.prototype.finally=n):f.Promise=o;var p,d,y,b=function(r,i,t){if(function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function")}(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}},m=function(t){try{return!!t()}catch(t){return!0}},g={}.toString,v=function(t){return g.call(t).slice(8,-1)},w="".split,_=m(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==v(t)?w.call(t,""):Object(t)}:Object,E=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},T=function(t){return Object(E(t))},S=Math.ceil,C=Math.floor,I=function(t){return isNaN(t=+t)?0:(0<t?C:S)(t)},N=Math.min,D=function(t){return 0<t?N(I(t),9007199254740991):0},A=function(t){return"object"==typeof t?null!==t:"function"==typeof t},k=Array.isArray||function(t){return"Array"==v(t)},R="object"==typeof window&&window&&window.Math==Math?window:"object"==typeof self&&self&&self.Math==Math?self:Function("return this")(),O=!m(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),P=R.document,M=A(P)&&A(P.createElement),x=function(t){return M?P.createElement(t):{}},L=!O&&!m(function(){return 7!=Object.defineProperty(x("div"),"a",{get:function(){return 7}}).a}),F=function(t){if(!A(t))throw TypeError(String(t)+" is not an object");return t},U=function(t,e){if(!A(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!A(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!A(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!A(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},q=Object.defineProperty,V={f:O?q:function(t,e,n){if(F(t),e=U(e,!0),F(n),L)try{return q(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},B=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},j=O?function(t,e,n){return V.f(t,e,B(1,n))}:function(t,e,n){return t[e]=n,t},W=function(e,n){try{j(R,e,n)}catch(t){R[e]=n}return n},Q=e(function(t){var e="__core-js_shared__",n=R[e]||W(e,{});(t.exports=function(t,e){return n[t]||(n[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.0.0",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})}),K=0,H=Math.random(),G=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++K+H).toString(36))},z=!m(function(){}),Y=Q("wks"),X=R.Symbol,J=function(t){return Y[t]||(Y[t]=z&&X[t]||(z?X:G)("Symbol."+t))},$=J("species"),Z=function(t,e){var n;return k(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!k(n.prototype)?A(n)&&null===(n=n[$])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)},tt=function(l,t){var f=1==l,p=2==l,d=3==l,y=4==l,m=6==l,g=5==l||m,v=t||Z;return function(t,e,n){for(var r,i,o=T(t),a=_(o),s=b(e,n,3),u=D(a.length),c=0,h=f?v(t,u):p?v(t,0):void 0;c<u;c++)if((g||c in a)&&(i=s(r=a[c],c,o),l))if(f)h[c]=i;else if(i)switch(l){case 3:return!0;case 5:return r;case 6:return c;case 2:h.push(r)}else if(y)return!1;return m?-1:d||y?y:h}},et={}.propertyIsEnumerable,nt=Object.getOwnPropertyDescriptor,rt={f:nt&&!et.call({1:2},1)?function(t){var e=nt(this,t);return!!e&&e.enumerable}:et},it=function(t){return _(E(t))},ot={}.hasOwnProperty,at=function(t,e){return ot.call(t,e)},st=Object.getOwnPropertyDescriptor,ut={f:O?st:function(t,e){if(t=it(t),e=U(e,!0),L)try{return st(t,e)}catch(t){}if(at(t,e))return B(!rt.f.call(t,e),t[e])}},ct=Q("native-function-to-string",Function.toString),ht=R.WeakMap,lt="function"==typeof ht&&/native code/.test(ct.call(ht)),ft=Q("keys"),pt=function(t){return ft[t]||(ft[t]=G(t))},dt={},yt=R.WeakMap;if(lt){var mt=new yt,gt=mt.get,vt=mt.has,bt=mt.set;p=function(t,e){return bt.call(mt,t,e),e},d=function(t){return gt.call(mt,t)||{}},y=function(t){return vt.call(mt,t)}}else{var wt=pt("state");dt[wt]=!0,p=function(t,e){return j(t,wt,e),e},d=function(t){return at(t,wt)?t[wt]:{}},y=function(t){return at(t,wt)}}var _t,Et={set:p,get:d,has:y,enforce:function(t){return y(t)?d(t):p(t,{})},getterFor:function(n){return function(t){var e;if(!A(t)||(e=d(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},Tt=e(function(t){var e=Et.get,s=Et.enforce,u=String(ct).split("toString");Q("inspectSource",function(t){return ct.call(t)}),(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||at(n,"name")||j(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==R?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:j(t,e,n)):o?t[e]=n:W(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||ct.call(this)})}),St=Math.max,Ct=Math.min,It=(_t=!1,function(t,e,n){var r,i,o,a=it(t),s=D(a.length),u=(r=s,(i=I(n))<0?St(i+r,0):Ct(i,r));if(_t&&e!=e){for(;u<s;)if((o=a[u++])!=o)return!0}else for(;u<s;u++)if((_t||u in a)&&a[u]===e)return _t||u||0;return!_t&&-1}),Nt=function(t,e){var n,r=it(t),i=0,o=[];for(n in r)!at(dt,n)&&at(r,n)&&o.push(n);for(;e.length>i;)at(r,n=e[i++])&&(~It(o,n)||o.push(n));return o},Dt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],At=Dt.concat("length","prototype"),kt={f:Object.getOwnPropertyNames||function(t){return Nt(t,At)}},Rt={f:Object.getOwnPropertySymbols},Ot=R.Reflect,Pt=Ot&&Ot.ownKeys||function(t){var e=kt.f(F(t)),n=Rt.f;return n?e.concat(n(t)):e},Mt=function(t,e){for(var n=Pt(e),r=V.f,i=ut.f,o=0;o<n.length;o++){var a=n[o];at(t,a)||r(t,a,i(e,a))}},xt=/#|\.prototype\./,Lt=function(t,e){var n=Ut[Ft(t)];return n==Vt||n!=qt&&("function"==typeof e?m(e):!!e)},Ft=Lt.normalize=function(t){return String(t).replace(xt,".").toLowerCase()},Ut=Lt.data={},qt=Lt.NATIVE="N",Vt=Lt.POLYFILL="P",Bt=Lt,jt=ut.f,Wt=function(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?R:c?R[s]||W(s,{}):(R[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=jt(n,r))&&a.value:n[r],!Bt(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;Mt(o,i)}(t.sham||i&&i.sham)&&j(o,"sham",!0),Tt(n,r,o,t)}},Qt=Object.keys||function(t){return Nt(t,Dt)},Kt=O?Object.defineProperties:function(t,e){F(t);for(var n,r=Qt(e),i=r.length,o=0;o<i;)V.f(t,n=r[o++],e[n]);return t},Ht=R.document,Gt=Ht&&Ht.documentElement,zt=pt("IE_PROTO"),Yt="prototype",Xt=function(){},Jt=function(){var t,e=x("iframe"),n=Dt.length,r="script";for(e.style.display="none",Gt.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),Jt=t.F;n--;)delete Jt[Yt][Dt[n]];return Jt()},$t=Object.create||function(t,e){var n;return null!==t?(Xt[Yt]=F(t),n=new Xt,Xt[Yt]=null,n[zt]=t):n=Jt(),void 0===e?n:Kt(n,e)};dt[zt]=!0;var Zt=J("unscopables"),te=Array.prototype;null==te[Zt]&&j(te,Zt,$t(null));var ee=function(t){te[Zt][t]=!0},ne=tt(5),re="find",ie=!0;re in[]&&Array(1)[re](function(){ie=!1}),Wt({target:"Array",proto:!0,forced:ie},{find:function(t){return ne(this,t,1<arguments.length?arguments[1]:void 0)}}),ee(re);var oe=Function.call,ae=function(t,e,n){return b(oe,R[t].prototype[e],n)},se=(ae("Array","find"),tt(6)),ue="findIndex",ce=!0;ue in[]&&Array(1)[ue](function(){ce=!1}),Wt({target:"Array",proto:!0,forced:ce},{findIndex:function(t){return se(this,t,1<arguments.length?arguments[1]:void 0)}}),ee(ue);ae("Array","findIndex");var he=Object.assign,le=!he||m(function(){var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=he({},t)[n]||Qt(he({},e)).join("")!=r})?function(t,e){for(var n=T(t),r=arguments.length,i=1,o=Rt.f,a=rt.f;i<r;)for(var s,u=_(arguments[i++]),c=o?Qt(u).concat(o(u)):Qt(u),h=c.length,l=0;l<h;)a.call(u,s=c[l++])&&(n[s]=u[s]);return n}:he;Wt({target:"Object",stat:!0,forced:Object.assign!==le},{assign:le});var fe=R,pe=(fe.Object.assign,J("match")),de=function(t,e,n){if(A(r=e)&&(void 0!==(i=r[pe])?i:"RegExp"==v(r)))throw TypeError("String.prototype."+n+" doesn't accept regex");var r,i;return String(E(t))},ye=J("match"),me="startsWith",ge=function(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[ye]=!1,"/./"[e](n)}catch(t){}}return!1}(me),ve=""[me];Wt({target:"String",proto:!0,forced:!ge},{startsWith:function(t){var e=de(this,t,me),n=D(Math.min(1<arguments.length?arguments[1]:void 0,e.length)),r=String(t);return ve?ve.call(e,r,n):e.slice(n,n+r.length)===r}});ae("String","startsWith");Wt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(E(this)),n="",r=I(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});ae("String","repeat");var be,we=function(t,e,n){var r=U(e);r in t?V.f(t,r,B(0,n)):t[r]=n},_e=J("species"),Ee=J("isConcatSpreadable"),Te=9007199254740991,Se="Maximum allowed index exceeded",Ce=!m(function(){var t=[];return t[Ee]=!1,t.concat()[0]!==t}),Ie=(be="concat",!m(function(){var t=[];return(t.constructor={})[_e]=function(){return{foo:1}},1!==t[be](Boolean).foo})),Ne=function(t){if(!A(t))return!1;var e=t[Ee];return void 0!==e?!!e:k(t)};Wt({target:"Array",proto:!0,forced:!Ce||!Ie},{concat:function(t){var e,n,r,i,o,a=T(this),s=Z(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(o=-1===e?a:arguments[e],Ne(o)){if(i=D(o.length),Te<u+i)throw TypeError(Se);for(n=0;n<i;n++,u++)n in o&&we(s,u,o[n])}else{if(Te<=u)throw TypeError(Se);we(s,u++,o)}return s.length=u,s}});var De=J("toStringTag"),Ae="Arguments"==v(function(){return arguments}()),ke={};ke[J("toStringTag")]="z";var Re="[object z]"!==String(ke)?function(){return"[object "+(void 0===(t=this)?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),De))?n:Ae?v(e):"Object"==(r=v(e))&&"function"==typeof e.callee?"Arguments":r)+"]";var t,e,n,r}:ke.toString,Oe=Object.prototype;Re!==Oe.toString&&Tt(Oe,"toString",Re,{unsafe:!0});var Pe=V.f,Me=J("toStringTag"),xe=function(t,e,n){t&&!at(t=n?t:t.prototype,Me)&&Pe(t,Me,{configurable:!0,value:e})},Le={f:J},Fe=V.f,Ue=function(t){var e=fe.Symbol||(fe.Symbol={});at(e,t)||Fe(e,t,{value:Le.f(t)})},qe=kt.f,Ve={}.toString,Be="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],je={f:function(t){return Be&&"[object Window]"==Ve.call(t)?function(t){try{return qe(t)}catch(t){return Be.slice()}}(t):qe(it(t))}},We=pt("hidden"),Qe="Symbol",Ke=Et.set,He=Et.getterFor(Qe),Ge=ut.f,ze=V.f,Ye=je.f,Xe=R.Symbol,Je=R.JSON,$e=Je&&Je.stringify,Ze="prototype",tn=J("toPrimitive"),en=rt.f,nn=Q("symbol-registry"),rn=Q("symbols"),on=Q("op-symbols"),an=Q("wks"),sn=Object[Ze],un=R.QObject,cn=!un||!un[Ze]||!un[Ze].findChild,hn=O&&m(function(){return 7!=$t(ze({},"a",{get:function(){return ze(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Ge(sn,e);r&&delete sn[e],ze(t,e,n),r&&t!==sn&&ze(sn,e,r)}:ze,ln=function(t,e){var n=rn[t]=$t(Xe[Ze]);return Ke(n,{type:Qe,tag:t,description:e}),O||(n.description=e),n},fn=z&&"symbol"==typeof Xe.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Xe},pn=function(t,e,n){return t===sn&&pn(on,e,n),F(t),e=U(e,!0),F(n),at(rn,e)?(n.enumerable?(at(t,We)&&t[We][e]&&(t[We][e]=!1),n=$t(n,{enumerable:B(0,!1)})):(at(t,We)||ze(t,We,B(1,{})),t[We][e]=!0),hn(t,e,n)):ze(t,e,n)},dn=function(t,e){F(t);for(var n,r=function(t){var e=Qt(t),n=Rt.f;if(n)for(var r,i=n(t),o=rt.f,a=0;i.length>a;)o.call(t,r=i[a++])&&e.push(r);return e}(e=it(e)),i=0,o=r.length;i<o;)pn(t,n=r[i++],e[n]);return t},yn=function(t){var e=en.call(this,t=U(t,!0));return!(this===sn&&at(rn,t)&&!at(on,t))&&(!(e||!at(this,t)||!at(rn,t)||at(this,We)&&this[We][t])||e)},mn=function(t,e){if(t=it(t),e=U(e,!0),t!==sn||!at(rn,e)||at(on,e)){var n=Ge(t,e);return!n||!at(rn,e)||at(t,We)&&t[We][e]||(n.enumerable=!0),n}},gn=function(t){for(var e,n=Ye(it(t)),r=[],i=0;n.length>i;)at(rn,e=n[i++])||at(dt,e)||r.push(e);return r},vn=function(t){for(var e,n=t===sn,r=Ye(n?on:it(t)),i=[],o=0;r.length>o;)!at(rn,e=r[o++])||n&&!at(sn,e)||i.push(rn[e]);return i};z||(Tt((Xe=function(){if(this instanceof Xe)throw TypeError("Symbol is not a constructor");var t=void 0===arguments[0]?void 0:String(arguments[0]),e=G(t),n=function(t){this===sn&&n.call(on,t),at(this,We)&&at(this[We],e)&&(this[We][e]=!1),hn(this,e,B(1,t))};return O&&cn&&hn(sn,e,{configurable:!0,set:n}),ln(e,t)})[Ze],"toString",function(){return He(this).tag}),rt.f=yn,V.f=pn,ut.f=mn,kt.f=je.f=gn,Rt.f=vn,O&&(ze(Xe[Ze],"description",{configurable:!0,get:function(){return He(this).description}}),Tt(sn,"propertyIsEnumerable",yn,{unsafe:!0})),Le.f=function(t){return ln(J(t),t)}),Wt({global:!0,wrap:!0,forced:!z,sham:!z},{Symbol:Xe});for(var bn=Qt(an),wn=0;bn.length>wn;)Ue(bn[wn++]);Wt({target:Qe,stat:!0,forced:!z},{for:function(t){return at(nn,t+="")?nn[t]:nn[t]=Xe(t)},keyFor:function(t){if(!fn(t))throw TypeError(t+" is not a symbol");for(var e in nn)if(nn[e]===t)return e},useSetter:function(){cn=!0},useSimple:function(){cn=!1}}),Wt({target:"Object",stat:!0,forced:!z,sham:!O},{create:function(t,e){return void 0===e?$t(t):dn($t(t),e)},defineProperty:pn,defineProperties:dn,getOwnPropertyDescriptor:mn}),Wt({target:"Object",stat:!0,forced:!z},{getOwnPropertyNames:gn,getOwnPropertySymbols:vn}),Je&&Wt({target:"JSON",stat:!0,forced:!z||m(function(){var t=Xe();return"[null]"!=$e([t])||"{}"!=$e({a:t})||"{}"!=$e(Object(t))})},{stringify:function(t){for(var e,n,r=[t],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=e=r[1],(A(e)||void 0!==t)&&!fn(t))return k(e)||(e=function(t,e){if("function"==typeof n&&(e=n.call(this,t,e)),!fn(e))return e}),r[1]=e,$e.apply(Je,r)}}),Xe[Ze][tn]||j(Xe[Ze],tn,Xe[Ze].valueOf),xe(Xe,Qe),dt[We]=!0,Ue("asyncIterator");var _n=V.f,En=R.Symbol;if(O&&"function"==typeof En&&(!("description"in En.prototype)||void 0!==En().description)){var Tn={},Sn=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof Sn?new En(t):void 0===t?En():En(t);return""===t&&(Tn[e]=!0),e};Mt(Sn,En);var Cn=Sn.prototype=En.prototype;Cn.constructor=Sn;var In=Cn.toString,Nn="Symbol(test)"==String(En("test")),Dn=/^Symbol\((.*)\)[^)]+$/;_n(Cn,"description",{configurable:!0,get:function(){var t=A(this)?this.valueOf():this,e=In.call(t);if(at(Tn,t))return"";var n=Nn?e.slice(7,-1):e.replace(Dn,"$1");return""===n?void 0:n}}),Wt({global:!0,forced:!0},{Symbol:Sn})}Ue("hasInstance"),Ue("isConcatSpreadable"),Ue("iterator"),Ue("match"),Ue("replace"),Ue("search"),Ue("species"),Ue("split"),Ue("toPrimitive"),Ue("toStringTag"),Ue("unscopables"),xe(Math,"Math",!0),xe(R.JSON,"JSON",!0);fe.Symbol;Ue("dispose"),Ue("observable"),Ue("patternMatch");var An,kn,Rn,On=!m(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Pn=pt("IE_PROTO"),Mn=Object.prototype,xn=On?Object.getPrototypeOf:function(t){return t=T(t),at(t,Pn)?t[Pn]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Mn:null},Ln=J("iterator"),Fn=!1;[].keys&&("next"in(Rn=[].keys())?(kn=xn(xn(Rn)))!==Object.prototype&&(An=kn):Fn=!0),null==An&&(An={}),at(An,Ln)||j(An,Ln,function(){return this});var Un={IteratorPrototype:An,BUGGY_SAFARI_ITERATORS:Fn},qn=Un.IteratorPrototype,Vn=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return function(t,e){if(F(t),!A(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(t,e),r?n.call(t,e):t.__proto__=e,t}}():void 0),Bn=J("iterator"),jn=Un.IteratorPrototype,Wn=Un.BUGGY_SAFARI_ITERATORS,Qn="values",Kn="entries",Hn=function(){return this},Gn=function(t,e,n,r,i,o,a){var s,u,c;u=r,c=e+" Iterator",(s=n).prototype=$t(qn,{next:B(1,u)}),xe(s,c,!1);var h,l,f,p=function(t){if(t===i&&v)return v;if(!Wn&&t in m)return m[t];switch(t){case"keys":case Qn:case Kn:return function(){return new n(this,t)}}return function(){return new n(this)}},d=e+" Iterator",y=!1,m=t.prototype,g=m[Bn]||m["@@iterator"]||i&&m[i],v=!Wn&&g||p(i),b="Array"==e&&m.entries||g;if(b&&(h=xn(b.call(new t)),jn!==Object.prototype&&h.next&&(xn(h)!==jn&&(Vn?Vn(h,jn):"function"!=typeof h[Bn]&&j(h,Bn,Hn)),xe(h,d,!0))),i==Qn&&g&&g.name!==Qn&&(y=!0,v=function(){return g.call(this)}),m[Bn]!==v&&j(m,Bn,v),i)if(l={values:p(Qn),keys:o?v:p("keys"),entries:p(Kn)},a)for(f in l)!Wn&&!y&&f in m||Tt(m,f,l[f]);else Wt({target:e,proto:!0,forced:Wn||y},l);return l},zn="String Iterator",Yn=Et.set,Xn=Et.getterFor(zn);Gn(String,"String",function(t){Yn(this,{type:zn,string:String(t),index:0})},function(){var t,e,n,r,i,o,a,s,u=Xn(this),c=u.string,h=u.index;return h>=c.length?{value:void 0,done:!0}:(e=h,n=!0,o=String(E(c)),a=I(e),s=o.length,t=a<0||s<=a?n?"":void 0:(r=o.charCodeAt(a))<55296||56319<r||a+1===s||(i=o.charCodeAt(a+1))<56320||57343<i?n?o.charAt(a):r:n?o.slice(a,a+2):i-56320+(r-55296<<10)+65536,u.index+=t.length,{value:t,done:!1})});var Jn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},$n="Array Iterator",Zn=Et.set,tr=Et.getterFor($n),er=Gn(Array,"Array",function(t,e){Zn(this,{type:$n,target:it(t),index:0,kind:e})},function(){var t=tr(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");ee("keys"),ee("values"),ee("entries");var nr=J("iterator"),rr=J("toStringTag"),ir=er.values;for(var or in Jn){var ar=R[or],sr=ar&&ar.prototype;if(sr){if(sr[nr]!==ir)try{j(sr,nr,ir)}catch(Ts){sr[nr]=ir}if(sr[rr]||j(sr,rr,or),Jn[or])for(var ur in er)if(sr[ur]!==er[ur])try{j(sr,ur,er[ur])}catch(Ts){sr[ur]=er[ur]}}}Le.f("iterator");var cr=!1,hr="${JSCORE_VERSION}",lr=function(t,e){if(!t)throw fr(e)},fr=function(t){return new Error("Firebase Database ("+hr+") INTERNAL ASSERT FAILED: "+t)},pr=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,i>>6&63|128),63&i|128)}return e},dr={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(pr(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!=s){var h=a<<4&240|s>>2;if(r.push(h),64!=u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},yr=function(t){try{return dr.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function mr(t){return gr(void 0,t)}function gr(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=gr(t[n],e[n]));return t}function vr(t,e,n){t[e]=n}var br=function(){function t(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}return t.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},t}(),wr=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")},_r=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},Er=function(){return!0===cr},Tr="FirebaseError",Sr=Error.captureStackTrace,Cr=function(t,e){if(this.code=t,this.message=e,Sr)Sr(this,Ir.prototype.create);else try{throw Error.apply(this,arguments)}catch(t){this.name=Tr,Object.defineProperty(this,"stack",{get:function(){return t.stack}})}};Cr.prototype=Object.create(Error.prototype),(Cr.prototype.constructor=Cr).prototype.name=Tr;var Ir=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return t.prototype.create=function(t,r){void 0===r&&(r={});var e,n=this.errors[t],i=this.service+"/"+t;e=void 0===n?"Error":n.replace(this.pattern,function(t,e){var n=r[e];return void 0!==n?n.toString():"<"+e+"?>"}),e=this.serviceName+": "+e+" ("+i+").";var o=new Cr(i,e);for(var a in r)r.hasOwnProperty(a)&&"_"!==a.slice(-1)&&(o[a]=r[a]);return o},t}();function Nr(t){return JSON.parse(t)}function Dr(t){return JSON.stringify(t)}var Ar=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=Nr(yr(o[0])||""),n=Nr(yr(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}},kr=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},Rr=function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]},Or=function(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])},Pr=function(t){return n={},Or(t,function(t,e){n[t]=e}),n;var n},Mr=function(t){for(var e in t)return!1;return!0},xr=function(t){var e=0;for(var n in t)e++;return e},Lr=function(t,e,n){var r={};for(var i in t)r[i]=e.call(n,t[i],i,t);return r},Fr=function(t,e,n){for(var r in t)if(e.call(n,t[r],r,t))return r},Ur=function(t){for(var e in t)return e},qr=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782);i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0==o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();function Vr(t,e){var n=new Br(t,e);return n.subscribe.bind(n)}var Br=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},t.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=jr),void 0===r.error&&(r.error=jr),void 0===r.complete&&(r.complete=jr);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function jr(){}var Wr=function(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function Qr(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function Kr(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(Qr(t,e,r)+"must be a valid function.")}function Hr(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(Qr(t,e,r)+"must be a valid context object.")}var Gr=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e},zr=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},Yr="[DEFAULT]",Xr=[],Jr=function(){function t(t,e,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled||!1,this.options_=mr(t),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){Xr.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(e){Xr=Xr.filter(function(t){return t!==e})}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(t){this.checkDestroyed_(),this._automaticDataCollectionEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var r=this;return new Promise(function(t){r.checkDestroyed_(),t()}).then(function(){r.firebase_.INTERNAL.removeApp(r.name_);var n=[];return Object.keys(r.services_).forEach(function(e){Object.keys(r.services_[e]).forEach(function(t){n.push(r.services_[e][t])})}),Promise.all(n.map(function(t){return t.INTERNAL.delete()}))}).then(function(){r.isDeleted_=!0,r.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=Yr),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==Yr?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype.extendApp=function(t){var e=this;gr(this,t),t.INTERNAL&&t.INTERNAL.addAuthTokenListener&&(Xr.forEach(function(t){e.INTERNAL.addAuthTokenListener(t)}),Xr=[])},t.prototype.checkDestroyed_=function(){this.isDeleted_&&$r("app-deleted",{name:this.name_})},t}();function $r(t,e){throw Zr.create(t,e)}Jr.prototype.name&&Jr.prototype.options||Jr.prototype.delete||console.log("dc");var Zr=new Ir("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."}),ti=!1;try{ti="[object process]"===Object.prototype.toString.call(global.process)}catch(Ts){}ti&&console.warn('\nWarning: This is a browser-targeted Firebase bundle but it appears it is being\nrun in a Node environment.  If running in a Node environment, make sure you\nare using the bundle specified by the "main" field in package.json.\n\nIf you are using Webpack, you can specify "main" as the first item in\n"resolve.mainFields":\nhttps://webpack.js.org/configuration/resolve/#resolvemainfields\n\nIf using Rollup, use the rollup-plugin-node-resolve plugin and set "module"\nto false and "main" to true:\nhttps://github.com/rollup/rollup-plugin-node-resolve\n');var Fh=function t(){var a={},s={},u={},c={__esModule:!0,initializeApp:function(t,e){if(void 0===e&&(e={}),"object"!=typeof e||null===e){var n=e;e={name:n}}var r=e;void 0===r.name&&(r.name=Yr);var i=r.name;"string"==typeof i&&i||$r("bad-app-name",{name:i+""}),zr(a,i)&&$r("duplicate-app",{name:i});var o=new Jr(t,r,c);return f(a[i]=o,"create"),o},app:h,apps:null,Promise:Promise,SDK_VERSION:"5.9.4",INTERNAL:{registerService:function(n,t,e,r,i){s[n]&&$r("duplicate-service",{name:n}),s[n]=t,r&&(u[n]=r,l().forEach(function(t){r("create",t)}));var o=function(t){return void 0===t&&(t=h()),"function"!=typeof t[n]&&$r("invalid-app-argument",{name:n}),t[n]()};return void 0!==e&&gr(o,e),c[n]=o,Jr.prototype[n]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,n).apply(this,i?t:[])},o},createFirebaseNamespace:t,extendNamespace:function(t){gr(c,t)},createSubscribe:Vr,ErrorFactory:Ir,removeApp:function(t){f(a[t],"delete"),delete a[t]},factories:s,useAsService:i,Promise:Promise,deepExtend:gr}};function h(t){return zr(a,t=t||Yr)||$r("no-app",{name:t}),a[t]}function l(){return Object.keys(a).map(function(t){return a[t]})}function f(n,r){Object.keys(s).forEach(function(t){var e=i(n,t);null!==e&&u[e]&&u[e](r,n)})}function i(t,e){if("serverAuth"===e)return null;var n=e;return t.options,n}return vr(c,"default",c),Object.defineProperty(c,"apps",{get:l}),vr(h,"App",Jr),c}();(function(){var t,u=u||{},l=this;function c(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var f=/^[\w+/_-]+[=]{0,2}$/,p=null;function o(){}function h(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function r(t){return null===t}function d(t){return"array"==h(t)}function y(t){var e=h(t);return"array"==e||"object"==e&&"number"==typeof t.length}function a(t){return"function"==h(t)}function m(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),i=0;function s(t,e,n){return t.call.apply(t.bind,arguments)}function g(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?s:g).apply(null,arguments)}function b(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var w=Date.now||function(){return+new Date};function _(t,o){function e(){}e.prototype=o.prototype,t.pb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).gd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function E(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function T(t){if(Error.captureStackTrace)Error.captureStackTrace(this,T);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function S(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");T.call(this,n+t[r])}function C(t,e){throw new S("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function I(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function N(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function D(){this.b=this.a=null}_(T,Error),T.prototype.name="CustomError",_(S,T),S.prototype.name="AssertionError",I.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var A=new I(function(){return new k},function(t){t.reset()});function k(){this.next=this.b=this.a=null}D.prototype.add=function(t,e){var n=A.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},k.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},k.prototype.reset=function(){this.next=this.b=this.a=null};var R=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(c(t))return c(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},O=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=c(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var P=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=c(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},M=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=c(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function x(t,e){return 0<=R(t,e)}function L(t,e){var n;return(n=0<=(e=R(t,e)))&&Array.prototype.splice.call(t,e,1),n}function F(n,r){!function(t,e){var n=t.length,r=c(t)?t.split(""):t;for(--n;0<=n;--n)n in r&&e.call(void 0,r[n],n,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function U(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}var V,B=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},j=/&/g,W=/</g,Q=/>/g,K=/"/g,H=/'/g,G=/\x00/g,z=/[\x00&<>"']/;function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var J=l.navigator;if(J){var $=J.userAgent;if($){V=$;break t}}V=""}function Z(t){return Y(V,t)}function tt(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function et(t){for(var e in t)return!1;return!0}function nt(t){var e,n={};for(e in t)n[e]=t[e];return n}var rt,it,ot="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ot.length;o++)n=ot[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function st(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function ut(t){return z.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(j,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(W,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(Q,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(K,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(H,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(G,"&#0;"))),t}function ct(t){l.setTimeout(function(){throw t},0)}function ht(t,e){it||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);it=function(){t.then(pt)}}else it=function(){var t=pt;!a(l.setImmediate)||l.Window&&l.Window.prototype&&!Z("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(rt||(rt=function(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Z("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",t.src="",document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(""),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=v(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Z("Trident")||Z("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).xb;n.xb=null,t()}},function(t){r.next={xb:t},r=r.next,e.port2.postMessage(0)}}()),rt(t)):l.setImmediate(t)}}(),lt||(it(),lt=!0),ft.add(t,e)}var lt=!1,ft=new D;function pt(){for(var t;n=e=void 0,n=null,(e=ft).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){ct(t)}N(A,t)}var e,n;lt=!1}function dt(t,e){if(this.a=yt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=o)try{var n=this;t.call(e,function(t){Nt(n,mt,t)},function(t){if(!(t instanceof Mt))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}Nt(n,gt,t)})}catch(t){Nt(this,gt,t)}}var yt=0,mt=2,gt=3;function vt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}vt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var bt=new I(function(){return new vt},function(t){t.reset()});function wt(t,e,n){var r=bt.get();return r.g=t,r.b=e,r.f=n,r}function _t(t){if(t instanceof dt)return t;var e=new dt(o);return Nt(e,mt,t),e}function Et(n){return new dt(function(t,e){e(n)})}function Tt(t,e,n){Dt(t,e,n,null)||ht(b(e,t))}function St(n){return new dt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Eb:!0,value:n}:{Eb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Tt(n[e],b(t,e,!0),b(t,e,!1));else r(o)})}function Ct(t,e){t.b||t.a!=mt&&t.a!=gt||At(t),t.f?t.f.next=e:t.b=e,t.f=e}function It(t,i,o,a){var e=wt(null,null,null);return e.a=new dt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof Mt?r(t):n(e)}catch(t){r(t)}}:r}),Ct(e.a.c=t,e),e.a}function Nt(t,e,n){var r,i;t.a==yt&&(t===n&&(e=gt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,Dt(n,t.Pc,t.Qc,t)||(t.i=n,t.a=e,t.c=null,At(t),e!=gt||n instanceof Mt||(i=n,(r=t).g=!0,ht(function(){r.g&&Pt.call(null,i)}))))}function Dt(t,e,n,r){if(t instanceof dt)return Ct(t,wt(e||o,n||null,r)),!0;if(E(t))return t.then(e,n,r),!0;if(m(t))try{var i=t.then;if(a(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function At(t){t.h||(t.h=!0,ht(t.Yb,t))}function kt(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function Rt(t,e,n,r){if(n==gt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,Ot(e,n,r);else try{e.c?e.g.call(e.f):Ot(e,n,r)}catch(t){Pt.call(null,t)}N(bt,e)}function Ot(t,e,n){e==mt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}dt.prototype.then=function(t,e,n){return It(this,a(t)?t:null,a(e)?e:null,n)},dt.prototype.$goog_Thenable=!0,(t=dt.prototype).ia=function(t,e){return(t=wt(t,t,e)).c=!0,Ct(this,t),this},t.s=function(t,e){return It(this,null,t,e)},t.cancel=function(t){this.a==yt&&ht(function(){!function t(e,n){if(e.a==yt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==yt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):kt(r),Rt(r,o,gt,n)))}e.c=null}else Nt(e,gt,n)}(this,new Mt(t))},this)},t.Pc=function(t){this.a=yt,Nt(this,mt,t)},t.Qc=function(t){this.a=yt,Nt(this,gt,t)},t.Yb=function(){for(var t;t=kt(this);)Rt(this,t,this.a,this.i);this.h=!1};var Pt=ct;function Mt(t){T.call(this,t)}function xt(){this.qa=this.qa,this.ja=this.ja}_(Mt,T);var Lt=0;function Ft(t){if(!t.qa&&(t.qa=!0,t.va(),0!=Lt))t[e]||(t[e]=++i)}function Ut(t){return Ut[" "](t),t}xt.prototype.qa=!(Mt.prototype.name="cancel"),xt.prototype.va=function(){if(this.ja)for(;this.ja.length;)this.ja.shift()()},Ut[" "]=o;var qt,Vt,Bt=Z("Opera"),jt=Z("Trident")||Z("MSIE"),Wt=Z("Edge"),Qt=Wt||jt,Kt=Z("Gecko")&&!(Y(V.toLowerCase(),"webkit")&&!Z("Edge"))&&!(Z("Trident")||Z("MSIE"))&&!Z("Edge"),Ht=Y(V.toLowerCase(),"webkit")&&!Z("Edge");function Gt(){var t=l.document;return t?t.documentMode:void 0}t:{var zt="",Yt=(Vt=V,Kt?/rv:([^\);]+)(\)|;)/.exec(Vt):Wt?/Edge\/([\d\.]+)/.exec(Vt):jt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Vt):Ht?/WebKit\/(\S+)/.exec(Vt):Bt?/(?:Version)[ \/]?(\S+)/.exec(Vt):void 0);if(Yt&&(zt=Yt?Yt[1]:""),jt){var Xt=Gt();if(null!=Xt&&Xt>parseFloat(zt)){qt=String(Xt);break t}}qt=zt}var Jt,$t={};function Zt(s){return t=s,e=function(){for(var t=0,e=B(String(qt)).split("."),n=B(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||X(0==o[2].length,0==a[2].length)||X(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t},n=$t,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var te=l.document;Jt=te&&jt?Gt()||("CSS1Compat"==te.compatMode?parseInt(qt,10):5):void 0;var ee=Object.freeze||function(t){return t},ne=!jt||9<=Number(Jt),re=jt&&!Zt("9"),ie=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",o,e),l.removeEventListener("test",o,e)}catch(t){}return t}();function oe(t,e){this.type=t,this.b=this.target=e,this.Kb=!0}function ae(t,e){if(oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Kt){t:{try{Ut(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=c(t.pointerType)?t.pointerType:se[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}oe.prototype.preventDefault=function(){this.Kb=!1},_(ae,oe);var se=ee({2:"touch",3:"pen",4:"mouse"});ae.prototype.preventDefault=function(){ae.pb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,re)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},ae.prototype.f=function(){return this.a};var ue="closure_listenable_"+(1e6*Math.random()|0),ce=0;function he(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Ma=i,this.key=++ce,this.oa=this.Ia=!1}function le(t){t.oa=!0,t.listener=null,t.proxy=null,t.src=null,t.Ma=null}function fe(t){this.src=t,this.a={},this.b=0}function pe(t,e){var n=e.type;n in t.a&&L(t.a[n],e)&&(le(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function de(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.oa&&o.listener==e&&o.capture==!!n&&o.Ma==r)return i}return-1}fe.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=de(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new he(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var ye="closure_lm_"+(1e6*Math.random()|0),me={};function ge(t,e,n,r,i){if(r&&r.once)be(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)ge(t,e[o],n,r,i);else n=De(n),t&&t[ue]?ke(t,e,n,m(r)?!!r.capture:!!r,i):ve(t,e,n,!1,r,i)}function ve(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a,s,u=m(i)?!!i.capture:!!i,c=Ie(t);if(c||(t[ye]=c=new fe(t)),!(n=c.add(e,n,r,u,o)).proxy)if(a=Ce,r=s=ne?function(t){return a.call(s.src,s.listener,t)}:function(t){if(!(t=a.call(s.src,s.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)ie||(i=u),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ee(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function be(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)be(t,e[o],n,r,i);else n=De(n),t&&t[ue]?Re(t,e,n,m(r)?!!r.capture:!!r,i):ve(t,e,n,!0,r,i)}function we(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)we(t,e[o],n,r,i);else r=m(r)?!!r.capture:!!r,n=De(n),t&&t[ue]?(t=t.o,(e=String(e).toString())in t.a&&(-1<(n=de(o=t.a[e],n,r,i))&&(le(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=Ie(t))&&(e=t.a[e.toString()],t=-1,e&&(t=de(e,n,r,i)),(n=-1<t?e[t]:null)&&_e(n))}function _e(t){if("number"!=typeof t&&t&&!t.oa){var e=t.src;if(e&&e[ue])pe(e.o,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ee(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ie(e))?(pe(n,t),0==n.b&&(n.src=null,e[ye]=null)):le(t)}}}function Ee(t){return t in me?me[t]:me[t]="on"+t}function Te(t,e,n,r){var i=!0;if((t=Ie(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.oa&&(o=Se(o,r),i=i&&!1!==o)}return i}function Se(t,e){var n=t.listener,r=t.Ma||t.src;return t.Ia&&_e(t),n.call(r,e)}function Ce(t,e){if(t.oa)return!0;if(ne)return Se(t,new ae(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new ae(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Te(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Te(r[i],t,!1,e),n=n&&o}return n}function Ie(t){return(t=t[ye])instanceof fe?t:null}var Ne="__closure_events_fn_"+(1e9*Math.random()>>>0);function De(e){return a(e)?e:(e[Ne]||(e[Ne]=function(t){return e.handleEvent(t)}),e[Ne])}function Ae(){xt.call(this),this.o=new fe(this),(this.Rb=this).Wa=null}function ke(t,e,n,r,i){t.o.add(String(e),n,!1,r,i)}function Re(t,e,n,r,i){t.o.add(String(e),n,!0,r,i)}function Oe(t,e,n,r){if(!(e=t.o.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.oa&&a.capture==n){var s=a.listener,u=a.Ma||a.src;a.Ia&&pe(t.o,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Kb}function Pe(t,e,n){if(a(t))n&&(t=v(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function Me(n){var r=null;return new dt(function(t,e){-1==(r=Pe(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function xe(t){if(t.S&&"function"==typeof t.S)return t.S();if(c(t))return t.split("");if(y(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function Le(t){if(t.U&&"function"==typeof t.U)return t.U();if(!t.S||"function"!=typeof t.S){if(y(t)||c(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Fe)for(n=t.U(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ue(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)qe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}_(Ae,xt),Ae.prototype[ue]=!0,Ae.prototype.addEventListener=function(t,e,n,r){ge(this,t,e,n,r)},Ae.prototype.removeEventListener=function(t,e,n,r){we(this,t,e,n,r)},Ae.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Rb;var r=t.type||t;if(c(t))t=new oe(t,n);else if(t instanceof oe)t.target=t.target||n;else{var i=t;at(t=new oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=Oe(a,r,!0,t)&&i}if(i=Oe(a=t.b=n,r,!0,t)&&i,i=Oe(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Oe(a=t.b=e[o],r,!1,t)&&i;return i},Ae.prototype.va=function(){if(Ae.pb.va.call(this),this.o){var t,e=this.o;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)le(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=Fe.prototype).S=function(){Ue(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.U=function(){return Ue(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return qe(this.b,t)?this.b[t]:e},t.set=function(t,e){qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.U(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ve=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(t,e){if(this.b=this.o=this.c="",this.i=null,this.h=this.g="",this.f=!1,t instanceof Be){this.f=void 0!==e?e:t.f,je(this,t.c),this.o=t.o,this.b=t.b,We(this,t.i),this.g=t.g,e=t.a;var n=new rn;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Qe(this,n),this.h=t.h}else t&&(n=String(t).match(Ve))?(this.f=!!e,je(this,n[1]||"",!0),this.o=Ye(n[2]||""),this.b=Ye(n[3]||"",!0),We(this,n[4]),this.g=Ye(n[5]||"",!0),Qe(this,n[6]||"",!0),this.h=Ye(n[7]||"")):(this.f=!!e,this.a=new rn(null,this.f))}function je(t,e,n){t.c=n?Ye(e,!0):e,t.c&&(t.c=t.c.replace(/:$/,""))}function We(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Qe(t,e,n){var r,i;e instanceof rn?(t.a=e,r=t.a,(i=t.f)&&!r.f&&(on(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(sn(this,e),cn(this,n,t))},r)),r.f=i):(n||(e=Xe(e,en)),t.a=new rn(e,t.f))}function Ke(t,e,n){t.a.set(e,n)}function He(t,e){return t.a.get(e)}function Ge(t){return t instanceof Be?new Be(t):new Be(t,void 0)}function ze(t,e){var n=new Be(null,void 0);return je(n,"https"),t&&(n.b=t),e&&(n.g=e),n}function Ye(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Xe(t,e,n){return c(t)?(t=encodeURI(t).replace(e,Je),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Je(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Be.prototype.toString=function(){var t=[],e=this.c;e&&t.push(Xe(e,$e,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(Xe(e,$e,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.g)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Xe(n,"/"==n.charAt(0)?tn:Ze,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.h)&&t.push("#",Xe(n,nn)),t.join("")};var $e=/[#\/\?@]/g,Ze=/[#\?:]/g,tn=/[#\?]/g,en=/[#\?@]/g,nn=/#/g;function rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function on(n){n.a||(n.a=new Fe,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function an(t){var e=Le(t);if(void 0===e)throw Error("Keys are undefined");var n=new rn(null,void 0);t=xe(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?cn(n,i,o):n.add(i,o)}return n}function sn(t,e){on(t),e=hn(t,e),qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,qe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ue(t)))}function un(t,e){return on(t),e=hn(t,e),qe(t.a.b,e)}function cn(t,e,n){sn(t,e),0<n.length&&(t.c=null,t.a.set(hn(t,e),q(n)),t.b+=n.length)}function hn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=rn.prototype).add=function(t,e){on(this),this.c=null,t=hn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){on(this),this.a.forEach(function(t,e){O(t,function(t){n.call(r,t,e,this)},this)},this)},t.U=function(){on(this);for(var t=this.a.S(),e=this.a.U(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.S=function(t){on(this);var e=[];if(c(t))un(this,t)&&(e=U(e,this.a.get(hn(this,t))));else{t=this.a.S();for(var n=0;n<t.length;n++)e=U(e,t[n])}return e},t.set=function(t,e){return on(this),this.c=null,un(this,t=hn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.S(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.U(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.S(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var ln=!jt||9<=Number(Jt);function fn(t,e){this.a=t===yn&&e||"",this.b=dn}function pn(t){return t instanceof fn&&t.constructor===fn&&t.b===dn?t.a:(C("expected object of type Const, got '"+t+"'"),"type_error:Const")}fn.prototype.na=!0,fn.prototype.ma=function(){return this.a},fn.prototype.toString=function(){return"Const{"+this.a+"}"};var dn={},yn={};function mn(){this.a="",this.b=_n}function gn(t){return t instanceof mn&&t.constructor===mn&&t.b===_n?t.a:(C("expected object of type TrustedResourceUrl, got '"+t+"' of type "+h(t)),"type_error:TrustedResourceUrl")}function vn(t,n){var e,r,i=pn(t);if(!wn.test(i))throw Error("Invalid TrustedResourceUrl format: "+i);return t=i.replace(bn,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+i+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof fn?pn(t):encodeURIComponent(String(t))}),e=t,(r=new mn).a=e,r}mn.prototype.na=!0,mn.prototype.ma=function(){return this.a},mn.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var bn=/%{(\w+)}/g,wn=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,_n={};function En(){this.a="",this.b=In}function Tn(t){return t instanceof En&&t.constructor===En&&t.b===In?t.a:(C("expected object of type SafeUrl, got '"+t+"' of type "+h(t)),"type_error:SafeUrl")}En.prototype.na=!0,En.prototype.ma=function(){return this.a},En.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Sn=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function Cn(t){return t instanceof En?t:(t="object"==typeof t&&t.na?t.ma():String(t),Sn.test(t)||(t="about:invalid#zClosurez"),Nn(t))}var In={};function Nn(t){var e=new En;return e.a=t,e}function Dn(){this.a="",this.b=An}Nn("about:blank"),Dn.prototype.na=!0,Dn.prototype.ma=function(){return this.a},Dn.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var An={};function kn(t){var e=new Dn;return e.a=t,e}function Rn(t){var e=document;return c(t)?e.getElementById(t):t}function On(n,t){tt(t,function(t,e){t&&"object"==typeof t&&t.na&&(t=t.ma()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:Pn.hasOwnProperty(e)?n.setAttribute(Pn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}kn("<!DOCTYPE html>"),kn(""),kn("<br>");var Pn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Mn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!ln&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',ut(a.name),'"'),a.type){o.push(' type="',ut(a.type),'"');var s={};at(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(c(a)?o.className=a:d(a)?o.className=a.join(" "):On(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(c(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!y(o)||m(o)&&0<o.nodeType?r(o):O(xn(o)?q(o):o,r)}}(i,o,r),o}function xn(t){if(t&&"number"==typeof t.length){if(m(t))return"function"==typeof t.item||"string"==typeof t.item;if(a(t))return"function"==typeof t.item}return!1}function Ln(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Vn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Vn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Fn,t,e),e.join("")}function Fn(){}var Un={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},qn=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Vn(t,e){e.push('"',t.replace(qn,function(t){var e=Un[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Un[t]=e),e}),'"')}function Bn(){var t=ar();return jt&&!!Jt&&11==Jt||/Edge\/\d+/.test(t)}function jn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function Wn(t,e){e=e||l.window;var n="about:blank";t&&(n=Tn(Cn(t))),e.location.href=n}function Qn(t){return!!((t=(t||ar()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function Kn(t){t=t||l.window;try{t.close()}catch(t){}}function Hn(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(s in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=ar().toLowerCase(),r&&(e.target=r,Y(n,"crios/")&&(e.target="_blank")),rr(ar())==er&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof En?n:Cn(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(s){case"width":case"height":case"top":case"left":i.push(s+"="+t[s]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(s+"="+(t[s]?1:0))}var a,s=i.join(",");if((Z("iPhone")&&!Z("iPod")&&!Z("iPad")||Z("iPad")||Z("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(s=r.document.createElement("A"),e instanceof En||e instanceof En||(e="object"==typeof e&&e.na?e.ma():String(e),Sn.test(e)||(e="about:invalid#zClosurez"),e=Nn(e)),s.href=Tn(e),s.setAttribute("target",n),t.noreferrer&&s.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),s.dispatchEvent(t),s={}):t.noreferrer?(s=r.open("",n,s),t=Tn(e),s&&(Qt&&Y(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),s.opener=null,t=kn('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+ut(t)+'">'),s.document.write((a=t)instanceof Dn&&a.constructor===Dn&&a.b===An?a.a:(C("expected object of type SafeHtml, got '"+a+"' of type "+h(a)),"type_error:SafeHtml")),s.document.close())):(s=r.open(Tn(e),n,s))&&t.noopener&&(s.opener=null),s)try{s.focus()}catch(t){}return s}var Gn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,zn=/^[^@]+@[^@]+$/;function Yn(){var e=null;return new dt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},be(window,"load",e))}).s(function(t){throw we(window,"load",e),t})}function Xn(t){return t=t||ar(),!("file:"!==lr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function Jn(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function $n(){return"object"!=typeof l.window&&"function"==typeof l.importScripts}function Zn(){return Fh.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":Fh.INTERNAL.hasOwnProperty("node")?"Node":$n()?"Worker":"Browser"}function tr(){var t=Zn();return"ReactNative"===t||"Node"===t}var er="Firefox",nr="Chrome";function rr(t){var e=t.toLowerCase();return Y(e,"opera/")||Y(e,"opr/")||Y(e,"opios/")?"Opera":Y(e,"iemobile")?"IEMobile":Y(e,"msie")||Y(e,"trident/")?"IE":Y(e,"edge/")?"Edge":Y(e,"firefox/")?er:Y(e,"silk/")?"Silk":Y(e,"blackberry")?"Blackberry":Y(e,"webos")?"Webos":!Y(e,"safari/")||Y(e,"chrome/")||Y(e,"crios/")||Y(e,"android")?!Y(e,"chrome/")&&!Y(e,"crios/")||Y(e,"edge/")?Y(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":nr:"Safari"}var ir={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function or(t,e){e=e||[];var n,r=[],i={};for(n in ir)i[ir[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=Zn())?r=rr(i=ar()):"Worker"===r&&(r=rr(i=ar())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function ar(){return l.navigator&&l.navigator.userAgent||""}function sr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function ur(){try{var t=l.localStorage,e=mr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Bn()||!!l.indexedDB}catch(t){return $n()&&!!l.indexedDB}return!1}function cr(){return(hr()||"chrome-extension:"===lr()||Xn())&&!tr()&&ur()&&!$n()}function hr(){return"http:"===lr()||"https:"===lr()}function lr(){return l.location&&l.location.protocol||null}function fr(t){return!Qn(t=t||ar())&&rr(t)!=er}function pr(t){return void 0===t?null:Ln(t)}function dr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function yr(t){if(null!==t)return JSON.parse(t)}function mr(t){return t||Math.floor(1e9*Math.random()).toString()}function gr(t){return"Safari"!=rr(t=t||ar())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function vr(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function br(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=ar(),e=Zn(),this.b=Qn(t)||"ReactNative"===e}function wr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function _r(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Er(){return!(!sr("fireauth.oauthhelper",l)&&!sr("fireauth.iframe",l))}br.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!hr()&&"chrome-extension:"!==lr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Tr,Sr={};function Cr(t){Sr[t]||(Sr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Ir={};Object.defineProperty(Ir,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Ir,"abcd",{configurable:!0,enumerable:!0,value:2}),Tr=2==Ir.abcd}catch(t){Tr=!1}function Nr(t,e,n){Tr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Dr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Nr(t,n,e[n])}function Ar(t){var e={};return Dr(e,t),e}function kr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Nr(e,n,kr(t[n]));return e}function Rr(t){var e={},n=t[Pr],r=t[Mr];if(!(t=t[xr])||t!=Or&&!n)throw Error("Invalid provider user info!");e[Fr]=r||null,e[Lr]=n||null,Nr(this,qr,t),Nr(this,Ur,kr(e))}var Or="EMAIL_SIGNIN",Pr="email",Mr="newEmail",xr="requestType",Lr="email",Fr="fromEmail",Ur="data",qr="operation";function Vr(t,e){this.code=jr+t,this.message=e||Wr[t]||""}function Br(t){var e=t&&t.code;return e?new Vr(e.substring(jr.length),t.message):null}_(Vr,Error),Vr.prototype.C=function(){return{code:this.code,message:this.message}},Vr.prototype.toJSON=function(){return this.C()};var jr="auth/",Wr={"argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Qr(t){var e=t[Yr];if(void 0===e)throw new Vr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Vr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[Kr];if(n&&"object"==typeof n){e=n[$r];var r=n[Xr];if(n=n[Jr],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Vr("argument-error",Xr+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Vr("argument-error",Jr+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Vr("argument-error",$r+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Vr("missing-android-pkg-name")}}else if(void 0!==n)throw new Vr("argument-error",Kr+" property must be a non null object when specified.");if(this.f=null,(e=t[zr])&&"object"==typeof e){if("string"==typeof(e=e[Zr])&&e.length)this.f=e;else if(void 0!==e)throw new Vr("argument-error",Zr+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Vr("argument-error",zr+" property must be a non null object when specified.");if(void 0!==(e=t[Gr])&&"boolean"!=typeof e)throw new Vr("argument-error",Gr+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[Hr])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Vr("argument-error",Hr+" property must be a non empty string when specified.");this.i=t||null}var Kr="android",Hr="dynamicLinkDomain",Gr="handleCodeInApp",zr="iOS",Yr="url",Xr="installApp",Jr="minimumVersion",$r="packageName",Zr="bundleId";function ti(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var ei=null,ni=null;function ri(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=ni[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!ei){ei={},ni={};for(var t=0;t<65;t++)ei[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(ni[ei[t]]=t)&&(ni["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function ii(t){this.c=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function oi(t){return(t=ai(t))&&t.sub&&t.iss&&t.aud&&t.exp?new ii(t):null}function ai(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(ri(t))}catch(t){}return null}ii.prototype.f=function(){return this.b};var si,ui={bd:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",jb:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",jb:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function ci(t){for(var e in ui)if(ui[e].id===t)return{firebaseEndpoint:(t=ui[e]).bb,secureTokenEndpoint:t.jb};return null}si=ci("__EID__")?"__EID__":void 0;var hi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),li=["client_id","response_type","scope","redirect_uri","state"],fi={Xc:{Na:"locale",Ba:500,Aa:600,Oa:"facebook.com",ib:li},Zc:{Na:null,Ba:500,Aa:620,Oa:"github.com",ib:li},$c:{Na:"hl",Ba:515,Aa:680,Oa:"google.com",ib:li},fd:{Na:"lang",Ba:485,Aa:705,Oa:"twitter.com",ib:hi}};function pi(t){for(var e in fi)if(fi[e].Oa==t)return fi[e];return null}function di(t){var e={};e["facebook.com"]=bi,e["google.com"]=_i,e["github.com"]=wi,e["twitter.com"]=Ei;var n=t&&t[mi];try{if(n)return e[n]?new e[n](t):new vi(t);if(void 0!==t[yi])return new gi(t)}catch(t){}return null}var yi="idToken",mi="providerId";function gi(t){var e=t[mi];if(!e&&t[yi]){var n=oi(t[yi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Nr(this,"providerId",e),Nr(this,"isNewUser",n)}function vi(t){gi.call(this,t),Nr(this,"profile",kr((t=yr(t.rawUserInfo||"{}"))||{}))}function bi(t){if(vi.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function wi(t){if(vi.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Nr(this,"username",this.profile&&this.profile.login||null)}function _i(t){if(vi.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ei(t){if(vi.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Nr(this,"username",t.screenName||null)}function Ti(t){this.a=Ge(t)}function Si(t){var e=Ge(t),n=He(e,"link"),r=He(Ge(n),"link");return He(Ge(e=He(e,"deep_link_id")),"link")||e||r||n||t}function Ci(t,n){return t.then(function(t){if(t[ha]){var e=oi(t[ha]);if(!e||n!=e.c)throw new Vr("user-mismatch");return t}throw new Vr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==jr+"user-not-found"?new Vr("user-mismatch"):t})}function Ii(t,e){if(!e)throw new Vr("internal-error","failed to construct a credential");this.a=e,Nr(this,"providerId",t),Nr(this,"signInMethod",t)}function Ni(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Di(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Nr(this,"idToken",e.idToken),e.accessToken&&Nr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Nr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Vr("internal-error","failed to construct a credential");Nr(this,"accessToken",e.oauthToken),Nr(this,"secret",e.oauthTokenSecret)}Nr(this,"providerId",t),Nr(this,"signInMethod",n)}function Ai(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:an(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function ki(t,e){this.Fc=e||[],Dr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(pi(t)||{}).Na||null,this.ab=null}function Ri(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Vr("argument-error",'SAML provider IDs must be prefixed with "saml."');ki.call(this,t,[])}function Oi(t){ki.call(this,t,li),this.a=[]}function Pi(){Oi.call(this,"facebook.com")}function Mi(t){if(!t)throw new Vr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return m(t)&&(e=t.accessToken),(new Pi).credential(null,e)}function xi(){Oi.call(this,"github.com")}function Li(t){if(!t)throw new Vr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return m(t)&&(e=t.accessToken),(new xi).credential(null,e)}function Fi(){Oi.call(this,"google.com"),this.ua("profile")}function Ui(t,e){var n=t;return m(t)&&(n=t.idToken,e=t.accessToken),(new Fi).credential(n,e)}function qi(){ki.call(this,"twitter.com",hi)}function Vi(t,e){var n=t;if(m(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Vr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Di("twitter.com",n,"twitter.com")}function Bi(t,e,n){this.a=t,this.c=e,Nr(this,"providerId","password"),Nr(this,"signInMethod",n===ji.EMAIL_LINK_SIGN_IN_METHOD?ji.EMAIL_LINK_SIGN_IN_METHOD:ji.EMAIL_PASSWORD_SIGN_IN_METHOD)}function ji(){Dr(this,{providerId:"password",isOAuthProvider:!1})}function Wi(t,e){if(!(e=Qi(e)))throw new Vr("argument-error","Invalid email link!");return new Bi(t,e,ji.EMAIL_LINK_SIGN_IN_METHOD)}function Qi(t){var e=He((t=new Ti(t=Si(t))).a,"oobCode")||null;return"signIn"===(He(t.a,"mode")||null)&&e?e:null}function Ki(t){if(!(t.Ua&&t.Ta||t.Fa&&t.$))throw new Vr("internal-error");this.a=t,Nr(this,"providerId","phone"),Nr(this,"signInMethod","phone")}function Hi(t){return t.a.Fa&&t.a.$?{temporaryProof:t.a.Fa,phoneNumber:t.a.$}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function Gi(t){try{this.a=t||Fh.auth()}catch(t){throw new Vr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Dr(this,{providerId:"phone",isOAuthProvider:!1})}function zi(t,e){if(!t)throw new Vr("missing-verification-id");if(!e)throw new Vr("missing-verification-code");return new Ki({Ua:t,Ta:e})}function Yi(t){if(t.temporaryProof&&t.phoneNumber)return new Ki({Fa:t.temporaryProof,$:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return Ui(o,n);case"facebook.com":return Mi(n);case"github.com":return Li(n);case"twitter.com":return Vi(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ii(e,a):new Di(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new Oi(e).credential(o,n,i):null}}catch(t){return null}}function Xi(t){if(!t.isOAuthProvider)throw new Vr("invalid-oauth-provider")}function Ji(t,e,n,r,i,o){if(this.b=t,this.c=e||null,this.f=n||null,this.g=r||null,this.h=o||null,this.a=i||null,!this.f&&!this.a)throw new Vr("invalid-auth-event");if(this.f&&this.a)throw new Vr("invalid-auth-event");if(this.f&&!this.g)throw new Vr("invalid-auth-event")}function $i(t){return(t=t||{}).type?new Ji(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Br(t.error),t.postBody):null}function Zi(){this.b=null,this.a=[]}_(vi,gi),_(bi,vi),_(wi,vi),_(_i,vi),_(Ei,vi),Ii.prototype.la=function(t){return Da(t,Ni(this))},Ii.prototype.b=function(t,e){var n=Ni(this);return n.idToken=e,Aa(t,n)},Ii.prototype.f=function(t,e){return Ci(ka(t,Ni(this)),e)},Ii.prototype.C=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Di.prototype.la=function(t){return Da(t,Ai(this))},Di.prototype.b=function(t,e){var n=Ai(this);return n.idToken=e,Aa(t,n)},Di.prototype.f=function(t,e){return Ci(ka(t,Ai(this)),e)},Di.prototype.C=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},ki.prototype.Da=function(t){return this.zb=nt(t),this},_(Ri,ki),_(Oi,ki),Oi.prototype.ua=function(t){return x(this.a,t)||this.a.push(t),this},Oi.prototype.Fb=function(){return q(this.a)},Oi.prototype.credential=function(t,e,n){if(!t&&!e)throw new Vr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Di(this.providerId,{idToken:t||null,accessToken:e||null,nonce:n||null},this.providerId)},_(Pi,Oi),Nr(Pi,"PROVIDER_ID","facebook.com"),Nr(Pi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),_(xi,Oi),Nr(xi,"PROVIDER_ID","github.com"),Nr(xi,"GITHUB_SIGN_IN_METHOD","github.com"),_(Fi,Oi),Nr(Fi,"PROVIDER_ID","google.com"),Nr(Fi,"GOOGLE_SIGN_IN_METHOD","google.com"),_(qi,ki),Nr(qi,"PROVIDER_ID","twitter.com"),Nr(qi,"TWITTER_SIGN_IN_METHOD","twitter.com"),Bi.prototype.la=function(t){return this.signInMethod==ji.EMAIL_LINK_SIGN_IN_METHOD?os(t,Ua,{email:this.a,oobCode:this.c}):os(t,es,{email:this.a,password:this.c})},Bi.prototype.b=function(t,e){return this.signInMethod==ji.EMAIL_LINK_SIGN_IN_METHOD?os(t,qa,{idToken:e,email:this.a,oobCode:this.c}):os(t,Ya,{idToken:e,email:this.a,password:this.c})},Bi.prototype.f=function(t,e){return Ci(this.la(t),e)},Bi.prototype.C=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Dr(ji,{PROVIDER_ID:"password"}),Dr(ji,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Dr(ji,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Ki.prototype.la=function(t){return t.Va(Hi(this))},Ki.prototype.b=function(t,e){var n=Hi(this);return n.idToken=e,os(t,rs,n)},Ki.prototype.f=function(t,e){var n=Hi(this);return n.operation="REAUTH",Ci(t=os(t,is,n),e)},Ki.prototype.C=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.$&&(t.phoneNumber=this.a.$),t},Gi.prototype.Va=function(r,i){var o=this.a.b;return _t(i.verify()).then(function(t){if(!c(t))throw new Vr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(i.type){case"recaptcha":return(e=o,n={phoneNumber:r,recaptchaToken:t},os(e,Ga,n)).then(function(t){return"function"==typeof i.reset&&i.reset(),t},function(t){throw"function"==typeof i.reset&&i.reset(),t});default:throw new Vr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}var e,n})},Dr(Gi,{PROVIDER_ID:"phone"}),Dr(Gi,{PHONE_SIGN_IN_METHOD:"phone"}),Ji.prototype.C=function(){return{type:this.b,eventId:this.c,urlResponse:this.f,sessionId:this.g,postBody:this.h,error:this.a&&this.a.C()}};var to,eo=null;function no(t){var e="unauthorized-domain",n=void 0,r=Ge(t);t=r.b,"chrome-extension"==(r=r.c)?n=st("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=st("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Vr.call(this,e,n)}function ro(t,e,n){Vr.call(this,t,n),(t=e||{}).Ab&&Nr(this,"email",t.Ab),t.$&&Nr(this,"phoneNumber",t.$),t.credential&&Nr(this,"credential",t.credential)}function io(t){if(t.code){var e=t.code||"";0==e.indexOf(jr)&&(e=e.substring(jr.length));var n={credential:Yi(t)};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.$=t.phoneNumber;else if(!n.credential)return new Vr(e,t.message||void 0);return new ro(e,n,t.message)}return null}function oo(){}function ao(t){return t.c||(t.c=t.b())}function so(){}function uo(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function co(){}function ho(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=v(this.fc,this),this.a.onerror=v(this.Gb,this),this.a.onprogress=v(this.gc,this),this.a.ontimeout=v(this.kc,this)}function lo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function fo(t,e,n){this.reset(t,e,n,void 0,void 0)}function po(t){this.f=t,this.b=this.c=this.a=null}function yo(t,e){this.name=t,this.value=e}Zi.prototype.subscribe=function(t){var n=this;this.a.push(t),this.b||(this.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=sr("universalLinks.subscribe",l))&&t(null,this.b))},Zi.prototype.unsubscribe=function(e){F(this.a,function(t){return t==e})},_(no,Vr),_(ro,Vr),ro.prototype.C=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber);var e=this.credential&&this.credential.C();return e&&at(t,e),t},ro.prototype.toJSON=function(){return this.C()},oo.prototype.c=null,_(so,oo),so.prototype.a=function(){var t=uo(this);return t?new ActiveXObject(t):new XMLHttpRequest},so.prototype.b=function(){var t={};return uo(this)&&(t[0]=!0,t[1]=!0),t},to=new so,_(co,oo),co.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new ho;throw Error("Unsupported browser")},co.prototype.b=function(){return{}},(t=ho.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,lo(this,4)},t.Gb=function(){this.status=500,this.response=this.responseText="",lo(this,4)},t.kc=function(){this.Gb()},t.gc=function(){this.status=200,lo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},fo.prototype.a=null,fo.prototype.reset=function(t,e,n,r,i){delete this.a},yo.prototype.toString=function(){return this.name};var mo=new yo("SEVERE",1e3),go=new yo("WARNING",900),vo=new yo("CONFIG",700),bo=new yo("FINE",500);po.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(C("Root logger has no level set."),null)}(this).value)for(a(e)&&(e=e()),t=new fo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var wo,_o={},Eo=null;function To(t){var e;if(Eo||(Eo=new po(""),(_o[""]=Eo).c=vo),!(e=_o[t])){e=new po(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=To(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,_o[t]=e}return e}function So(t,e){t&&t.log(bo,e,void 0)}function Co(t){this.f=t}function Io(t){Ae.call(this),this.u=t,this.readyState=No,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=To("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}_(Co,oo),Co.prototype.a=function(){return new Io(this.f)},Co.prototype.b=(wo={},function(){return wo}),_(Io,Ae);var No=0;function Do(t){t.c.read().then(t.ec.bind(t)).catch(t.La.bind(t))}function Ao(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,ko(t)}function ko(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ro(t){Ae.call(this),this.headers=new Fe,this.D=t||null,this.c=!1,this.w=this.a=null,this.h=this.N=this.l="",this.f=this.I=this.i=this.G=!1,this.g=0,this.u=null,this.m=Oo,this.v=this.O=!1}(t=Io.prototype).open=function(t,e){if(this.readyState!=No)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,ko(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.La.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Ao(this,!1)),this.readyState=No},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,ko(this)),this.a&&(this.readyState=3,ko(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.La.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Do(this)):t.text().then(this.ic.bind(this),this.La.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Ao(this,!0):ko(this),3==this.readyState&&Do(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Ao(this,!0))},t.hc=function(t){this.a&&(this.response=t,Ao(this,!0))},t.La=function(t){var e=this.h;e&&e.log(go,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Ao(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(go,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(go,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},_(Ro,Ae);var Oo="";Ro.prototype.b=To("goog.net.XhrIo");var Po=/^https?$/i,Mo=["POST","PUT"];function xo(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.N=n,e.G=!1,e.c=!0,e.a=e.D?e.D.a():to.a(),e.w=e.D?ao(e.D):ao(to),e.a.onreadystatechange=v(e.Jb,e);try{So(e.b,Qo(e,"Opening Xhr")),e.I=!0,e.a.open(n,String(t),!0),e.I=!1}catch(t){return So(e.b,Qo(e,"Error opening Xhr: "+t.message)),void Fo(e,t)}t=r||"";var o,a=new Fe(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(y(t)||c(t))O(t,e,void 0);else for(var n=Le(t),r=xe(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){a.set(e,t)}),i=function(t){t:{for(var e=Lo,n=t.length,r=c(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:c(t)?t.charAt(e):t[e]}(a.U()),r=l.FormData&&t instanceof l.FormData,!x(Mo,n)||i||r||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.O&&(e.a.withCredentials=e.O);try{Bo(e),0<e.g&&(e.v=(o=e.a,jt&&Zt(9)&&"number"==typeof o.timeout&&void 0!==o.ontimeout),So(e.b,Qo(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=v(e.Ga,e)):e.u=Pe(e.Ga,e.g,e)),So(e.b,Qo(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){So(e.b,Qo(e,"Send error: "+t.message)),Fo(e,t)}}function Lo(t){return"content-type"==t.toLowerCase()}function Fo(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,Uo(t),Vo(t)}function Uo(t){t.G||(t.G=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function qo(e){if(e.c&&void 0!==u)if(e.w[1]&&4==jo(e)&&2==Wo(e))So(e.b,Qo(e,"Local request error detected and ignored"));else if(e.i&&4==jo(e))Pe(e.Jb,0,e);else if(e.dispatchEvent("readystatechange"),4==jo(e)){So(e.b,Qo(e,"Request complete")),e.c=!1;try{var t,n=Wo(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(Ve)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!Po.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<jo(e)?e.a.statusText:""}catch(t){So(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+Wo(e)+"]",Uo(e)}}finally{Vo(e)}}}function Vo(e,t){if(e.a){Bo(e);var n=e.a,r=e.w[0]?o:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(mo,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function Bo(t){t.a&&t.v&&(t.a.ontimeout=null),t.u&&(l.clearTimeout(t.u),t.u=null)}function jo(t){return t.a?t.a.readyState:0}function Wo(t){try{return 2<jo(t)?t.a.status:-1}catch(t){return-1}}function Qo(t,e){return e+" ["+t.N+" "+t.l+" "+Wo(t)+"]"}function Ko(t){var e=na;this.g=[],this.v=e,this.u=t||null,this.f=this.a=!1,this.c=void 0,this.l=this.w=this.i=!1,this.h=0,this.b=null,this.o=0}function Ho(t,e,n){t.a=!0,t.c=n,t.f=!e,Xo(t)}function Go(t){if(t.a){if(!t.l)throw new Jo(t);t.l=!1}}function zo(t,e,n,r){t.g.push([e,n,r]),t.a&&Xo(t)}function Yo(t){return M(t.g,function(t){return a(t[1])})}function Xo(e){if(e.h&&e.a&&Yo(e)){var n=e.h,r=ta[n];r&&(l.clearTimeout(r.a),delete ta[n]),e.h=0}e.b&&(e.b.o--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.u,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(E(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,Yo(e)||(r=!0)}}e.c=n,t&&(s=v(e.m,e,!0),t=v(e.m,e,!1),n instanceof Ko?(zo(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new Zo(n),ta[n.a]=n,e.h=n.a)}function Jo(){T.call(this)}function $o(){T.call(this)}function Zo(t){this.a=l.setTimeout(v(this.c,this),0),this.b=t}(t=Ro.prototype).Ga=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",So(this.b,Qo(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(So(this.b,Qo(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Vo(this))},t.va=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Vo(this,!0)),Ro.pb.va.call(this)},t.Jb=function(){this.qa||(this.I||this.i||this.f?qo(this):this.yc())},t.yc=function(){qo(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case Oo:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(mo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return So(this.b,"Can not get response: "+t.message),null}},Ko.prototype.cancel=function(t){if(this.a)this.c instanceof Ko&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.o--,e.o<=0&&e.cancel())}this.v?this.v.call(this.u,this):this.l=!0,this.a||(t=new $o(this),Go(this),Ho(this,!1,t))}},Ko.prototype.m=function(t,e){this.i=!1,Ho(this,t,e)},Ko.prototype.then=function(t,e,n){var r,i,o=new dt(function(t,e){r=t,i=e});return zo(this,r,function(t){t instanceof $o?o.cancel():i(t)}),o.then(t,e,n)},Ko.prototype.$goog_Thenable=!0,_(Jo,T),Jo.prototype.message="Deferred has already fired",Jo.prototype.name="AlreadyCalledError",_($o,T),$o.prototype.message="Deferred was canceled",$o.prototype.name="CanceledError",Zo.prototype.c=function(){throw delete ta[this.a],this.b};var ta={};function ea(t){var e,n,r,i,o,a=document,s=gn(t),u=document.createElement("SCRIPT"),c={Lb:u,Ga:void 0},h=new Ko(c);return e=window.setTimeout(function(){ra(u,!0);var t=new aa(oa,"Timeout reached for loading script "+s);Go(h),Ho(h,!1,t)},5e3),c.Ga=e,u.onload=u.onreadystatechange=function(){u.readyState&&"loaded"!=u.readyState&&"complete"!=u.readyState||(ra(u,!1,e),Go(h),Ho(h,!0,null))},u.onerror=function(){ra(u,!0,e);var t=new aa(ia,"Error while loading script "+s);Go(h),Ho(h,!1,t)},at(c={},{type:"text/javascript",charset:"UTF-8"}),On(u,c),r=t,(n=u).src=gn(r),null===p&&(p=(r=(r=l.document).querySelector&&r.querySelector("script[nonce]"))&&(r=r.nonce||r.getAttribute("nonce"))&&f.test(r)?r:""),(r=p)&&n.setAttribute("nonce",r),(i=a,(o=(i||document).getElementsByTagName("HEAD"))&&0!=o.length?o[0]:i.documentElement).appendChild(u),h}function na(){if(this&&this.Lb){var t=this.Lb;t&&"SCRIPT"==t.tagName&&ra(t,!0,this.Ga)}}function ra(t,e,n){null!=n&&l.clearTimeout(n),t.onload=o,t.onerror=o,t.onreadystatechange=o,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var ia=0,oa=1;function aa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),T.call(this,n),this.code=t}function sa(t){this.f=t}function ua(t,e,n){if(this.b=t,t=e||{},this.i=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.o=t.secureTokenTimeout||la,this.f=nt(t.secureTokenHeaders||fa),this.g=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.h=t.firebaseTimeout||pa,this.a=nt(t.firebaseHeaders||da),n&&(this.a["X-Client-Version"]=n,this.f["X-Client-Version"]=n),n="Node"==Zn(),!(n=l.XMLHttpRequest||n&&Fh.INTERNAL.node&&Fh.INTERNAL.node.XMLHttpRequest)&&!$n())throw new Vr("internal-error","The XMLHttpRequest compatibility library was not found.");this.c=void 0,$n()?this.c=new Co(self):tr()?this.c=new sa(n):this.c=new co}_(aa,T),_(sa,oo),sa.prototype.a=function(){return new this.f},sa.prototype.b=function(){return{}};var ca,ha="idToken",la=new br(3e4,6e4),fa={"Content-Type":"application/x-www-form-urlencoded"},pa=new br(3e4,6e4),da={"Content-Type":"application/json"};function ya(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function ma(t,e){e?(t.a["X-Client-Version"]=e,t.f["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.f["X-Client-Version"])}function ga(t,e,n,r,i,o,a){var s;(t=!((s=rr(s=ar())!=nr?null:(s=s.match(/\sChrome\/(\d+)/i))&&2==s.length?parseInt(s[1],10):null)&&s<30||jt&&Jt&&!(9<Jt))||$n()?v(t.m,t):(ca||(ca=new dt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=vn(va,{onload:ba});zo(ea(n),null,function(){e(Error("CORS_UNSUPPORTED"))},void 0)}}(t,e)})),v(t.l,t)))(e,n,r,i,o,a)}ua.prototype.m=function(t,n,e,r,i,o){if($n()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Vr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Ro(this.c);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}ke(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return So(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),Re(a,"ready",function(){s&&clearTimeout(s),Ft(this)}),Re(a,"timeout",function(){s&&clearTimeout(s),Ft(this),n&&n(null)}),xo(a,t,e,r,i)};var va=new fn(yn,"https://apis.google.com/js/client.js?onload=%{onload}"),ba="__fcb"+Math.floor(1e6*Math.random()).toString();function wa(t){if(!c(t=t.email)||!zn.test(t))throw new Vr("invalid-email")}function _a(t){"email"in t&&wa(t)}function Ea(t){if(!t[ha])throw new Vr("internal-error")}function Ta(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Vr("internal-error")}else{if(!t.sessionInfo)throw new Vr("missing-verification-id");if(!t.code)throw new Vr("missing-verification-code")}}ua.prototype.l=function(t,n,r,i,o){var a=this;ca.then(function(){window.gapi.client.setApiKey(a.b);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},ua.prototype.Ra=function(){return os(this,Xa,{})},ua.prototype.qb=function(t,e){return os(this,za,{idToken:t,email:e})},ua.prototype.rb=function(t,e){return os(this,Ya,{idToken:t,password:e})};var Sa={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ca(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Vr("internal-error")}function Ia(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(un(t=new rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Na(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=io(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=io(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=io(t)):t.errorMessage&&(e=as(t.errorMessage)),e)throw e;if(!t[ha])throw new Vr("internal-error")}function Da(t,e){return e.returnIdpCredential=!0,os(t,Ja,e)}function Aa(t,e){return e.returnIdpCredential=!0,os(t,Za,e)}function ka(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,os(t,$a,e)}function Ra(t){if(!t.oobCode)throw new Vr("invalid-action-code")}(t=ua.prototype).sb=function(t,r){var i={idToken:t},o=[];return tt(Sa,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),os(this,za,i)},t.lb=function(t,e){return at(t={requestType:"PASSWORD_RESET",email:t},e),os(this,Wa,t)},t.mb=function(t,e){return at(t={requestType:"EMAIL_SIGNIN",email:t},e),os(this,Ba,t)},t.kb=function(t,e){return at(t={requestType:"VERIFY_EMAIL",idToken:t},e),os(this,ja,t)},t.Va=function(t){return os(this,ns,t)},t.$a=function(t,e){return os(this,Ha,{oobCode:t,newPassword:e})},t.Ja=function(t){return os(this,Pa,{oobCode:t})},t.Xa=function(t){return os(this,Oa,{oobCode:t})};var Oa={endpoint:"setAccountInfo",B:Ra,da:"email"},Pa={endpoint:"resetPassword",B:Ra,J:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Vr("internal-error")}},Ma={endpoint:"signupNewUser",B:function(t){if(wa(t),!t.password)throw new Vr("weak-password")},J:Ea,R:!0},xa={endpoint:"createAuthUri"},La={endpoint:"deleteAccount",T:["idToken"]},Fa={endpoint:"setAccountInfo",T:["idToken","deleteProvider"],B:function(t){if(!d(t.deleteProvider))throw new Vr("internal-error")}},Ua={endpoint:"emailLinkSignin",T:["email","oobCode"],B:wa,J:Ea,R:!0},qa={endpoint:"emailLinkSignin",T:["idToken","email","oobCode"],B:wa,J:Ea,R:!0},Va={endpoint:"getAccountInfo"},Ba={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Vr("internal-error");wa(t)},da:"email"},ja={endpoint:"getOobConfirmationCode",T:["idToken","requestType"],B:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Vr("internal-error")},da:"email"},Wa={endpoint:"getOobConfirmationCode",T:["requestType"],B:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Vr("internal-error");wa(t)},da:"email"},Qa={vb:!0,endpoint:"getProjectConfig",Ib:"GET"},Ka={vb:!0,endpoint:"getRecaptchaParam",Ib:"GET",J:function(t){if(!t.recaptchaSiteKey)throw new Vr("internal-error")}},Ha={endpoint:"resetPassword",B:Ra,da:"email"},Ga={endpoint:"sendVerificationCode",T:["phoneNumber","recaptchaToken"],da:"sessionInfo"},za={endpoint:"setAccountInfo",T:["idToken"],B:_a,R:!0},Ya={endpoint:"setAccountInfo",T:["idToken"],B:function(t){if(_a(t),!t.password)throw new Vr("weak-password")},J:Ea,R:!0},Xa={endpoint:"signupNewUser",J:Ea,R:!0},Ja={endpoint:"verifyAssertion",B:Ca,Pa:Ia,J:Na,R:!0},$a={endpoint:"verifyAssertion",B:Ca,Pa:Ia,J:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Vr("user-not-found");if(t.errorMessage)throw as(t.errorMessage);if(!t[ha])throw new Vr("internal-error")},R:!0},Za={endpoint:"verifyAssertion",B:function(t){if(Ca(t),!t.idToken)throw new Vr("internal-error")},Pa:Ia,J:Na,R:!0},ts={endpoint:"verifyCustomToken",B:function(t){if(!t.token)throw new Vr("invalid-custom-token")},J:Ea,R:!0},es={endpoint:"verifyPassword",B:function(t){if(wa(t),!t.password)throw new Vr("wrong-password")},J:Ea,R:!0},ns={endpoint:"verifyPhoneNumber",B:Ta,J:Ea},rs={endpoint:"verifyPhoneNumber",B:function(t){if(!t.idToken)throw new Vr("internal-error");Ta(t)},J:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",io(t);Ea(t)}},is={Xb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",B:Ta,J:Ea};function os(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.T))return Et(new Vr("internal-error"));var r,i=e.Ib||"POST";return _t(n).then(e.B).then(function(){return e.R&&(n.returnSecureToken=!0),function(t,e,r,i,o,n){var a=Ge(t.g+e);Ke(a,"key",t.b),n&&Ke(a,"cb",w().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&Ke(a,u,i[u]);return new dt(function(e,n){ga(t,a.toString(),function(t){t?t.error?n(ss(t,o||{})):e(t):n(new Vr("network-request-failed"))},r,s?void 0:Ln(dr(i)),t.a,t.h.get())})}(t,e.endpoint,i,n,e.Xb,e.vb||!1)}).then(function(t){return r=t,e.Pa?e.Pa(n,r):r}).then(e.J).then(function(){if(!e.da)return r;if(!(e.da in r))throw new Vr("internal-error");return r[e.da]})}function as(t){return ss({error:{errors:[{message:t}],code:400,message:t}})}function ss(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Vr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",at(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Vr(r[i],e);return!e&&t&&(e=pr(t)),new Vr("internal-error",e)}function us(t){var o;this.b=t,this.a=null,this.gb=(o=this,(fs||(fs=new dt(function(t,e){function n(){vr(),sr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){vr(),e(Error("Network Error"))},timeout:hs.get()})}if(sr("gapi.iframes.Iframe"))t();else if(sr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){sr("gapi.load")?n():e(Error("Network Error"))},_t(ea(r=vn(cs,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw fs=null,t}))).then(function(){return new dt(function(r,i){sr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:sr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},ls.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})}))}var cs=new fn(yn,"https://apis.google.com/js/api.js?onload=%{onload}"),hs=new br(3e4,6e4),ls=new br(5e3,15e3),fs=null;function ps(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=ze(this.i,"/__/auth/iframe"),Ke(this.a,"apiKey",this.g),Ke(this.a,"appName",this.h),this.b=null,this.c=[]}function ds(t,e,n,r,i){this.m=t,this.l=e,this.c=n,this.o=r,this.h=this.g=this.i=null,this.a=i,this.f=null}function ys(t){try{return Fh.app(t).auth().ya()}catch(t){return[]}}function ms(t,e,n,r,i){this.l=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.u=this.v=null,this.g=[],this.o=this.a=null}function gs(t){var e,s=jn();return(e=t,os(e,Qa,{}).then(function(t){return t.authorizedDomains||[]})).then(function(t){t:{var e=Ge(s),n=e.c;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?Ge(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(Gn.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new no(jn())})}function vs(i){return i.o||(i.o=Yn().then(function(){if(!i.u){var t=i.c,e=i.h,n=ys(i.b),r=new ps(i.l,i.f,i.b);r.f=t,r.b=e,r.c=q(n||[]),i.u=r.toString()}i.i=new us(i.u),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");t=r.i,e=function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=$i(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",_t(e)}return e.status="ERROR",_t(e)},t.gb.then(function(){t.a.register("authEvent",e,sr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))});var t,e}(i)})),i.o}function bs(t){return t.m||(t.v=t.c?or(t.c,ys(t.b)):null,t.m=new ua(t.f,ci(t.h),t.v)),t.m}function ws(t,e,n,r,i,o,a,s,u,c){return(t=new ds(t,e,n,r,i)).i=o,t.g=a,t.h=s,t.b=nt(u||null),t.f=c,t.toString()}function _s(t){if(this.a=t||Fh.INTERNAL.reactNative&&Fh.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Vr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Es(t){this.b=t,this.a={},this.c=v(this.f,this)}ps.prototype.toString=function(){return this.f?Ke(this.a,"v",this.f):sn(this.a.a,"v"),this.b?Ke(this.a,"eid",this.b):sn(this.a.a,"eid"),this.c.length?Ke(this.a,"fw",this.c.join(",")):sn(this.a.a,"fw"),this.a.toString()},ds.prototype.toString=function(){var t=ze(this.m,"/__/auth/handler");if(Ke(t,"apiKey",this.l),Ke(t,"appName",this.c),Ke(t,"authType",this.o),this.a.isOAuthProvider){var e=this.a;try{var n=Fh.app(this.c).auth().ea()}catch(t){n=null}for(var r in e.ab=n,Ke(t,"providerId",this.a.providerId),n=dr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=nt(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.ab&&!n[e.eb]&&(n[e.eb]=e.ab),et(n)||Ke(t,"customParameters",pr(n))}if("function"==typeof this.a.Fb&&((e=this.a.Fb()).length&&Ke(t,"scopes",e.join(","))),this.i?Ke(t,"redirectUrl",this.i):sn(t.a,"redirectUrl"),this.g?Ke(t,"eventId",this.g):sn(t.a,"eventId"),this.h?Ke(t,"v",this.h):sn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!He(t,a)&&Ke(t,a,this.b[a]);return this.f?Ke(t,"eid",this.f):sn(t.a,"eid"),(a=ys(this.c)).length&&Ke(t,"fw",a.join(",")),t.toString()},(t=ms.prototype).Ea=function(e,n,t){var r=new Vr("popup-closed-by-user"),i=new Vr("web-storage-unsupported"),o=this,a=!1;return this.ga().then(function(){var t,r;(t=o,r={type:"webStorageSupport"},vs(t).then(function(){return e=t.i,n=r,e.gb.then(function(){return new dt(function(t){e.a.send(n.type,n,t,sr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})});var e,n}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})).then(function(t){t||(e&&Kn(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return n=e,new dt(function(e){return function t(){Me(2e3).then(function(){if(n&&!n.closed)return t();e()})}()});var n}).then(function(){if(!a)return Me(t).then(function(){n(r)})})},t.Mb=function(){var t=ar();return!fr(t)&&!gr(t)},t.Hb=function(){return!1},t.Db=function(e,t,n,r,i,o,a){if(!e)return Et(new Vr("popup-blocked"));if(a&&!fr())return this.ga().s(function(t){Kn(e),i(t)}),r(),_t();this.a||(this.a=gs(bs(this)));var s=this;return this.a.then(function(){var t=s.ga().s(function(t){throw Kn(e),i(t),t});return r(),t}).then(function(){(Xi(n),a)||Wn(ws(s.l,s.f,s.b,t,n,null,o,s.c,void 0,s.h),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(s.a=null),t})},t.Ca=function(t,e,n){this.a||(this.a=gs(bs(this)));var r=this;return this.a.then(function(){Xi(e),Wn(ws(r.l,r.f,r.b,t,e,jn(),n,r.c,void 0,r.h))}).s(function(t){throw"auth/network-request-failed"==t.code&&(r.a=null),t})},t.ga=function(){var t=this;return vs(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new Vr("network-request-failed")})},t.Qb=function(){return!0},t.wa=function(t){this.g.push(t)},t.Ka=function(e){F(this.g,function(t){return t==e})},(t=_s.prototype).get=function(t){return _t(this.a.getItem(t)).then(function(t){return t&&yr(t)})},t.set=function(t,e){return _t(this.a.setItem(t,pr(e)))},t.P=function(t){return _t(this.a.removeItem(t))},t.Y=function(){},t.ca=function(){};var Ts,Ss=[];function Cs(t){this.a=t}function Is(t){this.c=t,this.b=!1,this.a=[]}function Ns(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Et(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new dt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Ds(r,c),t}).s(function(t){throw Ds(r,c),t})}function Ds(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),F(t.a,function(t){return t==e})}}function As(){if(!Os())throw new Vr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.l=l.indexedDB,this.type="indexedDB",this.g=this.o=this.f=this.i=null,this.u=!1,this.h=null;var t,r=this;$n()&&self?(this.o=function(){var e=$n()?self:null;if(O(Ss,function(t){t.b==e&&(n=t)}),!n){var n=new Es(e);Ss.push(n)}return n}(),this.o.subscribe("keyChanged",function(t,n){return Fs(r).then(function(e){return 0<e.length&&O(r.a,function(t){t(e)}),{keyProcessed:x(e,n.key)}})}),this.o.subscribe("ping",function(){return _t(["keyChanged"])})):(t=l.navigator,t&&t.serviceWorker?_t().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):_t(null)).then(function(t){(r.h=t)&&(r.g=new Is(new Cs(t)),Ns(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&x(t[0].value,"keyChanged")&&(r.u=!0)}).s(function(){}))})}function ks(i){return new dt(function(e,n){var t=i.l.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){var r;(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):(r=i,new dt(function(t,e){var n=r.l.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})).then(function(){return ks(i)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function Rs(t){return t.m||(t.m=ks(t)),t.m}function Os(){try{return!!l.indexedDB}catch(t){return!1}}function Ps(t){return t.objectStore("firebaseLocalStorage")}function Ms(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function xs(t){return new dt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function Ls(t,e){return t.g&&t.h&&((n=l.navigator)&&n.serviceWorker&&n.serviceWorker.controller||null)===t.h?Ns(t.g,"keyChanged",{key:e},t.u).then(function(){}).s(function(){}):_t();var n}function Fs(r){return Rs(r).then(function(t){var i=Ps(Ms(t,!1));return i.getAll?xs(i.getAll()):new dt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function Us(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function qs(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=_t().then(function(){if(Os()){var e=mr(),n="__sak"+e;return Ts||(Ts=new As),(i=Ts).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.P(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.Y(function(e){O(r.a,function(t){t(e)})}),t})}function Vs(){this.a={},this.type="inMemory"}function Bs(){if(!function(){var t="Node"==Zn();if(!(t=js()||t&&Fh.INTERNAL.node&&Fh.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==Zn())throw new Vr("internal-error","The LocalStorage compatibility library was not found.");throw new Vr("web-storage-unsupported")}this.a=js()||Fh.INTERNAL.node.localStorage,this.type="localStorage"}function js(){try{var t=l.localStorage,e=mr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Ws(){this.type="nullStorage"}function Qs(){if(!function(){var t="Node"==Zn();if(!(t=Ks()||t&&Fh.INTERNAL.node&&Fh.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==Zn())throw new Vr("internal-error","The SessionStorage compatibility library was not found.");throw new Vr("web-storage-unsupported")}this.a=Ks()||Fh.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Ks(){try{var t=l.sessionStorage,e=mr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function Hs(){var t={};t.Browser=Ys,t.Node=Xs,t.ReactNative=Js,t.Worker=$s,this.a=t[Zn()]}Es.prototype.f=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];O(t,function(t){e.push(_t().then(function(){return t(n.origin,n.data.data)}))}),St(e).then(function(t){var e=[];O(t,function(t){e.push({fulfilled:t.Eb,value:t.value,reason:t.reason?t.reason.message:void 0})}),O(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},Es.prototype.subscribe=function(t,e){et(this.a)&&this.b.addEventListener("message",this.c),void 0===this.a[t]&&(this.a[t]=[]),this.a[t].push(e)},Es.prototype.unsubscribe=function(t,e){void 0!==this.a[t]&&e?(F(this.a[t],function(t){return t==e}),0==this.a[t].length&&delete this.a[t]):e||delete this.a[t],et(this.a)&&this.b.removeEventListener("message",this.c)},Cs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Is.prototype.close=function(){for(;0<this.a.length;)Ds(this,this.a[0]);this.b=!0},(t=As.prototype).set=function(n,r){var i,o=!1,a=this;return Rs(this).then(function(t){return xs((t=Ps(Ms(i=t,!0))).get(n))}).then(function(t){var e=Ps(Ms(i,!0));return t?(t.value=r,xs(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,xs(e.add(t)))}).then(function(){return a.c[n]=r,Ls(a,n)}).ia(function(){o&&a.b--})},t.get=function(e){return Rs(this).then(function(t){return xs(Ps(Ms(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.P=function(e){var n=!1,r=this;return Rs(this).then(function(t){return n=!0,r.b++,xs(Ps(Ms(t,!0)).delete(e))}).then(function(){return delete r.c[e],Ls(r,e)}).ia(function(){n&&r.b--})},t.Y=function(t){var n;0==this.a.length&&(Us(n=this),function e(){n.f=setTimeout(function(){n.i=Fs(n).then(function(e){0<e.length&&O(n.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()),this.a.push(t)},t.ca=function(e){F(this.a,function(t){return t==e}),0==this.a.length&&Us(this)},(t=qs.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.P=function(e){return this.b.then(function(t){return t.P(e)})},t.Y=function(t){this.a.push(t)},t.ca=function(e){F(this.a,function(t){return t==e})},(t=Vs.prototype).get=function(t){return _t(this.a[t])},t.set=function(t,e){return this.a[t]=e,_t()},t.P=function(t){return delete this.a[t],_t()},t.Y=function(){},t.ca=function(){},(t=Bs.prototype).get=function(t){var e=this;return _t().then(function(){return yr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return _t().then(function(){var t=pr(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return _t().then(function(){e.a.removeItem(t)})},t.Y=function(t){l.window&&ge(l.window,"storage",t)},t.ca=function(t){l.window&&we(l.window,"storage",t)},(t=Ws.prototype).get=function(){return _t(null)},t.set=function(){return _t()},t.P=function(){return _t()},t.Y=function(){},t.ca=function(){},(t=Qs.prototype).get=function(t){var e=this;return _t().then(function(){return yr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return _t().then(function(){var t=pr(n);null===t?r.P(e):r.a.setItem(e,t)})},t.P=function(t){var e=this;return _t().then(function(){e.a.removeItem(t)})},t.Y=function(){},t.ca=function(){};var Gs,zs,Ys={A:Bs,Sa:Qs},Xs={A:Bs,Sa:Qs},Js={A:_s,Sa:Ws},$s={A:Bs,Sa:Ws},Zs={ad:"local",NONE:"none",cd:"session"};function tu(){var t=!(gr(ar())||!Jn()),e=fr(),n=ur();this.m=t,this.h=e,this.o=n,this.a={},Gs||(Gs=new Hs),t=Gs;try{this.g=!Bn()&&Er()||!l.indexedDB?new t.a.A:new qs($n()?new Vs:new t.a.A)}catch(t){this.g=new Vs,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new Vs}this.l=new Vs,this.f=v(this.Pb,this),this.b={}}function eu(){return zs||(zs=new tu),zs}function nu(t,e){switch(e){case"session":return t.i;case"none":return t.l;default:return t.g}}function ru(t,e){return"firebase:"+t.name+(e?":"+e:"")}function iu(t,e,n){return n=ru(e,n),"local"==e.A&&(t.b[n]=null),nu(t,e.A).P(n)}function ou(t){t.c&&(clearInterval(t.c),t.c=null)}function au(t){this.a=t,this.b=eu()}(t=tu.prototype).get=function(t,e){return nu(this,t.A).get(ru(t,e))},t.set=function(e,t,n){var r=ru(e,n),i=this,o=nu(this,e.A);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.A&&(i.b[r]=t)})},t.addListener=function(t,e,n){var r;t=ru(t,e),this.o&&(this.b[t]=l.localStorage.getItem(t)),et(this.a)&&(nu(this,"local").Y(this.f),this.h||(Bn()||!Er())&&l.indexedDB||!this.o||(ou(r=this),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new ae({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Pb(e))}},1e3))),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=ru(t,e),this.a[t]&&(F(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),et(this.a)&&(nu(this,"local").ca(this.f),ou(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Ya(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?nu(this,"local").ca(this.f):ou(this),this.m)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.Ya(e))},jt&&Jt&&10==Jt&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else O(t,v(this.Ya,this))},t.Ya=function(t){this.a[t]&&O(this.a[t],function(t){t()})};var su,uu={name:"authEvent",A:"local"};function cu(){this.a=eu()}function hu(t,e){this.b=lu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.o=l.Int32Array?new Int32Array(64):Array(64),void 0!==su||(su=l.Int32Array?new Int32Array(vu):vu),this.reset()}_(hu,function(){this.b=-1});for(var lu=64,fu=lu-1,pu=[],du=0;du<fu;du++)pu[du]=0;var yu=U(128,pu);function mu(t){for(var e=t.f,n=t.o,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|su[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function gu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(c(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(mu(t),i=0);else{if(!y(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(mu(t),i=0)}}t.c=i,t.g+=n}hu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):q(this.h)};var vu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function bu(){hu.call(this,8,wu)}_(bu,hu);var wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function _u(t,e,n,r,i){this.l=t,this.i=e,this.o=n,this.m=r||null,this.u=i||null,this.h=e+":"+n,this.v=new cu,this.g=new au(this.h),this.f=null,this.b=[],this.a=this.c=null}function Eu(t){return new Vr("invalid-cordova-configuration",t)}function Tu(t){var e=new bu;gu(e,t),t=[];var n=8*e.g;e.c<56?gu(e,yu,56-e.c):gu(e,yu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(mu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return P(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}function Su(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Cu(r){return r.f||(r.f=r.ga().then(function(){return new dt(function(n){r.wa(function t(e){return n(e),r.Ka(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Iu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Si(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=yr(He(n=Ge(e),"firebaseError")||null))?Br(n):null)?new Ji(t.b,t.c,null,null,n):new Ji(t.b,t.c,e,t.g)),e=n||o}Su(i,e)})}var o=new Ji("unknown",null,null,null,new Vr("no-auth-event")),t=!1,n=Me(500).then(function(){return Iu(i).then(function(){t||Su(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(sr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},eo||(eo=new Zi),eo.subscribe(e)}(r)})})),r.f}function Iu(e){var t,n=null;return(t=e.g,t.b.get(uu,t.a).then(function(t){return $i(t)})).then(function(t){return n=t,iu((t=e.g).b,uu,t.a)}).then(function(){return n})}function Nu(t){this.a=t,this.b=eu()}(t=_u.prototype).ga=function(){return this.za?this.za:this.za=(Xn(void 0)?Yn().then(function(){return new dt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Et(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof sr("universalLinks.subscribe",l))throw Eu("cordova-universal-links-plugin-fix is not installed");if(void 0===sr("BuildInfo.packageName",l))throw Eu("cordova-plugin-buildinfo is not installed");if("function"!=typeof sr("cordova.plugins.browsertab.openUrl",l))throw Eu("cordova-plugin-browsertab is not installed");if("function"!=typeof sr("cordova.InAppBrowser.open",l))throw Eu("cordova-plugin-inappbrowser is not installed")},function(){throw new Vr("cordova-not-ready")})},t.Ea=function(t,e){return e(new Vr("operation-not-supported-in-this-environment")),_t()},t.Db=function(){return Et(new Vr("operation-not-supported-in-this-environment"))},t.Qb=function(){return!1},t.Mb=function(){return!0},t.Hb=function(){return!0},t.Ca=function(t,e,n){if(this.c)return Et(new Vr("redirect-operation-pending"));var r=this,i=l.document,o=null,a=null,s=null,u=null;return this.c=_t().then(function(){return Xi(e),Cu(r)}).then(function(){return function(n,t,e,r){var i=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),o=new Ji(t,r,null,i,new Vr("no-auth-event")),a=sr("BuildInfo.packageName",l);if("string"!=typeof a)throw new Vr("invalid-cordova-configuration");var s=sr("BuildInfo.displayName",l),u={};if(ar().toLowerCase().match(/iphone|ipad|ipod/))u.ibi=a;else{if(!ar().toLowerCase().match(/android/))return Et(new Vr("operation-not-supported-in-this-environment"));u.apn=a}s&&(u.appDisplayName=s),i=Tu(i),u.sessionId=i;var c=ws(n.l,n.i,n.o,t,e,null,r,n.m,u,n.u);return n.ga().then(function(){var t=n.h;return n.v.a.set(uu,o.C(),t)}).then(function(){var t=sr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Vr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=sr("cordova.plugins.browsertab.openUrl",l)))throw new Vr("invalid-cordova-configuration");e(c)}else{if("function"!=typeof(e=sr("cordova.InAppBrowser.open",l)))throw new Vr("invalid-cordova-configuration");t=!(!(t=ar()).match(/(iPad|iPhone|iPod).*OS 7_\d/i)&&!t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)),n.a=e(c,t?"_blank":"_system","location=yes")}})})}(r,t,e,n)}).then(function(){return new dt(function(e,t){a=function(){var t=sr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),r.a&&"function"==typeof r.a.close&&(r.a.close(),r.a=null),!1},r.wa(a),s=function(){o||(o=Me(2e3).then(function(){t(new Vr("redirect-cancelled-by-user"))}))},u=function(){wr()&&s()},i.addEventListener("resume",s,!1),ar().toLowerCase().match(/android/)||i.addEventListener("visibilitychange",u,!1)}).s(function(t){return Iu(r).then(function(){throw t})})}).ia(function(){s&&i.removeEventListener("resume",s,!1),u&&i.removeEventListener("visibilitychange",u,!1),o&&o.cancel(),a&&r.Ka(a),r.c=null})},t.wa=function(e){this.b.push(e),Cu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new Ji("unknown",null,null,null,new Vr("no-auth-event")),e(t))})},t.Ka=function(e){F(this.b,function(t){return t==e})};var Du={name:"pendingRedirect",A:"session"};function Au(t){return iu(t.b,Du,t.a)}function ku(t,e,n){this.u=t,this.o=e,this.l=n,this.h=[],this.f=!1,this.i=v(this.cb,this),this.b=new Vu,this.m=new Qu,this.g=new Nu(this.o+":"+this.l),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.m,this.c.linkViaPopup=this.m,this.c.reauthViaPopup=this.m,this.a=Ru(this.u,this.o,this.l,si)}function Ru(t,e,n,r){var i=Fh.SDK_VERSION||null;return Xn()?new _u(t,e,n,i,r):new ms(t,e,n,i,r)}function Ou(e){e.f||(e.f=!0,e.a.wa(e.i));var n=e.a;return e.a.ga().s(function(t){throw e.a==n&&e.reset(),t})}function Pu(n){n.a.Mb()&&Ou(n).s(function(t){var e=new Ji("unknown",null,null,null,new Vr("operation-not-supported-in-this-environment"));Fu(t)&&n.cb(e)}),n.a.Hb()||Bu(n.b)}(t=ku.prototype).reset=function(){this.f=!1,this.a.Ka(this.i),this.a=Ru(this.u,this.o,this.l)},t.Za=function(){this.b.Za()},t.subscribe=function(t){if(x(this.h,t)||this.h.push(t),!this.f){var n=this;(e=this.g,e.b.get(Du,e.a).then(function(t){return"pending"==t})).then(function(t){t?Au(n.g).then(function(){Ou(n).s(function(t){var e=new Ji("unknown",null,null,null,new Vr("operation-not-supported-in-this-environment"));Fu(t)&&n.cb(e)})}):Pu(n)}).s(function(){Pu(n)})}var e},t.unsubscribe=function(e){F(this.h,function(t){return t==e})},t.cb=function(t){if(!t)throw new Vr("invalid-auth-event");for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.wb(t.b,t.c)){(e=this.c[t.b])&&e.h(t,r),e=!0;break}}return Bu(this.b),e};var Mu=new br(2e3,1e4),xu=new br(3e4,6e4);function Lu(t,e,n,r,i,o){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.wa(t.i))},function(){t.reset()},i,o)}function Fu(t){return!(!t||"auth/cordova-not-ready"!=t.code)}ku.prototype.fa=function(){return this.b.fa()},ku.prototype.Ca=function(t,e,n){var r,i,o=this;return(i=this.g,i.b.set(Du,"pending",i.a)).then(function(){return o.a.Ca(t,e,n).s(function(t){if(Fu(t))throw new Vr("operation-not-supported-in-this-environment");return r=t,Au(o.g).then(function(){throw r})}).then(function(){return o.a.Qb()?new dt(function(){}):Au(o.g).then(function(){return o.fa()}).then(function(){}).s(function(){})})})},ku.prototype.Ea=function(e,n,t,r){return this.a.Ea(t,function(t){e.ha(n,null,t,r)},Mu.get())};var Uu={};function qu(t,e,n){var r=e+":"+n;return Uu[r]||(Uu[r]=new ku(t,e,n)),Uu[r]}function Vu(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Bu(t){t.g||(t.g=!0,Wu(t,!1,null,null))}function ju(t,e){if(t.b=function(){return _t(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function Wu(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Et(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):ju(t,n):ju(t,{user:null}),t.f=[],t.c=[]}function Qu(){}function Ku(){this.tb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.tb},set:function(t){this.tb=t},enumerable:!1})}function Hu(t,e){this.a=e,Nr(this,"verificationId",t)}function Gu(t,e,n,r){return new Gi(t).Va(e,n).then(function(t){return new Hu(t,r)})}function zu(t){var e=ai(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Vr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Dr(this,{token:t,expirationTime:_r(1e3*e.exp),authTime:_r(1e3*e.auth_time),issuedAtTime:_r(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Yu(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Xu(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function Ju(t){this.f=t,this.b=this.a=null,this.c=0}function $u(t,e){var n=e[ha],r=e.refreshToken;e=Zu(e.expiresIn),t.b=n,t.c=e,t.a=r}function Zu(t){return w()+1e3*parseInt(t,10)}function tc(e,t){return(r=e.f,i=t,new dt(function(e,n){"refresh_token"==i.grant_type&&i.refresh_token||"authorization_code"==i.grant_type&&i.code?ga(r,r.i+"?key="+encodeURIComponent(r.b),function(t){t?t.error?n(ss(t)):t.access_token&&t.refresh_token?e(t):n(new Vr("internal-error")):n(new Vr("network-request-failed"))},"POST",an(i).toString(),r.f,r.o.get()):n(new Vr("internal-error"))})).then(function(t){return e.b=t.access_token,e.c=Zu(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t});var r,i}function ec(t,e){this.a=t||null,this.b=e||null,Dr(this,{lastSignInTime:_r(e||null),creationTime:_r(t||null)})}function nc(t,e,n,r,i,o){Dr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function rc(t,e){for(var n in oe.call(this,t),e)this[n]=e[n]}function ic(t,e,n){var r;this.G=[],this.l=t.apiKey,this.m=t.appName,this.u=t.authDomain||null,t=Fh.SDK_VERSION?or(Fh.SDK_VERSION):null,this.b=new ua(this.l,ci(si),t),this.h=new Ju(this.b),lc(this,e[ha]),$u(this.h,e),Nr(this,"refreshToken",this.h.a),dc(this,n||{}),Ae.call(this),this.I=!1,this.u&&cr()&&(this.a=qu(this.u,this.l,this.m)),this.N=[],this.i=null,this.w=(r=this,new Yu(function(){return r.F(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=r.h.c-w()-3e5;return 0<t?t:0})),this.V=v(this.Ha,this);var i=this;this.ka=null,this.ta=function(t){i.pa(t.g)},this.X=null,this.O=[],this.sa=function(t){ac(i,t.c)},this.W=null}function oc(t,e){t.X&&we(t.X,"languageCodeChanged",t.ta),(t.X=e)&&ge(e,"languageCodeChanged",t.ta)}function ac(t,e){t.O=e,ma(t.b,Fh.SDK_VERSION?or(Fh.SDK_VERSION,t.O):null)}function sc(t,e){t.W&&we(t.W,"frameworkChanged",t.sa),(t.W=e)&&ge(e,"frameworkChanged",t.sa)}function uc(e){try{return Fh.app(e.m).auth()}catch(t){throw new Vr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function cc(t){t.D||t.w.b||(t.w.start(),we(t,"tokenChanged",t.V),ge(t,"tokenChanged",t.V))}function hc(t){we(t,"tokenChanged",t.V),t.w.stop()}function lc(t,e){t.ra=e,Nr(t,"_lat",e)}function fc(t){for(var e=[],n=0;n<t.N.length;n++)e.push(t.N[n](t));return St(e).then(function(){return t})}function pc(t){t.a&&!t.I&&(t.I=!0,t.a.subscribe(t))}function dc(t,e){Dr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,metadata:new ec(e.createdAt,e.lastLoginAt),providerData:[]})}function yc(){}function mc(t){return _t().then(function(){if(t.D)throw new Vr("app-deleted")})}function gc(t){return P(t.providerData,function(t){return t.providerId})}function vc(t,e){e&&(bc(t,e.providerId),t.providerData.push(e))}function bc(t,e){F(t.providerData,function(t){return t.providerId==e})}function wc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Nr(t,e,n)}function _c(e,t){var n,r,i;e!=t&&(Dr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,providerData:[]}),t.metadata?Nr(e,"metadata",new ec((i=t.metadata).a,i.b)):Nr(e,"metadata",new ec),O(t.providerData,function(t){vc(e,t)}),n=e.h,r=t.h,n.b=r.b,n.a=r.a,n.c=r.c,Nr(e,"refreshToken",e.h.a))}function Ec(i){return i.F().then(function(t){var e,n,r=i.isAnonymous;return(e=i,n=t,os(e.b,Va,{idToken:n}).then(v(e.zc,e))).then(function(){return r||wc(i,"isAnonymous",!1),t})})}function Tc(t,e){e[ha]&&t.ra!=e[ha]&&($u(t.h,e),t.dispatchEvent(new rc("tokenChanged")),lc(t,e[ha]),wc(t,"refreshToken",t.h.a))}function Sc(t,e){return Ec(t).then(function(){if(x(gc(t),e))return fc(t).then(function(){throw new Vr("provider-already-linked")})})}function Cc(t,e,n){return Ar({user:t,credential:Yi(e),additionalUserInfo:e=di(e),operationType:n})}function Ic(t,e){return Tc(t,e),t.reload().then(function(){return t})}function Nc(n,r,t,e,i){if(!cr())return Et(new Vr("operation-not-supported-in-this-environment"));if(n.i&&!i)return Et(n.i);var o=pi(t.providerId),a=mr(n.uid+":::"),s=null;(!fr()||Jn())&&n.u&&t.isOAuthProvider&&(s=ws(n.u,n.l,n.m,r,t,null,a,Fh.SDK_VERSION||null));var u=Hn(s,o&&o.Ba,o&&o.Aa);return e=e().then(function(){if(Ac(n),!i)return n.F().then(function(){})}).then(function(){return Lu(n.a,u,r,t,a,!!s)}).then(function(){return new dt(function(t,e){n.ha(r,null,new Vr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.c=n.a.Ea(n,r,u,a)})}).then(function(t){return u&&Kn(u),t?Ar(t):null}).s(function(t){throw u&&Kn(u),t}),kc(n,e,i)}function Dc(e,t,n,r,i){if(!cr())return Et(new Vr("operation-not-supported-in-this-environment"));if(e.i&&!i)return Et(e.i);var o=null,a=mr(e.uid+":::");return r=r().then(function(){if(Ac(e),!i)return e.F().then(function(){})}).then(function(){return e.aa=a,fc(e)}).then(function(t){return e.ba&&(t=(t=e.ba).b.set(Pc,e.C(),t.a)),t}).then(function(){return e.a.Ca(t,n,a)}).s(function(t){if(o=t,e.ba)return Mc(e.ba);throw o}).then(function(){if(o)throw o}),kc(e,r,i)}function Ac(t){if(!t.a||!t.I){if(t.a&&!t.I)throw new Vr("internal-error");throw new Vr("auth-domain-config-required")}}function kc(t,e,n){var r,i,o,a=(i=e,o=n,(r=t).i&&!o?(i.cancel(),Et(r.i)):i.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(r.i||r.dispatchEvent(new rc("userInvalidated")),r.i=t),t}));return t.G.push(a),a.ia(function(){L(t.G,a)}),a}function Rc(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[ha]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-w())/1e3;var r=new ic(e,n,t);return t.providerData&&O(t.providerData,function(t){t&&vc(r,Ar(t))}),t.redirectEventId&&(r.aa=t.redirectEventId),r}function Oc(t){this.a=t,this.b=eu()}Vu.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Vu.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.b,r=t.c,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(Wu(this,!0,null,t.a),_t()):e.xa(n,r)?function(e,t,n){n=n.xa(t.b,t.c);var r=t.f,i=t.g,o=t.h,a=!!t.b.match(/Redirect$/);n(r,i,o).then(function(t){Wu(e,a,t,null)}).s(function(t){Wu(e,a,null,t)})}(this,t,e):Et(new Vr("invalid-auth-event")):(Wu(this,!1,null,null),_t())}else Et(new Vr("invalid-auth-event"))},Vu.prototype.Za=function(){this.g&&!this.i&&Wu(this,!1,null,null)},Vu.prototype.fa=function(){var i=this;return new dt(function(t,e){var n,r;i.b?i.b().then(t,e):(i.f.push(t),i.c.push(e),n=i,r=new Vr("timeout"),n.a&&n.a.cancel(),n.a=Me(xu.get()).then(function(){n.b||(n.g=!0,Wu(n,!0,null,r))}))})},Qu.prototype.h=function(t,e){if(t){var n=t.b,r=t.c;t.a?(e.ha(t.b,null,t.a,t.c),_t()):e.xa(n,r)?(o=e,a=(i=t).c,s=i.b,o.xa(s,a)(i.f,i.g,i.h).then(function(t){o.ha(s,t,null,a)}).s(function(t){o.ha(s,null,t,a)})):Et(new Vr("invalid-auth-event"))}else Et(new Vr("invalid-auth-event"));var i,o,a,s},Hu.prototype.confirm=function(t){return t=zi(this.verificationId,t),this.a(t)},Yu.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=Me(Xu(n,t)).then(function(){return e=l.document,n=null,wr()||!e?_t():new dt(function(t){n=function(){wr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},Yu.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Ju.prototype.C=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Ju.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Et(new Vr("user-token-expired")):t||!this.b||w()>this.c-3e4?this.a?tc(this,{grant_type:"refresh_token",refresh_token:this.a}):_t(null):_t({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},ec.prototype.C=function(){return{lastLoginAt:this.b,createdAt:this.a}},_(rc,oe),_(ic,Ae),ic.prototype.pa=function(t){this.ka=t,ya(this.b,t)},ic.prototype.ea=function(){return this.ka},ic.prototype.ya=function(){return q(this.O)},ic.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Nr(ic.prototype,"providerId","firebase"),(t=ic.prototype).reload=function(){var t=this;return kc(this,mc(this).then(function(){return Ec(t).then(function(){return fc(t)}).then(yc)}))},t.dc=function(t){return this.F(t).then(function(t){return new zu(t)})},t.F=function(t){var e=this;return kc(this,mc(this).then(function(){return e.h.getToken(t)}).then(function(t){if(!t)throw new Vr("internal-error");return t.accessToken!=e.ra&&(lc(e,t.accessToken),e.dispatchEvent(new rc("tokenChanged"))),wc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Vr("internal-error");dc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt});for(var e=(r=(r=t).providerUserInfo)&&r.length?P(r,function(t){return new nc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[],n=0;n<e.length;n++)vc(this,e[n]);var r;wc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.hb=function(t){var e=this,n=null;return kc(this,t.f(this.b,this.uid).then(function(t){return Tc(e,t),n=Cc(e,t,"reauthenticate"),e.i=null,e.reload()}).then(function(){return n}),!0)},t.Ac=function(t){return Cr("firebase.User.prototype.reauthenticateWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential instead."),this.hb(t).then(function(){})},t.fb=function(e){var n=this,r=null;return kc(this,Sc(this,e.providerId).then(function(){return n.F()}).then(function(t){return e.b(n.b,t)}).then(function(t){return r=Cc(n,t,"link"),Ic(n,t)}).then(function(){return r}))},t.rc=function(t){return Cr("firebase.User.prototype.linkWithCredential is deprecated. Please use firebase.User.prototype.linkAndRetrieveDataWithCredential instead."),this.fb(t).then(function(t){return t.user})},t.sc=function(t,e){var n=this;return kc(this,Sc(this,"phone").then(function(){return Gu(uc(n),t,e,v(n.fb,n))}))},t.Bc=function(t,e){var n=this;return kc(this,_t().then(function(){return Gu(uc(n),t,e,v(n.hb,n))}),!0)},t.qb=function(e){var n=this;return kc(this,this.F().then(function(t){return n.b.qb(t,e)}).then(function(t){return Tc(n,t),n.reload()}))},t.Tc=function(e){var n=this;return kc(this,this.F().then(function(t){return e.b(n.b,t)}).then(function(t){return Tc(n,t),n.reload()}))},t.rb=function(e){var n=this;return kc(this,this.F().then(function(t){return n.b.rb(t,e)}).then(function(t){return Tc(n,t),n.reload()}))},t.sb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return mc(this);var n=this;return kc(this,this.F().then(function(t){return n.b.sb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Tc(n,t),wc(n,"displayName",t.displayName||null),wc(n,"photoURL",t.photoUrl||null),O(n.providerData,function(t){"password"===t.providerId&&(Nr(t,"displayName",n.displayName),Nr(t,"photoURL",n.photoURL))}),fc(n)}).then(yc))},t.Rc=function(i){var o=this;return kc(this,Ec(this).then(function(t){return x(gc(o),i)?(e=o.b,n=t,r=[i],os(e,Fa,{idToken:n,deleteProvider:r})).then(function(t){var e={};return O(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),O(gc(o),function(t){e[t]||bc(o,t)}),e[Gi.PROVIDER_ID]||Nr(o,"phoneNumber",null),fc(o)}):fc(o).then(function(){throw new Vr("no-such-provider")});var e,n,r}))},t.delete=function(){var e=this;return kc(this,this.F().then(function(t){return os(e.b,La,{idToken:t})}).then(function(){e.dispatchEvent(new rc("userDeleted"))})).then(function(){for(var t=0;t<e.G.length;t++)e.G[t].cancel("app-deleted");oc(e,null),sc(e,null),e.G=[],e.D=!0,hc(e),Nr(e,"refreshToken",null),e.a&&e.a.unsubscribe(e)})},t.wb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.aa||null)==e||"reauthViaRedirect"==t&&(this.aa||null)==e)},t.ha=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?v(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?v(this.Cb,this):"linkViaRedirect"==t&&(this.aa||null)==e?v(this.Bb,this):"reauthViaRedirect"==t&&(this.aa||null)==e?v(this.Cb,this):null},t.tc=function(t){var e=this;return Nc(this,"linkViaPopup",t,function(){return Sc(e,t.providerId).then(function(){return fc(e)})},!1)},t.Cc=function(t){return Nc(this,"reauthViaPopup",t,function(){return _t()},!0)},t.uc=function(t){var e=this;return Dc(this,"linkViaRedirect",t,function(){return Sc(e,t.providerId)},!1)},t.Dc=function(t){return Dc(this,"reauthViaRedirect",t,function(){return _t()},!0)},t.Bb=function(e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return kc(this,this.F().then(function(t){return Aa(i.b,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Cc(i,t,"link"),Ic(i,t)}).then(function(){return o}))},t.Cb=function(t,e,n){var r=this;this.c&&(this.c.cancel(),this.c=null);var i=null;return kc(this,_t().then(function(){return Ci(ka(r.b,{requestUri:t,sessionId:e,postBody:n}),r.uid)}).then(function(t){return i=Cc(r,t,"reauthenticate"),Tc(r,t),r.i=null,r.reload()}).then(function(){return i}),!0)},t.kb=function(e){var n=this,r=null;return kc(this,this.F().then(function(t){return r=t,void 0===e||et(e)?{}:ti(new Qr(e))}).then(function(t){return n.b.kb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.C()},t.C=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.u,stsTokenManager:this.h.C(),redirectEventId:this.aa||null};return this.metadata&&at(e,this.metadata.C()),O(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var Pc={name:"redirectUser",A:"session"};function Mc(t){return iu(t.b,Pc,t.a)}function xc(t){var e,n,r,i,o,a,s,u,c;this.a=t,this.b=eu(),this.c=null,this.f=(e=this,n=Uc("local"),r=Uc("session"),i=Uc("none"),(o=e.b,a=n,s=e.a,u=ru(a,s),c=nu(o,a.A),o.get(a,s).then(function(t){var e=null;try{e=yr(l.localStorage.getItem(u))}catch(t){}if(e&&!t)return l.localStorage.removeItem(u),o.set(a,e,s);e&&t&&"localStorage"!=c.type&&l.localStorage.removeItem(u)})).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(Fc,e.a).then(function(t){return t?Uc(t):n})})})}).then(function(t){return e.c=t,Lc(e,t.A)}).s(function(){e.c||(e.c=n)})),this.b.addListener(Uc("local"),this.a,v(this.g,this))}function Lc(t,e){var n,s,r=[];for(n in Zs)Zs[n]!==e&&r.push(iu(t.b,Uc(Zs[n]),t.a));return r.push(iu(t.b,Fc,t.a)),s=r,new dt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Tt(s[a],b(t,a),o);else n(i)})}xc.prototype.g=function(){var e=this,n=Uc("local");jc(this,function(){return _t().then(function(){return e.c&&"local"!=e.c.A?e.b.get(n,e.a):null}).then(function(t){if(t)return Lc(e,"local").then(function(){e.c=n})})})};var Fc={name:"persistence",A:"session"};function Uc(t){return{name:"authUser",A:t}}function qc(t,e){return jc(t,function(){return t.b.set(t.c,e.C(),t.a)})}function Vc(t){return jc(t,function(){return iu(t.b,t.c,t.a)})}function Bc(t,e){return jc(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),Rc(t||{})})})}function jc(t,e){return t.f=t.f.then(e,e),t.f}function Wc(t){if(this.l=!1,Nr(this,"settings",new Ku),Nr(this,"app",t),!Xc(this).options||!Xc(this).options.apiKey)throw new Vr("invalid-api-key");var n,e,r,i,o,a,s,u,c,h,l,f;t=Fh.SDK_VERSION?or(Fh.SDK_VERSION):null,this.b=new ua(Xc(this).options&&Xc(this).options.apiKey,ci(si),t),this.N=[],this.m=[],this.I=[],this.Tb=Fh.INTERNAL.createSubscribe(v(this.oc,this)),this.O=void 0,this.Ub=Fh.INTERNAL.createSubscribe(v(this.pc,this)),zc(this,null),this.h=new xc(Xc(this).options.apiKey+":"+Xc(this).name),this.w=new Oc(Xc(this).options.apiKey+":"+Xc(this).name),this.V=th(this,(e=Xc(n=this).options.authDomain,r=(i=n,o=(a=i.w,s=Xc(i).options.authDomain,a.b.get(Pc,a.a).then(function(t){return t&&s&&(t.authDomain=s),Rc(t||{})})).then(function(t){return(i.D=t)&&(t.ba=i.w),Mc(i.w)}),th(i,o)).then(function(){return Bc(n.h,e)}).then(function(e){return e?(e.ba=n.w,n.D&&(n.D.aa||null)==(e.aa||null)?e:e.reload().then(function(){return qc(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:Vc(n.h)})):null}).then(function(t){zc(n,t||null)}),th(n,r))),this.i=th(this,(u=this).V.then(function(){return u.fa()}).s(function(){}).then(function(){if(!u.l)return u.ka()}).s(function(){}).then(function(){if(!u.l){u.X=!0;var t=u.h;t.b.addListener(Uc("local"),t.a,u.ka)}})),this.X=!1,this.ka=v(this.Oc,this),this.Ha=v(this.Z,this),this.ra=v(this.bc,this),this.sa=v(this.mc,this),this.ta=v(this.nc,this),h=Xc(c=this).options.authDomain,l=Xc(c).options.apiKey,h&&cr()&&(c.Sb=c.V.then(function(){if(!c.l){if(c.a=qu(h,l,Xc(c).name),c.a.subscribe(c),Jc(c)&&pc(Jc(c)),c.D){pc(c.D);var t=c.D;t.pa(c.ea()),oc(t,c),ac(t=c.D,c.G),sc(t,c),c.D=null}return c.a}})),this.INTERNAL={},this.INTERNAL.delete=v(this.delete,this),this.INTERNAL.logFramework=v(this.vc,this),this.u=0,Ae.call(this),f=this,Object.defineProperty(f,"lc",{get:function(){return this.ea()},set:function(t){this.pa(t)},enumerable:!1}),f.W=null,this.G=[]}function Qc(t){oe.call(this,"languageCodeChanged"),this.g=t}function Kc(t){oe.call(this,"frameworkChanged"),this.c=t}function Hc(t){return t.Sb||Et(new Vr("auth-domain-config-required"))}function Gc(o,a){var s={};return s.apiKey=Xc(o).options.apiKey,s.authDomain=Xc(o).options.authDomain,s.appName=Xc(o).name,o.V.then(function(){return t=s,e=a,n=o.w,r=o.ya(),i=new ic(t,e),n&&(i.ba=n),r&&ac(i,r),i.reload().then(function(){return i});var t,e,n,r,i}).then(function(t){return Jc(o)&&t.uid==Jc(o).uid?_c(Jc(o),t):(zc(o,t),pc(t)),o.Z(t)}).then(function(){Zc(o)})}function zc(t,e){var n,r;Jc(t)&&(n=Jc(t),r=t.Ha,F(n.N,function(t){return t==r}),we(Jc(t),"tokenChanged",t.ra),we(Jc(t),"userDeleted",t.sa),we(Jc(t),"userInvalidated",t.ta),hc(Jc(t))),e&&(e.N.push(t.Ha),ge(e,"tokenChanged",t.ra),ge(e,"userDeleted",t.sa),ge(e,"userInvalidated",t.ta),0<t.u&&cc(e)),Nr(t,"currentUser",e),e&&(e.pa(t.ea()),oc(e,t),ac(e,t.G),sc(e,t))}function Yc(e,t){var n=null,r=null;return th(e,t.then(function(t){return n=Yi(t),r=di(t),Gc(e,t)}).then(function(){return Ar({user:Jc(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Xc(t){return t.app}function Jc(t){return t.currentUser}function $c(t){return Jc(t)&&Jc(t)._lat||null}function Zc(t){if(t.X){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e]($c(t));if(t.O!==t.getUid()&&t.I.length)for(t.O=t.getUid(),e=0;e<t.I.length;e++)t.I[e]&&t.I[e]($c(t))}}function th(t,e){return t.N.push(e),e.ia(function(){L(t.N,e)}),e}function eh(){}function nh(){this.a={},this.b=1e12}xc.prototype.nb=function(e){var n=null,r=this;return function(t){var e=new Vr("invalid-persistence-type"),n=new Vr("unsupported-persistence-type");t:{for(r in Zs)if(Zs[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(Zn()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!ur()&&"none"!==t)throw n}}(e),jc(this,function(){return e!=r.c.A?r.b.get(r.c,r.a).then(function(t){return n=t,Lc(r,e)}).then(function(){if(r.c=Uc(e),n)return r.b.set(r.c,n,r.a)}):_t()})},_(Wc,Ae),_(Qc,oe),_(Kc,oe),(t=Wc.prototype).nb=function(t){return th(this,t=this.h.nb(t))},t.pa=function(t){this.W===t||this.l||(this.W=t,ya(this.b,this.W),this.dispatchEvent(new Qc(this.ea())))},t.ea=function(){return this.W},t.Uc=function(){var t=l.navigator;this.pa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.G.push(t),ma(this.b,Fh.SDK_VERSION?or(Fh.SDK_VERSION,this.G):null),this.dispatchEvent(new Kc(this.G))},t.ya=function(){return q(this.G)},t.toJSON=function(){return{apiKey:Xc(this).options.apiKey,authDomain:Xc(this).options.authDomain,appName:Xc(this).name,currentUser:Jc(this)&&Jc(this).C()}},t.wb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ha=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.xa=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?v(this.ac,this):null},t.ac=function(t,e,n){var r=this;t={requestUri:t,postBody:n,sessionId:e},this.c&&(this.c.cancel(),this.c=null);var i=null,o=null,a=Da(r.b,t).then(function(t){return i=Yi(t),o=di(t),t});return th(this,t=r.V.then(function(){return a}).then(function(t){return Gc(r,t)}).then(function(){return Ar({user:Jc(r),credential:i,additionalUserInfo:o,operationType:"signIn"})}))},t.Mc=function(e){if(!cr())return Et(new Vr("operation-not-supported-in-this-environment"));var n=this,t=pi(e.providerId),r=mr(),i=null;(!fr()||Jn())&&Xc(this).options.authDomain&&e.isOAuthProvider&&(i=ws(Xc(this).options.authDomain,Xc(this).options.apiKey,Xc(this).name,"signInViaPopup",e,null,r,Fh.SDK_VERSION||null));var o=Hn(i,t&&t.Ba,t&&t.Aa);return th(this,t=Hc(this).then(function(t){return Lu(t,o,"signInViaPopup",e,r,!!i)}).then(function(){return new dt(function(t,e){n.ha("signInViaPopup",null,new Vr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.c=n.a.Ea(n,"signInViaPopup",o,r)})}).then(function(t){return o&&Kn(o),t?Ar(t):null}).s(function(t){throw o&&Kn(o),t}))},t.Nc=function(t){if(!cr())return Et(new Vr("operation-not-supported-in-this-environment"));var e=this;return th(this,Hc(this).then(function(){return jc(t=e.h,function(){return t.b.set(Fc,t.c.A,t.a)});var t}).then(function(){return e.a.Ca("signInViaRedirect",t)}))},t.fa=function(){if(!cr())return Et(new Vr("operation-not-supported-in-this-environment"));var t=this;return th(this,Hc(this).then(function(){return t.a.fa()}).then(function(t){return t?Ar(t):null}))},t.Sc=function(t){if(!t)return Et(new Vr("null-user"));var e=this,n={};n.apiKey=Xc(this).options.apiKey,n.authDomain=Xc(this).options.authDomain,n.appName=Xc(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.u,appName:t.m};var i=t.h,o={};return o[ha]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-w())/1e3,e=new ic(e,o),n&&(e.ba=n),r&&ac(e,r),_c(e,t),e}(t,n,e.w,e.ya());return th(this,this.i.then(function(){if(Xc(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Jc(e)&&t.uid==Jc(e).uid?(_c(Jc(e),t),e.Z(t)):(zc(e,r),pc(r),e.Z(r))}).then(function(){Zc(e)}))},t.ob=function(){var t=this;return th(this,this.i.then(function(){return Jc(t)?(zc(t,null),Vc(t.h).then(function(){Zc(t)})):_t()}))},t.Oc=function(){var r=this;return Bc(this.h,Xc(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=Jc(r)&&t){e=Jc(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return _c(Jc(r),t),Jc(r).F();(Jc(r)||t)&&(zc(r,t),t&&(pc(t),t.ba=r.w),r.a&&r.a.subscribe(r),Zc(r))}})},t.Z=function(t){return qc(this.h,t)},t.bc=function(){Zc(this),this.Z(Jc(this))},t.mc=function(){this.ob()},t.nc=function(){this.ob()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Jc(e))})},t.pc=function(t){var e,n,r=this;n=function(){t.next(Jc(r))},(e=this).I.push(n),th(e,e.i.then(function(){!e.l&&x(e.I,n)&&e.O!==e.getUid()&&(e.O=e.getUid(),n($c(e)))}))},t.xc=function(t,e,n){var r=this;return this.X&&Fh.Promise.resolve().then(function(){a(t)?t(Jc(r)):a(t.next)&&t.next(Jc(r))}),this.Tb(t,e,n)},t.wc=function(t,e,n){var r=this;return this.X&&Fh.Promise.resolve().then(function(){r.O=r.getUid(),a(t)?t(Jc(r)):a(t.next)&&t.next(Jc(r))}),this.Ub(t,e,n)},t.cc=function(t){var e=this;return th(this,this.i.then(function(){return Jc(e)?Jc(e).F(t).then(function(t){return{accessToken:t}}):null}))},t.Nb=function(t){var n=this;return this.i.then(function(){return Yc(n,os(n.b,ts,{token:t}))}).then(function(t){var e=t.user;return wc(e,"isAnonymous",!1),n.Z(e),t})},t.Gc=function(t){return Cr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCustomToken is deprecated. Please use firebase.auth.Auth.prototype.signInWithCustomToken instead."),this.Nb(t)},t.Hc=function(t,e){return Cr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.signInWithEmailAndPassword instead."),this.Ob(t,e)},t.Ob=function(t,e){var n=this;return this.i.then(function(){return Yc(n,os(n.b,es,{email:t,password:e}))})},t.yb=function(t,e){var n=this;return this.i.then(function(){return Yc(n,os(n.b,Ma,{email:t,password:e}))})},t.Wb=function(t,e){return Cr("firebase.auth.Auth.prototype.createUserAndRetrieveDataWithEmailAndPassword is deprecated. Please use firebase.auth.Auth.prototype.createUserWithEmailAndPassword instead."),this.yb(t,e)},t.Jc=function(t){return Cr("firebase.auth.Auth.prototype.signInWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential instead."),this.Qa(t).then(function(t){return t.user})},t.Qa=function(t){var e=this;return this.i.then(function(){return Yc(e,t.la(e.b))})},t.Ra=function(){var n=this;return this.i.then(function(){var t=Jc(n);return t&&t.isAnonymous?Ar({user:t,credential:null,additionalUserInfo:Ar({providerId:null,isNewUser:!1}),operationType:"signIn"}):Yc(n,n.b.Ra()).then(function(t){var e=t.user;return wc(e,"isAnonymous",!0),n.Z(e),t})})},t.Ic=function(){return Cr("firebase.auth.Auth.prototype.signInAnonymouslyAndRetrieveData is deprecated. Please use firebase.auth.Auth.prototype.signInAnonymously instead."),this.Ra()},t.getUid=function(){return Jc(this)&&Jc(this).uid||null},t.Vb=function(t){this.addAuthTokenListener(t),this.u++,0<this.u&&Jc(this)&&cc(Jc(this))},t.Ec=function(e){var n=this;O(this.m,function(t){t==e&&n.u--}),this.u<0&&(this.u=0),0==this.u&&Jc(this)&&hc(Jc(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),th(this,this.i.then(function(){e.l||x(e.m,t)&&t($c(e))}))},t.removeAuthTokenListener=function(e){F(this.m,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.N.length;t++)this.N[t].cancel("app-deleted");return this.N=[],this.h&&(t=this.h).b.removeListener(Uc("local"),t.a,this.ka),this.a&&(this.a.unsubscribe(this),this.a.Za()),Fh.Promise.resolve()},t.Zb=function(t){return Cr("firebase.auth.Auth.prototype.fetchProvidersForEmail is deprecated. Please use firebase.auth.Auth.prototype.fetchSignInMethodsForEmail instead."),th(this,os(this.b,xa,{identifier:t,continueUri:hr()?jn():"http://localhost"}).then(function(t){return t.allProviders||[]}))},t.$b=function(t){return th(this,os(this.b,xa,{identifier:t,continueUri:hr()?jn():"http://localhost"}).then(function(t){return t.signinMethods||[]}))},t.qc=function(t){return!!Qi(t)},t.mb=function(e,n){var r=this;return th(this,_t().then(function(){var t=new Qr(n);if(!t.c)throw new Vr("argument-error",Gr+" must be true when sending sign in link to email");return ti(t)}).then(function(t){return r.b.mb(e,t)}).then(function(){}))},t.Vc=function(t){return this.Ja(t).then(function(t){return t.data.email})},t.$a=function(t,e){return th(this,this.b.$a(t,e).then(function(){}))},t.Ja=function(t){return th(this,this.b.Ja(t).then(function(t){return new Rr(t)}))},t.Xa=function(t){return th(this,this.b.Xa(t).then(function(){}))},t.lb=function(e,t){var n=this;return th(this,_t().then(function(){return void 0===t||et(t)?{}:ti(new Qr(t))}).then(function(t){return n.b.lb(e,t)}).then(function(){}))},t.Lc=function(t,e){return th(this,Gu(this,t,e,v(this.Qa,this)))},t.Kc=function(e,n){var r=this;return th(this,_t().then(function(){var t=Wi(e,n||jn());return r.Qa(t)}))},eh.prototype.render=function(){},eh.prototype.reset=function(){},eh.prototype.getResponse=function(){},eh.prototype.execute=function(){};var rh=null;function ih(t,e){return(e=oh(e))&&t.a[e]||null}function oh(t){return(t=void 0===t?1e12:t)?t.toString():null}function ah(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Rn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():ge(this.f,"click",this.i)}function sh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function uh(){}nh.prototype.render=function(t,e){return this.a[this.b.toString()]=new ah(t,e),this.b++},nh.prototype.reset=function(t){var e=ih(this,t);t=oh(t),e&&t&&(e.delete(),delete this.a[t])},nh.prototype.getResponse=function(t){return(t=ih(this,t))?t.getResponse():null},nh.prototype.execute=function(t){(t=ih(this,t))&&t.execute()},ah.prototype.getResponse=function(){return sh(this),this.b},ah.prototype.execute=function(){sh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},ah.prototype.delete=function(){sh(this),this.g=!0,clearTimeout(this.a),this.a=null,we(this.f,"click",this.i)},uh.prototype.g=function(){return rh||(rh=new nh),_t(rh)},uh.prototype.c=function(){};var ch=null;function hh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var lh=new fn(yn,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),fh=new br(3e4,6e4);hh.prototype.g=function(i){var o=this;return new dt(function(t,e){var r=setTimeout(function(){e(new Vr("network-request-failed"))},fh.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Vr("internal-error"));delete l[o.a]},_t(ea(vn(lh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Vr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},hh.prototype.c=function(){this.b--};var ph=null;function dh(t,e,n,r,i,o,a){if(Nr(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.l=e,this.g=null,a=a?(ch||(ch=new uh),ch):(ph||(ph=new hh),ph),this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[gh])throw new Vr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[vh],!l.document)throw new Vr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Rn(e)||!this.i&&Rn(e).hasChildNodes())throw new Vr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new ua(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.o=[];var u=this.a[yh];this.a[yh]=function(t){if(bh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=sr(u,l);"function"==typeof e&&e(t)}};var c=this.a[mh];this.a[mh]=function(){if(bh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=sr(c,l);"function"==typeof t&&t()}}}var yh="callback",mh="expired-callback",gh="sitekey",vh="size";function bh(t,e){for(var n=0;n<t.o.length;n++)try{t.o[n](e)}catch(t){}}function wh(t,e){return t.h.push(e),e.ia(function(){L(t.h,e)}),e}function _h(t){if(t.D)throw new Vr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Eh(t,e,n){var r=!1;try{this.b=n||Fh.app()}catch(t){throw new Vr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Vr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().ya()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=Fh.SDK_VERSION?or(Fh.SDK_VERSION,o):null,dh.call(this,n,t,e,function(){try{var e=i.b.auth().ea()}catch(t){e=null}return e},o,ci(si),r)}function Th(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Vr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].M(n[i])&&!o){if(e=e[i],i<0||i>=Sh.length)throw new Vr("internal-error","Argument validator received an unsupported number of arguments.");n=Sh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.K+".";break t}r=null}}if(r)throw new Vr("argument-error",t+" failed: "+r)}(t=dh.prototype).za=function(){var e=this;return this.f?this.f:this.f=wh(this,_t().then(function(){if(hr()&&!$n())return Yn();throw new Vr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.m.g(e.v())}).then(function(t){return e.g=t,os(e.u,Ka,{})}).then(function(t){e.a[gh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){_h(this);var n=this;return wh(this,this.za().then(function(){if(null===n.c){var t=n.l;if(!n.i){var e=Rn(t);t=Mn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){_h(this);var i=this;return wh(this,this.render().then(function(e){return new dt(function(n){var t=i.g.getResponse(e);if(t)n(t);else{var r=function(t){var e;t&&(e=r,F(i.o,function(t){return t==e}),n(t))};i.o.push(r),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){_h(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){_h(this),this.D=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Rn(this.l);for(var e;e=t.firstChild;)t.removeChild(e)}},_(Eh,dh);var Sh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Ch(t,e){return{name:t||"",K:"a valid string",optional:!!e,M:c}}function Ih(t,e){return{name:t||"",K:"a boolean",optional:!!e,M:n}}function Nh(t,e){return{name:t||"",K:"a valid object",optional:!!e,M:m}}function Dh(t,e){return{name:t||"",K:"a function",optional:!!e,M:a}}function Ah(t,e){return{name:t||"",K:"null",optional:!!e,M:r}}function kh(n){return{name:n?n+"Credential":"credential",K:n?"a valid "+n+" credential":"a valid credential",optional:!1,M:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.la||!e)}}}function Rh(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(t){return!!(t&&c(t.type)&&a(t.verify))}}}function Oh(e,n,t,r){return{name:t||"",K:e.K+" or "+n.K,optional:!!r,M:function(t){return e.M(t)||n.M(t)}}}function Ph(t,e){for(var n in e){var r=e[n].name;t[r]=Lh(r,t[n],e[n].j)}}function Mh(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:b(function(t){return this[t]},n),set:b(function(t,e,n,r){Th(t,[n],[r],!0),this[e]=r},r,n,e[n].ub),enumerable:!0})}}function xh(t,e,n,r){t[e]=Lh(e,n,r)}function Lh(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Th(a,n,t),e.apply(this,t)}if(!n)return e;var i,o,a=(o=(o=t).split("."))[o.length-1];for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}Ph(Wc.prototype,{Xa:{name:"applyActionCode",j:[Ch("code")]},Ja:{name:"checkActionCode",j:[Ch("code")]},$a:{name:"confirmPasswordReset",j:[Ch("code"),Ch("newPassword")]},yb:{name:"createUserWithEmailAndPassword",j:[Ch("email"),Ch("password")]},Wb:{name:"createUserAndRetrieveDataWithEmailAndPassword",j:[Ch("email"),Ch("password")]},Zb:{name:"fetchProvidersForEmail",j:[Ch("email")]},$b:{name:"fetchSignInMethodsForEmail",j:[Ch("email")]},fa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[Ch("emailLink")]},wc:{name:"onAuthStateChanged",j:[Oh(Nh(),Dh(),"nextOrObserver"),Dh("opt_error",!0),Dh("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[Oh(Nh(),Dh(),"nextOrObserver"),Dh("opt_error",!0),Dh("opt_completed",!0)]},lb:{name:"sendPasswordResetEmail",j:[Ch("email"),Oh(Nh("opt_actionCodeSettings",!0),Ah(null,!0),"opt_actionCodeSettings",!0)]},mb:{name:"sendSignInLinkToEmail",j:[Ch("email"),Nh("actionCodeSettings")]},nb:{name:"setPersistence",j:[Ch("persistence")]},Qa:{name:"signInAndRetrieveDataWithCredential",j:[kh()]},Ra:{name:"signInAnonymously",j:[]},Ic:{name:"signInAnonymouslyAndRetrieveData",j:[]},Jc:{name:"signInWithCredential",j:[kh()]},Nb:{name:"signInWithCustomToken",j:[Ch("token")]},Gc:{name:"signInAndRetrieveDataWithCustomToken",j:[Ch("token")]},Ob:{name:"signInWithEmailAndPassword",j:[Ch("email"),Ch("password")]},Kc:{name:"signInWithEmailLink",j:[Ch("email"),Ch("emailLink",!0)]},Hc:{name:"signInAndRetrieveDataWithEmailAndPassword",j:[Ch("email"),Ch("password")]},Lc:{name:"signInWithPhoneNumber",j:[Ch("phoneNumber"),Rh()]},Mc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Nc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Sc:{name:"updateCurrentUser",j:[Oh({name:"user",K:"an instance of Firebase User",optional:!1,M:function(t){return!!(t&&t instanceof ic)}},Ah(),"user")]},ob:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Ch(null,!0)]},Uc:{name:"useDeviceLanguage",j:[]},Vc:{name:"verifyPasswordResetCode",j:[Ch("code")]}}),Mh(Wc.prototype,{lc:{name:"languageCode",ub:Oh(Ch(),Ah(),"languageCode")}}),(Wc.Persistence=Zs).LOCAL="local",Wc.Persistence.SESSION="session",Wc.Persistence.NONE="none",Ph(ic.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[Ih("opt_forceRefresh",!0)]},F:{name:"getIdToken",j:[Ih("opt_forceRefresh",!0)]},fb:{name:"linkAndRetrieveDataWithCredential",j:[kh()]},rc:{name:"linkWithCredential",j:[kh()]},sc:{name:"linkWithPhoneNumber",j:[Ch("phoneNumber"),Rh()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},hb:{name:"reauthenticateAndRetrieveDataWithCredential",j:[kh()]},Ac:{name:"reauthenticateWithCredential",j:[kh()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[Ch("phoneNumber"),Rh()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},kb:{name:"sendEmailVerification",j:[Oh(Nh("opt_actionCodeSettings",!0),Ah(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Ch(null,!0)]},Rc:{name:"unlink",j:[Ch("provider")]},qb:{name:"updateEmail",j:[Ch("email")]},rb:{name:"updatePassword",j:[Ch("password")]},Tc:{name:"updatePhoneNumber",j:[kh("phone")]},sb:{name:"updateProfile",j:[Nh("profile")]}}),Ph(nh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Ph(eh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),Ph(dt.prototype,{ia:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),Mh(Ku.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",ub:Ih("appVerificationDisabledForTesting")}}),Ph(Hu.prototype,{confirm:{name:"confirm",j:[Ch("verificationCode")]}}),xh(ji,"credential",function(t,e){return new Bi(t,e)},[Ch("email"),Ch("password")]),Ph(Pi.prototype,{ua:{name:"addScope",j:[Ch("scope")]},Da:{name:"setCustomParameters",j:[Nh("customOAuthParameters")]}}),xh(Pi,"credential",Mi,[Oh(Ch(),Nh(),"token")]),xh(ji,"credentialWithLink",Wi,[Ch("email"),Ch("emailLink")]),Ph(xi.prototype,{ua:{name:"addScope",j:[Ch("scope")]},Da:{name:"setCustomParameters",j:[Nh("customOAuthParameters")]}}),xh(xi,"credential",Li,[Oh(Ch(),Nh(),"token")]),Ph(Fi.prototype,{ua:{name:"addScope",j:[Ch("scope")]},Da:{name:"setCustomParameters",j:[Nh("customOAuthParameters")]}}),xh(Fi,"credential",Ui,[Oh(Ch(),Oh(Nh(),Ah()),"idToken"),Oh(Ch(),Ah(),"accessToken",!0)]),Ph(qi.prototype,{Da:{name:"setCustomParameters",j:[Nh("customOAuthParameters")]}}),xh(qi,"credential",Vi,[Oh(Ch(),Nh(),"token"),Ch("secret",!0)]),Ph(Oi.prototype,{ua:{name:"addScope",j:[Ch("scope")]},credential:{name:"credential",j:[Oh(Ch(),Ah(),"idToken",!0),Oh(Ch(),Ah(),"accessToken",!0),Oh(Ch(),Ah(),"nonce",!0)]},Da:{name:"setCustomParameters",j:[Nh("customOAuthParameters")]}}),xh(Gi,"credential",zi,[Ch("verificationId"),Ch("verificationCode")]),Ph(Gi.prototype,{Va:{name:"verifyPhoneNumber",j:[Ch("phoneNumber"),Rh()]}}),Ph(Vr.prototype,{toJSON:{name:"toJSON",j:[Ch(null,!0)]}}),Ph(ro.prototype,{toJSON:{name:"toJSON",j:[Ch(null,!0)]}}),Ph(no.prototype,{toJSON:{name:"toJSON",j:[Ch(null,!0)]}}),Ph(Eh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),function(){if(void 0===Fh||!Fh.INTERNAL||!Fh.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={Auth:Wc,Error:Vr};xh(t,"EmailAuthProvider",ji,[]),xh(t,"FacebookAuthProvider",Pi,[]),xh(t,"GithubAuthProvider",xi,[]),xh(t,"GoogleAuthProvider",Fi,[]),xh(t,"TwitterAuthProvider",qi,[]),xh(t,"OAuthProvider",Oi,[Ch("providerId")]),xh(t,"SAMLAuthProvider",Ri,[Ch("providerId")]),xh(t,"PhoneAuthProvider",Gi,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(t){return!!(t&&t instanceof Wc)}}]),xh(t,"RecaptchaVerifier",Eh,[Oh(Ch(),{name:"",K:"an HTML element",optional:!1,M:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),Nh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(t){return!!(t&&t instanceof Fh.app.App)}}]),Fh.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:v((t=new Wc(t)).getUid,t),getToken:v(t.cc,t),addAuthTokenListener:v(t.Vb,t),removeAuthTokenListener:v(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),Fh.INTERNAL.extendNamespace({User:ic})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ei=function(t,e){return(ei=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function ni(t,e){function n(){this.constructor=t}ei(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ri,ii,oi=function(){return(oi=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ai(o,a,s,u){return new(s||(s=Promise))(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function si(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function ui(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(ii=ri||(ri={}))[ii.DEBUG=0]="DEBUG",ii[ii.VERBOSE=1]="VERBOSE",ii[ii.INFO=2]="INFO",ii[ii.WARN=3]="WARN",ii[ii.ERROR=4]="ERROR",ii[ii.SILENT=5]="SILENT";var ci,hi=ri.INFO,li=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case ri.DEBUG:case ri.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ri.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ri.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case ri.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},fi=function(){function t(t){this.name=t,this._logLevel=hi,this._logHandler=li}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in ri))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ri.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ri.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ri.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ri.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,ri.ERROR].concat(t))},t}(),pi=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Dr(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Nr(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),di=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return kr(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),yi=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new pi(e)}}catch(t){}return new di},mi=yi("localStorage"),gi=yi("sessionStorage"),vi=new fi("@firebase/database"),bi=(ci=1,function(){return ci++}),wi=function(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;lr(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}e[n++]=i<128?i:(e[n++]=i<2048?i>>6|192:(e[n++]=i<65536?i>>12|224:(e[n++]=i>>18|240,i>>12&63|128),i>>6&63|128),63&i|128)}return e}(t),n=new qr;n.update(e);var r=n.digest();return dr.encodeByteArray(r)},_i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++)Array.isArray(t[r])||t[r]&&"object"==typeof t[r]&&"number"==typeof t[r].length?n+=_i.apply(null,t[r]):"object"==typeof t[r]?n+=Dr(t[r]):n+=t[r],n+=" ";return n},Ei=null,Ti=!0,Si=function(t,e){lr(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(vi.logLevel=ri.VERBOSE,Ei=vi.log.bind(vi),e&&gi.set("logging_enabled",!0)):"function"==typeof t?Ei=t:(Ei=null,gi.remove("logging_enabled"))},Ci=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===Ti&&(Ti=!1,null===Ei&&!0===gi.get("logging_enabled")&&Si(!0)),Ei){var n=_i.apply(null,t);Ei(n)}},Ii=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ci.apply(void 0,[n].concat(t))}},Ni=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+_i.apply(void 0,t);vi.error(n)},Di=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+_i.apply(void 0,t);throw vi.error(n),new Error(n)},Ai=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+_i.apply(void 0,t);vi.warn(n)},ki=function(t){return"number"==typeof t&&(t!=t||t==Number.POSITIVE_INFINITY||t==Number.NEGATIVE_INFINITY)},Ri="[MIN_NAME]",Oi="[MAX_NAME]",Pi=function(t,e){if(t===e)return 0;if(t===Ri||e===Oi)return-1;if(e===Ri||t===Oi)return 1;var n=Bi(t),r=Bi(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},Mi=function(t,e){return t===e?0:t<e?-1:1},xi=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Dr(e))},Li=function(t){if("object"!=typeof t||null===t)return Dr(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Dr(e[i]),r+=":",r+=Li(t[e[i]]);return r+="}"},Fi=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r},Ui=function(t,n){if(Array.isArray(t))for(var e=0;e<t.length;++e)n(e,t[e]);else Or(t,function(t,e){return n(e,t)})},qi=function(t){lr(!ki(t),"Invalid JSON number");var e,n,r,i,o,a,s;for(0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074)))),a=[],o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse(),s=a.join("");var u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()},Vi=new RegExp("^-?\\d{1,10}$"),Bi=function(t){if(Vi.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},ji=function(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw Ai("Exception was thrown by user callback.",t),e},Math.floor(0))}},Wi=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},Qi=function(){function i(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return Object.defineProperty(i,"Empty",{get:function(){return new i("")},enumerable:!0,configurable:!0}),i.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},i.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},i.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new i(this.pieces_,t)},i.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},i.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},i.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},i.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},i.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new i(t,0)},i.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof i)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new i(e,0)},i.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},i.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return i.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},i.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=Pi(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},i.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},i.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},i}(),Ki=function(){function t(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Gr(this.parts_[n]);this.checkValid_()}return Object.defineProperty(t,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(t,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),t.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=Gr(t),this.checkValid_()},t.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=Gr(t),0<this.parts_.length&&(this.byteLength_-=1)},t.prototype.checkValid_=function(){if(this.byteLength_>t.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+t.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>t.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+t.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},t.prototype.toErrorString=function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},t}(),Hi="firebaseio.com",Gi="websocket",zi="long_polling",Yi=function(){function t(t,e,n,r,i){void 0===i&&(i=""),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=mi.get("host:"+t)||this.host}return t.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()},t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},t.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&mi.set("host:"+this.host,this.internalHost))},t.prototype.connectionURL=function(t,e){var n;if(lr("string"==typeof t,"typeof type must == string"),lr("object"==typeof e,"typeof params must == object"),t===Gi)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==zi)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return Or(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},t}();var Xi,Ji,$i,Zi,to,eo=function(t){var e=no(t),n=e.subdomain;"firebase"===e.domain&&Di(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!=n||"localhost"===e.domain||Di("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Ai("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Yi(e.host,e.secure,n,r),path:new Qi(e.pathString)}},no=function(t){var e="",n="",r="",i="",o=!0,a="https",s=443;if("string"==typeof t){var u=t.indexOf("//");0<=u&&(a=t.substring(0,u-1),t=t.substring(u+2));var c=t.indexOf("/");-1===c&&(c=t.length);var h=t.indexOf("?");-1===h&&(h=t.length),e=t.substring(0,Math.min(c,h)),c<h&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(c,h)));var l=function(t){var e={};"?"===t.charAt(0)&&(t=t.substring(1));for(var n=0,r=t.split("&");n<r.length;n++){var i=r[n];if(0!==i.length){var o=i.split("=");2===o.length?e[decodeURIComponent(o[0])]=decodeURIComponent(o[1]):Ai("Invalid query segment '"+i+"' in query '"+t+"'")}}return e}(t.substring(Math.min(t.length,h)));0<=(u=e.indexOf(":"))?(o="https"===a||"wss"===a,s=parseInt(e.substring(u+1),10)):u=t.length;var f=e.split(".");3===f.length?(n=f[1],r=f[0].toLowerCase()):2===f.length?n=f[0]:"localhost"===f[0].slice(0,u).toLowerCase()&&(n="localhost"),""===r&&"ns"in l&&(r=l.ns)}return{host:e,port:s,domain:n,subdomain:r,secure:o,scheme:a,pathString:i}},ro=/[\[\].#$\/\u0000-\u001F\u007F]/,io=/[\[\].#$\u0000-\u001F\u007F]/,oo=10485760,ao=function(t){return"string"==typeof t&&0!==t.length&&!ro.test(t)},so=function(t){return"string"==typeof t&&0!==t.length&&!io.test(t)},uo=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!ki(t)||t&&"object"==typeof t&&kr(t,".sv")},co=function(t,e,n,r,i){i&&void 0===n||ho(Qr(t,e,i),n,r)},ho=function(n,t,e){var r=e instanceof Qi?new Ki(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(ki(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>oo/3&&Gr(t)>oo)throw new Error(n+"contains a string greater than "+oo+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Or(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!ao(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),ho(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},lo=function(t,e,n,r,i){if(!i||void 0!==n){var o=Qr(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];Or(n,function(t,e){var n=new Qi(t);if(ho(o,e,r.child(n)),".priority"===n.getBack()&&!uo(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ao(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(Qi.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}},fo=function(t,e,n,r){if(!r||void 0!==n){if(ki(n))throw new Error(Qr(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!uo(n))throw new Error(Qr(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},po=function(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Qr(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},yo=function(t,e,n,r){if(!(r&&void 0===n||ao(n)))throw new Error(Qr(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},mo=function(t,e,n,r){if(!(r&&void 0===n||so(n)))throw new Error(Qr(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},go=function(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")},vo=function(t,e,n){var r,i=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ao(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==i.length&&((r=i)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),!so(r)))throw new Error(Qr(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},bo=function(){function t(t,e){this.repo_=t,this.path_=e}return t.prototype.cancel=function(t){Wr("OnDisconnect.cancel",0,1,arguments.length),Kr("OnDisconnect.cancel",1,t,!0);var e=new br;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},t.prototype.remove=function(t){Wr("OnDisconnect.remove",0,1,arguments.length),go("OnDisconnect.remove",this.path_),Kr("OnDisconnect.remove",1,t,!0);var e=new br;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},t.prototype.set=function(t,e){Wr("OnDisconnect.set",1,2,arguments.length),go("OnDisconnect.set",this.path_),co("OnDisconnect.set",1,t,this.path_,!1),Kr("OnDisconnect.set",2,e,!0);var n=new br;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},t.prototype.setWithPriority=function(t,e,n){Wr("OnDisconnect.setWithPriority",2,3,arguments.length),go("OnDisconnect.setWithPriority",this.path_),co("OnDisconnect.setWithPriority",1,t,this.path_,!1),fo("OnDisconnect.setWithPriority",2,e,!1),Kr("OnDisconnect.setWithPriority",3,n,!0);var r=new br;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},t.prototype.update=function(t,e){if(Wr("OnDisconnect.update",1,2,arguments.length),go("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Ai("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}lo("OnDisconnect.update",1,t,this.path_,!1),Kr("OnDisconnect.update",2,e,!0);var i=new br;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},t}(),wo=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Wr("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),_o=(Xi="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Ji=0,$i=[],function(t){var e,n=t===Ji;Ji=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Xi.charAt(t%64),t=Math.floor(t/64);lr(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===$i[e];e--)$i[e]=0;$i[e]++}else for(e=0;e<12;e++)$i[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Xi.charAt($i[e]);return lr(20===i.length,"nextPushId: Length should be 20."),i}),Eo=function(){function n(t,e){this.name=t,this.node=e}return n.Wrap=function(t,e){return new n(t,e)},n}(),To=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new Eo(Ri,t),r=new Eo(Ri,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return Eo.MIN},t}(),So=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ni(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return Zi},set:function(t){Zi=t},enumerable:!0,configurable:!0}),e.prototype.compare=function(t,e){return Pi(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw fr("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return Eo.MIN},e.prototype.maxPost=function(){return new Eo(Oi,Zi)},e.prototype.makePost=function(t,e){return lr("string"==typeof t,"KeyIndex indexValue must always be a string."),new Eo(t,Zi)},e.prototype.toString=function(){return".key"},e}(To),Co=new So;var Io,No,Do,Ao=function(t){return"number"==typeof t?"number:"+qi(t):"string:"+t},ko=function(t){if(t.isLeafNode()){var e=t.val();lr("string"==typeof e||"number"==typeof e||"object"==typeof e&&kr(e,".sv"),"Priority must be a string or number.")}else lr(t===to||t.isEmpty(),"priority of unexpected type.");lr(t===to||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Ro=function(){function o(t,e){void 0===e&&(e=o.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,lr(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ko(this.priorityNode_)}return Object.defineProperty(o,"__childrenNodeConstructor",{get:function(){return Io},set:function(t){Io=t},enumerable:!0,configurable:!0}),o.prototype.isLeafNode=function(){return!0},o.prototype.getPriority=function(){return this.priorityNode_},o.prototype.updatePriority=function(t){return new o(this.value_,t)},o.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:o.__childrenNodeConstructor.EMPTY_NODE},o.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:o.__childrenNodeConstructor.EMPTY_NODE},o.prototype.hasChild=function(){return!1},o.prototype.getPredecessorChildName=function(t,e){return null},o.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:o.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},o.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(lr(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,o.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},o.prototype.isEmpty=function(){return!1},o.prototype.numChildren=function(){return 0},o.prototype.forEachChild=function(t,e){return!1},o.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},o.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ao(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?qi(this.value_):this.value_,this.lazyHash_=wi(t)}return this.lazyHash_},o.prototype.getValue=function(){return this.value_},o.prototype.compareTo=function(t){return t===o.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof o.__childrenNodeConstructor?-1:(lr(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},o.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=o.VALUE_TYPE_ORDER.indexOf(e),i=o.VALUE_TYPE_ORDER.indexOf(n);return lr(0<=r,"Unknown leaf type: "+e),lr(0<=i,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},o.prototype.withIndex=function(){return this},o.prototype.isIndexed=function(){return!0},o.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},o.VALUE_TYPE_ORDER=["object","boolean","number","string"],o}();var Oo,Po,Mo=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ni(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?Pi(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return Eo.MIN},e.prototype.maxPost=function(){return new Eo(Oi,new Ro("[PRIORITY-POST]",Do))},e.prototype.makePost=function(t,e){var n=No(t);return new Eo(e,new Ro("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(To)),xo=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return 0<this.nodeStack_.length},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),Lo=function(){function o(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:o.RED,this.left=null!=r?r:Uo.EMPTY_NODE,this.right=null!=i?i:Uo.EMPTY_NODE}return o.prototype.copy=function(t,e,n,r,i){return new o(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},o.prototype.count=function(){return this.left.count()+1+this.right.count()},o.prototype.isEmpty=function(){return!1},o.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},o.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},o.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},o.prototype.minKey=function(){return this.min_().key},o.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},o.prototype.insert=function(t,e,n){var r,i;return(i=(r=n(t,(i=this).key))<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n))).fixUp_()},o.prototype.removeMin_=function(){if(this.left.isEmpty())return Uo.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},o.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Uo.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},o.prototype.isRed_=function(){return this.color},o.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},o.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},o.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},o.prototype.rotateLeft_=function(){var t=this.copy(null,null,o.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},o.prototype.rotateRight_=function(){var t=this.copy(null,null,o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},o.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},o.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},o.prototype.check_=function(){var t;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if((t=this.left.check_())!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},o.RED=!0,o.BLACK=!1,o}(),Fo=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Lo(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Uo=function(){function n(t,e){void 0===e&&(e=n.EMPTY_NODE),this.comparator_=t,this.root_=e}return n.prototype.insert=function(t,e){return new n(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,Lo.BLACK,null,null))},n.prototype.remove=function(t){return new n(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Lo.BLACK,null,null))},n.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},n.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},n.prototype.isEmpty=function(){return this.root_.isEmpty()},n.prototype.count=function(){return this.root_.count()},n.prototype.minKey=function(){return this.root_.minKey()},n.prototype.maxKey=function(){return this.root_.maxKey()},n.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},n.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},n.prototype.getIterator=function(t){return new xo(this.root_,null,this.comparator_,!1,t)},n.prototype.getIteratorFrom=function(t,e){return new xo(this.root_,t,this.comparator_,!1,e)},n.prototype.getReverseIteratorFrom=function(t,e){return new xo(this.root_,t,this.comparator_,!0,e)},n.prototype.getReverseIterator=function(t){return new xo(this.root_,null,this.comparator_,!0,t)},n.EMPTY_NODE=new Fo,n}(),qo=Math.log(2),Vo=function(){function t(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/qo,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),Bo=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new Lo(r,n.node,Lo.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new Lo(r,n.node,Lo.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(n+1,r),o=c[n],a=h?h(o):o;u(new Lo(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,Lo.BLACK):(r(a,Lo.BLACK),r(a,Lo.RED))}return n}(new Vo(c.length));return new Uo(e||t,n)},jo={},Wo=function(){function l(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(l,"Default",{get:function(){return lr(Mo,"ChildrenNode.ts has not been loaded"),Oo=Oo||new l({".priority":jo},{".priority":Mo})},enumerable:!0,configurable:!0}),l.prototype.get=function(t){var e=Rr(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e===jo?null:e},l.prototype.hasIndex=function(t){return kr(this.indexSet_,t.toString())},l.prototype.addIndex=function(t,e){lr(t!==Co,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(Eo.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?Bo(r,t.getCompare()):jo;var s=t.toString(),u=Pr(this.indexSet_);u[s]=t;var c=Pr(this.indexes_);return c[s]=n,new l(c,u)},l.prototype.addToIndexes=function(u,c){var h=this;return new l(Lr(this.indexes_,function(t,e){var n=Rr(h.indexSet_,e);if(lr(n,"Missing index implementation for "+e),t===jo){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(Eo.Wrap),o=i.getNext();o;)o.name!=u.name&&r.push(o),o=i.getNext();return r.push(u),Bo(r,n.getCompare())}return jo}var a=c.get(u.name),s=t;return a&&(s=s.remove(new Eo(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},l.prototype.removeFromIndexes=function(n,r){return new l(Lr(this.indexes_,function(t){if(t===jo)return t;var e=r.get(n.name);return e?t.remove(new Eo(n.name,e)):t}),this.indexSet_)},l}();function Qo(t,e){return Pi(t.name,e.name)}function Ko(t,e){return Pi(t,e)}var Ho=function(){function s(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ko(this.priorityNode_),this.children_.isEmpty()&&lr(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(s,"EMPTY_NODE",{get:function(){return Po||(Po=new s(new Uo(Ko),null,Wo.Default))},enumerable:!0,configurable:!0}),s.prototype.isLeafNode=function(){return!1},s.prototype.getPriority=function(){return this.priorityNode_||Po},s.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new s(this.children_,t,this.indexMap_)},s.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Po:e},s.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},s.prototype.hasChild=function(t){return null!==this.children_.get(t)},s.prototype.updateImmediateChild=function(t,e){if(lr(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n=new Eo(t,e),r=void 0,i=void 0;return i=e.isEmpty()?(r=this.children_.remove(t),this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(t,e),this.indexMap_.addToIndexes(n,this.children_)),new s(r,r.isEmpty()?Po:this.priorityNode_,i)},s.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;lr(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},s.prototype.isEmpty=function(){return this.children_.isEmpty()},s.prototype.numChildren=function(){return this.children_.count()},s.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(Mo,function(t,e){r[t]=e.val(n),i++,a&&s.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},s.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+Ao(this.getPriority().val())+":"),this.forEachChild(Mo,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":wi(r)}return this.lazyHash_},s.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Eo(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},s.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},s.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Eo(e,this.children_.get(e)):null},s.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},s.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Eo(e,this.children_.get(e)):null},s.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},s.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},s.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Eo.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},s.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},s.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Eo.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},s.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Go?-1:0},s.prototype.withIndex=function(t){if(t===Co||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new s(this.children_,this.priorityNode_,e)},s.prototype.isIndexed=function(t){return t===Co||this.indexMap_.hasIndex(t)},s.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(Mo),r=e.getIterator(Mo),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},s.prototype.resolveIndex_=function(t){return t===Co?null:this.indexMap_.get(t.toString())},s.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,s}(),Go=new(function(t){function e(){return t.call(this,new Uo(Ko),Ho.EMPTY_NODE,Wo.Default)||this}return ni(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return Ho.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(Ho));Object.defineProperties(Eo,{MIN:{value:new Eo(Ri,Ho.EMPTY_NODE)},MAX:{value:new Eo(Oi,Go)}}),So.__EMPTY_NODE=Ho.EMPTY_NODE,Ro.__childrenNodeConstructor=Ho,to=Go,Do=Go;var zo=!0;function Yo(t,e){if(void 0===e&&(e=null),null===t)return Ho.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),lr(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Ro(t,Yo(e));if(t instanceof Array||!zo){var r=Ho.EMPTY_NODE,i=t;return Or(i,function(t,e){if(kr(i,t)&&"."!==t.substring(0,1)){var n=Yo(e);!n.isLeafNode()&&n.isEmpty()||(r=r.updateImmediateChild(t,n))}}),r.updatePriority(Yo(e))}var o=[],a=!1,s=t;if(Or(s,function(t,e){if("string"!=typeof t||"."!==t.substring(0,1)){var n=Yo(s[t]);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new Eo(t,n)))}}),0==o.length)return Ho.EMPTY_NODE;var n=Bo(o,Qo,function(t){return t.name},Ko);if(a){var u=Bo(o,Mo.getCompare());return new Ho(n,Yo(e),new Wo({".priority":u},{".priority":Mo}))}return new Ho(n,Yo(e),Wo.Default)}No=Yo;var Xo,Jo,$o,Zo=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ni(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?Pi(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return Eo.MIN},e.prototype.maxPost=function(){return Eo.MAX},e.prototype.makePost=function(t,e){var n=Yo(t);return new Eo(e,n)},e.prototype.toString=function(){return".value"},e}(To)),ta=function(n){function t(t){var e=n.call(this)||this;return e.indexPath_=t,lr(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}return ni(t,n),t.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?Pi(t.name,e.name):i},t.prototype.makePost=function(t,e){var n=Yo(t),r=Ho.EMPTY_NODE.updateChild(this.indexPath_,n);return new Eo(e,r)},t.prototype.maxPost=function(){var t=Ho.EMPTY_NODE.updateChild(this.indexPath_,Go);return new Eo(Oi,t)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(To),ea=function(){function i(t,e,n){this.node_=t,this.ref_=e,this.index_=n}return i.prototype.val=function(){return Wr("DataSnapshot.val",0,0,arguments.length),this.node_.val()},i.prototype.exportVal=function(){return Wr("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},i.prototype.toJSON=function(){return Wr("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},i.prototype.exists=function(){return Wr("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},i.prototype.child=function(t){Wr("DataSnapshot.child",0,1,arguments.length),t=String(t),mo("DataSnapshot.child",1,t,!1);var e=new Qi(t),n=this.ref_.child(e);return new i(this.node_.getChild(e),n,Mo)},i.prototype.hasChild=function(t){Wr("DataSnapshot.hasChild",1,1,arguments.length),mo("DataSnapshot.hasChild",1,t,!1);var e=new Qi(t);return!this.node_.getChild(e).isEmpty()},i.prototype.getPriority=function(){return Wr("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},i.prototype.forEach=function(n){var r=this;return Wr("DataSnapshot.forEach",1,1,arguments.length),Kr("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new i(e,r.ref_.child(t),Mo))})},i.prototype.hasChildren=function(){return Wr("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(i.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),i.prototype.numChildren=function(){return Wr("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},i.prototype.getRef=function(){return Wr("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(i.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),i}(),na=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Dr(this.snapshot.exportVal())},t}(),ra=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),ia=function(){function e(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}return e.prototype.respondsTo=function(t){return"value"===t},e.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new na("value",this,new ea(t.snapshotNode,e.getRef(),n))},e.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){lr(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},e.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new ra(this,t,e):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),oa=function(){function i(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}return i.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,kr(this.callbacks_,e)},i.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new ra(this,t,e):null},i.prototype.createEvent=function(t,e){lr(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new na(t.type,this,new ea(t.snapshotNode,n,r),t.prevName)},i.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){lr(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},i.prototype.matches=function(n){if(n instanceof i){if(!this.callbacks_||!n.callbacks_)return!0;if(this.context_===n.context_){var t=xr(n.callbacks_);if(t===xr(this.callbacks_)){if(1!==t)return function(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&!e(n,t[n]))return!1;return!0}(this.callbacks_,function(t,e){return n.callbacks_[t]===e});var e=Ur(n.callbacks_),r=Ur(this.callbacks_);return!(r!==e||n.callbacks_[e]&&this.callbacks_[r]&&n.callbacks_[e]!==this.callbacks_[r])}}}return!1},i.prototype.hasAnyCallback=function(){return null!==this.callbacks_},i}(),aa=function(){function c(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(c,"__referenceConstructor",{get:function(){return lr(Xo,"Reference.ts has not been loaded"),Xo},set:function(t){Xo=t},enumerable:!0,configurable:!0}),c.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Co){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!=Ri)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!=Oi)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===Mo){if(null!=e&&!uo(e)||null!=n&&!uo(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(lr(t.getIndex()instanceof ta||t.getIndex()===Zo,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},c.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},c.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},c.prototype.getQueryParams=function(){return this.queryParams_},c.prototype.getRef=function(){return Wr("Query.ref",0,0,arguments.length),new c.__referenceConstructor(this.repo,this.path)},c.prototype.on=function(t,e,n,r){Wr("Query.on",2,4,arguments.length),po("Query.on",1,t,!1),Kr("Query.on",2,e,!1);var i=c.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},c.prototype.onValueEvent=function(t,e,n){var r=new ia(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},c.prototype.onChildEvent=function(t,e,n){var r=new oa(t,e,n);this.repo.addEventCallbackForQuery(this,r)},c.prototype.off=function(t,e,n){Wr("Query.off",0,3,arguments.length),po("Query.off",1,t,!0),Kr("Query.off",2,e,!0),Hr("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new ia(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new oa(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},c.prototype.once=function(e,n,t,r){var i=this;Wr("Query.once",1,4,arguments.length),po("Query.once",1,e,!1),Kr("Query.once",2,n,!0);var o=c.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new br;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},c.prototype.limitToFirst=function(t){if(Wr("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new c(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},c.prototype.limitToLast=function(t){if(Wr("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new c(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},c.prototype.orderByChild=function(t){if(Wr("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');mo("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new Qi(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new ta(e),r=this.queryParams_.orderBy(n);return c.validateQueryEndpoints_(r),new c(this.repo,this.path,r,!0)},c.prototype.orderByKey=function(){Wr("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(Co);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.orderByPriority=function(){Wr("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Mo);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.orderByValue=function(){Wr("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Zo);return c.validateQueryEndpoints_(t),new c(this.repo,this.path,t,!0)},c.prototype.startAt=function(t,e){void 0===t&&(t=null),Wr("Query.startAt",0,2,arguments.length),co("Query.startAt",1,t,this.path,!0),yo("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(c.validateLimit_(n),c.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new c(this.repo,this.path,n,this.orderByCalled_)},c.prototype.endAt=function(t,e){void 0===t&&(t=null),Wr("Query.endAt",0,2,arguments.length),co("Query.endAt",1,t,this.path,!0),yo("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(c.validateLimit_(n),c.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new c(this.repo,this.path,n,this.orderByCalled_)},c.prototype.equalTo=function(t,e){if(Wr("Query.equalTo",1,2,arguments.length),co("Query.equalTo",1,t,this.path,!1),yo("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},c.prototype.toString=function(){return Wr("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},c.prototype.toJSON=function(){return Wr("Query.toJSON",0,1,arguments.length),this.toString()},c.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},c.prototype.queryIdentifier=function(){var t=this.queryObject(),e=Li(t);return"{}"===e?"default":e},c.prototype.isEqual=function(t){if(Wr("Query.isEqual",1,1,arguments.length),!(t instanceof c)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},c.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,Kr(t,3,r.cancel,!0),r.context=n,Hr(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Qr(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(c.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),c}(),sa=function(){function t(){this.set={}}return t.prototype.add=function(t,e){this.set[t]=null===e||e},t.prototype.contains=function(t){return kr(this.set,t)},t.prototype.get=function(t){return this.contains(t)?this.set[t]:void 0},t.prototype.remove=function(t){delete this.set[t]},t.prototype.clear=function(){this.set={}},t.prototype.isEmpty=function(){return Mr(this.set)},t.prototype.count=function(){return xr(this.set)},t.prototype.each=function(n){Or(this.set,function(t,e){return n(t,e)})},t.prototype.keys=function(){var e=[];return Or(this.set,function(t){e.push(t)}),e},t}(),ua=function(){function i(){this.value_=null,this.children_=null}return i.prototype.find=function(t){if(null!=this.value_)return this.value_.getChild(t);if(t.isEmpty()||null==this.children_)return null;var e=t.getFront();return t=t.popFront(),this.children_.contains(e)?this.children_.get(e).find(t):null},i.prototype.remember=function(t,e){if(t.isEmpty())this.value_=e,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(t,e);else{null==this.children_&&(this.children_=new sa);var n=t.getFront();this.children_.contains(n)||this.children_.add(n,new i);var r=this.children_.get(n);t=t.popFront(),r.remember(t,e)}},i.prototype.forget=function(t){if(t.isEmpty())return this.value_=null,!(this.children_=null);if(null!==this.value_){if(this.value_.isLeafNode())return!1;var e=this.value_;this.value_=null;var n=this;return e.forEachChild(Mo,function(t,e){n.remember(new Qi(t),e)}),this.forget(t)}if(null===this.children_)return!0;var r=t.getFront();return t=t.popFront(),this.children_.contains(r)&&this.children_.get(r).forget(t)&&this.children_.remove(r),!!this.children_.isEmpty()&&!(this.children_=null)},i.prototype.forEachTree=function(r,i){null!==this.value_?i(r,this.value_):this.forEachChild(function(t,e){var n=new Qi(r.toString()+"/"+t);e.forEachTree(n,i)})},i.prototype.forEachChild=function(n){null!==this.children_&&this.children_.each(function(t,e){n(t,e)})},i}(),ca=function(t,e){return t&&"object"==typeof t?(lr(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t},ha=function(t,r){var i,e=t.getPriority().val(),n=ca(e,r);if(t.isLeafNode()){var o=t,a=ca(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new Ro(a,Yo(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new Ro(n))),s.forEachChild(Mo,function(t,e){var n=ha(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};($o=Jo||(Jo={}))[$o.OVERWRITE=0]="OVERWRITE",$o[$o.MERGE=1]="MERGE",$o[$o.ACK_USER_WRITE=2]="ACK_USER_WRITE",$o[$o.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var la,fa,pa=function(){function e(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,lr(!r||e,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),da=function(){function n(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Jo.ACK_USER_WRITE,this.source=pa.User}return n.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return lr(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new Qi(t));return new n(Qi.Empty,e,this.revert)}return lr(this.path.getFront()===t,"operationForChild called for unrelated child."),new n(this.path.popFront(),this.affectedTree,this.revert)},n}(),ya=function(){function o(t,e){void 0===e&&(la||(la=new Uo(Mi)),e=la),this.value=t,this.children=e}return o.fromObject=function(t){var n=o.Empty;return Or(t,function(t,e){n=n.set(new Qi(t),e)}),n},o.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},o.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:Qi.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new Qi(n).child(i.path),value:i.value}},o.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},o.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):o.Empty},o.prototype.set=function(t,e){if(t.isEmpty())return new o(e,this.children);var n=t.getFront(),r=(this.children.get(n)||o.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new o(this.value,i)},o.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?o.Empty:new o(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?o.Empty:new o(this.value,i)}return this},o.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},o.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||o.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new o(this.value,i)},o.prototype.fold=function(t){return this.fold_(Qi.Empty,t)},o.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},o.prototype.findOnPath=function(t,e){return this.findOnPath_(t,Qi.Empty,e)},o.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},o.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,Qi.Empty,e)},o.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):o.Empty},o.prototype.foreach=function(t){this.foreach_(Qi.Empty,t)},o.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},o.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},o.Empty=new o(null),o}(),ma=function(){function e(t,e){this.source=t,this.path=e,this.type=Jo.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,Qi.Empty):new e(this.source,this.path.popFront())},e}(),ga=function(){function e(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Jo.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,Qi.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),va=function(){function n(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Jo.MERGE}return n.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new Qi(t));return e.isEmpty()?null:e.value?new ga(this.source,Qi.Empty,e.value):new n(this.source,Qi.Empty,e)}return lr(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new n(this.source,this.path.popFront(),this.children)},n.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},n}(),ba=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),wa=function(){function r(t,e){this.eventCache_=t,this.serverCache_=e}return r.prototype.updateEventSnap=function(t,e,n){return new r(new ba(t,e,n),this.serverCache_)},r.prototype.updateServerSnap=function(t,e,n){return new r(this.eventCache_,new ba(t,e,n))},r.prototype.getEventCache=function(){return this.eventCache_},r.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},r.prototype.getServerCache=function(){return this.serverCache_},r.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},r.Empty=new r(new ba(Ho.EMPTY_NODE,!1,!1),new ba(Ho.EMPTY_NODE,!1,!1)),r}(),_a=function(){function r(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}return r.valueChange=function(t){return new r(r.VALUE,t)},r.childAddedChange=function(t,e){return new r(r.CHILD_ADDED,e,t)},r.childRemovedChange=function(t,e){return new r(r.CHILD_REMOVED,e,t)},r.childChangedChange=function(t,e,n){return new r(r.CHILD_CHANGED,e,t,n)},r.childMovedChange=function(t,e){return new r(r.CHILD_MOVED,e,t)},r.CHILD_ADDED="child_added",r.CHILD_REMOVED="child_removed",r.CHILD_CHANGED="child_changed",r.CHILD_MOVED="child_moved",r.VALUE="value",r}(),Ea=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,i,o){lr(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()==n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(_a.childRemovedChange(e,a)):lr(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(_a.childAddedChange(e,n)):o.trackChildChange(_a.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(Mo,function(t,e){n.hasChild(t)||i.trackChildChange(_a.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(Mo,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(_a.childChangedChange(t,e,n))}else i.trackChildChange(_a.childAddedChange(t,e))})),n.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?Ho.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),Ta=function(){function t(){this.changeMap_={}}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;lr(e==_a.CHILD_ADDED||e==_a.CHILD_CHANGED||e==_a.CHILD_REMOVED,"Only child changes supported for tracking"),lr(".priority"!==n,"Only non-priority child changes can be tracked.");var r=Rr(this.changeMap_,n);if(r){var i=r.type;if(e==_a.CHILD_ADDED&&i==_a.CHILD_REMOVED)this.changeMap_[n]=_a.childChangedChange(n,t.snapshotNode,r.snapshotNode);else if(e==_a.CHILD_REMOVED&&i==_a.CHILD_ADDED)delete this.changeMap_[n];else if(e==_a.CHILD_REMOVED&&i==_a.CHILD_CHANGED)this.changeMap_[n]=_a.childRemovedChange(n,r.oldSnap);else if(e==_a.CHILD_CHANGED&&i==_a.CHILD_ADDED)this.changeMap_[n]=_a.childAddedChange(n,t.snapshotNode);else{if(e!=_a.CHILD_CHANGED||i!=_a.CHILD_CHANGED)throw fr("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap_[n]=_a.childChangedChange(n,t.snapshotNode,r.oldSnap)}}else this.changeMap_[n]=t},t.prototype.getChanges=function(){return function(t){var e=[],n=0;for(var r in t)e[n++]=t[r];return e}(this.changeMap_)},t}(),Sa=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),Ca=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new ba(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},t}(),Ia=function(t,e){this.viewCache=t,this.changes=e},Na=function(){function l(t){this.filter_=t}return l.prototype.assertIndexed=function(t){lr(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),lr(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},l.prototype.applyOperation=function(t,e,n,r){var i,o,a=new Ta;if(e.type===Jo.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(lr(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===Jo.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(lr(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===Jo.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==Jo.LISTEN_COMPLETE)throw fr("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return l.maybeAddValueEvent_(t,i,h),new Ia(i,h)},l.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(_a.valueChange(e.getCompleteEventSnap()))}},l.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(lr(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof Ho?u:Ho.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"==f){lr(1==e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var y=e.popFront(),m=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);m=null!=g?o.getNode().getImmediateChild(f).updateChild(y,g):o.getNode().getImmediateChild(f)}else m=n.calcCompleteChild(f,t.getServerCache());a=null!=m?this.filter_.updateChild(o.getNode(),f,m,y,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},l.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"==l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,Sa,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),y=new Ca(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,y,a)},l.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new Ca(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Ho.EMPTY_NODE}if(f.equals(p))a=t;else{var y=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(y,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},l.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},l.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);l.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);l.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},l.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},l.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:ya.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new Qi(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new Qi(t),i,a,s,u,c)}}),l},l.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=ya.Empty;return s.getNode().forEachChild(Co,function(t,e){u=u.set(new Qi(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=ya.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},l.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,Sa,r)},l.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new Ca(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();lr(h instanceof Ho,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,Ho.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(Qi.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},l}(),Da=function(){function t(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}return t.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===_a.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(_a.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,_a.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,_a.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,_a.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,_a.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,_a.VALUE,t,n,e),i},t.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},t.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},t.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw fr("Should only compare child_ events.");var n=new Eo(t.childName,t.snapshotNode),r=new Eo(e.childName,e.snapshotNode);return this.index_.compare(n,r)},t}(),Aa=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new Ea(n.getIndex()),i=n.getNodeFilter();this.processor_=new Na(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(Ho.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Ho.EMPTY_NODE,a.getNode(),null),c=new ba(s,o.isFullyInitialized(),r.filtersNodes()),h=new ba(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new wa(h,c),this.eventGenerator_=new Da(this.query_)}return t.prototype.getQuery=function(){return this.query_},t.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},t.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},t.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},t.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},t.prototype.removeEventRegistration=function(t,n){var r=[];if(n){lr(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},t.prototype.applyOperation=function(t,e,n){t.type===Jo.MERGE&&null!==t.source.queryId&&(lr(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),lr(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),lr(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},t.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];e.getNode().isLeafNode()||e.getNode().forEachChild(Mo,function(t,e){n.push(_a.childAddedChange(t,e))});return e.isFullyInitialized()&&n.push(_a.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},t.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},t}(),ka=function(){function c(){this.views_={}}return Object.defineProperty(c,"__referenceConstructor",{get:function(){return lr(fa,"Reference.ts has not been loaded"),fa},set:function(t){lr(!fa,"__referenceConstructor has already been defined"),fa=t},enumerable:!0,configurable:!0}),c.prototype.isEmpty=function(){return Mr(this.views_)},c.prototype.applyOperation=function(n,r,i){var t=n.source.queryId;if(null!==t){var e=Rr(this.views_,t);return lr(null!=e,"SyncTree gave us an op for an invalid query."),e.applyOperation(n,r,i)}var o=[];return Or(this.views_,function(t,e){o=o.concat(e.applyOperation(n,r,i))}),o},c.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=Rr(this.views_,o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof Ho?n.calcCompleteEventChildren(r):Ho.EMPTY_NODE,!1);var c=new wa(new ba(s,u,!1),new ba(r,i,!1));a=new Aa(t,c),this.views_[o]=a}return a.addEventRegistration(e),a.getInitialEvents(e)},c.prototype.removeEventRegistration=function(t,n,r){var e=t.queryIdentifier(),i=[],o=[],a=this.hasCompleteView();if("default"===e){var s=this;Or(this.views_,function(t,e){o=o.concat(e.removeEventRegistration(n,r)),e.isEmpty()&&(delete s.views_[t],e.getQuery().getQueryParams().loadsAllData()||i.push(e.getQuery()))})}else{var u=Rr(this.views_,e);u&&(o=o.concat(u.removeEventRegistration(n,r)),u.isEmpty()&&(delete this.views_[e],u.getQuery().getQueryParams().loadsAllData()||i.push(u.getQuery())))}return a&&!this.hasCompleteView()&&i.push(new c.__referenceConstructor(t.repo,t.path)),{removed:i,events:o}},c.prototype.getQueryViews=function(){var e=this;return Object.keys(this.views_).map(function(t){return e.views_[t]}).filter(function(t){return!t.getQuery().getQueryParams().loadsAllData()})},c.prototype.getCompleteServerCache=function(n){var r=null;return Or(this.views_,function(t,e){r=r||e.getCompleteServerCache(n)}),r},c.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return Rr(this.views_,e)},c.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},c.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},c.prototype.getCompleteView=function(){var t,e,n;return(t=this.views_,(n=Fr(t,function(t){return t.getQuery().getQueryParams().loadsAllData()},e))&&t[n])||null},c}(),Ra=function(){function s(t){this.writeTree_=t}return s.prototype.addWrite=function(t,e){if(t.isEmpty())return new s(new ya(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=Qi.relativePath(r,t);return i=i.updateChild(o,e),new s(this.writeTree_.set(r,i))}var a=new ya(e);return new s(this.writeTree_.setTree(t,a))},s.prototype.addWrites=function(n,t){var r=this;return Or(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},s.prototype.removeWrite=function(t){return t.isEmpty()?s.Empty:new s(this.writeTree_.setTree(t,ya.Empty))},s.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},s.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(Qi.relativePath(e.path,t)):null},s.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Mo,function(t,e){n.push(new Eo(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new Eo(t,e.value))}),n},s.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new s(null!=e?new ya(e):this.writeTree_.subtree(t))},s.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},s.prototype.apply=function(t){return s.applySubtreeWrite_(Qi.Empty,this.writeTree_,t)},s.Empty=new s(new ya(null)),s.applySubtreeWrite_=function(n,t,r){if(null!=t.value)return r.updateChild(n,t.value);var i=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(lr(null!==e.value,"Priority writes must always be leaf nodes"),i=e.value):r=s.applySubtreeWrite_(n.child(t),e,r)}),r.getChild(n).isEmpty()||null===i||(r=r.updateChild(n.child(".priority"),i)),r},s}(),Oa=function(){function c(){this.visibleWrites_=Ra.Empty,this.allWrites_=[],this.lastWriteId_=-1}return c.prototype.childWrites=function(t){return new Pa(t,this)},c.prototype.addOverwrite=function(t,e,n,r){lr(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},c.prototype.addMerge=function(t,e,n){lr(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},c.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},c.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});lr(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}if(i){if(o)return this.resetTree_(),!0;if(r.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(r.path);else{var u=r.children;Or(u,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))})}return!0}return!1},c.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},c.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(Qi.Empty)){var o=c.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);u=t||Ho.EMPTY_NODE;return o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(Qi.Empty)){var u=t||Ho.EMPTY_NODE;return s.apply(u)}return null},c.prototype.calcCompleteEventChildren=function(t,e){var r=Ho.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(Mo,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(Mo,function(t,e){var n=i.childCompoundWrite(new Qi(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},c.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){lr(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},c.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},c.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},c.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(Qi.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},c.prototype.recordContainsPath_=function(n,r){return n.snap?n.path.contains(r):!!Fr(n.children,function(t,e){return n.path.child(e).contains(r)})},c.prototype.resetTree_=function(){this.visibleWrites_=c.layerTree_(this.allWrites_,c.DefaultFilter_,Qi.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},c.DefaultFilter_=function(t){return t.visible},c.layerTree_=function(t,e,n){for(var r=Ra.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=Qi.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=Qi.relativePath(a,n),r=r.addWrite(Qi.Empty,o.snap.getChild(s)));else{if(!o.children)throw fr("WriteRecord should have .snap or .children");if(n.contains(a))s=Qi.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=Qi.relativePath(a,n)).isEmpty())r=r.addWrites(Qi.Empty,o.children);else{var u=Rr(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(Qi.Empty,c)}}}}}return r},c}(),Pa=function(){function e(t,e){this.treePath_=t,this.writeTree_=e}return e.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},e.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},e.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},e.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},e.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},e.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),Ma=function(){function g(t){this.listenProvider_=t,this.syncPointTree_=ya.Empty,this.pendingWriteTree_=new Oa,this.tagToQueryMap_={},this.queryToTagMap_={}}return g.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new ga(pa.User,t,e)):[]},g.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=ya.fromObject(e);return this.applyOperationToSyncPoints_(new va(pa.User,t,r))},g.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=ya.Empty;return null!=n.snap?r=r.set(Qi.Empty,!0):Or(n.children,function(t,e){r=r.set(new Qi(t),e)}),this.applyOperationToSyncPoints_(new da(n.path,r,e))}return[]},g.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new ga(pa.Server,t,e))},g.prototype.applyServerMerge=function(t,e){var n=ya.fromObject(e);return this.applyOperationToSyncPoints_(new va(pa.Server,t,n))},g.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new ma(pa.Server,t))},g.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=g.parseQueryKey_(r),o=i.path,a=i.queryId,s=Qi.relativePath(o,t),u=new ga(pa.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},g.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=g.parseQueryKey_(r),o=i.path,a=i.queryId,s=Qi.relativePath(o,t),u=ya.fromObject(e),c=new va(pa.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},g.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=g.parseQueryKey_(n),i=r.path,o=r.queryId,a=Qi.relativePath(i,t),s=new ma(pa.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},g.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=Qi.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);(a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(Qi.Empty)):(a=new ka,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i)?n=!0:(n=!1,i=Ho.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(Qi.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=g.makeQueryKey_(t);lr(!(u in this.queryToTagMap_),"View does not exist, but we have a tag");var c=g.getNextQueryTag_();this.queryToTagMap_[u]=c,this.tagToQueryMap_["_"+c]=u}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},g.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],y=d.getQuery(),m=this.createListenerForView_(d);this.listenProvider_.startListening(g.queryForListening_(y),this.tagForQuery_(y),m.hashFn,m.onComplete)}}if(!h&&0<u.length&&!n)if(c){this.listenProvider_.stopListening(g.queryForListening_(t),null)}else u.forEach(function(t){var e=r.queryToTagMap_[g.makeQueryKey_(t)];r.listenProvider_.stopListening(g.queryForListening_(t),e)});this.removeTags_(u)}return a},g.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=Qi.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},g.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),Or(n,function(t,e){r=r.concat(e)}),r})},g.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=g.makeQueryKey_(n),i=this.queryToTagMap_[r];delete this.queryToTagMap_[r],delete this.tagToQueryMap_["_"+i]}}},g.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},g.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(g.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)lr(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),Or(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(g.queryForListening_(c),this.tagForQuery_(c))}return o},g.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||Ho.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==t?n="Client doesn't have permission to access the desired data.":"unavailable"==t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},g.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},g.parseQueryKey_=function(t){var e=t.indexOf("$");return lr(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Qi(t.substr(0,e))}},g.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap_["_"+t]},g.prototype.tagForQuery_=function(t){var e=g.makeQueryKey_(t);return Rr(this.queryToTagMap_,e)},g.getNextQueryTag_=function(){return g.nextQueryTag_++},g.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);lr(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},g.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Qi.Empty))},g.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(Qi.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(Qi.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},g.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(Qi.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(Qi.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},g.nextQueryTag_=1,g}(),xa=function(){function t(){this.rootNode_=Ho.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}(),La=function(){function t(t){this.app_=t}return t.prototype.getToken=function(t){return this.app_.INTERNAL.getToken(t).then(null,function(t){return t&&"auth/token-not-initialized"===t.code?(Ci("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)})},t.prototype.addTokenChangeListener=function(t){this.app_.INTERNAL.addAuthTokenListener(t)},t.prototype.removeTokenChangeListener=function(t){this.app_.INTERNAL.removeAuthTokenListener(t)},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ai(t)},t}(),Fa=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),kr(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return mr(this.counters_)},t}(),Ua=function(){function t(){}return t.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new Fa),this.collections_[e]},t.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},t.collections_={},t.reporters_={},t}(),qa=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),n=Pr(t);return this.last_&&Or(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},t}(),Va=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new qa(t);var n=1e4+2e4*Math.random();Wi(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.includeStat=function(t){this.statsToReport_[t]=!0},t.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;Or(t,function(t,e){0<e&&kr(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),Wi(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Ba=function(){function t(){this.eventLists_=[],this.recursionDepth_=0}return t.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new ja(i)),e.add(r)}e&&this.eventLists_.push(e)},t.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},t.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},t.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1}e&&(this.eventLists_=[]),this.recursionDepth_--},t}(),ja=function(){function t(t){this.path_=t,this.events_=[]}return t.prototype.add=function(t){this.events_.push(t)},t.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();Ei&&Ci("event: "+e.toString()),ji(n)}}},t.prototype.getPath=function(){return this.path_},t}(),Wa=function(){function t(t){this.allowedEvents_=t,this.listeners_={},lr(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=this.listeners_[t].slice(),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(e){lr(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},t}(),Qa=function(r){function t(){var e,t,n=r.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}return ni(t,r),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(t){return lr("visible"===t,"Unknown event type: "+t),[this.visible_]},t}(Wa),Ka=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||wr()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}return ni(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(t){return lr("online"===t,"Unknown event type: "+t),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Wa),Ha=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&ji(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===n())break}},t}(),Ga=function(){function t(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ii(t),this.stats_=Ua.getCollection(e),this.urlFn=function(t){return e.connectionURL(zi,t)}}return t.prototype.open=function(t,e){var o=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Ha(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){o.log_("Timed out trying to connect."),o.onClosed_(),o.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!o.isClosed_){o.scriptTagHolder=new za(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],r=t[1],i=t[2];if(o.incrementIncomingBytes_(t),o.scriptTagHolder)if(o.connectTimeoutTimer_&&(clearTimeout(o.connectTimeoutTimer_),o.connectTimeoutTimer_=null),o.everConnected_=!0,"start"==n)o.id=r,o.password=i;else{if("close"!==n)throw new Error("Unrecognized command received: "+n);r?(o.scriptTagHolder.sendNewPolls=!1,o.myPacketOrderer.closeAfter(r,function(){o.onClosed_()})):o.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],r=t[1];o.incrementIncomingBytes_(t),o.myPacketOrderer.handleResponse(n,r)},function(){o.onClosed_()},o.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),o.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=o.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",o.transportSessionId&&(t.s=o.transportSessionId),o.lastSessionId&&(t.ls=o.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Hi)&&(t.r="f");var e=o.urlFn(t);o.log_("Connecting via long-poll to "+e),o.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return t.forceAllow_||!t.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI)&&!Er()},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=Dr(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n,r=(n=pr(e),dr.encodeByteArray(n,!0)),i=Fi(r,1840),o=0;o<i.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},t.prototype.incrementIncomingBytes_=function(t){var e=Dr(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),za=function(){function a(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new sa,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=bi(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=a.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Ci("frame writing exception"),t.stack&&Ci(t.stack),Ci(t)}}return a.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ci("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},a.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},a.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},a.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},a.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},a.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e,1);var r=function(){n.outstandingRequests.remove(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},a.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){Ci("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},a}(),Ya=null;"undefined"!=typeof MozWebSocket?Ya=MozWebSocket:"undefined"!=typeof WebSocket&&(Ya=WebSocket);var Xa=function(){function i(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ii(this.connId),this.stats_=Ua.getCollection(e),this.connURL=i.connectionURL_(e,n,r)}return i.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Hi)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Gi,r)},i.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,mi.set("previous_websocket_failure",!0);try{this.mySock=new Ya(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var r=t.message||t.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},i.prototype.start=function(){},i.forceDisallow=function(){i.forceDisallow_=!0},i.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Ya&&!i.forceDisallow_},i.previouslyFailed=function(){return mi.isInMemoryStorage||!0===mi.get("previous_websocket_failure")},i.prototype.markConnectionHealthy=function(){mi.remove("previous_websocket_failure")},i.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length==this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Nr(e);this.onMessage(n)}},i.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},i.prototype.extractFrameCount_=function(t){if(lr(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},i.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},i.prototype.send=function(t){this.resetKeepAlive();var e=Dr(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=Fi(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},i.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},i.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},i.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},i.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},i.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},i.responsesRequiredToBeHealthy=2,i.healthyTimeout=3e4,i}(),Ja=function(){function i(t){this.initTransports_(t)}return Object.defineProperty(i,"ALL_TRANSPORTS",{get:function(){return[Ga,Xa]},enumerable:!0,configurable:!0}),i.prototype.initTransports_=function(t){var e=Xa&&Xa.isAvailable(),n=e&&!Xa.previouslyFailed();if(t.webSocketOnly&&(e||Ai("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Xa];else{var r=this.transports_=[];Ui(i.ALL_TRANSPORTS,function(t,e){e&&e.isAvailable()&&r.push(e)})}},i.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},i.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},i}(),$a=function(){function t(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ii("c:"+this.id+":"),this.transportManager_=new Ja(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=Wi(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},t.prototype.connReceiver_=function(e){var n=this;return function(t){2!=n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},t.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=xi("t",t),n=xi("d",t);if("c"==e)this.onSecondaryControl_(n);else{if("d"!=e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=xi("t",t),n=xi("d",t);"c"==e?this.onControl_(n):"d"==e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=xi("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?Ni("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ni("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0==this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Ai("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Wi(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Wi(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(mi.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),Za=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),ts=function(s){function h(t,e,n,r,i,o){var a=s.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=h.nextPersistentConnectionId_++,a.log_=Ii("p:"+a.id+":"),a.interruptReasons_={},a.listens_={},a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!Er())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),Qa.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Ka.getInstance().on("online",a.onOnline_,a),a}return ni(h,s),h.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Dr(i)),lr(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},h.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens_[o]=this.listens_[o]||{},lr(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),lr(!this.listens_[o][i],"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens_[o][i]=a,this.connected_&&this.sendListen_(a)},h.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;h.warnOnListenWarnings_(e,o),(i.listens_[a]&&i.listens_[a][s])===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},h.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&kr(t,"w")){var n=Rr(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();Ai("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},h.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},h.prototype.reduceReconnectDelayIfAdminCredential_=function(t){var e;(t&&40===t.length||"object"==typeof(e=Ar(t).claims)&&!0===e.admin)&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},h.prototype.tryAuth=function(){var t,r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,e=(t=Ar(i).claims)&&"object"==typeof t&&t.hasOwnProperty("iat")?"auth":"gauth",n={cred:i};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(e,n,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},h.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),lr(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},h.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},h.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},h.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},h.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},h.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},h.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},h.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},h.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},h.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},h.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},h.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Dr(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},h.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):Ni("Unrecognized action received from server: "+Dr(t)+"\nAre you using the latest client?")},h.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},h.prototype.scheduleConnect_=function(t){var e=this;lr(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},h.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},h.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},h.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},h.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+h.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){lr(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?Ci("getToken() completed but was canceled"):(Ci("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new $a(i,o.repoInfo_,e,n,r,function(t){Ai(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},h.prototype.interrupt=function(t){Ci("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},h.prototype.resume=function(t){Ci("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Mr(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},h.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},h.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},h.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return Li(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},h.prototype.removeListen_=function(t,e){var n,r=new Qi(t).toString();return void 0!==this.listens_[r]?(n=this.listens_[r][e],delete this.listens_[r][e],0===xr(this.listens_[r])&&delete this.listens_[r]):n=void 0,n},h.prototype.onAuthRevoked_=function(t,e){Ci("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},h.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},h.prototype.restoreState_=function(){var n=this;this.tryAuth(),Or(this.listens_,function(t,e){Or(e,function(t,e){n.sendListen_(e)})});for(var t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){var e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}},h.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+Fh.SDK_VERSION.replace(/\./g,"-")]=1,wr()?t["framework.cordova"]=1:_r()&&(t["framework.reactnative"]=1),this.reportStats(t)},h.prototype.shouldReconnect_=function(){var t=Ka.getInstance().currentlyOnline();return Mr(this.interruptReasons_)&&t},h.nextPersistentConnectionId_=0,h.nextConnectionId_=0,h}(Za),es=function(i){function c(t,e,n){var r=i.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Ii("p:rest:"),r.listens_={},r}return ni(c,i),c.prototype.reportStats=function(t){throw new Error("Method not implemented.")},c.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(lr(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},c.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=c.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;(404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Rr(o.listens_,s)===u)&&i(t?401==t?"permission_denied":"rest_error:"+t:"ok",null)})},c.prototype.unlisten=function(t,e){var n=c.getListenId_(t,e);delete this.listens_[n]},c.prototype.refreshAuthToken=function(t){},c.prototype.restRequest_=function(o,a,s){var u=this;void 0===a&&(a={}),a.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(a.auth=e);var n,r=(u.repoInfo_.secure?"https://":"http://")+u.repoInfo_.host+o+"?ns="+u.repoInfo_.namespace+(n=[],Or(a,function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),n.length?"&"+n.join("&"):"");u.log_("Sending REST request for "+r);var i=new XMLHttpRequest;i.onreadystatechange=function(){if(s&&4===i.readyState){u.log_("REST Response for "+r+" received. status:",i.status,"response:",i.responseText);var t=null;if(200<=i.status&&i.status<300){try{t=Nr(i.responseText)}catch(t){Ai("Failed to parse JSON response for "+r+": "+i.responseText)}s(null,t)}else 401!==i.status&&404!==i.status&&Ai("Got unsuccessful REST response for "+r+" Status: "+i.status),s(i.status);s=null}},i.open("GET",r,!0),i.send()})},c}(Za),ns="repo_interrupt",rs=function(){function t(t,e,n){var a=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Ba,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new ua,this.persistentConnection_=null;var r=new La(n);if(this.stats_=Ua.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new es(this.repoInfo_,this.onDataUpdate_.bind(this),r),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var i=n.options.databaseAuthVariableOverride;if(null!=i){if("object"!=typeof i)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Dr(i)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new ts(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),r,i),this.server_=this.persistentConnection_}r.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=Ua.getOrCreateReporter(t,function(){return new Va(a.stats_,a.server_)}),this.transactions_init_(),this.infoData_=new xa,this.infoSyncTree_=new Ma({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Ma({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t.prototype.name=function(){return this.repoInfo_.namespace},t.prototype.serverTime=function(){var t=this.infoData_.getNode(new Qi(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},t.prototype.generateServerValues=function(){return(t=(t={timestamp:this.serverTime()})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t},t.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new Qi(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=Lr(e,function(t){return Yo(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Yo(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=Lr(e,function(t){return Yo(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Yo(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},t.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},t.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},t.prototype.onServerInfoUpdate_=function(t){var n=this;Ui(t,function(t,e){n.updateInfo_(e,t)})},t.prototype.updateInfo_=function(t,e){var n=new Qi("/.info/"+t),r=Yo(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},t.prototype.getNextWriteId_=function(){return this.nextWriteId_++},t.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=Yo(t,e),s=ha(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||Ai("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},t.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(Or(t,function(t,e){r=!1;var n=Yo(e);u[t]=ha(n,i)}),r)Ci("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||Ai("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),Or(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},t.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t,n,i,e=this.generateServerValues(),o=(t=this.onDisconnect_,n=e,i=new ua,t.forEachTree(new Qi(""),function(t,e){i.remember(t,ha(e,n))}),i),a=[];o.forEachTree(Qi.Empty,function(t,e){a=a.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new ua,this.eventQueue_.raiseEventsForChangedPath(Qi.Empty,a)},t.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectSet=function(n,t,r){var i=this,o=Yo(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=Yo(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},t.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Mr(n))return Ci("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&Or(n,function(t,e){var n=Yo(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},t.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},t.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(ns)},t.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(ns)},t.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new qa(this.stats_)),this.statsListener_.get()):this.stats_.get();var r=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);Or(e,function(t,e){for(var n=t.length;n<r+2;n++)t+=" ";console.log(t+e)})}},t.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},t.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Ci.apply(void 0,[n].concat(t))},t.prototype.callOnCompleteCallback=function(r,i,o){r&&ji(function(){if("ok"==i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(t.prototype,"database",{get:function(){return this.__database||(this.__database=new ys(this))},enumerable:!0,configurable:!0}),t}(),is=function(){function e(t){this.indexedFilter_=new Ea(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},e.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Eo(e,n))||(n=Ho.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},e.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Ho.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Ho.EMPTY_NODE);var i=this;return e.forEachChild(Mo,function(t,e){i.matches(new Eo(t,e))||(r=r.updateImmediateChild(t,Ho.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},e.prototype.updatePriority=function(t,e){return t},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},e.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},e}(),os=function(){function t(t){this.rangedFilter_=new is(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Eo(e,n))||(n=Ho.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Ho.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Ho.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Ho.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();){a=i.getNext();!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,Ho.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;lr(s.numChildren()==this.limit_,"");var u=new Eo(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name==e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(_a.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(_a.childRemovedChange(e,l));var d=s.updateImmediateChild(e,Ho.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(_a.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(_a.childRemovedChange(c.name,c.node)),i.trackChildChange(_a.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,Ho.EMPTY_NODE)):t},t}(),as=function(){function r(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Mo}return r.prototype.hasStart=function(){return this.startSet_},r.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},r.prototype.getIndexStartValue=function(){return lr(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},r.prototype.getIndexStartName=function(){return lr(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ri},r.prototype.hasEnd=function(){return this.endSet_},r.prototype.getIndexEndValue=function(){return lr(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},r.prototype.getIndexEndName=function(){return lr(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Oi},r.prototype.hasLimit=function(){return this.limitSet_},r.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},r.prototype.getLimit=function(){return lr(this.limitSet_,"Only valid if limit has been set"),this.limit_},r.prototype.getIndex=function(){return this.index_},r.prototype.copy_=function(){var t=new r;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},r.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},r.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},r.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=r.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},r.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,n.indexStartName_=null!=e?(n.startNameSet_=!0,e):(n.startNameSet_=!1,""),n},r.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,n.indexEndName_=void 0!==e?(n.endNameSet_=!0,e):(n.endNameSet_=!1,""),n},r.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},r.prototype.getQueryObject=function(){var t=r.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==Mo&&(e[t.INDEX]=this.index_.toString()),e},r.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},r.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==Mo},r.prototype.getNodeFilter=function(){return this.loadsAllData()?new Ea(this.getIndex()):this.hasLimit()?new os(this):new is(this)},r.prototype.toRestQueryStringParameters=function(){var t,e=r.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===Mo?e.PRIORITY_INDEX:this.index_===Zo?e.VALUE_INDEX:this.index_===Co?e.KEY_INDEX:(lr(this.index_ instanceof ta,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Dr(t),this.startSet_&&(n[e.START_AT]=Dr(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Dr(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Dr(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Dr(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},r.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},r.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},r.DEFAULT=new r,r}(),ss=function(n){function o(t,e){if(!(t instanceof rs))throw new Error("new Reference() no longer supported - use app.database().");return n.call(this,t,e,as.DEFAULT,!1)||this}return ni(o,n),o.prototype.getKey=function(){return Wr("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},o.prototype.child=function(t){var e,n,r,i;return Wr("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof Qi||(null===this.path.getFront()?(e="Reference.child",i=!(n=1),(r=t)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),mo(e,n,r,i)):mo("Reference.child",1,t,!1)),new o(this.repo,this.path.child(t))},o.prototype.getParent=function(){Wr("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new o(this.repo,t)},o.prototype.getRoot=function(){Wr("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},o.prototype.databaseProp=function(){return this.repo.database},o.prototype.set=function(t,e){Wr("Reference.set",1,2,arguments.length),go("Reference.set",this.path),co("Reference.set",1,t,this.path,!1),Kr("Reference.set",2,e,!0);var n=new br;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},o.prototype.update=function(t,e){if(Wr("Reference.update",1,2,arguments.length),go("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Ai("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}lo("Reference.update",1,t,this.path,!1),Kr("Reference.update",2,e,!0);var i=new br;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},o.prototype.setWithPriority=function(t,e,n){if(Wr("Reference.setWithPriority",2,3,arguments.length),go("Reference.setWithPriority",this.path),co("Reference.setWithPriority",1,t,this.path,!1),fo("Reference.setWithPriority",2,e,!1),Kr("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new br;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},o.prototype.remove=function(t){return Wr("Reference.remove",0,1,arguments.length),go("Reference.remove",this.path),Kr("Reference.remove",1,t,!0),this.set(null,t)},o.prototype.transaction=function(t,r,e){if(Wr("Reference.transaction",1,3,arguments.length),go("Reference.transaction",this.path),Kr("Reference.transaction",1,t,!1),Kr("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Qr(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new br;"function"==typeof r&&i.promise.catch(function(){});return this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new wo(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},o.prototype.setPriority=function(t,e){Wr("Reference.setPriority",1,2,arguments.length),go("Reference.setPriority",this.path),fo("Reference.setPriority",1,t,!1),Kr("Reference.setPriority",2,e,!0);var n=new br;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},o.prototype.push=function(t,e){Wr("Reference.push",0,2,arguments.length),go("Reference.push",this.path),co("Reference.push",1,t,this.path,!0),Kr("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=_o(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},o.prototype.onDisconnect=function(){return go("Reference.onDisconnect",this.path),new bo(this.repo,this.path)},Object.defineProperty(o.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),o}(aa);aa.__referenceConstructor=ss,ka.__referenceConstructor=ss;var us,cs,hs=function(){this.children={},this.childCount=0,this.value=null},ls=function(){function i(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new hs),this.name_=t,this.parent_=e,this.node_=n}return i.prototype.subTree=function(t){for(var e,n=t instanceof Qi?t:new Qi(t),r=this;null!==(e=n.getFront());){r=new i(e,r,Rr(r.node_.children,e)||new hs),n=n.popFront()}return r},i.prototype.getValue=function(){return this.node_.value},i.prototype.setValue=function(t){lr(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},i.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},i.prototype.hasChildren=function(){return 0<this.node_.childCount},i.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},i.prototype.forEachChild=function(n){var r=this;Or(this.node_.children,function(t,e){n(new i(t,r,e))})},i.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},i.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},i.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},i.prototype.path=function(){return new Qi(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},i.prototype.name=function(){return this.name_},i.prototype.parent=function(){return this.parent_},i.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},i.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=kr(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},i}();(cs=us||(us={}))[cs.RUN=0]="RUN",cs[cs.SENT=1]="SENT",cs[cs.COMPLETED=2]="COMPLETED",cs[cs.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",cs[cs.NEEDS_ABORT=4]="NEEDS_ABORT",rs.MAX_TRANSACTION_RETRIES_=25,rs.prototype.transactions_init_=function(){this.transactionQueueTree_=new ls},rs.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);var i=function(){},o=new ss(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:bi(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new ea(a.currentInputSnapshot,new ss(this,a.path),Mo);a.onComplete(null,!1,c)}}else{ho("transaction failed: Data returned ",u,a.path),a.status=us.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&kr(u,".priority"))f=Rr(u,".priority"),lr(uo(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||Ho.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=Yo(u,f),y=ha(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=y,a.currentWriteId=this.getNextWriteId_();var m=this.serverSyncTree_.applyUserOverwrite(t,y,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,m),this.sendReadyTransactions_()}},rs.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Ho.EMPTY_NODE},rs.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);lr(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===us.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},rs.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];lr(o.status===us.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=us.SENT,o.retryCount++;var a=Qi.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=us.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new ss(c,u[r].path),a=new ea(i,o,Mo);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)ji(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===us.SENT_NEEDS_ABORT?u[r].status=us.NEEDS_ABORT:u[r].status=us.RUN;else{Ai("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=us.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},rs.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},rs.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===us.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=Qi.relativePath(e,s.path),c=!1,h=void 0;if(lr(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===us.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===us.RUN)if(s.retryCount>=rs.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){ho("transaction failed: Data returned ",f,s.path);var p=Yo(f);"object"==typeof f&&null!=f&&kr(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,y=this.generateServerValues(),m=ha(p,y);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=m,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,m,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=us.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var g=new ss(this,t[a].path),v=t[a].currentInputSnapshot,b=new ea(v,g,Mo);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)ji(r[a]);this.sendReadyTransactions_()}},rs.prototype.getAncestorTransactionNode_=function(t){for(var e,n=this.transactionQueueTree_;null!==(e=t.getFront())&&null===n.getValue();)n=n.subTree(e),t=t.popFront();return n},rs.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},rs.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},rs.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==us.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},rs.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},rs.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===us.SENT_NEEDS_ABORT);else if(e[o].status===us.SENT)lr(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=us.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(lr(e[o].status===us.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)ji(n[o])}};var fs,ps="databaseURL",ds=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return fs||(fs=new t),fs},t.prototype.interrupt=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].interrupt()},t.prototype.resume=function(){for(var t in this.repos_)for(var e in this.repos_[t])this.repos_[t][e].resume()},t.prototype.databaseFromApp=function(t,e){var n=e||t.options[ps];void 0===n&&Di("Can't determine Firebase Database URL.  Be sure to include "+ps+" option when calling firebase.initializeApp().");var r=eo(n),i=r.repoInfo;return vo("Invalid Firebase Database URL",1,r),r.path.isEmpty()||Di("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(i,t).database},t.prototype.deleteRepo=function(t){var e=Rr(this.repos_,t.app.name);e&&Rr(e,t.repoInfo_.toURLString())===t||Di("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},t.prototype.createRepo=function(t,e){var n=Rr(this.repos_,e.name);n||(n={},this.repos_[e.name]=n);var r=Rr(n,t.toURLString());return r&&Di("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new rs(t,this.useRestClient_,e),n[t.toURLString()]=r},t.prototype.forceRestClient=function(t){this.useRestClient_=t},t}(),ys=function(){function t(t){(this.repo_=t)instanceof rs||Di("Don't call new Database() directly - please use firebase.database()."),this.root_=new ss(t,Qi.Empty),this.INTERNAL=new ms(this)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),t.prototype.ref=function(t){return this.checkDeleted_("ref"),Wr("database.ref",0,1,arguments.length),t instanceof ss?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},t.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),Wr(e,1,1,arguments.length);var n=eo(t);vo(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Di(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},t.prototype.checkDeleted_=function(t){null===this.repo_&&Di("Cannot call "+t+" on a deleted database.")},t.prototype.goOffline=function(){Wr("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},t.prototype.goOnline=function(){Wr("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},t.ServerValue={TIMESTAMP:{".sv":"timestamp"}},t}(),ms=function(){function t(t){this.database=t}return t.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.database.checkDeleted_("delete"),ds.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},t}(),gs=Object.freeze({forceLongPolling:function(){Xa.forceDisallow(),Ga.forceAllow()},forceWebSockets:function(){Ga.forceDisallow()},isWebSocketsAvailable:function(){return Xa.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),vs=ts;ts.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},ts.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var bs=$a,ws=Yi,_s=Object.freeze({DataConnection:vs,RealTimeConnection:bs,hijackHash:function(i){var o=ts.prototype.put;return ts.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){ts.prototype.put=o}},ConnectionTarget:ws,queryIdentifier:function(t){return t.queryIdentifier()},listens:function(t){return t.repo.persistentConnection_.listens_},forceRestClient:function(t){ds.getInstance().forceRestClient(t)}}),Es=ys.ServerValue;Fh.INTERNAL.registerService("database",function(t,e,n){return ds.getInstance().databaseFromApp(t,n)},{Reference:ss,Query:aa,Database:ys,DataSnapshot:ea,enableLogging:Si,INTERNAL:gs,ServerValue:Es,TEST_ACCESS:_s},null,!0);var Ts,Ss="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Cs=Cs||{},Is=Ss;function Ns(t){return"string"==typeof t}function Ds(t,e){t=t.split("."),e=e||Is;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function As(){}function ks(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Rs(t){return"array"==ks(t)}function Os(t){var e=ks(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Ps(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ms="closure_uid_"+(1e9*Math.random()>>>0),xs=0;function Ls(t,e,n){return t.call.apply(t.bind,arguments)}function Fs(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Us(t,e,n){return(Us=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ls:Fs).apply(null,arguments)}function qs(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var Vs=Date.now||function(){return+new Date};function Bs(t,o){function e(){}e.prototype=o.prototype,t.S=o.prototype,t.prototype=new e,(t.prototype.constructor=t).re=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function js(){this.i=this.i,this.j=this.j}js.prototype.i=!1,js.prototype.La=function(){if(!this.i&&(this.i=!0,this.G(),0))this[Ms]||(this[Ms]=++xs)},js.prototype.G=function(){if(this.j)for(;this.j.length;)this.j.shift()()};var Ws=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(Ns(t))return Ns(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Qs=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=Ns(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Ks(t){return Array.prototype.concat.apply([],arguments)}function Hs(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Gs(t){return/^[\s\xa0]*$/.test(t)}var zs,Ys=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Xs(t,e){return-1!=t.indexOf(e)}function Js(t,e){return t<e?-1:e<t?1:0}t:{var $s=Is.navigator;if($s){var Zs=$s.userAgent;if(Zs){zs=Zs;break t}}zs=""}function tu(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function eu(t){var e,n={};for(e in t)n[e]=t[e];return n}var nu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ru(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nu.length;o++)n=nu[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function iu(t){return iu[" "](t),t}iu[" "]=As;var ou,au,su=Xs(zs,"Opera"),uu=Xs(zs,"Trident")||Xs(zs,"MSIE"),cu=Xs(zs,"Edge"),hu=cu||uu,lu=Xs(zs,"Gecko")&&!(Xs(zs.toLowerCase(),"webkit")&&!Xs(zs,"Edge"))&&!(Xs(zs,"Trident")||Xs(zs,"MSIE"))&&!Xs(zs,"Edge"),fu=Xs(zs.toLowerCase(),"webkit")&&!Xs(zs,"Edge");function pu(){var t=Is.document;return t?t.documentMode:void 0}t:{var du="",yu=(au=zs,lu?/rv:([^\);]+)(\)|;)/.exec(au):cu?/Edge\/([\d\.]+)/.exec(au):uu?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(au):fu?/WebKit\/(\S+)/.exec(au):su?/(?:Version)[ \/]?(\S+)/.exec(au):void 0);if(yu&&(du=yu?yu[1]:""),uu){var mu=pu();if(null!=mu&&mu>parseFloat(du)){ou=String(mu);break t}}ou=du}var gu,vu={};function bu(s){return t=s,e=function(){for(var t=0,e=Ys(String(ou)).split("."),n=Ys(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=Js(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||Js(0==o[2].length,0==a[2].length)||Js(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t},n=vu,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var wu=Is.document;gu=wu&&uu?pu()||("CSS1Compat"==wu.compatMode?parseInt(ou,10):5):void 0;var _u=!uu||9<=Number(gu),Eu=uu&&!bu("9"),Tu=function(){if(!Is.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Is.addEventListener("test",As,e),Is.removeEventListener("test",As,e)}catch(t){}return t}();function Su(t,e){this.type=t,this.a=this.target=e,this.b=!1,this.hc=!0}function Cu(t,e){Su.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.f=null,t&&this.g(t,e)}Su.prototype.c=function(){this.hc=!1},Bs(Cu,Su);var Iu={2:"touch",3:"pen",4:"mouse"};Cu.prototype.g=function(t,e){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(lu){t:{try{iu(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,this.screenY=r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=Ns(t.pointerType)?t.pointerType:Iu[t.pointerType]||"",(this.f=t).defaultPrevented&&this.c()},Cu.prototype.c=function(){Cu.S.c.call(this);var t=this.f;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Eu)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Nu="closure_listenable_"+(1e6*Math.random()|0),Du=0;function Au(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ya=i,this.key=++Du,this.ja=this.oa=!1}function ku(t){this.src=t,this.a={},this.b=0}function Ru(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ja&&o.listener==e&&o.capture==!!n&&o.ya==r)return i}return-1}Au.prototype.a=function(){this.ja=!0,this.ya=this.src=this.proxy=this.listener=null},(Ts=ku.prototype).add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Ru(t,e,r,i);return-1<a?(e=t[a],n||(e.oa=!1)):((e=new Au(e,this.src,o,!!r,i)).oa=n,t.push(e)),e},Ts.Sc=function(t,e,n,r){if((t=t.toString())in this.a){var i=this.a[t];-1<(e=Ru(i,e,n,r))&&(i[e].a(),Array.prototype.splice.call(i,e,1),0==i.length&&(delete this.a[t],this.b--))}},Ts.fc=function(t){var e=t.type;if(e in this.a){var n,r=this.a[e],i=Ws(r,t);(n=0<=i)&&Array.prototype.splice.call(r,i,1),n&&(t.a(),0==this.a[e].length&&(delete this.a[e],this.b--))}},Ts.Tc=function(){var t;for(t in this.a){for(var e=this.a[t],n=0;n<e.length;n++)e[n].a();delete this.a[t],this.b--}},Ts.Rc=function(t,e,n,r){var i=-1;return(t=this.a[t.toString()])&&(i=Ru(t,e,n,r)),-1<i?t[i]:null};var Ou="closure_lm_"+(1e6*Math.random()|0),Pu={};function Mu(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Rs(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=ju(r);return e&&e[Nu]?e.Mb(n,r,Ps(i)?!!i.capture:!!i,o):xu(e,n,r,!0,i,o)}(t,e,n,r,i);if(Rs(e)){for(var o=0;o<e.length;o++)Mu(t,e[o],n,r,i);return null}return n=ju(n),t&&t[Nu]?t.Lb(e,n,Ps(r)?!!r.capture:!!r,i):xu(t,e,n,!1,r,i)}function xu(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Ps(i)?!!i.capture:!!i;if(a&&!_u)return null;var s,u,c=Vu(t);if(c||(t[Ou]=c=new ku(t)),(n=c.add(e,n,r,a,o)).proxy)return n;if(s=qu,r=u=_u?function(t){return s.call(u.src,u.listener,t)}:function(t){if(!(t=s.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tu||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Fu(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lu(t){if("number"!=typeof t&&t&&!t.ja){var e=t.src;if(e&&e[Nu])e.nc(t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Fu(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Vu(e))?(n.fc(t),0==n.b&&(n.src=null,e[Ou]=null)):t.a()}}}function Fu(t){return t in Pu?Pu[t]:Pu[t]="on"+t}function Uu(t,e){var n=t.listener,r=t.ya||t.src;return t.oa&&Lu(t),n.call(r,e)}function qu(t,e){return!!t.ja||(_u?Uu(t,new Cu(e,this)):Uu(t,e=new Cu(e||Ds("window.event"),this)))}function Vu(t){return(t=t[Ou])instanceof ku?t:null}var Bu="__closure_events_fn_"+(1e9*Math.random()>>>0);function ju(e){return"function"==ks(e)?e:(e[Bu]||(e[Bu]=function(t){return e.handleEvent(t)}),e[Bu])}function Wu(){js.call(this),this.c=new ku(this),(this.K=this).F=null}Bs(Wu,js),Wu.prototype[Nu]=!0,(Ts=Wu.prototype).addEventListener=function(t,e,n,r){Mu(this,t,e,n,r)},Ts.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Rs(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Ps(i)?!!i.capture:!!i,r=ju(r),e&&e[Nu]?e.Qc(n,r,i,o):e&&(e=Vu(e))&&(n=e.Rc(n,r,i,o))&&Lu(n)}(this,t,e,n,r)},Ts.dispatchEvent=function(t){var e,n=this.F;if(n)for(e=[];n;n=n.F)e.push(n);n=this.K;var r=t.type||t;if(Ns(t))t=new Su(t,n);else if(t instanceof Su)t.target=t.target||n;else{var i=t;ru(t=new Su(r,n),i)}if(i=!0,e)for(var o=e.length-1;!t.b&&0<=o;o--){var a=t.a=e[o];i=a.ua(r,!0,t)&&i}if(t.b||(i=(a=t.a=n).ua(r,!0,t)&&i,t.b||(i=a.ua(r,!1,t)&&i)),e)for(o=0;!t.b&&o<e.length;o++)i=(a=t.a=e[o]).ua(r,!1,t)&&i;return i},Ts.G=function(){Wu.S.G.call(this),this.Id(),this.F=null},Ts.Lb=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},Ts.Mb=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)},Ts.Qc=function(t,e,n,r){this.c.Sc(String(t),e,n,r)},Ts.nc=function(t){this.c.fc(t)},Ts.Id=function(){this.c&&this.c.Tc()},Ts.ua=function(t,e,n){if(!(t=this.c.a[String(t)]))return!0;t=t.concat();for(var r=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.ja&&o.capture==e){var a=o.listener,s=o.ya||o.src;o.oa&&this.nc(o),r=!1!==a.call(s,n)&&r}}return r&&0!=n.hc};var Qu=Is.JSON.stringify;function Ku(t,e){this.g=100,this.c=t,this.h=e,this.b=0,this.a=null}function Hu(){this.b=this.a=null}Ku.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t},Ku.prototype.f=function(t){this.h(t),this.b<this.g&&(this.b++,t.next=this.a,this.a=t)};var Gu,zu=new Ku(function(){return new Yu},function(t){t.reset()});function Yu(){this.next=this.b=this.a=null}function Xu(t){Is.setTimeout(function(){throw t},0)}Hu.prototype.add=function(t,e){var n=this.c();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Hu.prototype.f=function(){var t=null;return this.a&&(t=this.a,this.a=this.a.next,this.a||(this.b=null),t.next=null),t},Hu.prototype.g=function(t){zu.f(t)},Hu.prototype.c=function(){return zu.get()},Yu.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Ju=!(Yu.prototype.reset=function(){this.next=this.b=this.a=null}),$u=new Hu;function Zu(){for(var t;t=$u.f();){try{t.a.call(t.b)}catch(t){Xu(t)}$u.g(t)}Ju=!1}function tc(t,e){Wu.call(this),this.b=t||1,this.a=e||Is,this.f=Us(this.$d,this),this.g=Vs()}function ec(t,e,n){if("function"==ks(t))n&&(t=Us(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Us(t.handleEvent,t)}return 2147483647<Number(e)?-1:Is.setTimeout(t,e||0)}function nc(t,e,n){js.call(this),this.f=null!=n?Us(t,n):t,this.c=e,this.b=Us(this.Cd,this),this.a=[]}function rc(t){js.call(this),this.b=t,this.a={}}Bs(tc,Wu),(Ts=tc.prototype).wa=!1,Ts.P=null,Ts.$d=function(){if(this.wa){var t=Vs()-this.g;0<t&&t<.8*this.b?this.P=this.a.setTimeout(this.f,this.b-t):(this.P&&(this.a.clearTimeout(this.P),this.P=null),this.Gc(),this.wa&&(this.Na(),this.start()))}},Ts.Gc=function(){this.dispatchEvent("tick")},Ts.start=function(){this.wa=!0,this.P||(this.P=this.a.setTimeout(this.f,this.b),this.g=Vs())},Ts.Na=function(){this.wa=!1,this.P&&(this.a.clearTimeout(this.P),this.P=null)},Ts.G=function(){tc.S.G.call(this),this.Na(),delete this.a},Bs(nc,js),(Ts=nc.prototype).Ca=!1,Ts.ec=0,Ts.ba=null,Ts.Hc=function(t){this.a=arguments,this.ba||this.ec?this.Ca=!0:this.yb()},Ts.Pc=function(){this.ba&&(Is.clearTimeout(this.ba),this.ba=null,this.Ca=!1,this.a=[])},Ts.G=function(){nc.S.G.call(this),this.Pc()},Ts.Cd=function(){this.ba=null,this.Ca&&!this.ec&&(this.Ca=!1,this.yb())},Ts.yb=function(){this.ba=ec(this.b,this.c),this.f.apply(null,this.a)},Bs(rc,js);var ic=[];function oc(){}(Ts=rc.prototype).Jb=function(t,e,n){this.wd(t,e,n)},Ts.wd=function(t,e,n){Rs(e)||(e&&(ic[0]=e.toString()),e=ic);for(var r=0;r<e.length;r++){var i=Mu(t,e[r],n||this.handleEvent,!1,this.b||this);if(!i)break;this.a[i.key]=i}},Ts.Kb=function(){tu(this.a,function(t,e){this.a.hasOwnProperty(e)&&Lu(t)},this),this.a={}},Ts.G=function(){rc.S.G.call(this),this.Kb()},Ts.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ac=new Wu;function sc(t){Su.call(this,"serverreachability",t)}function uc(t){ac.dispatchEvent(new sc(ac,t))}function cc(t){Su.call(this,"statevent",t)}function hc(t){ac.dispatchEvent(new cc(ac,t))}function lc(t){Su.call(this,"timingevent",t)}function fc(t,e){if("function"!=ks(t))throw Error("Fn must not be null and must be a function");return Is.setTimeout(function(){t()},e)}Bs(sc,Su),Bs(cc,Su),Bs(lc,Su);var pc={NO_ERROR:0,ae:1,he:2,ge:3,de:4,fe:5,ie:6,qc:7,TIMEOUT:8,le:9},dc={ce:"complete",pe:"success",rc:"error",qc:"abort",ne:"ready",oe:"readystatechange",TIMEOUT:"timeout",je:"incrementaldata",me:"progress",ee:"downloadprogress",qe:"uploadprogress"};function yc(){}function mc(){}yc.prototype.a=null,yc.prototype.c=function(){return this.a||(this.a={})};var gc,vc={OPEN:"a",be:"b",rc:"c",ke:"d"};function bc(){Su.call(this,"d")}function wc(){Su.call(this,"c")}function _c(){}function Ec(t,e,n){this.g=t,this.da=e,this.ca=n||1,this.I=new rc(this),this.L=45e3,t=hu?125:void 0,this.T=new tc(t),this.J=null,this.b=!1,this.i=this.C=this.f=this.F=this.u=this.U=this.h=null,this.j=[],this.a=null,this.A=0,this.c=this.v=null,this.o=-1,this.l=!1,this.K=0,this.B=null,this.s=this.Y=this.H=!1}Bs(bc,Su),Bs(wc,Su),Bs(_c,yc),_c.prototype.b=function(){return new XMLHttpRequest},gc=new _c;var Tc={},Sc={};function Cc(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Os(t)||Ns(t))Qs(t,e,void 0);else{if(t.O&&"function"==typeof t.O)var n=t.O();else if(t.D&&"function"==typeof t.D)n=void 0;else if(Os(t)||Ns(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.D&&"function"==typeof t.D)return t.D();if(Ns(t))return t.split("");if(Os(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ic(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else t&&this.fd(t)}function Nc(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Ts=Ec.prototype).ha=function(t){this.J=t},Ts.setTimeout=function(t){this.L=t},Ts.Xc=function(t){this.K=t},Ts.Qd=function(t){this.j=t},Ts.cb=function(t,e){this.F=1,this.f=t.N().za(),this.i=e,this.H=!0,this.ic(null)},Ts.bb=function(t,e,n){this.F=1,this.f=t.N().za(),this.i=null,this.H=e,this.ic(n)},Ts.ic=function(t){this.u=Vs(),this.fa(),this.C=this.f.N(),this.C.Aa("t",this.ca),this.A=0,this.a=this.g.sa(this.g.Da()?t:null),0<this.K&&(this.B=new nc(Us(this.oc,this,this.a),this.K)),this.I.Jb(this.a,"readystatechange",this.Hd),t=this.J?eu(this.J):{},this.i?(this.v||(this.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",this.a.xa(this.C,this.v,this.i,t)):(this.v="GET",this.a.xa(this.C,this.v,null,t)),uc(1)},Ts.Hd=function(t){t=t.target;var e=this.B;e&&3==t.W()?e.Hc():this.oc(t)},Ts.oc=function(t){try{t==this.a&&this.Ed()}catch(t){}},Ts.Ed=function(){var t=this.a.W(),e=this.a.Db(),n=this.a.aa();if(!(t<3||3==t&&!hu&&!this.a.va()))if(this.l||4!=t||7==e||uc(8==e||n<=0?3:2),this.pa(),this.o=n=this.a.aa(),e=this.a.va(),this.b=200==n){if(this.Td()){if(!(n=this.Kc()))return this.b=!1,this.c=3,hc(12),this.Z(),void this.ta();this.s=!0,this.Wa(n)}this.H?(this.vb(t,e),hu&&this.b&&3==t&&this.Yd()):this.Wa(e),4==t&&this.Z(),this.b&&!this.l&&(4==t?this.g.Va(this):(this.b=!1,this.fa()))}else 400==n&&0<e.indexOf("Unknown SID")?(this.c=3,hc(12)):(this.c=0,hc(13)),this.Z(),this.ta()},Ts.Td=function(){return this.Y&&!this.s},Ts.Kc=function(){if(this.a){var t=this.a.ga("X-HTTP-Initial-Response");if(t&&!Gs(t))return t}return null},Ts.Md=function(){this.Y=!0},Ts.vb=function(t,e){for(var n=!0;!this.l&&this.A<e.length;){var r=this.Lc(e);if(r==Sc){4==t&&(this.c=4,hc(14),n=!1);break}if(r==Tc){this.c=4,hc(15),n=!1;break}this.Wa(r)}4==t&&0==e.length&&(this.c=1,hc(16),n=!1),this.b=this.b&&n,n||(this.Z(),this.ta())},Ts.Gd=function(){if(this.a){var t=this.a.W(),e=this.a.va();this.A<e.length&&(this.pa(),this.vb(t,e),this.b&&4!=t&&this.fa())}},Ts.Yd=function(){this.I.Jb(this.T,"tick",this.Gd),this.T.start()},Ts.Lc=function(t){var e=this.A,n=t.indexOf("\n",e);return-1==n?Sc:(e=Number(t.substring(e,n)),isNaN(e)?Tc:(n+=1)+e>t.length?Sc:(t=t.substr(n,e),this.A=n+e,t))},Ts.Ld=function(t){this.F=2,this.f=t.N().za(),t=!1,Is.navigator&&Is.navigator.sendBeacon&&(t=Is.navigator.sendBeacon(this.f.toString(),"")),!t&&Is.Image&&((new Image).src=this.f,t=!0),t||(this.a=this.g.sa(null),this.a.xa(this.f)),this.u=Vs(),this.fa()},Ts.cancel=function(){this.l=!0,this.Z()},Ts.Kd=function(t){t&&this.setTimeout(t),this.h&&(this.pa(),this.fa())},Ts.fa=function(){this.U=Vs()+this.L,this.mc(this.L)},Ts.mc=function(t){if(null!=this.h)throw Error("WatchDog timer not null");this.h=fc(Us(this.Dd,this),t)},Ts.pa=function(){this.h&&(Is.clearTimeout(this.h),this.h=null)},Ts.Dd=function(){this.h=null;var t=Vs();0<=t-this.U?this.md():this.mc(this.U-t)},Ts.md=function(){2!=this.F&&(uc(3),hc(17)),this.Z(),this.c=2,this.ta()},Ts.ta=function(){this.g.Tb()||this.l||this.g.Va(this)},Ts.Z=function(){this.pa();var t=this.B;t&&"function"==typeof t.La&&t.La(),this.B=null,this.T.Na(),this.I.Kb(),this.a&&(t=this.a,this.a=null,t.abort(),t.La())},Ts.Wa=function(t){try{this.g.bc(this,t),uc(4)}catch(t){}},(Ts=Ic.prototype).D=function(){this.Ka();for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},Ts.O=function(){return this.Ka(),this.a.concat()},Ts.Ra=function(t){return Nc(this.b,t)},Ts.hd=function(){return 0==this.c},Ts.gd=function(){this.b={},this.c=this.a.length=0},Ts.Qb=function(t){Nc(this.b,t)&&(delete this.b[t],this.c--,this.a.length>2*this.c&&this.Ka())},Ts.Ka=function(){if(this.c!=this.a.length){for(var t=0,e=0;t<this.a.length;){var n=this.a[t];Nc(this.b,n)&&(this.a[e++]=n),t++}this.a.length=e}if(this.c!=this.a.length){var r={};for(e=t=0;t<this.a.length;)Nc(r,n=this.a[t])||(r[this.a[e++]=n]=1),t++;this.a.length=e}},Ts.get=function(t,e){return Nc(this.b,t)?this.b[t]:e},Ts.set=function(t,e){Nc(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},Ts.fd=function(t){if(t instanceof Ic)for(var e=t.O(),n=0;n<e.length;n++)this.set(e[n],t.get(e[n]));else for(e in t)this.set(e,t[e])},Ts.forEach=function(t,e){for(var n=this.O(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}},Ts.Pb=function(){return new Ic(this)};var Dc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ac(t,e){var n;this.c=this.i=this.b="",this.h=null,this.j=this.g="",this.f=this.l=!1,t instanceof Ac?(this.f=void 0!==e?e:t.f,this.ma(t.b),this.$a(t.i),this.ka(t.c),this.la(t.h),this.Ba(t.g),this.Za(t.a.Gb()),this.Ya(t.j)):t&&(n=String(t).match(Dc))?(this.f=!!e,this.ma(n[1]||"",!0),this.$a(n[2]||"",!0),this.ka(n[3]||"",!0),this.la(n[4]),this.Ba(n[5]||"",!0),this.Za(n[6]||"",!0),this.Ya(n[7]||"",!0)):(this.f=!!e,this.a=new Uc(null,this.f))}function kc(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Rc(t,e,n){return Ns(t)?(t=encodeURI(t).replace(e,Oc),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Oc(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}(Ts=Ac.prototype).toString=function(){var t=[],e=this.b;e&&t.push(Rc(e,Pc,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(Rc(e,Pc,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.Sa()&&"/"!=n.charAt(0)&&t.push("/"),t.push(Rc(n,"/"==n.charAt(0)?xc:Mc,!0))),(n=this.Ic())&&t.push("?",n),(n=this.j)&&t.push("#",Rc(n,Fc)),t.join("")},Ts.resolve=function(t){var e=this.N(),n=t.qd();n?e.ma(t.b):n=t.rd(),n?e.$a(t.i):n=t.Sa(),n?e.ka(t.c):n=t.od();var r=t.g;if(n)e.la(t.h);else if(n=t.Sb()){if("/"!=r.charAt(0))if(this.Sa()&&!this.Sb())r="/"+r;else{var i=e.g.lastIndexOf("/");-1!=i&&(r=e.g.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(Xs(i,"./")||Xs(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.Ba(r):n=t.pd(),n?e.Za(t.a.Gb()):n=t.nd(),n&&e.Ya(t.j),e},Ts.N=function(){return new Ac(this)},Ts.ma=function(t,e){this.M(),(this.b=e?kc(t,!0):t)&&(this.b=this.b.replace(/:$/,""))},Ts.qd=function(){return!!this.b},Ts.$a=function(t,e){this.M(),this.i=e?kc(t):t},Ts.rd=function(){return!!this.i},Ts.ka=function(t,e){this.M(),this.c=e?kc(t,!0):t},Ts.Sa=function(){return!!this.c},Ts.la=function(t){if(this.M(),t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);this.h=t}else this.h=null},Ts.od=function(){return null!=this.h},Ts.Ba=function(t,e){this.M(),this.g=e?kc(t,!0):t},Ts.Sb=function(){return!!this.g},Ts.pd=function(){return""!==this.a.toString()},Ts.Za=function(t,e){this.M(),t instanceof Uc?(this.a=t,this.a.Oc(this.f)):(e||(t=Rc(t,Lc)),this.a=new Uc(t,this.f))},Ts.Ic=function(){return this.a.toString()},Ts.m=function(t,e){this.M(),this.a.set(t,e)},Ts.Aa=function(t,e){this.M(),Rs(e)||(e=[String(e)]),this.a.lc(t,e)},Ts.Ya=function(t,e){this.M(),this.j=e?kc(t):t},Ts.nd=function(){return!!this.j},Ts.za=function(){return this.M(),this.m("zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Vs()).toString(36)),this},Ts.M=function(){if(this.l)throw Error("Tried to modify a read-only Uri")};var Pc=/[#\/\?@]/g,Mc=/[#\?:]/g,xc=/[#\?]/g,Lc=/[#\?@]/g,Fc=/#/g;function Uc(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function qc(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Vc(){this.a=this.b=null}function Bc(){this.a=new Ic}function jc(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Ms]||(t[Ms]=++xs)):e.charAt(0)+t}function Wc(t,e){this.a=t,this.b=e}function Qc(t){this.g=t||Kc,t=Is.PerformanceNavigationTiming?0<(t=Is.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Is.Ja&&Is.Ja.Vb&&Is.Ja.Vb()&&Is.Ja.Vb().te),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Bc),this.b=null,this.c=[]}(Ts=Uc.prototype).V=function(){if(!this.a&&(this.a=new Ic,this.b=0,this.c)){var n=this;!function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(this.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)})}},Ts.add=function(t,e){this.V(),this.ia(),t=this.$(t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},Ts.Ib=function(t){this.V(),t=this.$(t),this.a.Ra(t)&&(this.ia(),this.b-=this.a.get(t).length,this.a.Qb(t))},Ts.Hb=function(t){return this.V(),t=this.$(t),this.a.Ra(t)},Ts.forEach=function(n,r){this.V(),this.a.forEach(function(t,e){Qs(t,function(t){n.call(r,t,e,this)},this)},this)},Ts.O=function(){this.V();for(var t=this.a.D(),e=this.a.O(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Ts.D=function(t){this.V();var e=[];if(Ns(t))this.Hb(t)&&(e=Ks(e,this.a.get(this.$(t))));else{t=this.a.D();for(var n=0;n<t.length;n++)e=Ks(e,t[n])}return e},Ts.set=function(t,e){return this.V(),this.ia(),t=this.$(t),this.Hb(t)&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},Ts.get=function(t,e){return t&&0<(t=this.D(t)).length?String(t[0]):e},Ts.lc=function(t,e){this.Ib(t),0<e.length&&(this.ia(),this.a.set(this.$(t),Hs(e)),this.b+=e.length)},Ts.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.O(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.D(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Ts.ia=function(){this.c=null},Ts.Gb=function(){var t=new Uc;return t.c=this.c,this.a&&(t.a=this.a.Pb(),t.b=this.b),t},Ts.$=function(t){return t=String(t),this.f&&(t=t.toLowerCase()),t},Ts.Oc=function(t){t&&!this.f&&(this.V(),this.ia(),this.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(this.Ib(e),this.lc(n,t))},this)),this.f=t},Bs(function(){},function(){}),(Ts=qc.prototype).R=null,Ts.Wc=function(t){this.h=t},Ts.Vc=function(t){this.i=t,t=this.a.Cb(this.i),hc(3);var e=this.a.H.b;null!=e?(this.f=this.a.Oa(e[0]),this.R=1,this.rb()):(t.Aa("MODE","init"),!this.a.o&&this.a.j&&t.Aa("X-HTTP-Session-Id",this.a.j),this.b=new Ec(this,void 0,void 0),this.b.ha(this.h),this.b.bb(t,!1,null),this.R=0)},Ts.rb=function(){var t=this.a.H.a;if(null!=t)hc(4),t?(hc(10),this.a.na(this,!1)):(hc(11),this.a.na(this,!0));else{this.b=new Ec(this,void 0,void 0),this.b.ha(this.h),t=this.a.Bb(this.f,this.i),hc(4),t.Aa("TYPE","xmlhttp");var e=this.a.j,n=this.a.Fa;e&&n&&t.m(e,n),this.b.bb(t,!1,this.f)}},Ts.sa=function(t){return this.a.sa(t)},Ts.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},Ts.Tb=function(){return!1},Ts.bc=function(t,e){if(this.c=t.o,0==this.R)if(this.Uc(t),e){try{var n=this.a.U.a(e)}catch(t){return void this.a.ab(this)}this.f=this.a.Oa(n[0])}else this.a.ab(this);else 1==this.R&&(this.g?hc(6):"11111"==e?(hc(5),this.g=!0,this.Ac()&&(this.c=200,this.b.cancel(),hc(11),this.a.na(this,!0))):(hc(7),this.g=!1))},Ts.Va=function(){this.c=this.b.o,this.b.b?0==this.R?(this.R=1,this.rb()):1==this.R&&(this.g?(hc(11),this.a.na(this,!0)):(hc(10),this.a.na(this,!1))):(0==this.R?hc(8):1==this.R&&hc(9),this.a.ab(this))},Ts.Uc=function(t){if(!this.a.o&&(t=t.a)){var e=t.ga("X-Client-Wire-Protocol");this.l=e||null,this.a.j&&(t=t.ga("X-HTTP-Session-Id"))&&this.a.kc(t)}},Ts.Da=function(){return this.a.Da()},Ts.Pa=function(){return this.a.Pa()},Ts.Ac=function(){return!uu||10<=Number(gu)},(Ts=Bc.prototype).add=function(t){this.a.set(jc(t),t)},Ts.ed=function(t){this.a.Qb(jc(t))},Ts.jd=function(){this.a.gd()},Ts.Rb=function(){return this.a.hd()},Ts.Ob=function(t){return this.a.Ra(jc(t))},Ts.D=function(){return this.a.D()};var Kc=10;function Hc(){this.b=this.a=void 0}function Gc(){this.f=new Hc}function zc(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}(Ts=Qc.prototype).kb=function(t){!this.a&&(Xs(t,"spdy")||Xs(t,"quic")||Xs(t,"h2"))&&(this.f=this.g,this.a=new Bc,this.b&&(this.Ha(this.b),this.b=null))},Ts.Ub=function(){return!!this.b||!!this.a&&this.a.a.c>=this.f},Ts.Mc=function(){return this.b?1:this.a?this.a.a.c:0},Ts.Ta=function(t){return this.b?this.b==t:!!this.a&&this.a.Ob(t)},Ts.Ha=function(t){this.a?this.a.add(t):this.b=t},Ts.gc=function(t){this.b&&this.b==t?this.b=null:this.a&&this.a.Ob(t)&&this.a.ed(t)},Ts.cancel=function(){this.c=this.Xb(),this.b?(this.b.cancel(),this.b=null):this.a&&!this.a.Rb()&&(Qs(this.a.D(),function(t){t.cancel()}),this.a.jd())},Ts.Xb=function(){if(null!=this.b)return this.c.concat(this.b.j);if(null==this.a||this.a.Rb())return Hs(this.c);var e=this.c;return Qs(this.a.D(),function(t){e=e.concat(t.j)}),e},Ts.wc=function(t){this.c=this.c.concat(t)},Ts.Bc=function(){this.c.length=0},Hc.prototype.stringify=function(t){return Is.JSON.stringify(t,this.a)},Hc.prototype.parse=function(t){return Is.JSON.parse(t,this.b)},Gc.prototype.b=function(t,r,e){var i=e||"";try{Cc(t,function(t,e){var n=t;Ps(t)&&(n=Qu(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}},Gc.prototype.c=function(t,e,n){for(var r=-1;;){var i=["count="+e];-1==r?0<e?(r=t[0].a,i.push("ofs="+r)):r=0:i.push("ofs="+r);for(var o=!0,a=0;a<e;a++){var s=t[a].a,u=t[a].b;if((s-=r)<0)r=Math.max(0,t[a].a-100),o=!1;else try{this.b(u,i,"req"+s+"_")}catch(t){n&&n(u)}}if(o)return i.join("&")}},Gc.prototype.a=function(t){return this.f.parse(t)};var Yc=Is.JSON.parse;function Xc(t){Wu.call(this),this.headers=new Ic,this.l=t||null,this.b=!1,this.v=this.a=null,this.C="",this.h=0,this.f="",this.g=this.B=this.o=this.A=!1,this.u=0,this.s=null,this.J=Jc,this.H=this.L=this.I=!1}Bs(Xc,Wu);var Jc="",$c=/^https?$/i,Zc=["POST","PUT"];function th(t){return"content-type"==t.toLowerCase()}function eh(t,e){return{type:e,lengthComputable:t.lengthComputable,loaded:t.loaded,total:t.total}}function nh(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;var i;if(i="",tu(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,Ns(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var o=""}else o=t.substring(r+1,n);n=(t=[t.substr(0,r),o,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return t.m(e,n),t}function rh(t){this.gb=22,this.g=[],this.H=new Vc,this.da=this.fb=this.C=this.Ea=this.a=this.Fa=this.j=this.ca=this.f=this.J=this.h=null,this.sc=!0,this.zc=this.L=0,this.uc=!!Ds("internalChannelParams.failFast",t),this.Ga=this.v=this.s=this.l=this.i=this.b=null,this.eb=!0,this.B=this.jb=this.K=-1,this.Y=this.u=this.A=0,this.tc=Ds("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Fc=Ds("internalChannelParams.retryDelaySeedMs",t)||1e4,this.pc=Ds("internalChannelParams.forwardChannelMaxRetries",t)||2,this.ib=Ds("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.xc=t&&t.ue||void 0,this.F=void 0,this.vc=0,this.T=t&&t.supportsCrossDomainXhr||!1,this.I="",this.c=new Qc(t&&t.concurrentRequestLimit),this.U=new Gc,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.hb=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.se&&(this.eb=!1)}function ih(){}function oh(){if(uu&&!(10<=Number(gu)))throw Error("Environmental error: no available transport.")}function ah(t,e){Wu.call(this),this.a=new rh(e),this.g=t,this.o=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.cd(t),t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.tb&&(t?t["X-WebChannel-Client-Profile"]=e.tb:t={"X-WebChannel-Client-Profile":e.tb}),this.a.Pd(t),(t=e&&e.httpHeadersOverwriteParam)&&!Gs(t)&&this.a.Nd(t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Gs(e)&&(this.a.Od(e),null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ch(this)}function sh(t){bc.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.f=t)?(t=this.f,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function uh(){wc.call(this),this.status=1}function ch(t){this.a=t}(Ts=Xc.prototype).Sd=function(t){this.I=t},Ts.xa=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.C+"; newUri="+t);e=e?e.toUpperCase():"GET",this.C=t,this.f="",this.h=0,this.A=!1,this.b=!0,this.a=this.Ec(),this.v=this.l?this.l.c():gc.c(),this.a.onreadystatechange=Us(this.ac,this),this.L&&"onprogress"in this.a&&(this.a.onprogress=Us(function(t){this.Zb(t,!0)},this),this.a.upload&&(this.a.upload.onprogress=Us(this.Zb,this)));try{this.B=!0,this.a.open(e,String(t),!0),this.B=!1}catch(t){return void this.Ab(t)}t=n||"";var i,o=this.headers.Pb();r&&Cc(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=th,n=t.length,r=Ns(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:Ns(t)?t.charAt(e):t[e]}(o.O()),n=Is.FormData&&t instanceof Is.FormData,!(0<=Ws(Zc,e))||r||n||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.J&&(this.a.responseType=this.J),"withCredentials"in this.a&&this.a.withCredentials!==this.I&&(this.a.withCredentials=this.I);try{this.sb(),0<this.u&&((this.H=(i=this.a,uu&&bu(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.u,this.a.ontimeout=Us(this.Nb,this)):this.s=ec(this.Nb,this.u,this)),this.o=!0,this.a.send(t),this.o=!1}catch(t){this.Ab(t)}},Ts.Ec=function(){return this.l?this.l.b():gc.b()},Ts.Nb=function(){void 0!==Cs&&this.a&&(this.f="Timed out after "+this.u+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},Ts.Ab=function(t){this.b=!1,this.a&&(this.g=!0,this.a.abort(),this.g=!1),this.f=t,this.h=5,this.xb(),this.qa()},Ts.xb=function(){this.A||(this.A=!0,this.dispatchEvent("complete"),this.dispatchEvent("error"))},Ts.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),this.qa())},Ts.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),this.qa(!0)),Xc.S.G.call(this)},Ts.ac=function(){this.i||(this.B||this.o||this.g?this.$b():this.Bd())},Ts.Bd=function(){this.$b()},Ts.$b=function(){if(this.b&&void 0!==Cs&&(!this.v[1]||4!=this.W()||2!=this.aa()))if(this.o&&4==this.W())ec(this.ac,0,this);else if(this.dispatchEvent("readystatechange"),this.td()){this.b=!1;try{this.vd()?(this.dispatchEvent("complete"),this.dispatchEvent("success")):(this.h=6,this.f=this.Fb()+" ["+this.aa()+"]",this.xb())}finally{this.qa()}}},Ts.Zb=function(t,e){this.dispatchEvent(eh(t,"progress")),this.dispatchEvent(eh(t,e?"downloadprogress":"uploadprogress"))},Ts.qa=function(t){if(this.a){this.sb();var e=this.a,n=this.v[0]?As:null;this.v=this.a=null,t||this.dispatchEvent("ready");try{e.onreadystatechange=n}catch(t){}}},Ts.sb=function(){this.a&&this.H&&(this.a.ontimeout=null),this.s&&(Is.clearTimeout(this.s),this.s=null)},Ts.td=function(){return 4==this.W()},Ts.vd=function(){var t=this.aa();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}return e||0===t&&!this.ud()},Ts.ud=function(){var t=String(this.C).match(Dc)[1]||null;return!t&&Is.self&&Is.self.location&&(t=(t=Is.self.location.protocol).substr(0,t.length-1)),$c.test(t?t.toLowerCase():"")},Ts.W=function(){return this.a?this.a.readyState:0},Ts.aa=function(){try{return 2<this.W()?this.a.status:-1}catch(t){return-1}},Ts.Fb=function(){try{return 2<this.W()?this.a.statusText:""}catch(t){return""}},Ts.va=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},Ts.Nc=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Yc(e)}},Ts.ga=function(t){return this.a?this.a.getResponseHeader(t):null},Ts.Db=function(){return this.h},Ts.dd=function(){return Ns(this.f)?this.f:String(this.f)},(Ts=rh.prototype).qb=8,Ts.w=1,Ts.bd=function(t,e,n){hc(0),this.Ea=e,this.ca=n||{},this.o&&(this.H.b=[],this.H.a=!1),this.Dc(t)},Ts.Qa=function(){if(this.lb(),3==this.w){var t=this.L++,e=this.C.N();e.m("SID",this.I),e.m("RID",t),e.m("TYPE","terminate"),this.ea(e),new Ec(this,t,void 0).Ld(e)}this.Yb()},Ts.Dc=function(t){this.v=new qc(this),null===this.f&&this.v.Wc(this.h);var e=t;this.f&&this.h&&(e=nh(t,this.f,this.h)),this.v.Vc(e)},Ts.Cc=function(){this.C=this.Cb(this.Ea),this.Ma()},Ts.lb=function(){this.v&&(this.v.abort(),this.v=null),this.a&&(this.a.cancel(),this.a=null),this.l&&(Is.clearTimeout(this.l),this.l=null),this.ra(),this.c.cancel(),this.i&&(Is.clearTimeout(this.i),this.i=null)},Ts.cd=function(t){this.h=t},Ts.Pd=function(t){this.J=t},Ts.Nd=function(t){this.f=t},Ts.Od=function(t){this.j=t},Ts.kc=function(t){this.Fa=t},Ts.Rd=function(){this.T=!0},Ts.jc=function(t){this.b=t},Ts.sd=function(){return!this.Ga},Ts.Xa=function(t){this.g.push(new Wc(this.zc++,t)),3==this.w&&this.Ma()},Ts.Jc=function(){return this.uc?0:this.pc},Ts.Tb=function(){return 0==this.w},Ts.Ma=function(){this.c.Ub()||this.i||(this.i=fc(Us(this.dc,this),0),this.A=0)},Ts.xd=function(t){return!(this.c.Mc()>=this.c.f-(this.i?1:0))&&(this.i?(this.g=t.j.concat(this.g),!0):!(1==this.w||2==this.w||this.A>=this.Jc())&&(this.i=fc(Us(this.dc,this,t),this.Eb(this.A)),this.A++,!0))},Ts.dc=function(t){this.i=null,this.Xd(t)},Ts.Xd=function(t){1==this.w?t||(this.Fd(),this.w=2):3==this.w&&(t?this.Wb(t):0==this.g.length||this.c.Ub()||this.Wb())},Ts.Fd=function(){this.L=Math.floor(1e5*Math.random());var t=this.L++,e=new Ec(this,t,void 0),n=this.h;this.J&&(n?ru(n=eu(n),this.J):n=this.J),null===this.f&&e.ha(n);var r=this.wb(e),i=this.C.N();i.m("RID",t),0<this.gb&&i.m("CVER",this.gb),this.o&&this.j&&i.m("X-HTTP-Session-Id",this.j),this.ea(i),this.f&&n&&nh(i,this.f,n),this.c.Ha(e),this.hb?(i.m("$req",r),i.m("SID","null"),e.Md(),e.cb(i,null)):e.cb(i,r)},Ts.Wb=function(t){var e;e=t?t.da:this.L++;var n=this.C.N();n.m("SID",this.I),n.m("RID",e),n.m("AID",this.K),this.ea(n),this.f&&this.h&&nh(n,this.f,this.h),e=new Ec(this,e,this.A+1),null===this.f&&e.ha(this.h),t&&this.Jd(t),t=this.wb(e),e.setTimeout(Math.round(.5*this.ib)+Math.round(.5*this.ib*Math.random())),this.c.Ha(e),e.cb(n,t)},Ts.ea=function(n){this.b&&Cc({},function(t,e){n.m(e,t)})},Ts.wb=function(t){var e=Math.min(this.g.length,1e3),n=this.b?Us(this.b.yc,this.b,this):null;return n=this.U.c(this.g,e,n),t.Qd(this.g.splice(0,e)),n},Ts.Jd=function(t){this.g=t.j.concat(this.g)},Ts.zb=function(){if(!this.a&&!this.l){this.Y=1;var t=this.cc;Gu||(e=Is.Promise.resolve(void 0),Gu=function(){e.then(Zu)}),Ju||(Gu(),Ju=!0),$u.add(t,this),this.u=0}var e},Ts.Ua=function(){return!(this.a||this.l||3<=this.u)&&(this.Y++,this.l=fc(Us(this.cc,this),this.Eb(this.u)),this.u++,!0)},Ts.cc=function(){this.l=null,this.Vd()},Ts.Vd=function(){this.a=new Ec(this,"rpc",this.Y),null===this.f&&this.a.ha(this.h),this.a.Xc(this.vc);var t=this.fb.N();t.m("RID","rpc"),t.m("SID",this.I),t.m("CI",this.Ga?"0":"1"),t.m("AID",this.K),this.ea(t),t.m("TYPE","xmlhttp"),this.f&&this.h&&nh(t,this.f,this.h),this.F&&this.a.setTimeout(this.F),this.a.bb(t,!0,this.da)},Ts.na=function(t,e){var n=t.l;n&&this.c.kb(n),this.Ga=this.eb&&e,this.B=t.c,this.Cc()},Ts.ab=function(t){this.B=t.c,this.X(2)},Ts.bc=function(t,e){if(0!=this.w&&(this.a==t||this.c.Ta(t)))if(this.B=t.o,!t.s&&this.c.Ta(t)&&3==this.w){try{var n=this.U.a(e)}catch(t){n=null}Rs(n)&&3==n.length?this.ld(n,t):this.X(11)}else(t.s||this.a==t)&&this.ra(),Gs(e)||(n=this.U.a(e),this.Ad(n,t))},Ts.ld=function(t,e){0==t[0]?this.kd(e):(this.jb=t[1],0<this.jb-this.K&&this.Ud(t[2])&&!this.s&&(this.s=fc(Us(this.yd,this),6e3)))},Ts.kd=function(t){if(!this.l){if(this.a){if(!(this.a.u+3e3<t.u))return;this.ra(),this.a.cancel(),this.a=null}this.Ua(),hc(18)}},Ts.Ud=function(t){return t<37500&&!this.sd()&&0==this.u},Ts.Oa=function(t){return this.sc?this.b?this.b.$c(t):t:null},Ts.yd=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,this.Ua(),hc(19))},Ts.ra=function(){null!=this.s&&(Is.clearTimeout(this.s),this.s=null)},Ts.Va=function(t){var e=null;if(this.a==t){this.ra(),this.a=null;var n=2}else{if(!this.c.Ta(t))return;e=t.j,this.c.gc(t),n=1}if(this.B=t.o,0!=this.w)if(t.b)1==n?(n=Vs()-t.u,ac.dispatchEvent(new lc(ac,t.i?t.i.length:0,n,this.A)),this.Ma()):this.zb();else{var r=t.c;if(3==r||0==r&&0<this.B||!(1==n&&this.xd(t)||2==n&&this.Ua()))switch(e&&0<e.length&&this.c.wc(e),r){case 1:this.X(5);break;case 4:this.X(10);break;case 3:this.X(6);break;default:this.X(2)}}},Ts.Eb=function(t){var e=this.tc+Math.floor(Math.random()*this.Fc);return this.Pa()||(e*=2),e*t},Ts.ad=function(t){if(this.o&&(t=t.a)){var e=t.ga("X-Client-Wire-Protocol");e&&this.c.kb(e),this.j&&(t=t.ga("X-HTTP-Session-Id"))&&(this.kc(t),this.C.m(this.j,t))}},Ts.Ad=function(t,e){for(var n=this.b&&this.b.Ia?[]:null,r=0;r<t.length;r++){var i=t[r];if(this.K=i[0],i=i[1],2==this.w)if("c"==i[0]){this.I=i[1],this.da=this.Oa(i[2]);var o=i[3];null!=o&&(this.qb=o),null!=(i=i[5])&&"number"==typeof i&&0<i&&(this.F=1.5*i),this.ad(e),this.w=3,this.b&&this.b.pb(),this.Wd(e)}else"stop"!=i[0]&&"close"!=i[0]||this.X(7);else 3==this.w&&("stop"==i[0]||"close"==i[0]?(n&&0!=n.length&&(this.b.Ia(this,n),n.length=0),"stop"==i[0]?this.X(7):this.Qa()):"noop"!=i[0]&&(n?n.push(i):this.b&&this.b.ob(i)),this.u=0)}n&&0!=n.length&&this.b.Ia(this,n)},Ts.Wd=function(t){this.fb=this.Bb(this.da,this.Ea),t.s?(this.c.gc(t),t.Kd(this.F),this.a=t):this.zb()},Ts.X=function(t){if(2==t){var e=null;this.b&&(e=null);var n=Us(this.Zd,this);e||(e=new Ac("//www.google.com/images/cleardot.gif"),Is.location&&"http"==Is.location.protocol||e.ma("https"),e.za()),function(t,e){var n=new oc;if(Is.Image){var r=new Image;r.onload=qs(zc,n,r,"TestLoadImage: loaded",!0,e),r.onerror=qs(zc,n,r,"TestLoadImage: error",!1,e),r.onabort=qs(zc,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=qs(zc,n,r,"TestLoadImage: timeout",!1,e),Is.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(e.toString(),n)}else hc(2);this.zd(t)},Ts.Zd=function(t){hc(t?2:1)},Ts.zd=function(t){this.w=0,this.b&&this.b.nb(t),this.Yb(),this.lb()},Ts.Yb=function(){this.w=0,this.B=-1,this.b&&(0==this.c.Xb().length&&0==this.g.length||(this.c.Bc(),Hs(this.g),this.g.length=0),this.b.mb())},Ts.Cb=function(t){return this.ub(null,t)},Ts.Bb=function(t,e){return this.ub(this.Da()?t:null,e)},Ts.ub=function(t,e){var n,r,i,o,a,s,u=(n=e)instanceof Ac?n.N():new Ac(n,void 0);if(""!=u.c)t&&u.ka(t+"."+u.c),u.la(u.h);else{var c,h=Is.location;c=t?t+"."+h.hostname:h.hostname,r=h.protocol,i=c,o=+h.port,a=e,s=new Ac(null,void 0),r&&s.ma(r),i&&s.ka(i),o&&s.la(o),a&&s.Ba(a),u=s}return this.ca&&tu(this.ca,function(t,e){u.m(e,t)}),t=this.j,e=this.Fa,t&&e&&u.m(t,e),u.m("VER",this.qb),this.ea(u),u},Ts.sa=function(t){if(t&&!this.T)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Xc(this.xc)).Sd(this.T),t},Ts.Pa=function(){return!!this.b&&!0},Ts.Da=function(){return this.T},(Ts=ih.prototype).Ia=null,Ts.pb=function(){},Ts.ob=function(){},Ts.nb=function(){},Ts.mb=function(){},Ts.yc=function(){},Ts.$c=function(t){return t},oh.prototype.a=function(t,e){return new ah(t,e)},Bs(ah,Wu),(Ts=ah.prototype).addEventListener=function(t,e,n,r){ah.S.addEventListener.call(this,t,e,n,r)},Ts.removeEventListener=function(t,e,n,r){ah.S.removeEventListener.call(this,t,e,n,r)},Ts.Yc=function(){this.a.jc(this.f),this.l&&this.a.Rd(),this.a.bd(this.o,this.g,this.b||void 0)},Ts.close=function(){this.a.Qa()},Ts.Zc=function(t){if(Ns(t)){var e={};e.__data__=t,this.a.Xa(e)}else this.h?((e={}).__data__=Qu(t),this.a.Xa(e)):this.a.Xa(t)},Ts.G=function(){this.a.jc(null),delete this.f,this.a.Qa(),delete this.a,ah.S.G.call(this)},Bs(sh,bc),Bs(uh,wc),Bs(ch,ih),ch.prototype.pb=function(){this.a.dispatchEvent("a")},ch.prototype.ob=function(t){this.a.dispatchEvent(new sh(t))},ch.prototype.nb=function(t){this.a.dispatchEvent(new uh(t))},ch.prototype.mb=function(){this.a.dispatchEvent("b")};var hh=qs(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},oh);oh.prototype.createWebChannel=oh.prototype.a,ah.prototype.send=ah.prototype.Zc,ah.prototype.open=ah.prototype.Yc,ah.prototype.close=ah.prototype.close,pc.NO_ERROR=0,pc.TIMEOUT=8,pc.HTTP_ERROR=6,dc.COMPLETE="complete",(mc.EventType=vc).OPEN="a",vc.CLOSE="b",vc.ERROR="c",vc.MESSAGE="d",Wu.prototype.listen=Wu.prototype.Lb,Xc.prototype.listenOnce=Xc.prototype.Mb,Xc.prototype.getLastError=Xc.prototype.dd,Xc.prototype.getLastErrorCode=Xc.prototype.Db,Xc.prototype.getStatus=Xc.prototype.aa,Xc.prototype.getStatusText=Xc.prototype.Fb,Xc.prototype.getResponseJson=Xc.prototype.Nc,Xc.prototype.getResponseText=Xc.prototype.va,Xc.prototype.send=Xc.prototype.xa;var lh,fh,ph={createWebChannelTransport:hh,ErrorCode:pc,EventType:dc,WebChannel:mc,XhrIo:Xc},dh=ph.createWebChannelTransport,yh=ph.ErrorCode,mh=ph.EventType,gh=ph.WebChannel,vh=ph.XhrIo,bh=Fh.SDK_VERSION,wh=new fi("@firebase/firestore");function _h(){return wh.logLevel===ri.DEBUG?lh.DEBUG:wh.logLevel===ri.SILENT?lh.SILENT:lh.ERROR}function Eh(t){switch(t){case lh.DEBUG:wh.logLevel=ri.DEBUG;break;case lh.ERROR:wh.logLevel=ri.ERROR;break;case lh.SILENT:wh.logLevel=ri.SILENT;break;default:wh.error("Firestore ("+bh+"): Invalid value passed to `setLogLevel`")}}function Th(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(wh.logLevel<=ri.DEBUG){var i=n.map(Ch);wh.debug.apply(wh,["Firestore ("+bh+") ["+t+"]: "+e].concat(i))}}function Sh(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(wh.logLevel<=ri.ERROR){var r=e.map(Ch);wh.error.apply(wh,["Firestore ("+bh+"): "+t].concat(r))}}function Ch(e){if("string"==typeof e)return e;var t=Dh.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Ih(t){var e="FIRESTORE ("+bh+") INTERNAL ASSERTION FAILED: "+t;throw Sh(e),new Error(e)}function Nh(t,e){t||Ih(e)}(fh=lh||(lh={}))[fh.DEBUG=0]="DEBUG",fh[fh.ERROR=1]="ERROR",fh[fh.SILENT=2]="SILENT";var Dh=function(){function e(){}return e.setPlatform=function(t){e.platform&&Ih("Platform already defined"),e.platform=t},e.getPlatform=function(){return e.platform||Ih("Platform not set"),e.platform},e}();function Ah(){return Dh.getPlatform().emptyByteString}var kh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Rh=function(r){function t(t,e){var n=r.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}return ni(t,r),t}(Error);function Oh(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Rh(kh.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Ph(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Mh(t,e){return void 0!==t?t:e}function xh(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Lh(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Uh(t){for(var e in Nh(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function qh(t,e){if(0!==e.length)throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+nl(e.length,"argument")+".")}function Vh(t,e,n){if(e.length!==n)throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires "+nl(n,"argument")+", but was called with "+nl(e.length,"argument")+".")}function Bh(t,e,n){if(e.length<n)throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires at least "+nl(n,"argument")+", but was called with "+nl(e.length,"argument")+".")}function jh(t,e,n,r){if(e.length<n||e.length>r)throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+nl(e.length,"argument")+".")}function Wh(t,e,n,r){Yh(t,e,el(n)+" argument",r)}function Qh(t,e,n,r){void 0!==r&&Wh(t,e,n,r)}function Kh(t,e,n,r){Yh(t,e,n+" option",r)}function Hh(t,e,n,r){void 0!==r&&Kh(t,e,n,r)}function Gh(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Jh(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Jh(r[o]))}(t,e,n,r,i)}function zh(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Jh(u))}var c=Jh(r);throw new Rh(kh.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Yh(t,e,n,r){if(!("object"===e?Xh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Jh(r);throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Xh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Jh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Ih("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function $h(t,e,n){if(void 0===n)throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+el(e)+" argument, but it was undefined.")}function Zh(n,t,r){Lh(t,function(t,e){if(r.indexOf(t)<0)throw new Rh(kh.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function tl(t,e,n,r){var i=Jh(r);return new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires its "+el(n)+" argument to be a "+e+", but it was: "+i)}function el(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function nl(t,e){return t+" "+e+(1===t?"":"s")}var rl=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return Nh(20===e.length,"Invalid auto ID: "+e),e},t}();function il(t,e){return t<e?-1:e<t?1:0}function ol(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function al(t){return t+"\0"}function sl(){if("undefined"==typeof Uint8Array)throw new Rh(kh.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ul(){if(!Dh.getPlatform().base64Available)throw new Rh(kh.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var cl,hl,ll,fl,pl=function(){function e(t){ul(),this._binaryString=t}return e.fromBase64String=function(t){Vh("Blob.fromBase64String",arguments,1),Wh("Blob.fromBase64String","string",1,t),ul();try{return new e(Dh.getPlatform().atob(t))}catch(t){throw new Rh(kh.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},e.fromUint8Array=function(t){if(Vh("Blob.fromUint8Array",arguments,1),sl(),!(t instanceof Uint8Array))throw tl("Blob.fromUint8Array","Uint8Array",1,t);return new e(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},e.prototype.toBase64=function(){return Vh("Blob.toBase64",arguments,0),ul(),Dh.getPlatform().btoa(this._binaryString)},e.prototype.toUint8Array=function(){Vh("Blob.toUint8Array",arguments,0),sl();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._binaryString===t._binaryString},e.prototype._compareTo=function(t){return il(this._binaryString,t._binaryString)},e}(),dl=Oh(pl,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),yl=function(){function t(t,e){if(Vh("GeoPoint",arguments,2),Wh("GeoPoint","number",1,t),Wh("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Rh(kh.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Rh(kh.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return il(this._lat,t._lat)||il(this._long,t._long)},t}(),ml=function(){function n(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Rh(kh.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Rh(kh.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Rh(kh.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Rh(kh.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return n.now=function(){return n.fromMillis(Date.now())},n.fromDate=function(t){return n.fromMillis(t.getTime())},n.fromMillis=function(t){var e=Math.floor(t/1e3);return new n(e,1e6*(t-1e3*e))},n.prototype.toDate=function(){return new Date(this.toMillis())},n.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},n.prototype._compareTo=function(t){return this.seconds===t.seconds?il(this.nanoseconds,t.nanoseconds):il(this.seconds,t.seconds)},n.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},n.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},n}(),gl=function(t,e,n,r){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r},vl="(default)",bl=function(){function e(t,e){this.projectId=t,this.database=e||vl}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database===vl},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e.prototype.compareTo=function(t){return il(this.projectId,t.projectId)||il(this.database,t.database)},e}(),wl="__name__",_l=function(){function n(t,e,n){this.init(t,e,n)}return n.prototype.init=function(t,e,n){void 0===e?e=0:e>t.length&&Ih("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Ih("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n},n.prototype.construct=function(t,e,n){var r=Object.create(Object.getPrototypeOf(this));return r.init(t,e,n),r},Object.defineProperty(n.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),n.prototype.isEqual=function(t){return 0===n.comparator(this,t)},n.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(function(t){e.push(t)}):"string"==typeof t?e.push(t):Ih("Unknown parameter type for Path.child(): "+t),this.construct(e)},n.prototype.limit=function(){return this.offset+this.length},n.prototype.popFirst=function(t){return t=void 0===t?1:t,Nh(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},n.prototype.popLast=function(){return Nh(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},n.prototype.firstSegment=function(){return Nh(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},n.prototype.lastSegment=function(){return this.get(this.length-1)},n.prototype.get=function(t){return Nh(t<this.length,"Index out of range"),this.segments[this.offset+t]},n.prototype.isEmpty=function(){return 0===this.length},n.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},n.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},n.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},n.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},n}(),El=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ni(e,t),e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(0<=t.indexOf("//"))throw new Rh(kh.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return 0<t.length}))},e.EMPTY_PATH=new e([]),e}(_l),Tl=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Sl=function(t){function u(){return null!==t&&t.apply(this,arguments)||this}return ni(u,t),u.isValidIdentifier=function(t){return Tl.test(t)},u.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),u.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},u.prototype.toString=function(){return this.canonicalString()},u.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===wl},u.keyField=function(){return new u([wl])},u.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Rh(kh.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new Rh(kh.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Rh(kh.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new Rh(kh.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new u(e)},u.EMPTY_PATH=new u([]),u}(_l),Cl=function(){function e(t){this.path=t,Nh(e.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}return e.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return null!==t&&0===El.comparator(this.path,t.path)},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,e){return El.comparator(t.path,e.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new El(t.slice()))},e.fromPathString=function(t){return new e(El.fromString(t))},e.EMPTY=new e(new El([])),e}(),Il=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return Cl.comparator(t.key,e.key)},t}(),Nl=function(a){function e(t,e,n,r,i){var o=a.call(this,t,e)||this;return o.data=n,o.proto=i,o.hasLocalMutations=!!r.hasLocalMutations,o.hasCommittedMutations=!!r.hasCommittedMutations,o}return ni(e,a),e.prototype.field=function(t){return this.data.field(t)},e.prototype.fieldValue=function(t){var e=this.field(t);return e?e.value():void 0},e.prototype.value=function(){return this.data.value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.data.isEqual(t.data)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return void 0!==r&&void 0!==i?r.compareTo(i):Ih("Trying to compare documents on fields that don't exist")},e}(Il),Dl=function(i){function e(t,e,n){var r=i.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}return ni(e,i),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Il),Al=function(n){function e(t,e){return n.call(this,t,e)||this}return ni(e,n),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Il),kl=function(){function n(t,e){this.comparator=t,this.root=e||Ol.EMPTY}return n.prototype.insert=function(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ol.BLACK,null,null))},n.prototype.remove=function(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ol.BLACK,null,null))},n.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},n.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},n.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(n.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),n.prototype.minKey=function(){return this.root.minKey()},n.prototype.maxKey=function(){return this.root.maxKey()},n.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},n.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},n.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},n.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},n.prototype.getIterator=function(){return new Rl(this.root,null,this.comparator,!1)},n.prototype.getIteratorFrom=function(t){return new Rl(this.root,t,this.comparator,!1)},n.prototype.getReverseIterator=function(){return new Rl(this.root,null,this.comparator,!0)},n.prototype.getReverseIteratorFrom=function(t){return new Rl(this.root,t,this.comparator,!0)},n}(),Rl=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){Nh(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return 0<this.nodeStack.length},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Ol=function(){function o(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:o.RED,this.left=null!=r?r:o.EMPTY,this.right=null!=i?i:o.EMPTY,this.size=this.left.size+1+this.right.size}return o.prototype.copy=function(t,e,n,r,i){return new o(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},o.prototype.isEmpty=function(){return!1},o.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},o.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},o.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},o.prototype.minKey=function(){return this.min().key},o.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},o.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},o.prototype.removeMin=function(){if(this.left.isEmpty())return o.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},o.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return o.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},o.prototype.isRed=function(){return this.color},o.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},o.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},o.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},o.prototype.rotateLeft=function(){var t=this.copy(null,null,o.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},o.prototype.rotateRight=function(){var t=this.copy(null,null,o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},o.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},o.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},o.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Ih("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Ih("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Ih("Black depths differ");return t+(this.isRed()?0:1)},o.EMPTY=null,o.RED=!0,o.BLACK=!1,o}(),Pl=function(){function t(){this.size=0}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Ol(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();Ol.EMPTY=new Pl,(hl=cl||(cl={}))[hl.NullValue=0]="NullValue",hl[hl.BooleanValue=1]="BooleanValue",hl[hl.NumberValue=2]="NumberValue",hl[hl.TimestampValue=3]="TimestampValue",hl[hl.StringValue=4]="StringValue",hl[hl.BlobValue=5]="BlobValue",hl[hl.RefValue=6]="RefValue",hl[hl.GeoPointValue=7]="GeoPointValue",hl[hl.ArrayValue=8]="ArrayValue",hl[hl.ObjectValue=9]="ObjectValue",(fl=ll||(ll={}))[fl.Default=0]="Default",fl[fl.Estimate=1]="Estimate",fl[fl.Previous=2]="Previous";var Ml=function(){function n(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return n.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new n(ll.Estimate,e);case"previous":return new n(ll.Previous,e);case"none":case void 0:return new n(ll.Default,e);default:return Ih("fromSnapshotOptions() called with invalid options.")}},n}(),xl=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return Nh(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),il(this.typeOrder,t.typeOrder)},t}(),Ll=function(e){function n(){var t=e.call(this)||this;return t.typeOrder=cl.NullValue,t.internalValue=null,t}return ni(n,e),n.prototype.value=function(t){return null},n.prototype.isEqual=function(t){return t instanceof n},n.prototype.compareTo=function(t){return t instanceof n?0:this.defaultCompareTo(t)},n.INSTANCE=new n,n}(xl),Fl=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.BooleanValue,e}return ni(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?il(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(xl),Ul=function(n){function r(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.NumberValue,e}return ni(r,n),r.prototype.value=function(t){return this.internalValue},r.prototype.compareTo=function(t){return t instanceof r?(e=this.internalValue,n=t.internalValue,e<n?-1:n<e?1:e===n?0:isNaN(e)?isNaN(n)?0:-1:1):this.defaultCompareTo(t);var e,n},r}(xl);function ql(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var Vl=function(e){function n(t){return e.call(this,t)||this}return ni(n,e),n.prototype.isEqual=function(t){return t instanceof n&&ql(this.internalValue,t.internalValue)},n}(Ul),Bl=function(n){function e(t){var e=n.call(this,t)||this;return e.internalValue=t,e}return ni(e,n),e.prototype.isEqual=function(t){return t instanceof e&&ql(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Ul),jl=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.StringValue,e}return ni(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?il(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(xl),Wl=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.TimestampValue,e}return ni(e,n),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof Ql?-1:this.defaultCompareTo(t)},e}(xl),Ql=function(r){function e(t,e){var n=r.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=cl.TimestampValue,n}return ni(e,r),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===ll.Estimate?new Wl(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===ll.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Wl?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(xl),Kl=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.BlobValue,e}return ni(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(xl),Hl=function(r){function n(t,e){var n=r.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=cl.RefValue,n}return ni(n,r),n.prototype.value=function(t){return this.key},n.prototype.isEqual=function(t){return t instanceof n&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},n.prototype.compareTo=function(t){if(t instanceof n){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:Cl.comparator(this.key,t.key)}return this.defaultCompareTo(t)},n}(xl),Gl=function(n){function e(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.GeoPointValue,e}return ni(e,n),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(xl),zl=function(n){function a(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.ObjectValue,e}return ni(a,n),a.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},a.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},a.prototype.isEqual=function(t){if(t instanceof a){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},a.prototype.compareTo=function(t){if(t instanceof a){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=il(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return il(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},a.prototype.set=function(t,e){if(Nh(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof a||(n=a.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},a.prototype.delete=function(t){if(Nh(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new a(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof a){var n=e.delete(t.popFirst());return new a(this.internalValue.insert(t.firstSegment(),n))}return this},a.prototype.contains=function(t){return void 0!==this.field(t)},a.prototype.field=function(t){Nh(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof a&&e.internalValue.get(t)||void 0}),e},a.prototype.toString=function(){return this.internalValue.toString()},a.prototype.child=function(t){return this.internalValue.get(t)||void 0},a.prototype.setChild=function(t,e){return new a(this.internalValue.insert(t,e))},a.EMPTY=new a(new kl(il)),a}(xl),Yl=function(n){function i(t){var e=n.call(this)||this;return e.internalValue=t,e.typeOrder=cl.ArrayValue,e}return ni(i,n),i.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},i.prototype.forEach=function(t){this.internalValue.forEach(t)},i.prototype.isEqual=function(t){if(t instanceof i){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},i.prototype.compareTo=function(t){if(t instanceof i){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return il(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},i.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},i}(xl),Xl=Number,Jl=Xl.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),$l=Xl.MAX_SAFE_INTEGER||Math.pow(2,53)-1,Zl=Xl.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function tf(t){return null==t}function ef(t){return Zl(t)&&t<=$l&&Jl<=t}var nf,rf,of=function(){function n(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return n.atPath=function(t){return new n(t)},Object.defineProperty(n.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[df]:this.memoizedOrderBy=[new pf(t),df];else{Nh(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:lf.ASCENDING;this.memoizedOrderBy.push(a===lf.ASCENDING?df:yf)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),n.prototype.addFilter=function(t){Nh(null==this.getInequalityFilterField()||!(t instanceof uf)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),Nh(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.startAt,this.endAt)},n.prototype.addOrderBy=function(t){Nh(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new n(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.startAt,this.endAt)},n.prototype.withLimit=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,this.startAt,this.endAt)},n.prototype.withStartAt=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,t,this.endAt)},n.prototype.withEndAt=function(t){return new n(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,t)},n.prototype.asCollectionQueryAtPath=function(t){return new n(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},n.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}tf(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},n.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),tf(this.limit)||(t+=", limit: "+this.limit),0<this.explicitOrderBy.length&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},n.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},n.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return Nh(n,"orderBy used that doesn't compare on key field"),0},n.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},n.prototype.hasLimit=function(){return!tf(this.limit)},n.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},n.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof uf&&n.isInequality())return n.field}return null},n.prototype.hasArrayContainsFilter=function(){return void 0!==this.filters.find(function(t){return t instanceof uf&&t.op===sf.ARRAY_CONTAINS})},n.prototype.isDocumentQuery=function(){return Cl.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},n.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},n.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Cl.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},n.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&void 0===t.field(r.field))return!1}return!0},n.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},n.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},n.prototype.assertValidBound=function(t){Nh(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},n}(),af=function(){function t(){}return t.create=function(t,e,n){if(n.isEqual(Ll.INSTANCE)){if(e!==sf.EQUAL)throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on null.");return new cf(t)}if(n.isEqual(Bl.NAN)){if(e!==sf.EQUAL)throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. You can only perform equals comparisons on NaN.");return new hf(t)}return new uf(t,e,n)},t}(),sf=function(){function e(t){this.name=t}return e.fromString=function(t){switch(t){case"<":return e.LESS_THAN;case"<=":return e.LESS_THAN_OR_EQUAL;case"==":return e.EQUAL;case">=":return e.GREATER_THAN_OR_EQUAL;case">":return e.GREATER_THAN;case"array-contains":return e.ARRAY_CONTAINS;default:return Ih("Unknown relation: "+t)}},e.prototype.toString=function(){return this.name},e.prototype.isEqual=function(t){return this.name===t.name},e.LESS_THAN=new e("<"),e.LESS_THAN_OR_EQUAL=new e("<="),e.EQUAL=new e("=="),e.GREATER_THAN=new e(">"),e.GREATER_THAN_OR_EQUAL=new e(">="),e.ARRAY_CONTAINS=new e("array-contains"),e}(),uf=function(i){function e(t,e,n){var r=i.call(this)||this;return r.field=t,r.op=e,r.value=n,r}return ni(e,i),e.prototype.matches=function(t){if(this.field.isKeyField()){Nh(this.value instanceof Hl,"Comparing on key, but filter value not a RefValue"),Nh(this.op!==sf.ARRAY_CONTAINS,"array-contains queries don't make sense on document keys.");var e=this.value,n=Cl.comparator(t.key,e.key);return this.matchesComparison(n)}var r=t.field(this.field);return void 0!==r&&this.matchesValue(r)},e.prototype.matchesValue=function(t){var e=this;return this.op===sf.ARRAY_CONTAINS?t instanceof Yl&&void 0!==t.internalValue.find(function(t){return t.isEqual(e.value)}):this.value.typeOrder===t.typeOrder&&this.matchesComparison(t.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case sf.LESS_THAN:return t<0;case sf.LESS_THAN_OR_EQUAL:return t<=0;case sf.EQUAL:return 0===t;case sf.GREATER_THAN:return 0<t;case sf.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Ih("Unknown relation op"+this.op)}},e.prototype.isInequality=function(){return this.op!==sf.EQUAL&&this.op!==sf.ARRAY_CONTAINS},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(af),cf=function(n){function e(t){var e=n.call(this)||this;return e.field=t,e}return ni(e,n),e.prototype.matches=function(t){var e=t.field(this.field);return void 0!==e&&null===e.value()},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS null"},e.prototype.toString=function(){return this.field.canonicalString()+" IS null"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(af),hf=function(n){function e(t){var e=n.call(this)||this;return e.field=t,e}return ni(e,n),e.prototype.matches=function(t){var e=t.field(this.field),n=e&&e.value();return"number"==typeof n&&isNaN(n)},e.prototype.canonicalId=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.toString=function(){return this.field.canonicalString()+" IS NaN"},e.prototype.isEqual=function(t){return t instanceof e&&this.field.isEqual(t.field)},e}(af),lf=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),ff=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){Nh(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())Nh(o instanceof Hl,"Bound has a non-key value where the key path is being used."),n=Cl.comparator(o.key,e.key);else{var a=e.field(i.field);Nh(void 0!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===lf.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];return n.isEqual(r)}return!0},t}(),pf=function(){function t(t,e){this.field=t,void 0===e&&(e=lf.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Nl.compareByKey(t,e):Nl.compareByField(this.field,t,e);switch(this.dir){case lf.ASCENDING:return n;case lf.DESCENDING:return-1*n;default:return Ih("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),df=new pf(Sl.keyField(),lf.ASCENDING),yf=new pf(Sl.keyField(),lf.DESCENDING),mf=function(){function n(t){this.timestamp=t}return n.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new n(new ml(e,t%1e6*1e3))},n.fromTimestamp=function(t){return new n(t)},n.forDeletedDoc=function(){return n.MIN},n.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},n.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},n.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},n.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},n.prototype.toTimestamp=function(){return this.timestamp},n.MIN=new n(new ml(0,0)),n}();(rf=nf||(nf={}))[rf.Listen=0]="Listen",rf[rf.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",rf[rf.LimboResolution=2]="LimboResolution";var gf,vf,bf=function(){function e(t,e,n,r,i,o){void 0===i&&(i=mf.MIN),void 0===o&&(o=Ah()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return e.prototype.copy=function(t){return new e(this.query,this.targetId,this.purpose,void 0===t.sequenceNumber?this.sequenceNumber:t.sequenceNumber,void 0===t.snapshotVersion?this.snapshotVersion:t.snapshotVersion,void 0===t.resumeToken?this.resumeToken:t.resumeToken)},e.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},e}(),wf=function(){function o(t){this.comparator=t,this.data=new kl(this.comparator)}return o.fromMapKeys=function(t){var e=new o(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},o.prototype.has=function(t){return null!==this.data.get(t)},o.prototype.first=function(){return this.data.minKey()},o.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(o.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),o.prototype.indexOf=function(t){return this.data.indexOf(t)},o.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},o.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},o.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},o.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},o.prototype.getIterator=function(){return new _f(this.data.getIterator())},o.prototype.getIteratorFrom=function(t){return new _f(this.data.getIteratorFrom(t))},o.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},o.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},o.prototype.isEmpty=function(){return this.data.isEmpty()},o.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},o.prototype.isEqual=function(t){if(!(t instanceof o))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},o.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},o.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},o.prototype.copy=function(t){var e=new o(this.comparator);return e.data=t,e},o}(),_f=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Ef=function(){function n(t){this.fields=t}return n.fromSet=function(t){return new n(t)},n.fromArray=function(t){var e=new wf(Sl.comparator);return t.forEach(function(t){return e=e.add(t)}),new n(e)},n.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},n.prototype.applyTo=function(n){var r=zl.EMPTY;return this.fields.forEach(function(t){if(t.isEmpty())return n;var e=n.field(t);void 0!==e&&(r=r.set(t,e))}),r},n.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},n}(),Tf=function(){function t(t,e){this.field=t,this.transform=e}return Object.defineProperty(t.prototype,"isIdempotent",{get:function(){return this.transform.isIdempotent},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),Sf=function(t,e){this.version=t,this.transformResults=e};(vf=gf||(gf={}))[vf.Set=0]="Set",vf[vf.Patch=1]="Patch",vf[vf.Transform=2]="Transform",vf[vf.Delete=3]="Delete";var Cf=function(){function e(t,e){this.updateTime=t,this.exists=e,Nh(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),e.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Nl&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Nl:(Nh(this.isNone,"Precondition should be empty"),!0)},e.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},e.NONE=new e,e}(),If=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&Nh(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof Nl?t.version:mf.MIN},t}(),Nf=function(i){function e(t,e,n){var r=i.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=gf.Set,r}return ni(e,i),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),Nh(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Nl(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=If.getPostMutationVersion(t);return new Nl(this.key,r,this.value,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(If),Df=function(o){function e(t,e,n,r){var i=o.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=gf.Patch,i}return ni(e,o),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Nh(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new Al(this.key,e.version);var n=this.patchDocument(t);return new Nl(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=If.getPostMutationVersion(t),i=this.patchDocument(t);return new Nl(this.key,r,i,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof Nl?t.data:zl.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=void 0!==e?n.set(t,e):n.delete(t)}}),n},e}(If),Af=function(r){function e(t,e){var n=r.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=gf.Transform,n.precondition=Cf.exists(!0),n}return ni(e,r),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),Nh(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new Al(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data,r);return new Nl(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,e),o=this.transformObject(r.data,i);return new Nl(this.key,r.version,o,{hasLocalMutations:!0})},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){for(var t=0,e=this.fieldTransforms;t<e.length;t++){if(!e[t].isIdempotent)return!1}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){var e=new wf(Sl.comparator);return this.fieldTransforms.forEach(function(t){return e=e.add(t.field)}),new Ef(e)},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&ol(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){Nh(t instanceof Nl,"Unknown MaybeDocument type "+t);var e=t;return Nh(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];Nh(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Nl&&(a=t.field(i.field)||null),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e){for(var n=[],r=0,i=this.fieldTransforms;r<i.length;r++){var o=i[r],a=o.transform,s=null;e instanceof Nl&&(s=e.field(o.field)||null),n.push(a.applyToLocalView(s,t))}return n},e.prototype.transformObject=function(t,e){Nh(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(If),kf=function(r){function e(t,e){var n=r.call(this)||this;return n.key=t,n.precondition=e,n.type=gf.Delete,n}return ni(e,r),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),Nh(null==e.transformResults,"Transform results received by DeleteMutation."),new Dl(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&Nh(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new Dl(this.key,mf.forDeletedDoc())):t},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},Object.defineProperty(e.prototype,"isIdempotent",{get:function(){return!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldMask",{get:function(){return null},enumerable:!0,configurable:!0}),e}(If),Rf=function(){function e(){this.isIdempotent=!0}return e.prototype.applyToLocalView=function(t,e){return new Ql(e,t)},e.prototype.applyToRemoteDocument=function(t,e){return e},e.prototype.isEqual=function(t){return t instanceof e},e.instance=new e,e}(),Of=function(){function e(t){this.elements=t,this.isIdempotent=!0}return e.prototype.applyToLocalView=function(t,e){return this.apply(t)},e.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},e.prototype.apply=function(t){for(var n=xf(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++){e(i[r])}return new Yl(n)},e.prototype.isEqual=function(t){return t instanceof e&&ol(t.elements,this.elements)},e}(),Pf=function(){function e(t){this.elements=t,this.isIdempotent=!0}return e.prototype.applyToLocalView=function(t,e){return this.apply(t)},e.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},e.prototype.apply=function(t){for(var n=xf(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++){e(i[r])}return new Yl(n)},e.prototype.isEqual=function(t){return t instanceof e&&ol(t.elements,this.elements)},e}(),Mf=function(){function e(t){this.operand=t,this.isIdempotent=!1}return e.prototype.applyToLocalView=function(t,e){if(t instanceof Vl&&this.operand instanceof Vl){var n=t.internalValue+this.operand.internalValue;return new Vl(n)}if(t instanceof Ul){n=t.internalValue+this.operand.internalValue;return new Bl(n)}return this.operand},e.prototype.applyToRemoteDocument=function(t,e){return Nh(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},e.prototype.isEqual=function(t){return t instanceof e&&this.operand.isEqual(t.operand)},e}();function xf(t){return t instanceof Yl?t.internalValue.slice():[]}var Lf,Ff,Uf=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}();function qf(t){switch(t){case kh.OK:return Ih("Treated status OK as error");case kh.CANCELLED:case kh.UNKNOWN:case kh.DEADLINE_EXCEEDED:case kh.RESOURCE_EXHAUSTED:case kh.INTERNAL:case kh.UNAVAILABLE:case kh.UNAUTHENTICATED:return!1;case kh.INVALID_ARGUMENT:case kh.NOT_FOUND:case kh.ALREADY_EXISTS:case kh.PERMISSION_DENIED:case kh.FAILED_PRECONDITION:case kh.ABORTED:case kh.OUT_OF_RANGE:case kh.UNIMPLEMENTED:case kh.DATA_LOSS:return!0;default:return Ih("Unknown status code: "+t)}}function Vf(t){if(void 0===t)return Sh("GRPC error has no .code"),kh.UNKNOWN;switch(t){case Lf.OK:return kh.OK;case Lf.CANCELLED:return kh.CANCELLED;case Lf.UNKNOWN:return kh.UNKNOWN;case Lf.DEADLINE_EXCEEDED:return kh.DEADLINE_EXCEEDED;case Lf.RESOURCE_EXHAUSTED:return kh.RESOURCE_EXHAUSTED;case Lf.INTERNAL:return kh.INTERNAL;case Lf.UNAVAILABLE:return kh.UNAVAILABLE;case Lf.UNAUTHENTICATED:return kh.UNAUTHENTICATED;case Lf.INVALID_ARGUMENT:return kh.INVALID_ARGUMENT;case Lf.NOT_FOUND:return kh.NOT_FOUND;case Lf.ALREADY_EXISTS:return kh.ALREADY_EXISTS;case Lf.PERMISSION_DENIED:return kh.PERMISSION_DENIED;case Lf.FAILED_PRECONDITION:return kh.FAILED_PRECONDITION;case Lf.ABORTED:return kh.ABORTED;case Lf.OUT_OF_RANGE:return kh.OUT_OF_RANGE;case Lf.UNIMPLEMENTED:return kh.UNIMPLEMENTED;case Lf.DATA_LOSS:return kh.DATA_LOSS;default:return Ih("Unknown status code: "+t)}}(Ff=Lf||(Lf={}))[Ff.OK=0]="OK",Ff[Ff.CANCELLED=1]="CANCELLED",Ff[Ff.UNKNOWN=2]="UNKNOWN",Ff[Ff.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ff[Ff.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ff[Ff.NOT_FOUND=5]="NOT_FOUND",Ff[Ff.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ff[Ff.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ff[Ff.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ff[Ff.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ff[Ff.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ff[Ff.ABORTED=10]="ABORTED",Ff[Ff.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ff[Ff.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ff[Ff.INTERNAL=13]="INTERNAL",Ff[Ff.UNAVAILABLE=14]="UNAVAILABLE",Ff[Ff.DATA_LOSS=15]="DATA_LOSS";var Bf=new kl(Cl.comparator);function jf(){return Bf}function Wf(){return jf()}var Qf=new kl(Cl.comparator);function Kf(){return Qf}var Hf=new kl(Cl.comparator);function Gf(){return Hf}var zf=new wf(Cl.comparator);function Yf(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=zf,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Xf=new wf(il);function Jf(){return Xf}var $f,Zf,tp,ep,np=function(){function o(n){this.comparator=n?function(t,e){return n(t,e)||Cl.comparator(t.key,e.key)}:function(t,e){return Cl.comparator(t.key,e.key)},this.keyedMap=Kf(),this.sortedSet=new kl(this.comparator)}return o.emptySet=function(t){return new o(t.comparator)},o.prototype.has=function(t){return null!=this.keyedMap.get(t)},o.prototype.get=function(t){return this.keyedMap.get(t)},o.prototype.first=function(){return this.sortedSet.minKey()},o.prototype.last=function(){return this.sortedSet.maxKey()},o.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},o.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(o.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),o.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},o.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},o.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},o.prototype.isEqual=function(t){if(!(t instanceof o))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},o.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},o.prototype.copy=function(t,e){var n=new o;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},o}();(Zf=$f||($f={}))[Zf.Added=0]="Added",Zf[Zf.Removed=1]="Removed",Zf[Zf.Modified=2]="Modified",Zf[Zf.Metadata=3]="Metadata",(ep=tp||(tp={}))[ep.Local=0]="Local",ep[ep.Synced=1]="Synced";var rp,ip,op=function(){function t(){this.changeMap=new kl(Cl.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==$f.Added&&n.type===$f.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===$f.Metadata&&n.type!==$f.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===$f.Modified&&n.type===$f.Modified?this.changeMap=this.changeMap.insert(e,{type:$f.Modified,doc:t.doc}):t.type===$f.Modified&&n.type===$f.Added?this.changeMap=this.changeMap.insert(e,{type:$f.Added,doc:t.doc}):t.type===$f.Removed&&n.type===$f.Added?this.changeMap=this.changeMap.remove(e):t.type===$f.Removed&&n.type===$f.Modified?this.changeMap=this.changeMap.insert(e,{type:$f.Removed,doc:n.doc}):t.type===$f.Added&&n.type===$f.Removed?this.changeMap=this.changeMap.insert(e,{type:$f.Modified,doc:t.doc}):Ih("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},t}(),ap=function(){function o(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return o.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:$f.Added,doc:t})}),new o(t,e,np.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(o.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),o.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},o}(),sp=function(){function i(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return i.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=up.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new i(mf.MIN,r,Jf(),jf(),Yf())},i}(),up=function(){function n(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return n.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new n(Ah(),e,Yf(),Yf(),Yf())},n}(),cp=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},hp=function(t,e){this.targetId=t,this.existenceFilter=e};(ip=rp||(rp={}))[ip.NoChange=0]="NoChange",ip[ip.Added=1]="Added",ip[ip.Removed=2]="Removed",ip[ip.Current=3]="Current",ip[ip.Reset=4]="Reset";var lp=function(t,e,n,r){void 0===n&&(n=Ah()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},fp=function(){function t(){this.pendingResponses=0,this.documentChanges=yp(),this._resumeToken=Ah(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var n=Yf(),r=Yf(),i=Yf();return this.documentChanges.forEach(function(t,e){switch(e){case $f.Added:n=n.add(t);break;case $f.Modified:r=r.add(t);break;case $f.Removed:i=i.add(t);break;default:Ih("Encountered invalid change type: "+e)}}),new up(this._resumeToken,this._current,n,r,i)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=yp()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),pp=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=jf(),this.pendingDocumentTargetMapping=dp(),this.pendingTargetResets=new wf(il)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Nl?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof Dl&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case rp.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case rp.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case rp.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),Nh(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case rp.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case rp.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Ih("Unknown target watch change state: "+n.state)}})},t.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):xh(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Cl(i.path);this.removeDocumentFromTarget(e,o,new Dl(o,mf.forDeletedDoc()))}else Nh(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(i){var o=this,a={};xh(this.targetStates,function(t,e){var n=o.queryDataForActiveTarget(t);if(n){if(e.current&&n.query.isDocumentQuery()){var r=new Cl(n.query.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new Dl(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=Yf();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.queryDataForActiveTarget(t);return!e||e.purpose===nf.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new sp(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=jf(),this.pendingDocumentTargetMapping=dp(),this.pendingTargetResets=new wf(il),t},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?$f.Modified:$f.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,$f.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new fp),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new wf(il),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){return null!==this.queryDataForActiveTarget(t)},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(e){var n=this;Nh(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new fp,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function dp(){return new kl(Cl.comparator)}function yp(){return new kl(Cl.comparator)}var mp,gp,vp=((mp={})[lf.ASCENDING.name]="ASCENDING",mp[lf.DESCENDING.name]="DESCENDING",mp),bp=((gp={})[sf.LESS_THAN.name]="LESS_THAN",gp[sf.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",gp[sf.GREATER_THAN.name]="GREATER_THAN",gp[sf.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",gp[sf.EQUAL.name]="EQUAL",gp[sf.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",gp),wp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _p(t,e){Nh(!tf(t),e+" is missing")}function Ep(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Ih("can't parse "+t)}var Tp=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?kh.UNKNOWN:Vf(t.code);return new Rh(e,t.message||"")},t.prototype.toInt32Value=function(t){return tf(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return tf(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);Nh(!!t,"Cannot deserialize null or undefined timestamp.");var e=Ep(t.seconds||"0"),n=t.nanos||0;return new ml(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=wp.exec(t);if(Nh(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new ml(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(Nh(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),pl.fromBase64String(t)):(Nh(!this.options.useProto3Json,"Expected bytes to be passed in as string, but got something else instead."),pl.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return Nh(!!t,"Trying to deserialize version that isn't set"),mf.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=El.fromString(t);return Nh(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return Nh(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),Nh(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Cl(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?El.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new El(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new El(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return Nh(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Ll)return{nullValue:"NULL_VALUE"};if(t instanceof Fl)return{booleanValue:t.value()};if(t instanceof Vl)return{integerValue:""+t.value()};if(t instanceof Bl){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof jl?{stringValue:t.value()}:t instanceof zl?{mapValue:this.toMapValue(t)}:t instanceof Yl?{arrayValue:this.toArrayValue(t)}:t instanceof Wl?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Gl?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Kl?{bytesValue:this.toBytes(t.value())}:t instanceof Hl?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Ih("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this,n=t.value_type;if(Sp(t,n,"nullValue"))return Ll.INSTANCE;if(Sp(t,n,"booleanValue"))return Fl.of(t.booleanValue);if(Sp(t,n,"integerValue"))return new Vl(Ep(t.integerValue));if(Sp(t,n,"doubleValue")){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Bl.NAN;if("Infinity"===t.doubleValue)return Bl.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Bl.NEGATIVE_INFINITY}return new Bl(t.doubleValue)}if(Sp(t,n,"stringValue"))return new jl(t.stringValue);if(Sp(t,n,"mapValue"))return this.fromFields(t.mapValue.fields||{});if(Sp(t,n,"arrayValue")){_p(t.arrayValue,"arrayValue");var r=t.arrayValue.values||[];return new Yl(r.map(function(t){return e.fromValue(t)}))}if(Sp(t,n,"timestampValue"))return _p(t.timestampValue,"timestampValue"),new Wl(this.fromTimestamp(t.timestampValue));if(Sp(t,n,"geoPointValue")){_p(t.geoPointValue,"geoPointValue");var i=t.geoPointValue.latitude||0,o=t.geoPointValue.longitude||0;return new Gl(new yl(i,o))}if(Sp(t,n,"bytesValue")){_p(t.bytesValue,"bytesValue");var a=this.fromBlob(t.bytesValue);return new Kl(a)}if(Sp(t,n,"referenceValue")){_p(t.referenceValue,"referenceValue");var s=this.fromResourceName(t.referenceValue),u=new bl(s.get(1),s.get(3)),c=new Cl(this.extractLocalPathFromResourceName(s));return new Hl(u,c)}return Ih("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return Nh(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){return new Nl(this.fromName(t.name),this.fromVersion(t.updateTime),this.fromFields(t.fields||{}),{hasCommittedMutations:!!e})},t.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},t.prototype.fromFields=function(t){var n=this,e=t,r=zl.EMPTY;return Lh(e,function(t,e){r=r.set(new Sl([t]),n.fromValue(e))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){Nh(!!t.found,"Tried to deserialize a found document from a missing document."),_p(t.found.name,"doc.found.name"),_p(t.found.updateTime,"doc.found.updateTime");var e=this.fromName(t.found.name),n=this.fromVersion(t.found.updateTime),r=this.fromFields(t.found.fields||{});return new Nl(e,n,r,{},t.found)},t.prototype.fromMissing=function(t){Nh(!!t.missing,"Tried to deserialize a missing document from a found document."),Nh(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new Dl(e,n)},t.prototype.fromMaybeDocument=function(t){var e=t.result;return Sp(t,e,"found")?this.fromFound(t):Sp(t,e,"missing")?this.fromMissing(t):Ih("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case rp.Added:return"ADD";case rp.Current:return"CURRENT";case rp.NoChange:return"NO_CHANGE";case rp.Removed:return"REMOVE";case rp.Reset:return"RESET";default:return Ih("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof hp)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof cp){if(t.newDoc instanceof Nl){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof Dl){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof lp){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return Lf.OK;switch(t){case kh.OK:return Lf.OK;case kh.CANCELLED:return Lf.CANCELLED;case kh.UNKNOWN:return Lf.UNKNOWN;case kh.DEADLINE_EXCEEDED:return Lf.DEADLINE_EXCEEDED;case kh.RESOURCE_EXHAUSTED:return Lf.RESOURCE_EXHAUSTED;case kh.INTERNAL:return Lf.INTERNAL;case kh.UNAVAILABLE:return Lf.UNAVAILABLE;case kh.UNAUTHENTICATED:return Lf.UNAUTHENTICATED;case kh.INVALID_ARGUMENT:return Lf.INVALID_ARGUMENT;case kh.NOT_FOUND:return Lf.NOT_FOUND;case kh.ALREADY_EXISTS:return Lf.ALREADY_EXISTS;case kh.PERMISSION_DENIED:return Lf.PERMISSION_DENIED;case kh.FAILED_PRECONDITION:return Lf.FAILED_PRECONDITION;case kh.ABORTED:return Lf.ABORTED;case kh.OUT_OF_RANGE:return Lf.OUT_OF_RANGE;case kh.UNIMPLEMENTED:return Lf.UNIMPLEMENTED;case kh.DATA_LOSS:return Lf.DATA_LOSS;default:return Ih("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Ih("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=t.response_type;if(Sp(t,n,"targetChange")){_p(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new lp(r,i,o,s||null)}else if(Sp(t,n,"documentChange")){_p(t.documentChange,"documentChange"),_p(t.documentChange.document,"documentChange.name"),_p(t.documentChange.document.name,"documentChange.document.name"),_p(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=this.fromFields(u.document.fields||{}),f=new Nl(c,h,l,{},u.document),p=u.targetIds||[],d=u.removedTargetIds||[];e=new cp(p,d,f.key,f)}else if(Sp(t,n,"documentDelete")){_p(t.documentDelete,"documentDelete"),_p(t.documentDelete.document,"documentDelete.document");var y=t.documentDelete;c=this.fromName(y.document),h=y.readTime?this.fromVersion(y.readTime):mf.forDeletedDoc(),f=new Dl(c,h),d=y.removedTargetIds||[];e=new cp([],d,f.key,f)}else if(Sp(t,n,"documentRemove")){_p(t.documentRemove,"documentRemove"),_p(t.documentRemove.document,"documentRemove");var m=t.documentRemove;c=this.fromName(m.document),d=m.removedTargetIds||[];e=new cp([],d,c,null)}else{if(!Sp(t,n,"filter"))return Ih("Unknown change type "+JSON.stringify(t));_p(t.filter,"filter"),_p(t.filter.targetId,"filter.targetId");var g=t.filter,v=g.count||0,b=new Uf(v),w=g.targetId;e=new hp(w,b)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?rp.NoChange:"ADD"===t?rp.Added:"REMOVE"===t?rp.Removed:"CURRENT"===t?rp.Current:"RESET"===t?rp.Reset:Ih("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!Sp(t,t.response_type,"targetChange"))return mf.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?mf.MIN:e.readTime?this.fromVersion(e.readTime):mf.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof Nf)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof kf)e={delete:this.toName(t.key)};else if(t instanceof Df)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Af))return Ih("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Cf.NONE;if(t.update){_p(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Df(r,i,o,n)}return new Nf(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new kf(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return Nh(!0===n.exists,'Transforms only support precondition "exists == true"'),new Af(r,a)}return Ih("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return Nh(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ih("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Cf.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Cf.exists(t.exists):Cf.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new Sf(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?(Nh(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof Rf)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Of)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Pf)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof Mf)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Ih("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=t.transform_type,r=null;if(Sp(t,n,"setToServerValue"))Nh("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),r=Rf.instance;else if(Sp(t,n,"appendMissingElements")){var i=t.appendMissingElements.values||[];r=new Of(i.map(function(t){return e.fromValue(t)}))}else if(Sp(t,n,"removeAllFromArray")){i=t.removeAllFromArray.values||[];r=new Pf(i.map(function(t){return e.fromValue(t)}))}else if(Sp(t,n,"increment")){var o=this.fromValue(t.increment);Nh(o instanceof Ul,"NUMERIC_ADD transform requires a NumberValue"),r=new Mf(o)}else Ih("Unknown transform proto: "+JSON.stringify(t));var a=Sl.fromServerFormat(t.fieldPath);return new Tf(a,r)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;Nh(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return of.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Nh(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Nh(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Nh(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new of(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case nf.Listen:return null;case nf.ExistenceFilterMismatch:return"existence-filter-mismatch";case nf.LimboResolution:return"limbo-document";default:return Ih("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof uf?e.toRelationFilter(t):e.toUnaryFilter(t)});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromRelationFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Ih("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new ff(r,n)},t.prototype.toDirection=function(t){return vp[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return lf.ASCENDING;case"DESCENDING":return lf.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return bp[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return sf.EQUAL;case"GREATER_THAN":return sf.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return sf.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return sf.LESS_THAN;case"LESS_THAN_OR_EQUAL":return sf.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return sf.ARRAY_CONTAINS;case"OPERATOR_UNSPECIFIED":return Ih("Unspecified relation");default:return Ih("Unknown relation")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return Sl.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new pf(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.toRelationFilter=function(t){return t instanceof uf?{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}:Ih("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromRelationFilter=function(t){return new uf(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryFilter=function(t){return t instanceof hf?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}}:t instanceof cf?{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}:Ih("Unrecognized filter: "+JSON.stringify(t))},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return new hf(e);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return new cf(n);case"OPERATOR_UNSPECIFIED":return Ih("Unspecified filter");default:return Ih("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return Sl.fromServerFormat(t)});return Ef.fromArray(e)},t}();function Sp(t,e,n){return e===n||!e&&n in t}var Cp=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){Nh(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){Nh(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){Nh(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){Nh(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){Nh(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){Nh(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),Ip="Connection",Np={BatchGetDocuments:"batchGet",Commit:"commit"},Dp="gl-js/ fire/"+bh,Ap=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=Dp},t.prototype.invokeRPC=function(o,a,s){var u=this,c=this.makeUrl(o);return new Promise(function(n,r){var i=new vh;i.listenOnce(mh.COMPLETE,function(){try{switch(i.getLastErrorCode()){case yh.NO_ERROR:var t=i.getResponseJson();Th(Ip,"XHR received:",JSON.stringify(t)),n(t);break;case yh.TIMEOUT:Th(Ip,'RPC "'+o+'" timed out'),r(new Rh(kh.DEADLINE_EXCEEDED,"Request time out"));break;case yh.HTTP_ERROR:var e=i.getStatus();Th(Ip,'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?r(new Rh(function(t){switch(t){case 200:return kh.OK;case 400:return kh.INVALID_ARGUMENT;case 401:return kh.UNAUTHENTICATED;case 403:return kh.PERMISSION_DENIED;case 404:return kh.NOT_FOUND;case 409:return kh.ABORTED;case 416:return kh.OUT_OF_RANGE;case 429:return kh.RESOURCE_EXHAUSTED;case 499:return kh.CANCELLED;case 500:return kh.UNKNOWN;case 501:return kh.UNIMPLEMENTED;case 503:return kh.UNAVAILABLE;case 504:return kh.DEADLINE_EXCEEDED;default:return 200<=t&&t<300?kh.OK:400<=t&&t<500?kh.FAILED_PRECONDITION:500<=t&&t<600?kh.INTERNAL:kh.UNKNOWN}}(e),"Server responded with status "+i.getStatusText())):(Th(Ip,'RPC "'+o+'" failed'),r(new Rh(kh.UNAVAILABLE,"Connection failed.")));break;default:Ih('RPC "'+o+'" failed with unanticipated webchannel error '+i.getLastErrorCode()+": "+i.getLastError()+", giving up.")}}finally{Th(Ip,'RPC "'+o+'" completed.')}});var t=JSON.stringify(a);Th(Ip,"XHR sending: ",c+" "+t);var e={"Content-Type":"text/plain"};u.modifyHeadersForRequest(e,s),i.send(c,"POST",t,e,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=dh(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5}};this.modifyHeadersForRequest(i.initMessageHeaders,e),_r()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");Th(Ip,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),s=!1,u=!1,c=new Cp({sendFn:function(t){u?Th(Ip,"Not sending because WebChannel is closed:",t):(s||(Th(Ip,"Opening WebChannel transport."),a.open(),s=!0),Th(Ip,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),h=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(gh.EventType.OPEN,function(){u||Th(Ip,"WebChannel transport opened.")}),h(gh.EventType.CLOSE,function(){u||(u=!0,Th(Ip,"WebChannel transport closed"),c.callOnClose())}),h(gh.EventType.ERROR,function(t){u||(u=!0,Th(Ip,"WebChannel transport errored:",t),c.callOnClose(new Rh(kh.UNAVAILABLE,"The operation could not be completed")))}),h(gh.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];Nh(!!e,"Got a webchannel message without data.");var n=e.error||e[0]&&e[0].error;if(n){Th(Ip,"WebChannel received error:",n);var r=n.status,i=function(t){var e=Lf[t];if(void 0!==e)return Vf(e)}(r),o=n.message;void 0===i&&(i=kh.INTERNAL,o="Unknown error status: "+r+" with message "+n.message),u=!0,c.callOnClose(new Rh(i,o)),a.close()}else Th(Ip,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=Np[t];Nh(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),kp=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new Ap(t))},t.prototype.newSerializer=function(t){return new Tp(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();Dh.setPlatform(new kp);var Rp,Op,Pp=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),Mp=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(Op=Rp||(Rp={})).All="all",Op.ListenStreamIdle="listen_stream_idle",Op.ListenStreamConnectionBackoff="listen_stream_connection_backoff",Op.WriteStreamIdle="write_stream_idle",Op.WriteStreamConnectionBackoff="write_stream_connection_backoff",Op.OnlineStateTimeout="online_state_timeout",Op.ClientMetadataRefresh="client_metadata_refresh",Op.LruGarbageCollection="lru_garbage_collection";var xp=function(){function a(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Mp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return a.createAndSchedule=function(t,e,n,r,i){var o=new a(t,e,Date.now()+n,r,i);return o.start(n),o},a.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},a.prototype.skipDelay=function(){return this.handleDelayElapsed()},a.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Rh(kh.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},a.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},a.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},a}(),Lp=function(){function t(){this.tail=Promise.resolve(),this.delayedOperations=[],this.operationInProgress=!1}return t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueue=function(t){var n=this;this.verifyNotFailed();var e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Sh("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),Nh(0<=e,"Attempted to schedule an operation with a negative delay of "+e),Nh(!this.containsDelayedOperation(t),"Attempted to schedule multiple operations with timer id "+t+".");var i=xp.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Ih("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){Nh(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueue(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){Nh(r===Rp.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==Rp.All&&n.timerId===r)break}return i.drain()})},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);Nh(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Fp="",Up="",qp="",Vp="";function Bp(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Wp(e)),e=jp(t.get(n),e);return Wp(e)}function jp(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Fp+qp;break;case Fp:n+=Fp+Vp;break;default:n+=o}}return n}function Wp(t){return t+Fp+Up}function Qp(t){var e=t.length;if(Nh(2<=e,"Invalid path "+t),2===e)return Nh(t.charAt(0)===Fp&&t.charAt(1)===Up,"Non-empty path "+t+" had length 2"),El.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Fp,o);switch((a<0||n<a)&&Ih('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Up:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case qp:i+=t.substring(o,a),i+="\0";break;case Vp:i+=t.substring(o,a+1);break;default:Ih('Invalid encoded resource path: "'+t+'"')}o=a+2}return new El(r)}var Kp=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,Nh(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&Nh(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;Nh(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&Nh(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Yf())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ol(this.mutations,t.mutations)&&ol(this.baseMutations,t.baseMutations)},t}(),Hp=function(){function s(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return s.from=function(t,e,n,r){Nh(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=Gf(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new s(t,e,n,r,i)},s}(),Gp=function(){function a(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return a.prototype.catch=function(t){return this.next(void 0,t)},a.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Ih("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new a(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},a.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},a.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof a?e:a.resolve(e)}catch(t){return a.reject(t)}},a.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):a.resolve(e)},a.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):a.reject(e)},a.resolve=function(n){return new a(function(t,e){t(n)})},a.reject=function(n){return new a(function(t,e){e(n)})},a.waitFor=function(t){return new a(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},a.or=function(t){for(var n=a.resolve(!1),e=function(e){n=n.next(function(t){return t?a.resolve(t):e()})},r=0,i=t;r<i.length;r++){e(i[r])}return n},a.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},a}(),zp=function(){function i(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return i.forUser=function(t,e,n,r){return Nh(""!==t.uid,"UserID must not be an empty string."),new i(t.isAuthenticated()?t.uid:"",e,n,r)},i.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $p(t).iterate({index:Od.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},i.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Jp(n),td(e).put(t)})},i.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},i.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=Jp(n),td(e).put(t)})},i.prototype.addMutationBatch=function(u,c,h,l){var f=this,p=Zp(u),d=$p(u);return d.add({}).next(function(t){Nh("number"==typeof t,"Auto-generated key is not a number");var e=new Kp(t,c,h,l),n=f.serializer.toDbMutationBatch(f.userId,e);f.documentKeysByBatchId[t]=e.keys();for(var r=[],i=0,o=l;i<o.length;i++){var a=o[i],s=Pd.key(f.userId,a.key.path,t);r.push(d.put(n)),r.push(p.put(s,Pd.PLACEHOLDER)),r.push(f.indexManager.addToCollectionParentIndex(u,a.key.path.popLast()))}return Gp.waitFor(r).next(function(){return e})})},i.prototype.lookupMutationBatch=function(t,e){var n=this;return $p(t).get(e).next(function(t){return t?(Nh(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},i.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?Gp.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},i.prototype.getNextMutationBatchAfterBatchId=function(n,o){var a=this;return this.getMutationQueueMetadata(n).next(function(t){var r=o+1,e=IDBKeyRange.lowerBound([a.userId,r]),i=null;return $p(n).iterate({index:Od.userMutationsIndex,range:e},function(t,e,n){e.userId===a.userId&&(Nh(e.batchId>=r,"Should have found mutation after "+r),i=a.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return i})})},i.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return $p(t).loadAll(Od.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},i.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=Pd.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return Zp(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=Qp(i);if(r===c.userId&&u.path.isEqual(a))return $p(s).get(o).next(function(t){if(!t)throw Ih("Dangling document-mutation reference found: "+e+" which points to "+o);Nh(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},i.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new wf(il),i=[];return t.forEach(function(s){var t=Pd.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=Zp(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Qp(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),Gp.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},i.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;Nh(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),Nh(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=Pd.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new wf(il);return Zp(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=Qp(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},i.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push($p(t).get(e).next(function(t){if(null===t)throw Ih("Dangling document-mutation reference found, which points to "+e);Nh(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Gp.waitFor(i).next(function(){return r})},i.prototype.removeMutationBatch=function(e,n){var r=this;return Xp(e.simpleDbTransaction,this.userId,n).next(function(t){return r.removeCachedMutationKeys(n.batchId),Gp.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},i.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},i.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return Gp.resolve();var e=IDBKeyRange.lowerBound(Pd.prefixForUser(o.userId)),i=[];return Zp(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=Qp(t[1]);i.push(r)}else n.done()}).next(function(){Nh(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},i.prototype.containsKey=function(t,e){return Yp(t,this.userId,e)},i.prototype.getMutationQueueMetadata=function(t){var e=this;return td(t).get(this.userId).next(function(t){return t||new Rd(e.userId,-1,"")})},i}();function Yp(t,o,e){var n=Pd.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return Zp(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function Xp(t,e,n){var r=t.store(Od.store),i=t.store(Pd.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){Nh(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Pd.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Gp.waitFor(o).next(function(){return c})}function Jp(t){return t instanceof Uint8Array?(Nh("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function $p(t){return oy.getStore(t,Od.store)}function Zp(t){return oy.getStore(t,Pd.store)}function td(t){return oy.getStore(t,Rd.store)}var ed,nd;(nd=ed||(ed={}))[nd.QueryCache=0]="QueryCache",nd[nd.SyncEngine=1]="SyncEngine";var rd=function(){function t(t,e){Nh((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},t.prototype.after=function(t){return this.seek(t+2),this.next()},t.prototype.seek=function(t){Nh((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(ed.QueryCache,2)},t.forSyncEngine=function(){return new t(ed.SyncEngine)},t}(),id="SimpleDb",od=function(){function s(t){this.db=t}return s.openOrCreate=function(o,t,a){return Nh(s.isAvailable(),"IndexedDB not supported in current environment."),Th(id,"Opening database:",o),new Gp(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new s(e))},i.onblocked=function(){r(new Rh(kh.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Rh(kh.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Th(id,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result,n=new sd(i.transaction);a.createOrUpgrade(e,n,t.oldVersion,Nd).next(function(){Th(id,"Database upgrade to version "+Nd+" complete")})}}).toPromise()},s.delete=function(t){return Th(id,"Removing database:",t),cd(window.indexedDB.deleteDatabase(t)).toPromise()},s.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var t=window.navigator.userAgent;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/"))},s.getStore=function(t,e){return t.store(e)},s.prototype.runTransaction=function(t,e,n){var r=sd.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),Gp.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},s.prototype.close=function(){this.db.close()},s}(),ad=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return cd(this.dbCursor.delete())},t}(),sd=function(){function r(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Mp,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){e.completionDeferred.reject(t.target.error)}}return r.open=function(t,e,n){return new r(t.transaction(n,e))},Object.defineProperty(r.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),r.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(Th(id,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},r.prototype.store=function(t){var e=this.transaction.objectStore(t);return Nh(!!e,"Object store not part of transaction: "+t),new ud(e)},r}(),ud=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){return cd(void 0!==e?(Th(id,"PUT",this.store.name,t,e),this.store.put(e,t)):(Th(id,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},t.prototype.add=function(t){return Th(id,"ADD",this.store.name,t,t),cd(this.store.add(t))},t.prototype.get=function(e){var n=this;return cd(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Th(id,"GET",n.store.name,e,t),t})},t.prototype.delete=function(t){return Th(id,"DELETE",this.store.name,t),cd(this.store.delete(t))},t.prototype.count=function(){return Th(id,"COUNT",this.store.name),cd(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){Th(id,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(r){var t=this.cursor({});return new Gp(function(n,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,a){var s=[];return new Gp(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new ad(e),r=a(e.primaryKey,e.value,n);if(r instanceof Gp){var i=r.catch(function(t){return n.done(),Gp.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return Gp.waitFor(s)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Nh(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function cd(t){return new Gp(function(n,e){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){e(t.target.error)}})}var hd=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=rd.forQueryCache()}return t.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return mf.fromTimestamp(new ml(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return pd(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},t.prototype.addQueryData=function(e,n){var r=this;return this.saveQueryData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromQueryData(n,t),r.saveMetadata(e,t)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return ld(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return Nh(0<t.targetCount,"Removing from an empty query cache"),t.targetCount-=1,n.saveMetadata(e,t)})},t.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return ld(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&void 0===o[n.targetId]&&(s++,u.push(a.removeQueryData(r,n)))}).next(function(){return Gp.waitFor(u)}).next(function(){return s})},t.prototype.forEachTarget=function(t,r){var i=this;return ld(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},t.prototype.retrieveMetadata=function(t){return fd(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,oy.getStore(n,Vd.store)).put(Vd.key,e);var n},t.prototype.saveQueryData=function(t,e){return ld(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return ld(t).iterate({range:n,index:Ud.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.query)&&(a=r,n.done())}).next(function(){return a})},t.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=dd(n);return t.forEach(function(t){var e=Bp(t.path);o.push(a.put(new qd(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),Gp.waitFor(o)},t.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=dd(n);return Gp.forEach(t,function(t){var e=Bp(t.path);return Gp.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=dd(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=dd(t),o=Yf();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Qp(t[1]),i=new Cl(r);o=o.add(i)}).next(function(){return o})},t.prototype.containsKey=function(t,e){var n=Bp(e.path),r=IDBKeyRange.bound([n],[al(n)],!1,!0),i=0;return dd(t).iterate({index:qd.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())}).next(function(){return 0<i})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return ld(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function ld(t){return oy.getStore(t,Ud.store)}function fd(t){return od.getStore(t,Vd.store).get(Vd.key).next(function(t){return Nh(null!==t,"Missing metadata row."),t})}function pd(t){return fd(t).next(function(t){return t.highestListenSequenceNumber})}function dd(t){return oy.getStore(t,qd.store)}var yd=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(s){Lh(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},t.prototype.isEmpty=function(){return Uh(this.inner)},t}(),md=function(){function t(){this.changes=jf(),this.documentSizes=new yd(function(t){return t.toString()})}return t.prototype.addEntry=function(t){var e=this.assertChanges();this.changes=e.insert(t.key,t)},t.prototype.getEntry=function(t,e){var n=this,r=this.assertChanges().get(e);return r?Gp.resolve(r):this.getFromCache(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},t.prototype.getEntries=function(t,e){var n=this;return this.getAllFromCache(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},t.prototype.apply=function(t){var e=this.applyChanges(t);return this.changes=null,e},t.prototype.assertChanges=function(){return Nh(null!==this.changes,"Changes have already been applied."),this.changes},t}(),gd="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",vd=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=od.getStore(t,Wd.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntries=function(t,e,n){var r=[];if(0<e.length){for(var i=_d(t),o=Yf(),a=0,s=e;a<s.length;a++){var u=s[a],c=u.key,h=u.doc;r.push(i.put(Td(c),h)),o=o.add(c),r.push(this.indexManager.addToCollectionParentIndex(t,c.path.popLast()))}this.keepDocumentChangeLog&&r.push(Ed(t).put({changes:this.serializer.toDbResourcePaths(o)})),r.push(this.updateSize(t,n))}return Gp.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=_d(t),r=Td(e);return n.get(r).next(function(t){return t?n.delete(r).next(function(){return Sd(t)}):Gp.resolve(0)})},t.prototype.getEntry=function(t,e){var n=this;return _d(t).get(Td(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return _d(t).get(Td(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:Sd(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Wf();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=Wf(),i=new kl(Cl.comparator);return this.forEachDbEntry(t,e,function(t,e){i=e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i.insert(t,Sd(e))):(r=r.insert(t,null),i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return Gp.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return _d(t).iterate({range:n},function(t,e,n){for(var r=Cl.fromSegments(t);a&&Cl.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,i){var o=this;Nh(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=Kf(),s=i.path.length+1,e=i.path.toArray(),n=IDBKeyRange.lowerBound(e);return _d(t).iterate({range:n},function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof Nl&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},t.prototype.getNewDocumentChanges=function(e){var r=this;Nh(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Yf(),i=jf(),t=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=Ed(e);return a.iterate({range:t},function(t,e){if(o&&(o=!1,r._lastProcessedDocumentChangeId+1!==e.id))return r.synchronizeLastDocumentChangeId(a).next(function(){return Gp.reject(new Rh(kh.DATA_LOSS,gd))});n=n.unionWith(r.serializer.fromDbResourcePaths(e.changes)),r._lastProcessedDocumentChangeId=e.id}).next(function(){var t=[];return n.forEach(function(n){t.push(r.getEntry(e,n).next(function(t){var e=t||new Dl(n,mf.forDeletedDoc());i=i.insert(n,e)}))}),Gp.waitFor(t)}).next(function(){return i})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return Ed(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var r=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,e,n){r._lastProcessedDocumentChangeId=t,n.done()})},t.prototype.newChangeBuffer=function(){return new wd(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return bd(t).get(Fd.key).next(function(t){return Nh(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return bd(t).put(Fd.key,e)},t.prototype.updateSize=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},t}();function bd(t){return oy.getStore(t,Fd.store)}var wd=function(n){function t(t){var e=n.call(this)||this;return e.documentCache=t,e}return ni(t,n),t.prototype.applyChanges=function(t){var o=this,e=this.assertChanges(),a=0,s=[];return e.forEach(function(t,e){var n=o.documentCache.serializer.toDbRemoteDocument(e),r=o.documentSizes.get(t);Nh(void 0!==r,"Attempting to change document "+t.toString()+" without having read it first");var i=Sd(n);a+=i-r,s.push({key:t,doc:n})}),this.documentCache.addEntries(t,s,a)},t.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},t.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},t}(md);function _d(t){return oy.getStore(t,Ld.store)}function Ed(t){return oy.getStore(t,Wd.store)}function Td(t){return t.path.toArray()}function Sd(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ih("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var Cd=function(){function t(){this.collectionParentIndex=new Id}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Gp.resolve()},t.prototype.getCollectionParents=function(t,e){return Gp.resolve(this.collectionParentIndex.getEntries(e))},t}(),Id=function(){function t(){this.index={}}return t.prototype.add=function(t){Nh(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new wf(El.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new wf(El.comparator)).toArray()},t}(),Nd=8,Dd=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,n,e,r){var i,o=this;Nh(e<r&&0<=e&&r<=Nd,"Unexpected schema upgrade from v"+e+" to v{toVersion}."),e<1&&1<=r&&(t.createObjectStore(kd.store),(i=t).createObjectStore(Rd.store,{keyPath:Rd.keyPath}),i.createObjectStore(Od.store,{keyPath:Od.keyPath,autoIncrement:!0}).createIndex(Od.userMutationsIndex,Od.userMutationsKeyPath,{unique:!0}),i.createObjectStore(Pd.store),jd(t),t.createObjectStore(Ld.store));var a,s=Gp.resolve();return e<3&&3<=r&&(0!==e&&((a=t).deleteObjectStore(qd.store),a.deleteObjectStore(Ud.store),a.deleteObjectStore(Vd.store),jd(t)),s=s.next(function(){return t=n.store(Vd.store),e=new Vd(0,0,mf.MIN.toTimestamp(),0),t.put(Vd.key,e);var t,e})),e<4&&4<=r&&(0!==e&&(s=s.next(function(){return i=t,(o=n).store(Od.store).loadAll().next(function(t){i.deleteObjectStore(Od.store);var e=i.createObjectStore(Od.store,{keyPath:Od.keyPath,autoIncrement:!0});e.createIndex(Od.userMutationsIndex,Od.userMutationsKeyPath,{unique:!0});var n=o.store(Od.store),r=t.map(function(t){return n.put(t)});return Gp.waitFor(r)});var i,o})),s=s.next(function(){t.createObjectStore(Qd.store,{keyPath:Qd.keyPath}),t.createObjectStore(Wd.store,{keyPath:"id",autoIncrement:!0})})),e<5&&5<=r&&(s=s.next(function(){return o.removeAcknowledgedMutations(n)})),e<6&&6<=r&&(s=s.next(function(){return t.createObjectStore(Fd.store),o.addDocumentGlobal(n)})),e<7&&7<=r&&(s=s.next(function(){return o.ensureSequenceNumbers(n)})),e<8&&8<=r&&(s=s.next(function(){return o.createCollectionParentIndex(t,n)})),s},t.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Ld.store).iterate(function(t,e){n+=Sd(e)}).next(function(){var t=new Fd(n);return e.store(Fd.store).put(Fd.key,t)})},t.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Rd.store),e=r.store(Od.store);return t.loadAll().next(function(t){return Gp.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(Od.userMutationsIndex,t).next(function(t){return Gp.forEach(t,function(t){Nh(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return Xp(r,n.userId,e).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var a=t.store(qd.store),e=t.store(Ld.store);return pd(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new El(t),r=[0,Bp(n)];o.push(a.get(r).next(function(t){return t?Gp.resolve():(e=n,a.put(new qd(0,Bp(e),i)));var e}))}).next(function(){return Gp.waitFor(o)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Bd.store,{keyPath:Bd.keyPath});var r=e.store(Bd.store),i=new Id,o=function(t){if(i.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:Bp(n)})}};return e.store(Ld.store).iterate({keysOnly:!0},function(t,e){var n=new El(t);return o(n.popLast())}).next(function(){return e.store(Pd.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Qp(n));return o(r.popLast())})})},t}();var Ad=function(t,e){this.seconds=t,this.nanoseconds=e},kd=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var Rd=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),Od=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var Pd=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Bp(e)]},t.key=function(t,e,n){return[t,Bp(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var Md=function(t,e){this.path=t,this.readTime=e},xd=function(t,e){this.path=t,this.version=e},Ld=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),Fd=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var Ud=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),qd=function(){function t(t,e,n){this.targetId=t,this.path=e,Nh(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),Vd=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),Bd=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function jd(t){t.createObjectStore(qd.store,{keyPath:qd.keyPath}).createIndex(qd.documentTargetsIndex,qd.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ud.store,{keyPath:Ud.keyPath}).createIndex(Ud.queryTargetsIndexName,Ud.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Vd.store)}var Wd=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var Qd=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var Kd=[Rd.store,Od.store,Pd.store,Ld.store,Ud.store,kd.store,Vd.store,qd.store].concat([Qd.store,Wd.store]).concat([Fd.store]).concat([Bd.store]),Hd=function(){function t(){this.collectionParentsCache=new Id}return t.prototype.addToCollectionParentIndex=function(t,e){if(Nh(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){Nh(1<=e.length,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return Gd(t).put({collectionId:n,parent:Bp(r)})}return Gp.resolve()},t.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[al(i),""],!1,!0);return Gd(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Qp(r.parent))}return o})},t}();function Gd(t){return oy.getStore(t,Bd.store)}var zd=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Cl.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new Dl(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=Cl.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new Al(e,n)}return Ih("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof Nl){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Ld(null,null,e,n)}if(t instanceof Dl){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new Ld(null,new Md(r,i),null,n)}if(t instanceof Al){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new Ld(new xd(r,i),null,null,!0)}return Ih("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new Ad(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new ml(t.seconds,t.nanoseconds);return mf.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new Od(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=ml.fromMillis(t.localWriteTimeMs);return new Kp(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(Bp(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=Yf(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Cl(Qp(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new bf(e,t.targetId,nf.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){Nh(nf.Listen===t.purpose,"Only queries with purpose "+nf.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),n=t.resumeToken instanceof Uint8Array?(Nh("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new Ud(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function Yd(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=il(n,i);return 0===a?il(r,o):a}var Xd=function(){function t(t){this.maxElements=t,this.buffer=new wf(Yd),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Yd(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Jd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},$d=function(){function e(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e.COLLECTION_DISABLED=-1,e.MINIMUM_CACHE_SIZE_BYTES=1048576,e.DEFAULT=new e(e.DEFAULT_CACHE_SIZE_BYTES=41943040,e.DEFAULT_COLLECTION_PERCENTILE=10,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),e.DISABLED=new e(e.COLLECTION_DISABLED,0,0),e}(),Zd=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.gcTask=null}return t.prototype.start=function(){Nh(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==$d.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;Nh(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;Th("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(Rp.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(ay)})},t}(),ty=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Gp.resolve(Pp.INVALID);var r=new Xd(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===$d.COLLECTION_DISABLED?(Th("LruGarbageCollector","Garbage collection skipped; disabled"),Gp.resolve(Jd)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Th("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Jd):r.runGarbageCollection(e,n)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h,l=this;return a=Date.now(),this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>l.params.maximumSequenceNumbersToCollect?(Th("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.maximumSequenceNumbersToCollect+" from "+t),l.params.maximumSequenceNumbersToCollect):t,s=Date.now(),l.nthSequenceNumber(e,i)}).next(function(t){return r=t,u=Date.now(),l.removeTargets(e,r,n)}).next(function(t){return o=t,c=Date.now(),l.removeOrphanedDocuments(e,r)}).next(function(t){(h=Date.now(),_h()<=lh.DEBUG)&&Th("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-a)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(c-u)+"ms\n\tRemoved "+t+" documents in "+(h-c)+"ms\nTotal Duration: "+(h-a)+"ms");return Gp.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},t}(),ey="IndexedDbPersistence",ny="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ry="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `experimentalTabSynchronization:true` in all tabs.",iy=function(r){function t(t,e){var n=r.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}return ni(t,r),t}(function(){}),oy=function(){function c(t,e,n,r,i,o,a){if(this.persistenceKey=t,this.clientId=e,this.queue=r,this.multiClientParams=a,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.inForeground=!1,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},!c.isAvailable())throw new Rh(kh.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.referenceDelegate=new cy(this,o),this.dbName=t+c.MAIN_DATABASE,this.serializer=new zd(i),this.document=n.document,this.allowTabSynchronization=void 0!==a,this.queryCache=new hd(this.referenceDelegate,this.serializer),this.indexManager=new Hd,this.remoteDocumentCache=new vd(this.serializer,this.indexManager,this.allowTabSynchronization),!n.window||!n.window.localStorage)throw new Rh(kh.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=n.window,this.webStorage=this.window.localStorage}return c.getStore=function(t,e){if(t instanceof iy)return od.getStore(t.simpleDbTransaction,e);throw Ih("IndexedDbPersistence must use instances of IndexedDbTransaction")},c.createIndexedDbPersistence=function(n,r,i,o,a,s){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new c(n,r,i,o,a,s)).start()];case 1:return t.sent(),[2,e]}})})},c.createMultiClientIndexedDbPersistence=function(n,r,i,o,a,s,u){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,(e=new c(n,r,i,o,a,s,u)).start()];case 1:return t.sent(),[2,e]}})})},c.prototype.start=function(){var n=this;return Nh(!this.started,"IndexedDbPersistence double-started!"),Nh(null!==this.window,"Expected 'window' to be defined"),od.openOrCreate(this.dbName,Nd,new Dd(this.serializer)).then(function(t){return n.simpleDb=t,n.updateClientMetadataAndTryBecomePrimary()}).then(function(){return n.attachVisibilityHandler(),n.attachWindowUnloadHook(),n.scheduleClientMetadataAndPrimaryLeaseRefreshes(),n.startRemoteDocumentCache()}).then(function(){return n.simpleDb.runTransaction("readonly",[Vd.store],function(t){return pd(t).next(function(t){var e=n.multiClientParams?n.multiClientParams.sequenceNumberSyncer:void 0;n.listenSequence=new Pp(t,e)})})}).then(function(){n._started=!0}).catch(function(t){return n.simpleDb&&n.simpleDb.close(),Promise.reject(t)})},c.prototype.startRemoteDocumentCache=function(){var e=this;return this.simpleDb.runTransaction("readonly",Kd,function(t){return e.remoteDocumentCache.start(t)})},c.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return ai(t,void 0,void 0,function(){return si(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},c.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},c.prototype.updateClientMetadataAndTryBecomePrimary=function(){var r=this;return this.simpleDb.runTransaction("readwrite",Kd,function(n){return uy(n).put(new Qd(r.clientId,Date.now(),r.networkEnabled,r.inForeground,r.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(r.isPrimary)return r.verifyPrimaryLease(n).next(function(t){t||(r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}))})}).next(function(){return r.canActAsPrimary(n)}).next(function(t){var e=r.isPrimary;return r.isPrimary=t,e!==r.isPrimary&&r.queue.enqueueAndForget(function(){return r.primaryStateListener(r.isPrimary)}),e&&!r.isPrimary?r.releasePrimaryLeaseIfHeld(n):r.isPrimary?r.acquireOrExtendPrimaryLease(n):void 0})})},c.prototype.verifyPrimaryLease=function(t){var e=this;return sy(t).get(kd.key).next(function(t){return Gp.resolve(e.isLocalClient(t))})},c.prototype.removeClientMetadata=function(t){return uy(t).delete(this.clientId)},c.prototype.maybeGarbageCollectMultiClientState=function(){return ai(this,void 0,void 0,function(){var r,i,o=this;return si(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),i=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(n){var e=c.getStore(n,Qd.store);return e.loadAll().next(function(t){r=o.filterActiveClients(t,18e5),i=t.filter(function(t){return-1===r.indexOf(t)})}).next(function(){return Gp.forEach(i,function(t){return e.delete(t.clientId)})}).next(function(){if(0<(r=r.filter(function(t){return t.clientId!==o.clientId})).length){var t=r.map(function(t){return t.lastProcessedDocumentChangeId||0}),e=Math.min.apply(Math,t);return o.remoteDocumentCache.removeDocumentChangesThroughChangeId(n,e)}})})]);case 1:t.sent(),i.forEach(function(t){o.window.localStorage.removeItem(o.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},c.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(Rp.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},c.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},c.prototype.canActAsPrimary=function(e){var i=this;return sy(e).get(kd.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new Rh(kh.FAILED_PRECONDITION,ry);return!1}}return!(!i.networkEnabled||!i.inForeground)||uy(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Th(ey,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},c.prototype.shutdown=function(n){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&this.clientMetadataRefresher.cancel(),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[kd.store,Qd.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),n?[4,od.delete(this.dbName)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},c.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},c.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly",[Qd.store],function(t){return uy(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(c.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),c.prototype.getMutationQueue=function(t){return Nh(this.started,"Cannot initialize MutationQueue before persistence is started."),zp.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},c.prototype.getQueryCache=function(){return Nh(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},c.prototype.getRemoteDocumentCache=function(){return Nh(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},c.prototype.getIndexManager=function(){return Nh(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},c.prototype.runTransaction=function(n,t,r){var i=this;return Th(ey,"Starting transaction:",n),this.simpleDb.runTransaction("readonly"===t?"readonly":"readwrite",Kd,function(e){return"readwrite-primary"===t?i.verifyPrimaryLease(e).next(function(t){if(!t)throw Sh("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new Rh(kh.FAILED_PRECONDITION,ny);return r(new iy(e,i.listenSequence.next()))}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(new iy(e,i.listenSequence.next()))})})},c.prototype.verifyAllowTabSynchronization=function(t){var e=this;return sy(t).get(kd.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Rh(kh.FAILED_PRECONDITION,ry)})},c.prototype.acquireOrExtendPrimaryLease=function(t){var e=new kd(this.clientId,this.allowTabSynchronization,Date.now());return sy(t).put(kd.key,e)},c.isAvailable=function(){return od.isAvailable()},c.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},c.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=sy(t);return n.get(kd.key).next(function(t){return e.isLocalClient(t)?(Th(ey,"Releasing primary lease."),n.delete(kd.key)):Gp.resolve()})},c.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(n<t)||(Sh("Detected an update time that is in the future: "+t+" > "+n),!1))},c.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},c.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(Nh(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},c.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},c.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(Nh("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},c.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return Th(ey,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Sh(ey,"Failed to get zombied client id.",t),!1}},c.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Sh("Failed to set zombie client id.",t)}},c.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},c.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},c.MAIN_DATABASE="main",c}();function ay(n){return ai(this,void 0,void 0,function(){return si(this,function(t){if((e=n).code!==kh.FAILED_PRECONDITION||e.message!==ny)throw n;var e;return Th(ey,"Unexpectedly lost primary lease"),[2]})})}function sy(t){return t.store(kd.store)}function uy(t){return t.store(Qd.store)}var cy=function(){function t(t,e){this.db=t,this.garbageCollector=new ty(this,e)}return t.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(e){return n.next(function(t){return e+t})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return hy(t,e)},t.prototype.removeReference=function(t,e){return hy(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return hy(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Gp.resolve(!0):(r=e,i=!1,td(n=t).iterateSerial(function(t){return Yp(n,t,r).next(function(t){return t&&(i=!0),Gp.resolve(!t)})}).next(function(){return i}));var n,r,i},t.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=0,s=0,u=[];return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return a++,o.removeOrphanedDocument(r,e).next(function(t){s+=t})});u.push(n)}}).next(function(){return Gp.waitFor(u)}).next(function(){return o.db.getRemoteDocumentCache().updateSize(r,-s)}).next(function(){return a})},t.prototype.removeOrphanedDocument=function(t,e){var n,r=0,i=this.db.getRemoteDocumentCache();return Gp.waitFor([dd(t).delete((n=e,[0,Bp(n.path)])),i.removeEntry(t,e).next(function(t){r+=t})]).next(function(){return r})},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return hy(t,e)},t.prototype.forEachOrphanedDocument=function(t,o){var a,e=dd(t),s=Pp.INVALID;return e.iterate({index:qd.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==Pp.INVALID&&o(new Cl(Qp(a)),s),s=i,a=r):s=Pp.INVALID}).next(function(){s!==Pp.INVALID&&o(new Cl(Qp(a)),s)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function hy(t,e){return dd(t).put((n=e,r=t.currentSequenceNumber,new qd(0,Bp(n.path),r)));var n,r}var ly=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},t.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++){t=n[e].applyToLocalView(r,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=Wf();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++){e=r[n].applyToLocalView(t,e)}o=o.insert(t,e)}),o},t.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},t.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=jf();return e.forEach(function(t,e){e||(e=new Dl(t,mf.forDeletedDoc())),n=n.insert(t,e)}),n})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Cl(e)).next(function(t){var e=Kf();return t instanceof Nl&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r){var i=this;Nh(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var o=r.collectionGroup,a=Kf();return this.indexManager.getCollectionParents(n,o).next(function(t){return Gp.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(o));return i.getDocumentsMatchingCollectionQuery(n,e).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},t.prototype.getDocumentsMatchingCollectionQuery=function(e,h){var l,n=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,h).next(function(t){return l=t,n.mutationQueue.getAllMutationBatchesAffectingQuery(e,h)}).next(function(t){for(var e=0,n=t;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key;if(h.path.isImmediateParentOf(s.path)){var u=l.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);l=c instanceof Nl?l.insert(s,c):l.remove(s)}}}).next(function(){return l.forEach(function(t,e){h.matches(e)||(l=l.remove(t))}),l})},t}(),fy=function(){function t(){this.refsByKey=new wf(py.compareByKey),this.refsByTarget=new wf(py.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new py(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new py(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=Cl.EMPTY,r=new py(n,t),i=new py(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=Cl.EMPTY,n=new py(e,t),r=new py(e,t+1),i=Yf();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new py(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),py=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return Cl.comparator(t.key,e.key)||il(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return il(t.targetOrBatchId,e.targetOrBatchId)||Cl.comparator(t.key,e.key)},t}(),dy=function(){function l(t,e){this.persistence=t,this.localViewReferences=new fy,this.queryDataByTarget={},Nh(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new ly(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return l.prototype.handleUserChange=function(e){var m=this;return this.persistence.runTransaction("Handle user change","readonly",function(d){var y;return m.mutationQueue.getAllMutationBatches(d).next(function(t){return y=t,m.mutationQueue=m.persistence.getMutationQueue(e),m.localDocuments=new ly(m.remoteDocuments,m.mutationQueue,m.persistence.getIndexManager()),m.mutationQueue.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=Yf(),i=0,o=y;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h];n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++){c=p[f];r=r.add(c.key)}}return m.localDocuments.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})},l.prototype.localWrite=function(c){var h=this,l=ml.now(),t=c.reduce(function(t,e){return t.add(e.key)},Yf());return this.persistence.runTransaction("Locally write mutations","readwrite",function(u){return h.localDocuments.getDocuments(u,t).next(function(n){for(var t=[],e=0,r=c;e<r.length;e++){var i=r[e],o=n.get(i.key);if(!i.isIdempotent){var a=i.fieldMask;if(a){var s=o instanceof Nl?a.applyTo(o.data):zl.EMPTY;t.push(new Df(i.key,s,a,Cf.exists(!0)))}}}return h.mutationQueue.addMutationBatch(u,l,t,c).next(function(t){var e=t.applyToLocalDocumentSet(n);return{batchId:t.batchId,changes:e}})})})},l.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Gp.resolve(null)})})},l.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer();return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},l.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return Nh(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},l.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly",function(t){return e.mutationQueue.getLastStreamToken(t)})},l.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},l.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.queryCache.getLastRemoteSnapshotVersion(t)})},l.prototype.applyRemoteEvent=function(u){var c=this,h=this.remoteDocuments.newChangeBuffer();return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[],s=Yf();xh(u.targetChanges,function(t,e){var n=c.queryDataByTarget[t];if(n){e.addedDocuments.forEach(function(t){s=s.add(t)}),e.modifiedDocuments.forEach(function(t){s=s.add(t)}),a.push(c.queryCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.queryCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n;n=n.copy({resumeToken:r,snapshotVersion:u.snapshotVersion}),c.queryDataByTarget[t]=n,l.shouldPersistQueryData(i,n,e)&&a.push(c.queryCache.updateQueryData(o,n))}}});var i=jf(),n=Yf();u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(h.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);null==n||e.version.isEqual(mf.MIN)||s.has(e.key)&&!n.hasPendingWrites||0<=e.version.compareTo(n.version)?(h.addEntry(e),i=i.insert(t,e)):Th("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})}));var e=u.snapshotVersion;if(!e.isEqual(mf.MIN)){var t=c.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return Nh(0<=e.compareTo(t),"Watch stream reverted to previous snapshot?? "+e+" < "+t),c.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,e)});a.push(t)}return Gp.waitFor(a).next(function(){return h.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,i)})})},l.shouldPersistQueryData=function(t,e,n){return 0!==e.resumeToken.length&&(0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size))},l.prototype.notifyLocalViewChanges=function(t){var n=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return Gp.forEach(t,function(t){return n.localViewReferences.addReferences(t.addedKeys,t.targetId),n.localViewReferences.removeReferences(t.removedKeys,t.targetId),Gp.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},l.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},l.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.localDocuments.getDocument(t,e)})},l.prototype.allocateQuery=function(r){var i=this;return this.persistence.runTransaction("Allocate query","readwrite",function(e){var n;return i.queryCache.getQueryData(e,r).next(function(t){return t?(n=t,Gp.resolve()):i.queryCache.allocateTargetId(e).next(function(t){return n=new bf(r,t,nf.Listen,e.currentSequenceNumber),i.queryCache.addQueryData(e,n)})}).next(function(){return Nh(!i.queryDataByTarget[n.targetId],"Tried to allocate an already allocated query: "+r),i.queryDataByTarget[n.targetId]=n})})},l.prototype.releaseQuery=function(o,a){var s=this,t=a?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",t,function(i){return s.queryCache.getQueryData(i,o).next(function(t){Nh(null!=t,"Tried to release nonexistent query: "+o);var e=t.targetId,n=s.queryDataByTarget[e],r=s.localViewReferences.removeReferencesForId(e);return delete s.queryDataByTarget[e],a?Gp.resolve():Gp.forEach(r,function(t){return s.persistence.referenceDelegate.removeReference(i,t)}).next(function(){return s.persistence.referenceDelegate.removeTarget(i,n)})})})},l.prototype.executeQuery=function(e){var n=this;return this.persistence.runTransaction("Execute query","readonly",function(t){return n.localDocuments.getDocumentsMatchingQuery(t,e)})},l.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly",function(t){return n.queryCache.getMatchingKeysForTargetId(t,e)})},l.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},l.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},l.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},l.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=Gp.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);Nh(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e):Nh(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},l.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.queryDataByTarget)})},l.prototype.getQueryForTarget=function(e){var n=this;return this.queryDataByTarget[e]?Promise.resolve(this.queryDataByTarget[e].query):this.persistence.runTransaction("Get query data","readonly",function(t){return n.queryCache.getQueryDataForTarget(t,e).next(function(t){return t?t.query:null})})},l.prototype.getNewDocumentChanges=function(){var e=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return e.remoteDocuments.getNewDocumentChanges(t)})},l.RESUME_TOKEN_MAX_AGE_MICROS=3e8,l}(),yy=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Ah(),this.batchesByDocumentKey=new wf(py.compareByKey)}return t.prototype.checkEmpty=function(t){return Gp.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");Nh(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return Nh(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Gp.resolve()},t.prototype.getLastStreamToken=function(t){return Gp.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Gp.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){Nh(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,0<this.mutationQueue.length)&&Nh(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Kp(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new py(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Gp.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Gp.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return Nh(null!=n,"Failed to find local mutation batch."),Gp.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Gp.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getAllMutationBatches=function(t){return Gp.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new py(n,0),i=new py(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){Nh(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);Nh(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Gp.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new wf(il);return e.forEach(function(e){var t=new py(e,0),n=new py(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){Nh(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),Gp.resolve(this.findMutationBatches(i))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){Nh(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Cl.isDocumentKey(i)||(i=i.child(""));var o=new py(new Cl(i),0),a=new wf(il);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Gp.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},t.prototype.removeMutationBatch=function(n,r){var i=this;Nh(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return Gp.forEach(r.mutations,function(t){var e=new py(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new py(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Gp.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&Nh(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Gp.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return Nh(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return Nh(n.batchId===t,"If found batch must match"),n},t}(),my=function(){function t(t){this.persistence=t,this.queries=new yd(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=mf.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new fy,this.targetCount=0,this.targetIdGenerator=rd.forQueryCache()}return t.prototype.getTargetCount=function(t){return Gp.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,n){return this.queries.forEach(function(t,e){return n(e)}),Gp.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Gp.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Gp.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Gp.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Gp.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return Nh(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,Gp.resolve()},t.prototype.updateQueryData=function(t,e){return Nh(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),Gp.resolve()},t.prototype.removeQueryData=function(t,e){return Nh(0<this.targetCount,"Removing a target from an empty cache"),Nh(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Gp.resolve()},t.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.queries.forEach(function(t,e){e.sequenceNumber<=r&&!i[e.targetId]&&(o.queries.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),Gp.waitFor(s).next(function(){return a})},t.prototype.getQueryCount=function(t){return Gp.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return Gp.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return Ih("Not yet implemented.")},t.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),Gp.waitFor(i)},t.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),Gp.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Gp.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Gp.resolve(n)},t.prototype.containsKey=function(t,e){return Gp.resolve(this.references.containsKey(e))},t}();var gy,vy,by=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new kl(Cl.comparator),this.newDocumentChanges=Yf(),this.size=0}return t.prototype.addEntries=function(t,e,n){for(var r=[],i=0,o=e;i<o.length;i++){var a=o[i],s=a.maybeDocument.key;this.docs=this.docs.insert(s,a),this.newDocumentChanges=this.newDocumentChanges.add(s),r.push(this.indexManager.addToCollectionParentIndex(t,s.path.popLast()))}return this.size+=n,Gp.waitFor(r)},t.prototype.removeEntry=function(t,e){var n=this.docs.get(e);return n?(this.docs=this.docs.remove(e),this.size-=n.size,Gp.resolve(n.size)):Gp.resolve(0)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Gp.resolve(n?n.maybeDocument:null)},t.prototype.getSizedEntry=function(t,e){return Gp.resolve(this.docs.get(e))},t.prototype.getEntries=function(t,e){var n=this,r=Wf();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Gp.resolve(r)},t.prototype.getSizedEntries=function(t,e){var n=this,r=Wf(),i=new kl(Cl.comparator);return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null),i=i.insert(t,e?e.size:0)}),Gp.resolve({maybeDocuments:r,sizeMap:i})},t.prototype.getDocumentsMatchingQuery=function(t,e){Nh(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Kf(),r=new Cl(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof Nl&&e.matches(s)&&(n=n.insert(s.key,s))}return Gp.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return Gp.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var r=this,i=jf();return this.newDocumentChanges.forEach(function(t){var e=r.docs.get(t),n=e?e.maybeDocument:new Dl(t,mf.forDeletedDoc());i=i.insert(t,n)}),this.newDocumentChanges=Yf(),Gp.resolve(i)},t.prototype.newChangeBuffer=function(){return new wy(this.sizer,this)},t.prototype.getSize=function(t){return Gp.resolve(this.size)},t}(),wy=function(r){function t(t,e){var n=r.call(this)||this;return n.sizer=t,n.documentCache=e,n}return ni(t,r),t.prototype.applyChanges=function(t){var i=this,e=this.assertChanges(),o=0,a=[];return e.forEach(function(t,e){var n=i.documentSizes.get(t);Nh(void 0!==n,"Attempting to change document "+t.toString()+" without having read it first");var r=i.sizer(e);o+=r-n,a.push({maybeDocument:e,size:r})}),this.documentCache.addEntries(t,a,o)},t.prototype.getFromCache=function(t,e){return this.documentCache.getSizedEntry(t,e)},t.prototype.getAllFromCache=function(t,e){return this.documentCache.getSizedEntries(t,e)},t}(md),_y=function(){function r(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Pp(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new my(this);this.indexManager=new Cd,this.remoteDocumentCache=new by(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return r.createLruPersistence=function(t,e,n){return new r(t,function(t){return new Sy(t,new zd(e),n)})},r.createEagerPersistence=function(t){return new r(t,function(t){return new Ty(t)})},r.prototype.shutdown=function(t){return this._started=!1,Promise.resolve()},Object.defineProperty(r.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),r.prototype.getActiveClients=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,[this.clientId]]})})},r.prototype.setPrimaryStateListener=function(t){return t(!0)},r.prototype.setNetworkEnabled=function(t){},r.prototype.getIndexManager=function(){return this.indexManager},r.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new yy(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},r.prototype.getQueryCache=function(){return this.queryCache},r.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},r.prototype.runTransaction=function(t,e,n){var r=this;Th("MemoryPersistence","Starting transaction:",t);var i=new Ey(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},r.prototype.mutationQueuesContainKey=function(e,n){return Gp.or((t=this.mutationQueues,r=[],Lh(t,function(t,e){return r.push(e)}),r).map(function(t){return function(){return t.containsKey(e,n)}}));var t,r},r}(),Ey=function(t){this.currentSequenceNumber=t},Ty=function(){function t(t){this.persistence=t}return t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Gp.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Gp.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Gp.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this.orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(n){var t=this,r=this.persistence.getRemoteDocumentCache();return Gp.forEach(this.orphanedDocuments,function(e){return t.isReferenced(n,e).next(function(t){return t?Gp.resolve():r.removeEntry(n,e).next(function(){})})})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return Gp.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Gp.resolve(n.inMemoryPins.containsKey(e))}])},t}(),Sy=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.orphanedSequenceNumbers=new yd(function(t){return Bp(t.path)}),this.garbageCollector=new ty(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return Gp.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return Gp.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?Gp.resolve():r(e)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(n,t){var r=this,i=0,o=this.persistence.getRemoteDocumentCache();return o.forEachDocumentKey(n,function(e){return r.isPinned(n,e,t).next(function(t){return t?Gp.resolve():(i++,o.removeEntry(n,e).next())})}).next(function(){return i})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Gp.resolve()},t.prototype.removeTarget=function(t,e){var n=e.copy({sequenceNumber:t.currentSequenceNumber});return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Gp.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Gp.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Gp.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Ih("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return Gp.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Gp.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Gp.resolve(void 0!==t&&n<t)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),Cy=function(){function t(t,e,n,r,i){this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&Th("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}(),Iy="PersistentStream";(vy=gy||(gy={}))[vy.Initial=0]="Initial",vy[vy.Starting=1]="Starting",vy[vy.Open=2]="Open",vy[vy.Error=3]="Error",vy[vy.Backoff=4]="Backoff";var Ny,Dy,Ay,ky,Ry=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=gy.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Cy(t,e,1e3,1.5,6e4)}return t.prototype.isStarted=function(){return this.state===gy.Starting||this.state===gy.Open||this.state===gy.Backoff},t.prototype.isOpen=function(){return this.state===gy.Open},t.prototype.start=function(){this.state!==gy.Error?(Nh(this.state===gy.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(gy.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){Nh(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=gy.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.isOpen()?[2,this.close(gy.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Nh(this.isStarted(),"Only started streams should be closed."),Nh(e===gy.Error||tf(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==gy.Error?this.backoff.reset():n&&n.code===kh.RESOURCE_EXHAUSTED?(Sh(n.toString()),Sh("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===kh.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var n=this;Nh(this.state===gy.Initial,"Must be in initial state to auth"),this.state=gy.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new Rh(kh.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},t.prototype.startStream=function(t){var e=this;Nh(this.state===gy.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return Nh(e.state===gy.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=gy.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;Nh(this.state===gy.Error,"Should only perform backoff when in Error state"),this.state=gy.Backoff,this.backoff.backoffAndRun(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){return Nh(this.state===gy.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=gy.Initial,this.start(),Nh(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return Nh(this.isStarted(),"Can't handle server close on non-started stream"),Th(Iy,"close with error: "+t),this.stream=null,this.close(gy.Error,t)},t.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(Th(Iy,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Oy=function(a){function t(t,e,n,r,i){var o=a.call(this,t,Rp.ListenStreamConnectionBackoff,Rp.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}return ni(t,a),t.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},t.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},t.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},t.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},t}(Ry),Py=function(a){function t(t,e,n,r,i){var o=a.call(this,t,Rp.WriteStreamConnectionBackoff,Rp.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o}return ni(t,a),Object.defineProperty(t.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),t.prototype.start=function(){this.handshakeComplete_=!1,a.prototype.start.call(this)},t.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},t.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},t.prototype.onMessage=function(t){if(Nh(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return Nh(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},t.prototype.writeHandshake=function(){Nh(this.isOpen(),"Writing handshake requires an opened stream"),Nh(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},t.prototype.writeMutations=function(t){var e=this;Nh(this.isOpen(),"Writing mutations requires an opened stream"),Nh(this.handshakeComplete_,"Handshake must be complete before writing mutations"),Nh(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},t}(Ry),My=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Py(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Oy(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=jf();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);Nh(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},t.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===kh.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===kh.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},t}(),xy=function(){function t(t){this.datastore=t,this.readVersions=Gf(),this.mutations=[],this.committed=!1}return t.prototype.recordVersion=function(t){var e;if(t instanceof Nl)e=t.version;else{if(!(t instanceof Dl))throw Ih("Document in a transaction was a "+t.constructor.name);e=mf.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Rh(kh.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.lookup=function(t){var e=this;return this.committed?Promise.reject("Transaction has already completed."):0<this.mutations.length?Promise.reject("Transactions lookups are invalid after writes."):this.datastore.lookup(t).then(function(t){return t.forEach(function(t){t instanceof Dl||t instanceof Nl?e.recordVersion(t):Ih("Document in a transaction was a "+t.constructor.name)}),t})},t.prototype.write=function(t){if(this.committed)throw new Rh(kh.FAILED_PRECONDITION,"Transaction has already completed.");this.mutations=this.mutations.concat(t)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return e?Cf.updateTime(e):Cf.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(e&&e.isEqual(mf.forDeletedDoc()))throw new Rh(kh.FAILED_PRECONDITION,"Can't update a document that doesn't exist.");return e?Cf.updateTime(e):Cf.exists(!0)},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t)))},t.prototype.update=function(t,e){this.write(e.toMutations(t,this.preconditionForUpdate(t)))},t.prototype.delete=function(t){this.write([new kf(t,this.precondition(t))]),this.readVersions=this.readVersions.insert(t,mf.forDeletedDoc())},t.prototype.commit=function(){var t=this,e=this.readVersions;return this.mutations.forEach(function(t){e=e.remove(t.key)}),e.isEmpty()?this.datastore.commit(this.mutations).then(function(){t.committed=!0}):Promise.reject(Error("Every document read in a transaction must also be written."))},t}();(Dy=Ny||(Ny={}))[Dy.Unknown=0]="Unknown",Dy[Dy.Online=1]="Online",Dy[Dy.Offline=2]="Offline",(ky=Ay||(Ay={}))[ky.RemoteStore=0]="RemoteStore",ky[ky.SharedClientState=1]="SharedClientState";var Ly=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Ny.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Ny.Unknown),Nh(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(Rp.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,Nh(t.state===Ny.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Ny.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Ny.Online?(this.setAndBroadcast(Ny.Unknown),Nh(0===this.watchStreamFailures,"watchStreamFailures must be 0"),Nh(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Ny.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Ny.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Sh(e),this.shouldWarnClientIsOffline=!1):Th("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}(),Fy="RemoteStore",Uy=function(){function t(t,e,n,r){this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.onlineStateTracker=new Ly(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Ny.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Ny.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(Th(Fy,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return Th(Fy,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Ny.Unknown),[2]}})})},t.prototype.listen=function(t){Nh(!Ph(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){Nh(Ph(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Uh(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Ny.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){Nh(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new pp(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Uh(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return ai(this,void 0,void 0,function(){var n=this;return si(this,function(t){return xh(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},t.prototype.onWatchStreamClose=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return void 0===e&&Nh(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(Ny.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(Ny.Online),n instanceof lp&&n.state===rp.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof cp?this.watchChangeAggregator.handleDocumentChange(n):n instanceof hp?this.watchChangeAggregator.handleExistenceFilter(n):(Nh(n instanceof lp,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(mf.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(r){var i=this;Nh(!r.isEqual(mf.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return xh(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.copy({resumeToken:e.resumeToken,snapshotVersion:r}))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.copy({resumeToken:Ah()}),i.sendUnwatchRequest(t);var n=new bf(e.query,t,nf.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},t.prototype.handleTargetError=function(t){var n=this;Nh(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return ai(n,void 0,void 0,function(){return si(this,function(t){return Ph(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},t.prototype.fillWritePipeline=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){Nh(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},t.prototype.startWriteStream=function(){Nh(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(ay)},t.prototype.onMutationResult=function(t,e){var n=this;Nh(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Hp.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(n){return ai(this,void 0,void 0,function(){var e=this;return si(this,function(t){return void 0===n&&Nh(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return qf(e.code)?(Th(Fy,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Ah(),[2,this.localStore.setLastStreamToken(Ah()).catch(ay)]):[2]})})},t.prototype.handleWriteError=function(i){return ai(this,void 0,void 0,function(){var n,r=this;return si(this,function(t){return qf(e=i.code)&&e!==kh.ABORTED?(n=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(n.batchId,i).then(function(){return r.fillWritePipeline()})]):[2];var e})})},t.prototype.createTransaction=function(){return new xy(this.datastore)},t.prototype.handleCredentialChange=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(Th(Fy,"RemoteStore restarting streams for new credential"),this.networkEnabled=!1,[4,this.disableNetworkInternal()]):[3,3];case 1:return t.sent(),this.onlineStateTracker.set(Ny.Unknown),[4,this.enableNetwork()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},t.prototype.applyPrimaryState=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(Ny.Unknown),t.label=4;case 4:return[2]}})})},t}(),qy=function(){this.listeners=[]},Vy=function(){function t(t){this.syncEngine=t,this.queries=new yd(function(t){return t.canonicalId()}),this.onlineState=Ny.Unknown,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new qy,this.queries.set(e,r)),r.listeners.push(t),t.applyOnlineStateChange(this.onlineState),r.viewSnap&&t.onViewSnapshot(r.viewSnap),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.query,o=this.queries.get(i);if(o){for(var a=0,s=o.listeners;a<s.length;a++){s[a].onViewSnapshot(r)}o.viewSnap=r}}},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(i){this.onlineState=i,this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++){r[n].applyOnlineStateChange(i)}})},t}(),By=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.onlineState=Ny.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(Nh(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==$f.Metadata&&e.push(i)}t=new ap(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}this.raisedInitialEvent?this.shouldRaiseEvent(t)&&this.queryObserver.next(t):this.shouldRaiseInitialEvent(t,this.onlineState)&&this.raiseInitialEvent(t),this.snap=t},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t,this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&this.raiseInitialEvent(this.snap)},t.prototype.shouldRaiseInitialEvent=function(t,e){if(Nh(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Ny.Offline;return this.options.waitForSyncWhenOnline&&n?(Nh(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Ny.Offline},t.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){Nh(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=ap.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),jy=function(){function s(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return s.fromSnapshot=function(t,e){for(var n=Yf(),r=Yf(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case $f.Added:n=n.add(a.doc.key);break;case $f.Removed:r=r.add(a.doc.key)}}return new s(t,n,r)},s}(),Wy=function(t){this.key=t},Qy=function(t){this.key=t},Ky=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Yf(),this.mutatedKeys=Yf(),this.documentSet=new np(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new op,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimit()&&c.size===this.query.limit?c.last():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof Nl?e:null;r&&(Nh(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data.isEqual(r.data)?i!==o&&(u.track({type:$f.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:$f.Modified,doc:r}),a=!0,p&&0<s.query.docComparator(r,p)&&(f=!0)):!n&&r?(u.track({type:$f.Added,doc:r}),a=!0):n&&!r&&(u.track({type:$f.Removed,doc:n}),a=!0,p&&(f=!0));a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimit())for(;l.size>this.query.limit;){var n=l.last();l=l.delete(n.key),h=h.delete(n.key),u.track({type:$f.Removed,doc:n})}return Nh(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var o=this;Nh(!t.needsRefill,"Cannot apply changes that need a refill");var r=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var i=t.changeSet.getChanges();i.sort(function(t,e){return n=t.type,r=e.type,(i=function(t){switch(t){case $f.Added:return 1;case $f.Modified:case $f.Metadata:return 2;case $f.Removed:return 0;default:return Ih("Unknown ChangeType: "+t)}})(n)-i(r)||o.query.docComparator(t.doc,e.doc);var n,r,i}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?tp.Synced:tp.Local,u=s!==this.syncState;return this.syncState=s,0!==i.length||u?{snapshot:new ap(this.query,t.documentSet,r,i,t.mutatedKeys,s===tp.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Ny.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new op,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return Nh(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=Yf(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new Qy(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new Wy(t))}),r},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Yf();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return ap.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===tp.Local)},t}();var Hy="SyncEngine",Gy=function(t,e,n){this.query=t,this.targetId=e,this.view=n},zy=function(t){this.key=t},Yy=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new yd(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new kl(Cl.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new fy,this.mutationUserCallbacks={},this.limboTargetIdGenerator=rd.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Ny.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Nh(null!==t,"SyncEngine listener cannot be null"),Nh(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(a){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(a)];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(s,u){var c=this,h=s.query;return this.localStore.executeQuery(h).then(function(a){return c.localStore.remoteDocumentKeys(s.targetId).then(function(t){var e=new Ky(h,t),n=e.computeDocChanges(a),r=up.createSynthesizedTargetChangeForCurrentChange(s.targetId,u&&c.onlineState!==Ny.Offline),i=e.applyChanges(n,!0===c.isPrimary,r);Nh(0===i.limboChanges.length,"View returned limbo docs before target ack from the server."),Nh(!!i.snapshot,"applyChanges for new view should always return a snapshot");var o=new Gy(h,s.targetId,e);return c.queryViewsByQuery.set(h,o),c.queryViewsByTarget[s.targetId]=o,i.snapshot})})},t.prototype.synchronizeViewAndComputeSnapshot=function(i){var t=this;return this.localStore.executeQuery(i.query).then(function(r){return t.localStore.remoteDocumentKeys(i.targetId).then(function(n){return ai(t,void 0,void 0,function(){var e;return si(this,function(t){return e=i.view.synchronizeWithPersistedState(r,n),this.isPrimary&&this.updateTrackedLimbos(i.targetId,e.limboChanges),[2,e]})})})})},t.prototype.unlisten=function(r){return ai(this,void 0,void 0,function(){var e,n=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),Nh(!!(e=this.queryViewsByQuery.get(r)),"Trying to unlisten on query not found:"+r),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(r,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(ay)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(r,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){var n=this;return this.assertSubscribed("write()"),this.localStore.localWrite(t).then(function(t){return n.sharedClientState.addPendingMutation(t.batchId),n.addMutationCallback(t.batchId,e),n.emitNewSnapsAndNotifyLocalStore(t.changes)}).then(function(){return n.remoteStore.fillWritePipeline()})},t.prototype.wrapUpdateFunctionError=function(t){return t},t.prototype.runTransaction=function(e,n){var r=this;void 0===n&&(n=5),Nh(0<=n,"Got negative number of retries for transaction.");var i=this.remoteStore.createTransaction();return function(){try{var t=e(i);return!tf(t)&&t.catch&&t.then?t.catch(function(t){return Promise.reject(r.wrapUpdateFunctionError(t))}):Promise.reject(Error("Transaction callback must return a Promise"))}catch(t){return Promise.reject(r.wrapUpdateFunctionError(t))}}().then(function(t){return i.commit().then(function(){return t}).catch(function(t){return 0===n?Promise.reject(t):r.runTransaction(e,n-1)})})},t.prototype.applyRemoteEvent=function(e){var r=this;return this.assertSubscribed("applyRemoteEvent()"),this.localStore.applyRemoteEvent(e).then(function(t){return Lh(e.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[t];n&&(Nh(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?Nh(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&(Nh(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),r.emitNewSnapsAndNotifyLocalStore(t,e)}).catch(ay)},t.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===Ay.RemoteStore||!this.isPrimary&&t===Ay.SharedClientState){var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);Nh(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},t.prototype.rejectListen=function(u,c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(u,"rejected",c),e=this.limboResolutionsByTarget[u],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[u],r=(r=new kl(Cl.comparator)).insert(n,new Dl(n,mf.forDeletedDoc())),i=Yf().add(n),o=new sp(mf.MIN,{},new wf(il),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return Nh(!!(a=this.queryViewsByTarget[u]),"Unknown targetId: "+u),[4,this.localStore.releaseQuery(a.query,!1).then(function(){return s.removeAndCleanupQuery(a)}).catch(ay)];case 2:t.sent(),this.syncEngineListener.onWatchError(a.query,c),t.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(n,r,i){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(Th(Hy,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Ih("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){var e=this;this.assertSubscribed("applySuccessfulWrite()");var n=t.batch.batchId;return this.processUserCallback(n,null),this.localStore.acknowledgeBatch(t).then(function(t){return e.sharedClientState.updateMutationState(n,"acknowledged"),e.emitNewSnapsAndNotifyLocalStore(t)}).catch(ay)},t.prototype.rejectFailedWrite=function(e,n){var r=this;return this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(e,n),this.localStore.rejectBatch(e).then(function(t){return r.sharedClientState.updateMutationState(e,"rejected",n),r.emitNewSnapsAndNotifyLocalStore(t)}).catch(ay)},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new kl(il)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(Nh(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof Wy)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof Qy){Th(Hy,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else Ih("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){Th(Hy,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=of.atPath(e.path);this.limboResolutionsByTarget[n]=new zy(e),this.remoteStore.listen(new bf(r,n,nf.LimboResolution,Pp.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(n,u){return ai(this,void 0,void 0,function(){var o,a,e,s=this;return si(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var e=i.view.computeDocChanges(n);return e.needsRefill?s.localStore.executeQuery(i.query).then(function(t){return i.view.computeDocChanges(t,e)}):e}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=jy.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){Nh(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?[4,this.localStore.handleUserChange(r)]:[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},t.prototype.applyPrimaryState=function(c){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return si(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),xh(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var e=this;xh(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new kl(Cl.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){for(var e=this,n=Promise.resolve(),a=[],s=[],r=function(o){n=n.then(function(){return ai(e,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return(n=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(n.query,!0)]:[3,4];case 1:return t.sent(),[4,this.localStore.allocateQuery(n.query)];case 2:return e=t.sent(),[4,this.synchronizeViewAndComputeSnapshot(n)];case 3:return(r=t.sent()).snapshot&&s.push(r.snapshot),[3,8];case 4:return Nh(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 5:return Nh(!!(i=t.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(i)];case 6:return e=t.sent(),[4,this.initializeViewAndComputeSnapshot(e,!1)];case 7:t.sent(),t.label=8;case 8:return a.push(e),[2]}})})})},i=0,o=t;i<o.length;i++){r(o[i])}return n.then(function(){return e.syncEngineListener.onWatchChange(s),a})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(r,o,n){return ai(this,void 0,void 0,function(){var e,i=this;return si(this,function(t){switch(t.label){case 0:if(this.isPrimary)return Th(Hy,"Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[r])return[3,5];switch(o){case"current":case"not-current":return[3,1];case"rejected":return[3,2]}return[3,4];case 1:return[2,this.localStore.getNewDocumentChanges().then(function(n){return ai(i,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return e=sp.createSynthesizedRemoteEventForCurrentChange(r,"current"===o),[4,this.emitNewSnapsAndNotifyLocalStore(n,e)];case 1:return t.sent(),[2]}})})},function(r){return ai(i,void 0,void 0,function(){var n;return si(this,function(t){switch(t.label){case 0:return(e=r).code!==kh.DATA_LOSS||e.message!==gd?[3,2]:(n=[],xh(this.queryViewsByTarget,function(t){return n.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(n)]);case 1:return t.sent(),[3,3];case 2:throw r;case 3:return[2]}var e})})})];case 2:return e=this.queryViewsByTarget[r],this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(e.query,!0)];case 3:return t.sent(),this.syncEngineListener.onWatchError(e.query,n),[3,5];case 4:Ih("Unexpected target state: "+o),t.label=5;case 5:return[2]}})})},t.prototype.applyActiveTargetsChange=function(l,f){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return si(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],Nh(!this.queryViewsByTarget[c],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(c)]):[3,6];case 2:return Nh(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateQuery(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(i,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){var n;return si(this,function(t){switch(t.label){case 0:return(n=a.queryViewsByTarget[e])?[4,a.localStore.releaseQuery(n.query,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupQuery(n)}).catch(ay)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Yf().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Yf()},t}(),Xy=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Jy="SharedClientState",$y="firestore_clients",Zy="firestore_mutations",tm="firestore_targets",em=function(){function a(t,e,n,r){this.user=t,this.batchId=e,this.state=n,Nh(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return a.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Rh(r.error.code,r.error.message)),i?new a(t,e,r.state,o):(Sh(Jy,"Failed to parse mutation state for ID '"+e+"': "+n),null)},a.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},a}(),nm=function(){function o(t,e,n){this.targetId=t,this.state=e,Nh(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return o.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Rh(n.error.code,n.error.message)),r?new o(t,n.state,i):(Sh(Jy,"Failed to parse target state for ID '"+t+"': "+e),null)},o.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},o}(),rm=function(){function a(t,e){this.clientId=t,this.activeTargetIds=e}return a.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Jf(),o=0;r&&o<n.activeTargetIds.length;++o)r=ef(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new a(t,i):(Sh(Jy,"Failed to parse client data for instance '"+t+"': "+e),null)},a}(),im=function(){function n(t,e){this.clientId=t,this.onlineState=e}return n.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&void 0!==Ny[e.onlineState]&&"string"==typeof e.clientId?new n(e.clientId,Ny[e.onlineState]):(Sh(Jy,"Failed to parse online state: "+t),null)},n}(),om=function(){function t(){this.activeTargetIds=Jf()}return t.prototype.addQueryTarget=function(t){Nh(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),am=function(){function a(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!a.isAvailable(this.platform))throw new Rh(kh.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey="firestore_sequence_number_"+n,this.activeClients[this.localClientId]=new om,this.clientStateKeyRe=new RegExp("^"+$y+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Zy+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+tm+"_"+o+"_(\\d+)$"),this.onlineStateKey="firestore_online_state_"+n,this.platform.window.addEventListener("storage",this.storageListener)}return a.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},a.prototype.start=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return si(this,function(t){switch(t.label){case 0:return Nh(!this.started,"WebStorageSharedClientState already started"),Nh(null!==this.syncEngine,"syncEngine property must be set before calling start()"),Nh(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(this.toWebStorageClientStateKey(i)))&&(a=rm.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},a.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},a.prototype.getAllActiveQueryTargets=function(){var n=Jf();return Lh(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},a.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},a.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},a.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},a.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=nm.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},a.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},a.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},a.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},a.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},a.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},a.prototype.setOnlineState=function(t){this.persistOnlineState(t)},a.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},a.prototype.getItem=function(t){var e=this.storage.getItem(t);return Th(Jy,"READ",t,e),e},a.prototype.setItem=function(t,e){Th(Jy,"SET",t,e),this.storage.setItem(t,e)},a.prototype.removeItem=function(t){Th(Jy,"REMOVE",t),this.storage.removeItem(t)},a.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(Th(Jy,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Sh("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ai(t,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&(Nh(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Pp.INVALID;if(null!=t)try{var n=JSON.parse(t);Nh("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Sh(Jy,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Pp.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(a.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),a.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},a.prototype.persistMutationState=function(t,e,n){var r=new em(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},a.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},a.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Ny[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},a.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new nm(t,e,n);this.setItem(r,i.toWebStorageJSON())},a.prototype.toWebStorageClientStateKey=function(t){return Nh(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),$y+"_"+this.persistenceKey+"_"+t},a.prototype.toWebStorageQueryTargetMetadataKey=function(t){return tm+"_"+this.persistenceKey+"_"+t},a.prototype.toWebStorageMutationBatchKey=function(t){var e=Zy+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},a.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},a.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return Nh(null!==n,"Cannot parse client state key '"+t+"'"),rm.fromWebStorageEntry(n,e)},a.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);Nh(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return em.fromWebStorageEntry(new Xy(i),r,e)},a.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);Nh(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return nm.fromWebStorageEntry(r,e)},a.prototype.fromWebStorageOnlineState=function(t){return im.fromWebStorageEntry(t)},a.prototype.handleMutationBatchEvent=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){return e.user.uid!==this.currentUser.uid?(Th(Jy,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},a.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},a.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},a.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},a}();var sm=function(){function t(){this.localState=new om,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new om,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),um="FirestoreClient",cm=function(){function t(t,e){this.cacheSizeBytes=t,this.experimentalTabSynchronization=e}return t.prototype.lruParams=function(){return $d.withCacheSize(this.cacheSizeBytes)},t}(),hm=function(){},lm=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=rl.newId()}return t.prototype.start=function(t){var n=this,r=new Mp,i=new Mp,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},t.prototype.enableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof cm?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline storage. Falling back to storage disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof Rh?t.code===kh.FAILED_PRECONDITION||t.code===kh.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code)},t.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=oy.buildStoragePrefix(this.databaseInfo),a=new Tp(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ai(t,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(i.experimentalTabSynchronization&&!am.isAvailable(this.platform))throw new Rh(kh.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=i.lruParams(),i.experimentalTabSynchronization?(this.sharedClientState=new am(this.asyncQueue,this.platform,o,this.clientId,r),[4,oy.createMultiClientIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n,{sequenceNumberSyncer:this.sharedClientState})]):[3,2];case 1:return e=t.sent(),[3,4];case 2:return this.sharedClientState=new sm,[4,oy.createIndexedDbPersistence(o,this.clientId,this.platform,this.asyncQueue,a,n)];case 3:e=t.sent(),t.label=4;case 4:return[2,(this.persistence=e).referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=_y.createEagerPersistence(this.clientId),this.sharedClientState=new sm,Promise.resolve(null)},t.prototype.initializeRest=function(s,u){var t=this;return Th(um,"Initializing. user=",s.uid),this.platform.loadConnection(this.databaseInfo).then(function(a){return ai(t,void 0,void 0,function(){var e,n,r,i,o=this;return si(this,function(t){switch(t.label){case 0:return this.localStore=new dy(this.persistence,s),u&&(this.lruScheduler=new Zd(u,this.asyncQueue,this.localStore)),e=this.platform.newSerializer(this.databaseInfo.databaseId),n=new My(this.asyncQueue,a,this.credentials,e),r=function(t){return o.syncEngine.applyOnlineStateChange(t,Ay.RemoteStore)},i=function(t){return o.syncEngine.applyOnlineStateChange(t,Ay.SharedClientState)},this.remoteStore=new Uy(this.localStore,n,this.asyncQueue,r),this.syncEngine=new Yy(this.localStore,this.remoteStore,this.sharedClientState,s),this.sharedClientState.onlineStateHandler=i,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Vy(this.syncEngine),[4,this.sharedClientState.start()];case 1:return t.sent(),[4,this.remoteStore.start()];case 2:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return ai(o,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 3:return t.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),Th(um,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.shutdown=function(e){var t=this;return this.asyncQueue.enqueue(function(){return ai(t,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown(e&&e.purgePersistenceWithDataLoss)];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},t.prototype.listen=function(t,e,n){var r=this,i=new By(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Nl)return t;if(t instanceof Dl)return null;throw new Rh(kh.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.asyncQueue.enqueue(function(){return t.localStore.executeQuery(i)}).then(function(t){var e=Yf(),n=new Ky(i,e),r=n.computeDocChanges(t);return n.applyChanges(r,!1).snapshot})},t.prototype.write=function(t){var e=this,n=new Mp;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.transaction=function(t){var e=this;return this.asyncQueue.enqueue(function(){return ai(e,void 0,void 0,function(){return si(this,function(t){return[2]})})}).then(function(){return e.syncEngine.runTransaction(t)})},t}(),fm=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),pm=function(){function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+nl(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(Wh("FieldPath","string",n,t[n]),0===t[n].length)throw new Rh(kh.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Sl(t)}return e.documentId=function(){return e._DOCUMENT_ID},e.prototype.isEqual=function(t){if(!(t instanceof e))throw tl("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},e._DOCUMENT_ID=new e(Sl.keyField().canonicalString()),e}(),dm=new RegExp("[~\\*/\\[\\]]");var ym=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}},mm=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){Nh(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(Xy.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){Nh(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),gm=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var e=this;Nh(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new Rh(kh.ABORTED,"getToken aborted due to token change.");return t?(Nh("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new ym(t.accessToken,e.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){Nh(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.currentUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){Nh(null!=this.tokenListener,"removeChangeListener() called twice"),Nh(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return Nh(null===t||"string"==typeof t,"Received invalid UID: "+t),new Xy(t)},t}(),vm=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=Xy.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),bm=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new vm(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(Xy.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function wm(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var _m,Em,Tm=function(){function t(t){this._methodName=t}return t.delete=function(){return qh("FieldValue.delete",arguments),Sm.instance},t.serverTimestamp=function(){return qh("FieldValue.serverTimestamp",arguments),Cm.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Bh("FieldValue.arrayUnion",arguments,1),new Im(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Bh("FieldValue.arrayRemove",arguments,1),new Nm(t)},t.increment=function(t){return Wh("FieldValue.increment","number",1,t),Vh("FieldValue.increment",arguments,1),new Dm(t)},t.prototype.isEqual=function(t){return this===t},t}(),Sm=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return ni(e,t),e.instance=new e,e}(Tm),Cm=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return ni(e,t),e.instance=new e,e}(Tm),Im=function(n){function t(t){var e=n.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}return ni(t,n),t}(Tm),Nm=function(n){function t(t){var e=n.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}return ni(t,n),t}(Tm),Dm=function(n){function t(t){var e=n.call(this,"FieldValue.increment")||this;return e._operand=t,e}return ni(t,n),t}(Tm),Am=Oh(Tm,"Use FieldValue.<field>() instead."),km=/^__.*__$/,Rm=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Df(t,this.data,this.fieldMask,e)):n.push(new Nf(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Af(t,this.fieldTransforms)),n},t}(),Om=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Df(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new Af(t,this.fieldTransforms)),n},t}();function Pm(t){switch(t){case _m.Set:case _m.MergeSet:case _m.Update:return!0;case _m.Argument:return!1;default:throw Ih("Unexpected case for UserDataSource: "+t)}}(Em=_m||(_m={}))[Em.Set=0]="Set",Em[Em.Update=1]="Update",Em[Em.MergeSet=2]="MergeSet",Em[Em.Argument=3]="Argument";var Mm=function(){function r(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return r.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new r(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},r.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new r(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},r.prototype.childContextForArray=function(t){return new r(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},r.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Rh(kh.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},r.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},r.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},r.prototype.validatePathSegment=function(t){if(Pm(this.dataSource)&&km.test(t))throw this.createError("Document fields cannot begin and end with __")},r}(),xm=function(t,e){this.databaseId=t,this.key=e},Lm=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new Mm(_m.Set,t,Sl.EMPTY_PATH);Um("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new Rm(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new Mm(_m.MergeSet,t,Sl.EMPTY_PATH);Um("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new wf(Sl.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof pm)l=h._internalPath;else{if("string"!=typeof h)throw Ih("Expected stringOrFieldPath to be a string or a FieldPath");l=Vm(t,h)}if(!r.contains(l))throw new Rh(kh.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=Ef.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=Ef.fromArray(r.fieldMask),o=r.fieldTransforms;return new Rm(a,i,o)},t.prototype.parseUpdateData=function(o,t){var a=this,s=new Mm(_m.Update,o,Sl.EMPTY_PATH);Um("Data must be an object, but it was:",s,t);var u=new wf(Sl.comparator),c=zl.EMPTY;Lh(t,function(t,e){var n=Vm(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof Sm)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=Ef.fromSet(u);return new Om(c,e,s.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new Mm(_m.Update,t,Sl.EMPTY_PATH),o=[qm(t,e)],a=[n];if(r.length%2!=0)throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(qm(t,r[s])),a.push(r[s+1]);var u=new wf(Sl.comparator),c=zl.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof Sm)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=Ef.fromSet(u);return new Om(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new Mm(_m.Argument,t,Sl.EMPTY_PATH),r=this.parseData(e,n);return Nh(null!=r,"Parsed data should not be null."),Nh(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=Bm(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Fm(t=this.runPreConverter(t,e)))return Um("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof Tm)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,r){var i=this,o=new kl(il);return Uh(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):Lh(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new zl(o)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Ll.INSTANCE),n.push(s),r++}return new Yl(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Pm(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof Sm){if(e.dataSource!==_m.MergeSet)throw e.dataSource===_m.Update?(Nh(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof Cm)e.fieldTransforms.push(new Tf(e.path,Rf.instance));else if(t instanceof Im){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new Of(n);e.fieldTransforms.push(new Tf(e.path,r))}else if(t instanceof Nm){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new Pf(n);e.fieldTransforms.push(new Tf(e.path,i))}else if(t instanceof Dm){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new Mf(o);e.fieldTransforms.push(new Tf(e.path,a))}else Ih("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Ll.INSTANCE;if("number"==typeof t)return ef(t)?new Vl(t):new Bl(t);if("boolean"==typeof t)return Fl.of(t);if("string"==typeof t)return new jl(t);if(t instanceof Date)return new Wl(ml.fromDate(t));if(t instanceof ml)return new Wl(new ml(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof yl)return new Gl(t);if(t instanceof pl)return new Kl(t);if(t instanceof xm)return new Hl(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Jh(t))},t.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new Mm(_m.Argument,r,Sl.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},t}();function Fm(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ml||t instanceof yl||t instanceof pl||t instanceof xm||t instanceof Tm)}function Um(t,e,n){if(!Fm(n)||!Xh(n)){var r=Jh(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function qm(t,e){if(e instanceof pm)return e._internalPath;if("string"==typeof e)return Vm(t,e);throw new Rh(kh.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Vm(e,t){try{return function(e){if(0<=e.search(dm))throw new Rh(kh.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(pm.bind.apply(pm,[void 0].concat(e.split("."))))}catch(t){throw new Rh(kh.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=Bm(t);throw new Rh(kh.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function Bm(t){return t instanceof Error?t.message:t.toString()}var jm=$d.COLLECTION_DISABLED,Wm=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Rh(kh.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Kh("settings","non-empty string","host",t.host),this.host=t.host,Hh("settings","boolean","ssl",t.ssl),this.ssl=Mh(t.ssl,!0);if(Zh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes"]),Hh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Hh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Sh("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Sh("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=Mh(t.timestampsInSnapshots,!0),Hh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=$d.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==jm&&t.cacheSizeBytes<$d.MINIMUM_CACHE_SIZE_BYTES)throw new Rh(kh.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+$d.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes},t}(),Qm=function(){},Km=function(){function o(t){var n=this;this._queue=new Lp,this.INTERNAL={delete:function(e){return ai(n,void 0,void 0,function(){return si(this,function(t){return this._firestoreClient?[2,this._firestoreClient.shutdown(e)]:[2]})})}};var e=new Qm;if("object"==typeof t.options){var r=t;e.firebaseApp=r,e.databaseId=o.databaseIdFromApp(r),e.persistenceKey=e.firebaseApp.name,e.credentials=new gm(r)}else{var i=t;if(!i.projectId)throw new Rh(kh.INVALID_ARGUMENT,"Must provide projectId");e.databaseId=new bl(i.projectId,i.database),e.persistenceKey="[DEFAULT]",e.credentials=new mm}e.settings=new Wm({}),this._config=e,this._databaseId=e.databaseId}return o.prototype.settings=function(t){if(Vh("Firestore.settings",arguments,1),Wh("Firestore.settings","object",1,t),Ph(t,"persistence"))throw new Rh(kh.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Wm(t);if(this._firestoreClient&&!this._config.settings.isEqual(e))throw new Rh(kh.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._config.settings=e).credentials&&(this._config.credentials=function(t){if(!t)return new mm;switch(t.type){case"gapi":var e=t.client;return Nh(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new bm(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Rh(kh.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},o.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},o.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},o.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Rh(kh.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");return this.configureClient(new cm(this._config.settings.cacheSizeBytes,void 0!==t&&Mh(t.experimentalTabSynchronization,!1)))},o.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new hm),this._firestoreClient},o.prototype.configureClient=function(t){var r=this;Nh(!!this._config.settings.host,"FirestoreSettings.host cannot be falsey"),Nh(!this._firestoreClient,"configureClient() called multiple times");var e=new gl(this._config.databaseId,this._config.persistenceKey,this._config.settings.host,this._config.settings.ssl);return this._dataConverter=new Lm(function(t){if(t instanceof zm){var e=r._config.databaseId,n=t.firestore._config.databaseId;if(!n.isEqual(e))throw new Rh(kh.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new xm(r._config.databaseId,t._key)}return t}),this._firestoreClient=new lm(Dh.getPlatform(),e,this._config.credentials,this._queue),this._firestoreClient.start(t)},o.databaseIdFromApp=function(t){var e=t.options;if(!Ph(e,"projectId"))throw new Rh(kh.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Rh(kh.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new bl(n)},Object.defineProperty(o.prototype,"app",{get:function(){if(!this._config.firebaseApp)throw new Rh(kh.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._config.firebaseApp},enumerable:!0,configurable:!0}),o.prototype.collection=function(t){return Vh("Firestore.collection",arguments,1),Wh("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new tg(El.fromString(t),this)},o.prototype.doc=function(t){return Vh("Firestore.doc",arguments,1),Wh("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),zm.forPath(El.fromString(t),this)},o.prototype._collectionGroup=function(t){if(Vh("Firestore.collectionGroup",arguments,1),Wh("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Rh(kh.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new $m(new of(El.EMPTY_PATH,t),this)},o.prototype.runTransaction=function(e){var n=this;return Vh("Firestore.runTransaction",arguments,1),Wh("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new Hm(n,t))})},o.prototype.batch=function(){return this.ensureClientConfigured(),new Gm(this)},Object.defineProperty(o,"logLevel",{get:function(){switch(_h()){case lh.DEBUG:return"debug";case lh.ERROR:return"error";case lh.SILENT:return"silent";default:return Ih("Unknown log level: "+_h())}},enumerable:!0,configurable:!0}),o.setLogLevel=function(t){switch(Vh("Firestore.setLogLevel",arguments,1),Wh("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Eh(lh.DEBUG);break;case"error":Eh(lh.ERROR);break;case"silent":Eh(lh.SILENT);break;default:throw new Rh(kh.INVALID_ARGUMENT,"Invalid log level: "+t)}},o.prototype._areTimestampsInSnapshotsEnabled=function(){return this._config.settings.timestampsInSnapshots},o}(),Hm=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var n=this;Vh("Transaction.get",arguments,1);var r=ig("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Ih("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof Dl)return new Xm(n._firestore,r._key,null,!1,!1);if(e instanceof Nl)return new Xm(n._firestore,r._key,e,!1,!1);throw Ih("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},t.prototype.set=function(t,e,n){jh("Transaction.set",arguments,2,3);var r=ig("Transaction.set",t,this._firestore),i=(n=eg("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof pm?(Bh("Transaction.update",arguments,3),r=ig("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Vh("Transaction.update",arguments,2),r=ig("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Vh("Transaction.delete",arguments,1);var e=ig("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Gm=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){jh("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=ig("WriteBatch.set",t,this._firestore),i=(n=eg("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,Cf.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof pm?(Bh("WriteBatch.update",arguments,3),r=ig("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Vh("WriteBatch.update",arguments,2),r=ig("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Cf.exists(!0))),this},t.prototype.delete=function(t){Vh("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=ig("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new kf(e._key,Cf.NONE)),this},t.prototype.commit=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new Rh(kh.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),zm=function(){function n(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return n.forPath=function(t,e){if(t.length%2!=0)throw new Rh(kh.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new n(new Cl(t),e)},Object.defineProperty(n.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return new tg(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),n.prototype.collection=function(t){if(Vh("DocumentReference.collection",arguments,1),Wh("DocumentReference.collection","non-empty string",1,t),!t)throw new Rh(kh.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=El.fromString(t);return new tg(this._key.path.child(e),this.firestore)},n.prototype.isEqual=function(t){if(!(t instanceof n))throw tl("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)},n.prototype.set=function(t,e){jh("DocumentReference.set",arguments,1,2);var n=(e=eg("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,Cf.NONE))},n.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof pm?(Bh("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Vh("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Cf.exists(!0)))},n.prototype.delete=function(){return Vh("DocumentReference.delete",arguments,0),this._firestoreClient.write([new kf(this._key,Cf.NONE)])},n.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];jh("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||wm(t[i])||(Zh("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Hh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=wm(t[i])?t[i]:(Wh("DocumentReference.onSnapshot","function",i,t[i]),Qh("DocumentReference.onSnapshot","function",i+1,t[i+1]),Qh("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},n.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new fm({next:function(t){if(n.next){Nh(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new Xm(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites))}},error:e}),o=this._firestoreClient.listen(of.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},n.prototype.get=function(n){var r=this;return jh("DocumentReference.get",arguments,0,1),rg("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new Xm(r.firestore,r._key,t,!0,t instanceof Nl&&t.hasLocalMutations))},t):r.getViaSnapshotListener(e,t,n)})},n.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new Rh(kh.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new Rh(kh.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},n}(),Ym=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Xm=function(){function e(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return e.prototype.data=function(t){return jh("DocumentSnapshot.data",arguments,0,1),t=ng("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data,Ml.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},e.prototype.get=function(t,e){if(jh("DocumentSnapshot.get",arguments,1,2),e=ng("DocumentSnapshot.get",e),this._document){var n=this._document.data.field(qm("DocumentSnapshot.get",t));if(void 0!==n)return this.convertValue(n,Ml.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new zm(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return new Ym(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){if(!(t instanceof e))throw tl("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))},e.prototype.convertObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.convertValue(e,n)}),i},e.prototype.convertValue=function(t,e){if(t instanceof zl)return this.convertObject(t,e);if(t instanceof Yl)return this.convertArray(t,e);if(t instanceof Hl){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Sh("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new zm(n,this._firestore)}return t.value(e)},e.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},e}(),Jm=function(o){function t(t,e,n,r,i){return o.call(this,t,e,n,r,i)||this}return ni(t,o),t.prototype.data=function(t){var e=o.prototype.data.call(this,t);return Nh("object"==typeof e,"Document in a QueryDocumentSnapshot should exist"),e},t}(Xm),$m=function(){function c(t,e){this._query=t,this.firestore=e}return c.prototype.where=function(t,e,n){var r;Vh("Query.where",arguments,3),Wh("Query.where","non-empty string",2,e),$h("Query.where",3,n);var i=qm("Query.where",t),o=sf.fromString(e);if(i.isKeyField()){if(o===sf.ARRAY_CONTAINS)throw new Rh(kh.INVALID_ARGUMENT,"Invalid Query. You can't perform array-contains queries on FieldPath.documentId() since document IDs are not arrays.");if("string"==typeof n){if(""===n)throw new Rh(kh.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a valid document ID if the first parameter is FieldPath.documentId(), but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==n.indexOf("/"))throw new Rh(kh.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection by FieldPath.documentId(), the value provided must be a plain document ID, but '"+n+"' contains a slash.");var a=this._query.path.child(El.fromString(n));if(!Cl.isDocumentKey(a))throw new Rh(kh.INVALID_ARGUMENT,"Invalid third parameter to Query.where(). When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+a+"' is not because it has an odd number of segments ("+a.length+").");r=new Hl(this.firestore._databaseId,new Cl(a))}else{if(!(n instanceof zm))throw new Rh(kh.INVALID_ARGUMENT,"Function Query.where() requires its third parameter to be a string or a DocumentReference if the first parameter is FieldPath.documentId(), but it was: "+Jh(n)+".");var s=n;r=new Hl(this.firestore._databaseId,s._key)}}else r=this.firestore._dataConverter.parseQueryValue("Query.where",n);var u=af.create(i,o,r);return this.validateNewFilter(u),new c(this._query.addFilter(u),this.firestore)},c.prototype.orderBy=function(t,e){var n;if(jh("Query.orderBy",arguments,1,2),Qh("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=lf.ASCENDING;else{if("desc"!==e)throw new Rh(kh.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=lf.DESCENDING}if(null!==this._query.startAt)throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=qm("Query.orderBy",t),i=new pf(r,n);return this.validateNewOrderBy(i),new c(this._query.addOrderBy(i),this.firestore)},c.prototype.limit=function(t){if(Vh("Query.limit",arguments,1),Wh("Query.limit","number",1,t),t<=0)throw new Rh(kh.INVALID_ARGUMENT,"Invalid Query. Query limit ("+t+") is invalid. Limit must be positive.");return new c(this._query.withLimit(t),this.firestore)},c.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Bh("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new c(this._query.withStartAt(r),this.firestore)},c.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Bh("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new c(this._query.withStartAt(r),this.firestore)},c.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Bh("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new c(this._query.withEndAt(r),this.firestore)},c.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Bh("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new c(this._query.withEndAt(r),this.firestore)},c.prototype.isEqual=function(t){if(!(t instanceof c))throw tl("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},c.prototype.boundFromDocOrFields=function(t,e,n,r){if($h(t,1,e),e instanceof Xm){if(0<n.length)throw new Rh(kh.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Rh(kh.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},c.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new Hl(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Ql)throw new Rh(kh.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(void 0===s){var u=a.field.canonicalString();throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new ff(r,n)},c.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Rh(kh.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(El.fromString(a));if(!Cl.isDocumentKey(s))throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Cl(s);i.push(new Hl(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new ff(i,n)},c.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];jh("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||wm(t[i])||(Zh("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Hh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=wm(t[i])?t[i]:(Wh("Query.onSnapshot","function",i,t[i]),Qh("Query.onSnapshot","function",i+1,t[i+1]),Qh("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},c.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new fm({next:function(t){e.next&&e.next(new Zm(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},c.prototype.get=function(n){var r=this;return jh("Query.get",arguments,0,1),rg("Query.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new Zm(r.firestore,r._query,t))},t):r.getViaSnapshotListener(e,t,n)})},c.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new Rh(kh.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},c.prototype.validateNewFilter=function(t){if(t instanceof uf)if(t.isInequality()){var e=this._query.getInequalityFilterField();if(null!==e&&!e.isEqual(t.field))throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+e.toString()+"' and '"+t.field.toString()+"'");var n=this._query.getFirstOrderByField();null!==n&&this.validateOrderByAndInequalityMatch(t.field,n)}else if(t.op===sf.ARRAY_CONTAINS&&this._query.hasArrayContainsFilter())throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. Queries only support a single array-contains filter.")},c.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},c.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Rh(kh.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},c}(),Zm=function(){function e(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Ym(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(e.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),e.prototype.forEach=function(e,n){var r=this;jh("QuerySnapshot.forEach",arguments,1,2),Wh("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(e.prototype,"query",{get:function(){return new $m(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),e.prototype.docChanges=function(t){t&&(Zh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Hh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Rh(kh.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o){{if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new Jm(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key));return Nh(t.type===$f.Added,"Invalid event type for first snapshot"),Nh(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var a=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==$f.Metadata}).map(function(t){var e=new Jm(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key)),n=-1,r=-1;return t.type!==$f.Added&&(Nh(0<=(n=a.indexOf(t.doc.key)),"Index for document not found"),a=a.delete(t.doc.key)),t.type!==$f.Removed&&(a=a.add(t.doc),r=a.indexOf(t.doc.key)),{type:function(t){switch(t){case $f.Added:return"added";case $f.Modified:case $f.Metadata:return"modified";case $f.Removed:return"removed";default:return Ih("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},e.prototype.isEqual=function(t){if(!(t instanceof e))throw tl("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)},e.prototype.convertToDocumentImpl=function(t){return new Jm(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},e}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(Zm.prototype.docChanges,t,{get:function(){return function(){throw new Rh(kh.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var tg=function(r){function t(t,e){var n=r.call(this,of.atPath(t),e)||this;if(t.length%2!=1)throw new Rh(kh.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return n}return ni(t,r),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new zm(new Cl(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.doc=function(t){if(jh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=rl.newId()),Wh("CollectionReference.doc","non-empty string",1,t),""===t)throw new Rh(kh.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=El.fromString(t);return zm.forPath(this._query.path.child(e),this.firestore)},t.prototype.add=function(t){Vh("CollectionReference.add",arguments,1),Wh("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},t}($m);function eg(t,e){if(void 0===e)return{merge:!1};if(Zh(t,e,["merge","mergeFields"]),Hh(t,"boolean","merge",e.merge),Gh(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof pm}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Rh(kh.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ng(t,e){return void 0===e?{}:(Zh(t,e,["serverTimestamps"]),zh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function rg(t,e){Qh(t,"object",1,e),e&&(Zh(t,e,["source"]),zh(t,0,"source",e.source,["default","server","cache"]))}function ig(t,e,n){if(e instanceof zm){if(e.firestore!==n)throw new Rh(kh.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw tl(t,"DocumentReference",1,e)}var og=Oh(Km,"Use firebase.firestore() instead."),ag=Oh(Hm,"Use firebase.firestore().runTransaction() instead."),sg=Oh(Gm,"Use firebase.firestore().batch() instead."),ug=Oh(zm,"Use firebase.firestore().doc() instead."),cg=Oh(Xm),hg=Oh(Jm),lg=Oh($m),fg=Oh(Zm),pg=Oh(tg,"Use firebase.firestore().collection() instead."),dg={Firestore:og,GeoPoint:yl,Timestamp:ml,Blob:dl,Transaction:ag,WriteBatch:sg,DocumentReference:ug,DocumentSnapshot:cg,Query:lg,QueryDocumentSnapshot:hg,QuerySnapshot:fg,CollectionReference:pg,FieldPath:pm,FieldValue:Am,setLogLevel:Km.setLogLevel,CACHE_SIZE_UNLIMITED:jm};function yg(t){t.INTERNAL.registerService("firestore",function(t){return new Km(t)},function(t){Nh(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(dg))}yg(Fh);var mg={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},gg=function(i){function o(t,e,n){var r=i.call(this,e)||this;return Object.setPrototypeOf(r,o.prototype),r.code=t,r.details=n,r}return ni(o,i),o}(Error);var vg=function(){function t(t){this.app=t}return t.prototype.getAuthToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.app.INTERNAL.getToken()];case 1:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getInstanceIdToken=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this.app.messaging?[4,this.app.messaging().getToken()]:[2,void 0];case 1:return(e=t.sent())?[2,e]:[2,void 0];case 2:return t.sent(),[2,void 0];case 3:return[2]}})})},t.prototype.getContext=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},t}();function bg(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var wg=function(){function t(){}return t.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return bg(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},t.prototype.decode=function(t){var e=this;if(null===t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=parseFloat(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?bg(t,function(t){return e.decode(t)}):t},t}();var _g,Eg,Tg=function(){function t(t,e){void 0===e&&(e="us-central1"),this.app_=t,this.region_=e,this.serializer=new wg,this.emulatorOrigin=null,this.contextProvider=new vg(t)}return Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),t.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},t.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},t.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},t.prototype.postJSON=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},t.prototype.call=function(h,l,f){return ai(this,void 0,void 0,function(){var e,r,i,o,a,s,u,c;return si(this,function(t){switch(t.label){case 0:return e=this._url(h),l=this.serializer.encode(l),r={data:l},i=new Headers,[4,this.contextProvider.getContext()];case 1:return(o=t.sent()).authToken&&i.append("Authorization","Bearer "+o.authToken),o.instanceIdToken&&i.append("Firebase-Instance-ID-Token",o.instanceIdToken),a=f.timeout||7e4,[4,Promise.race([this.postJSON(e,r,i),(n=a,new Promise(function(t,e){setTimeout(function(){e(new gg("deadline-exceeded","deadline-exceeded"))},n)}))])];case 2:if(s=t.sent(),u=function(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e.error;if(a){var s=a.status;if("string"==typeof s){if(!mg[s])return new gg("internal","internal");r=mg[s]}i=s;var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new gg(r,i,o)}(s.status,s.json,this.serializer))throw u;if(!s.json)throw new gg("internal","Response is not valid JSON object.");if(void 0===(c=s.json.data)&&(c=s.json.result),void 0===c)throw new gg("internal","Response is missing data field.");return[2,{data:this.serializer.decode(c)}]}var n})})},t}();function Sg(t,e,n){return new Tg(t,n)}_g={Functions:Tg},Fh.INTERNAL.registerService("functions",Sg,_g,void 0,!0);var Cg,Ig,Ng,Dg,Ag=((Eg={})["only-available-in-window"]="This method is available in a Window context.",Eg["only-available-in-sw"]="This method is available in a service worker context.",Eg["should-be-overriden"]="This method should be overriden by extended classes.",Eg["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",Eg["permission-default"]="The required permissions were not granted and dismissed instead.",Eg["permission-blocked"]="The required permissions were not granted and blocked instead.",Eg["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",Eg["notifications-blocked"]="Notifications have been blocked.",Eg["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",Eg["sw-registration-expected"]="A service worker registration was the expected input.",Eg["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",Eg["invalid-saved-token"]="Unable to access details of the saved token.",Eg["sw-reg-redundant"]="The service worker being used for push was made redundant.",Eg["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$message}",Eg["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",Eg["token-subscribe-no-push-set"]="FCM returned an invalid response when getting an FCM token.",Eg["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$message}",Eg["token-update-failed"]="A problem occured while updating the user from FCM: {$message}",Eg["token-update-no-token"]="FCM returned no token when updating the user to push.",Eg["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",Eg["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",Eg["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",Eg["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",Eg["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",Eg["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",Eg["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",Eg["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",Eg["failed-to-delete-token"]="Unable to delete the currently saved token.",Eg["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",Eg["incorrect-gcm-sender-id"]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",Eg["bad-scope"]="The service worker scope must be a string with at least one character.",Eg["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",Eg["bad-subscription"]="The subscription must be a valid PushSubscription.",Eg["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",Eg["bad-push-set"]="The FCM push set used for storage / lookup was not not a valid push set string.",Eg["failed-delete-vapid-key"]="The VAPID key could not be deleted.",Eg["invalid-public-vapid-key"]="The public VAPID key must be a string.",Eg["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",Eg["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",Eg),kg=new Ir("messaging","Messaging",Ag),Rg=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),Og="https://fcm.googleapis.com";function Pg(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function Mg(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ui(arguments[e]));return t}(e)))}function xg(t){return Mg(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(Ig=Cg||(Cg={})).TYPE_OF_MSG="firebase-messaging-msg-type",Ig.DATA="firebase-messaging-msg-data",(Dg=Ng||(Ng={})).PUSH_MSG_RECEIVED="push-msg-received",Dg.NOTIFICATION_CLICKED="notification-clicked";var Lg=function(){function t(){}return t.prototype.getToken=function(c,h,l){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:e=xg(h.getKey("p256dh")),n=xg(h.getKey("auth")),r="authorized_entity="+c+"&endpoint="+h.endpoint+"&encryption_key="+e+"&encryption_auth="+n,Pg(l.buffer,Rg.buffer)||(i=xg(l),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(Og+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw t.sent(),kg.create("token-subscribe-failed");case 5:if(s.error)throw u=s.error.message,kg.create("token-subscribe-failed",{message:u});if(!s.token)throw kg.create("token-subscribe-no-token");if(!s.pushSet)throw kg.create("token-subscribe-no-push-set");return[2,{token:s.token,pushSet:s.pushSet}]}})})},t.prototype.updateToken=function(c,h,l,f,p){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return si(this,function(t){switch(t.label){case 0:e=xg(f.getKey("p256dh")),n=xg(f.getKey("auth")),r="push_set="+l+"&token="+h+"&authorized_entity="+c+"&endpoint="+f.endpoint+"&encryption_key="+e+"&encryption_auth="+n,Pg(p.buffer,Rg.buffer)||(i=xg(p),r+="&application_pub_key="+i),(o=new Headers).append("Content-Type","application/x-www-form-urlencoded"),a={method:"POST",headers:o,body:r},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(Og+"/fcm/connect/subscribe",a)];case 2:return[4,t.sent().json()];case 3:return s=t.sent(),[3,5];case 4:throw t.sent(),kg.create("token-update-failed");case 5:if(s.error)throw u=s.error.message,kg.create("token-update-failed",{message:u});if(!s.token)throw kg.create("token-update-no-token");return[2,s.token]}})})},t.prototype.deleteToken=function(a,s,u){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:e="authorized_entity="+a+"&token="+s+"&pushSet="+u,(n=new Headers).append("Content-Type","application/x-www-form-urlencoded"),r={method:"POST",headers:n,body:e},t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(Og+"/fcm/connect/unsubscribe",r)];case 2:return[4,t.sent().json()];case 3:if((i=t.sent()).error)throw o=i.error.message,kg.create("token-unsubscribe-failed",{message:o});return[3,5];case 4:throw t.sent(),kg.create("token-unsubscribe-failed");case 5:return[2]}})})},t}();function Fg(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var Ug="undefined",qg="fcm_token_object_Store";function Vg(){var e=indexedDB.open(Ug);e.onerror=function(t){},e.onsuccess=function(t){!function(n){if(n.objectStoreNames.contains(qg)){var t=n.transaction(qg).objectStore(qg),r=new Lg,i=t.openCursor();i.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},i.onsuccess=function(){var t=i.result;if(t){var e=t.value;r.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet),t.continue()}else n.close(),indexedDB.deleteDatabase(Ug)}}}(e.result)}}var Bg=function(){function t(){this.dbPromise=null}return t.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},t.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},t.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},t.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},t.prototype.closeDatabase=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},t.prototype.createTransaction=function(a,s){return void 0===s&&(s="readonly"),ai(this,void 0,void 0,function(){var e,r,i,o;return si(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),r=e.transaction(this.objectStoreName,s),i=r.objectStore(this.objectStoreName),[4,(n=a(i),new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}}))];case 2:return o=t.sent(),[2,new Promise(function(t,e){r.oncomplete=function(){t(o)},r.onerror=function(){e(r.error)}})]}var n})})},t.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},t}();var jg=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}return ni(t,e),t.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(r=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),r.createIndex("fcmToken","fcmToken",{unique:!0});case 1:Vg();case 2:var r,i=(r=t.transaction.objectStore(this.objectStoreName)).openCursor();i.onsuccess=function(){var t=i.result;if(t){var e=t.value,n=oi({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=Fg(e.vapidKey)),"string"==typeof e.auth&&(n.auth=Fg(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=Fg(e.p256dh).buffer),t.update(n),t.continue()}}}},t.prototype.getTokenDetailsFromToken=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw kg.create("bad-token");return Wg({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},t.prototype.getTokenDetailsFromSWScope=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw kg.create("bad-scope");return Wg({swScope:e}),[2,this.get(e)]})})},t.prototype.saveTokenDetails=function(e){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e.swScope)throw kg.create("bad-scope");if(!e.vapidKey)throw kg.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw kg.create("bad-subscription");if(!e.fcmSenderId)throw kg.create("bad-sender-id");if(!e.fcmToken)throw kg.create("bad-token");if(!e.fcmPushSet)throw kg.create("bad-push-set");return Wg(e),[2,this.put(e)]})})},t.prototype.deleteToken=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(kg.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw kg.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},t}(Bg);function Wg(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw kg.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw kg.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw kg.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw kg.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw kg.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw kg.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw kg.create("bad-sender-id");if(t.fcmPushSet&&("string"!=typeof t.fcmPushSet||0===t.fcmPushSet.length))throw kg.create("bad-push-set")}var Qg=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}return ni(t,e),t.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},t.prototype.getVapidFromSWScope=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw kg.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},t.prototype.saveVapidDetails=function(n,r){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){if("string"!=typeof n||0===n.length)throw kg.create("bad-scope");if(null===r||65!==r.length)throw kg.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},t.prototype.deleteVapidDetails=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw kg.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},t}(Bg),Kg="messagingSenderId",Hg=function(){function t(t){var e=this;if(!t.options[Kg]||"string"!=typeof t.options[Kg])throw kg.create("bad-sender-id");this.messagingSenderId=t.options[Kg],this.tokenDetailsModel=new jg,this.vapidDetailsModel=new Qg,this.iidModel=new Lg,this.app=t,this.INTERNAL={delete:function(){return e.delete()}}}return t.prototype.getToken=function(){return ai(this,void 0,void 0,function(){var e,n,r,i,o;return si(this,function(t){switch(t.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw kg.create("notifications-blocked");return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return n=t.sent(),[4,this.getPublicVapidKey_()];case 2:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 3:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 4:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},t.prototype.manageExistingToken=function(e,n,r,i){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!Pg(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=Pg(t.getKey("auth"),n.auth),o=Pg(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[4,this.deleteTokenFromDB(i.fcmToken)];case 1:return t.sent(),[2,this.getNewToken(e,n,r)]}})})},t.prototype.updateToken=function(i,o,a,s){return ai(this,void 0,void 0,function(){var e,n,r;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,s.fcmToken,s.fcmPushSet,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.messagingSenderId,fcmToken:e,fcmPushSet:s.fcmPushSet,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},t.prototype.getNewToken=function(r,i,o){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.messagingSenderId,fcmToken:e.token,fcmPushSet:e.pushSet,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e.token]}})})},t.prototype.deleteToken=function(r){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},t.prototype.deleteTokenFromDB=function(n){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(n)];case 1:return e=t.sent(),[4,this.iidModel.deleteToken(e.fcmSenderId,e.fcmToken,e.fcmPushSet)];case 2:return t.sent(),[2]}})})},t.prototype.getPushSubscription=function(e,n){return e.pushManager.getSubscription().then(function(t){return t||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n})})},t.prototype.requestPermission=function(){throw kg.create("only-available-in-window")},t.prototype.useServiceWorker=function(t){throw kg.create("only-available-in-window")},t.prototype.usePublicVapidKey=function(t){throw kg.create("only-available-in-window")},t.prototype.onMessage=function(t,e,n){throw kg.create("only-available-in-window")},t.prototype.onTokenRefresh=function(t,e,n){throw kg.create("only-available-in-window")},t.prototype.setBackgroundMessageHandler=function(t){throw kg.create("only-available-in-sw")},t.prototype.delete=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},t.prototype.getNotificationPermission_=function(){return Notification.permission},t.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},t.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},t.prototype.getIidModel=function(){return this.iidModel},t}();var Gg="FCM_MSG",zg=function(n){function t(t){var e=n.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}return ni(t,n),t.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},t.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},t.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},t.prototype.onPush_=function(s){return ai(this,void 0,void 0,function(){var e,n,r,i,o,a;return si(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},t.prototype.onSubChange_=function(t){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),kg.create("unable-to-resubscribe",{message:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},t.prototype.onNotificationClick_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return o.notification&&o.notification.data&&o.notification.data[Gg]?o.action?[2]:(o.stopImmediatePropagation(),o.notification.close(),(e=o.notification.data[Gg]).notification&&(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=t.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=t.sent(),t.label=5;case 5:return r?(delete e.notification,delete e.fcmOptions,i=Xg(Ng.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},t.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=oi({},t.notification);return n.data=oi({},t.notification.data,((e={})[Gg]=t,e)),n}},t.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw kg.create("bg-handler-function-expected");this.bgMessageHandler=t},t.prototype.getWindowClient_=function(o){return ai(this,void 0,void 0,function(){var e,n,r,i;return si(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,Yg()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},t.prototype.attemptToMessageClient_=function(e,n){return ai(this,void 0,void 0,function(){return si(this,function(t){if(!e)throw kg.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},t.prototype.hasVisibleClients_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return[4,Yg()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},t.prototype.sendMessageToWindowClients_=function(i){return ai(this,void 0,void 0,function(){var e,n,r=this;return si(this,function(t){switch(t.label){case 0:return[4,Yg()];case 1:return e=t.sent(),n=Xg(Ng.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},t.prototype.getSWRegistration_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return[2,self.registration]})})},t.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw kg.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,Rg]:[2,n]}})})},t}(Hg);function Yg(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Xg(t,e){var n;return(n={})[Cg.TYPE_OF_MSG]=t,n[Cg.DATA]=e,n}var Jg,$g=function(n){function t(t){var e=n.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.manifestCheckPromise=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Vr(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Vr(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}return ni(t,n),t.prototype.getToken=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){switch(t.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return ai(this,void 0,void 0,function(){var e,n;return si(this,function(t){switch(t.label){case 0:if(!(e=document.querySelector('link[rel="manifest"]')))return[2];t.label=1;case 1:return t.trys.push([1,4,,5]),[4,fetch(e.href)];case 2:return[4,t.sent().json()];case 3:return n=t.sent(),[3,5];case 4:return t.sent(),[2];case 5:if(!n||!n.gcm_sender_id)return[2];if("103953800507"!==n.gcm_sender_id)throw kg.create("incorrect-gcm-sender-id");return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return t.sent(),[2,n.prototype.getToken.call(this)]}})})},t.prototype.requestPermission=function(){return ai(this,void 0,void 0,function(){var e;return si(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?kg.create("permission-blocked"):kg.create("permission-default")}})})},t.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw kg.create("sw-registration-expected");if(null!=this.registrationToUse)throw kg.create("use-sw-before-get-token");this.registrationToUse=t},t.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw kg.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw kg.create("use-public-key-before-get-token");var e=Fg(t);if(65!==e.length)throw kg.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},t.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},t.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},t.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(kg.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(kg.create("sw-reg-redundant"));else t(r);else e(kg.create("no-sw-in-reg"))})},t.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw kg.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},t.prototype.getPublicVapidKey_=function(){return ai(this,void 0,void 0,function(){return si(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,Rg]})})},t.prototype.setupSWMessageListener_=function(){var r=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[Cg.TYPE_OF_MSG]){var e=t.data;switch(e[Cg.TYPE_OF_MSG]){case Ng.PUSH_MSG_RECEIVED:case Ng.NOTIFICATION_CLICKED:var n=e[Cg.DATA];r.messageObserver&&r.messageObserver.next(n)}}},!1)},t}(Hg);function Zg(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}Jg={isSupported:Zg},Fh.INTERNAL.registerService("messaging",function(t){if(!Zg())throw kg.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new zg(t):new $g(t)},Jg);var tv="firebasestorage.googleapis.com",ev=function(){function t(t,e){this.code_=rv(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}return t.prototype.codeProp=function(){return this.code},t.prototype.codeEquals=function(t){return rv(t)===this.codeProp()},t.prototype.serverResponseProp=function(){return this.serverResponse_},t.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(t.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),t}(),nv={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function rv(t){return"storage/"+t}function iv(){return new ev(nv.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function ov(){return new ev(nv.CANCELED,"User canceled the upload/download.")}function av(){return new ev(nv.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function sv(t,e,n){return new ev(nv.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function uv(){return new ev(nv.APP_DELETED,"The Firebase app was deleted.")}function cv(t,e){return new ev(nv.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function hv(t){throw new ev(nv.INTERNAL_ERROR,"Internal error: "+t)}var lv={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function fv(t){switch(t){case lv.RAW:case lv.BASE64:case lv.BASE64URL:case lv.DATA_URL:return;default:throw"Expected one of the event types: ["+lv.RAW+", "+lv.BASE64+", "+lv.BASE64URL+", "+lv.DATA_URL+"]."}}var pv=function(t,e){this.data=t,this.contentType=e||null};function dv(t,e){switch(t){case lv.RAW:return new pv(yv(e));case lv.BASE64:case lv.BASE64URL:return new pv(mv(t,e));case lv.DATA_URL:return new pv((n=new gv(e)).base64?mv(lv.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw cv(lv.DATA_URL,"Malformed data URL.")}return yv(e)}(n.rest),new gv(e).contentType)}var n;throw iv()}function yv(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function mv(e,t){switch(e){case lv.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw cv(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case lv.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw cv(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw cv(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var gv=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw cv(lv.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(r=";base64",(n=i).length>=r.length&&n.substring(n.length-r.length)===r),this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)};var vv,bv,wv={STATE_CHANGED:"state_changed"},_v="running",Ev="pausing",Tv="paused",Sv="success",Cv="canceling",Iv="canceled",Nv="error",Dv={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Av(t){switch(t){case _v:case Ev:case Cv:return Dv.RUNNING;case Tv:return Dv.PAUSED;case Sv:return Dv.SUCCESS;case Iv:return Dv.CANCELED;case Nv:default:return Dv.ERROR}}function kv(t,e){for(var n in t)r=t,i=n,Object.prototype.hasOwnProperty.call(r,i)&&e(n,t[n]);var r,i}function Rv(t){if(null==t)return{};var n={};return kv(t,function(t,e){n[t]=e}),n}function Ov(t){return new Promise(t)}function Pv(t){return Promise.resolve(t)}function Mv(t){return null!=t}function xv(t){return void 0!==t}function Lv(t){return"function"==typeof t}function Fv(t){return"object"==typeof t}function Uv(t){return"string"==typeof t||t instanceof String}function qv(t){return Vv()&&t instanceof Blob}function Vv(){return"undefined"!=typeof Blob}(bv=vv||(vv={}))[bv.NO_ERROR=0]="NO_ERROR",bv[bv.NETWORK_ERROR=1]="NETWORK_ERROR",bv[bv.ABORT=2]="ABORT";var Bv=function(){function t(){var n=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=vv.NO_ERROR,this.sendPromise_=Ov(function(e,t){n.xhr_.addEventListener("abort",function(t){n.errorCode_=vv.ABORT,e(n)}),n.xhr_.addEventListener("error",function(t){n.errorCode_=vv.NETWORK_ERROR,e(n)}),n.xhr_.addEventListener("load",function(t){e(n)})})}return t.prototype.send=function(t,e,n,r){var i=this;if(this.sent_)throw hv("cannot .send() more than once");(this.sent_=!0,this.xhr_.open(e,t,!0),Mv(r))&&kv(r,function(t,e){i.xhr_.setRequestHeader(t,e.toString())});return Mv(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw hv("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw hv("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw hv("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){Mv(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){Mv(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},t}(),jv=function(){function t(){}return t.prototype.createXhrIo=function(){return new Bv},t}();function Wv(t){var e,n;try{e=JSON.parse(t)}catch(t){return null}return Fv(n=e)&&!Array.isArray(n)?e:null}var Qv=function(){function f(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(f.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),f.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},f.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},f.makeFromBucketSpec=function(e){var t,n;try{t=f.makeFromUrl(e)}catch(t){return new f(e,"")}if(""===t.path)return t;throw n=e,new ev(nv.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")},f.makeFromUrl=function(t){var e=null,n="([A-Za-z0-9.\\-_]+)";var r=new RegExp("^gs://"+n+"(/(.*))?$","i");for(var i,o=tv.replace(/[.]/g,"\\."),a=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+o+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],s=0;s<a.length;s++){var u=a[s],c=u.regex.exec(t);if(c){var h=c[u.indices.bucket],l=c[u.indices.path];l||(l=""),e=new f(h,l),u.postModify(e);break}}if(null==e)throw i=t,new ev(nv.INVALID_URL,"Invalid URL '"+i+"'.");return e},f}();function Kv(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Hv(t){return"https://"+tv+"/v0"+t}function Gv(t){var r=encodeURIComponent,i="?";return kv(t,function(t,e){var n=r(t)+"="+r(e);i=i+n+"&"}),i=i.slice(0,-1)}function zv(t,e){return e}var Yv=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||zv},Xv=null;function Jv(){if(Xv)return Xv;var t=[];t.push(new Yv("bucket")),t.push(new Yv("generation")),t.push(new Yv("metageneration")),t.push(new Yv("name","fullPath",!0));var e=new Yv("name");e.xform=function(t,e){return!Uv(n=e)||n.length<2?n:Kv(n=n);var n},t.push(e);var n=new Yv("size");return n.xform=function(t,e){return Mv(e)?+e:e},t.push(n),t.push(new Yv("timeCreated")),t.push(new Yv("updated")),t.push(new Yv("md5Hash",null,!0)),t.push(new Yv("cacheControl",null,!0)),t.push(new Yv("contentDisposition",null,!0)),t.push(new Yv("contentEncoding",null,!0)),t.push(new Yv("contentLanguage",null,!0)),t.push(new Yv("contentType",null,!0)),t.push(new Yv("metadata","customMetadata",!0)),Xv=t}function $v(t,e,n){for(var r,i,o={type:"file"},a=n.length,s=0;s<a;s++){var u=n[s];o[u.local]=u.xform(o,e[u.server])}return r=o,i=t,Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new Qv(t,e);return i.makeStorageReference(n)}}),o}function Zv(t,e,n){var r=Wv(e);return null===r?null:$v(t,r,n)}function tb(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function eb(t){var e;if(!(t&&Fv(t)))throw"Expected Metadata object.";for(var n in t){var r=t[n];if("customMetadata"===n){if(!Fv(r))throw"Expected object for 'customMetadata' mapping."}else if(Fv(e=r)&&null!==e)throw"Mapping for '"+n+"' cannot be an object."}}function nb(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}var a,s,u,c,h,l;if(!(r<=n.length&&n.length<=i))throw a=r,s=i,u=e,c=n.length,l=a===s?1===(h=a)?"argument":"arguments":(h="between "+a+" and "+s,"arguments"),new ev(nv.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+u+"`: Expected "+h+" "+l+", received "+c+".");for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?sv(o,e,t.message):sv(o,e,t)}}var rb=function(e,t){var n=this;this.validator=function(t){n.optional&&!xv(t)||e(t)},this.optional=!!t};function ib(t,e){function n(t){if(!Uv(t))throw"Expected string."}var r,i,o;return r=t?(i=n,o=t,function(t){i(t),o(t)}):n,new rb(r,e)}function ob(t){return new rb(eb,t)}function ab(){return new rb(function(t){var e;if(!(("number"==typeof(e=t)||e instanceof Number)&&0<=t))throw"Expected a number 0 or greater."})}function sb(e,t){return new rb(function(t){if(!(null===t||Mv(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function ub(t){return new rb(function(t){if(null!==t&&!Lv(t))throw"Expected a Function."},t)}function cb(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Vv())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var hb=function(){function s(t,e){var n=0,r="";qv(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return s.prototype.size=function(){return this.size_},s.prototype.type=function(){return this.type_},s.prototype.slice=function(t,e){if(qv(this.data_)){var n=this.data_,r=(o=t,a=e,(i=n).webkitSlice?i.webkitSlice(o,a):i.mozSlice?i.mozSlice(o,a):i.slice?i.slice(o,a):null);return null===r?null:new s(r)}var i,o,a;return new s(new Uint8Array(this.data_.buffer,t,e-t),!0)},s.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(Vv()){var n=t.map(function(t){return t instanceof s?t.data_:t});return new s(cb.apply(null,n))}var r=t.map(function(t){return Uv(t)?dv(lv.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new s(o,!0)},s.prototype.uploadData=function(){return this.data_},s}();function lb(t,e){return-1!==t.indexOf(e)}var fb=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function pb(t){if(!t)throw iv()}function db(r,i){return function(t,e){var n=Zv(r,e,i);return pb(null!==n),n}}function yb(r,i){return function(t,e){var n=Zv(r,e,i);return pb(null!==n),function(r,t){var e=Wv(t);if(null===e)return null;if(!Uv(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return Hv("/b/"+i(e)+"/o/"+i(n))+Gv({alt:"media",token:t})})[0]}(n,e)}}function mb(o){return function(t,e){var n,r,i;return(n=401===t.getStatus()?new ev(nv.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=o.bucket,new ev(nv.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(r=o.path,new ev(nv.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")):e).setServerResponseProp(e.serverResponseProp()),n}}function gb(i){var o=mb(i);return function(t,e){var n,r=o(t,e);return 404===t.getStatus()&&(n=i.path,r=new ev(nv.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")),r.setServerResponseProp(e.serverResponseProp()),r}}function vb(t,e,n){var r=Hv(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new fb(r,"GET",db(t,n),i);return o.errorHandler=gb(e),o}function bb(t,e,n){var r,i,o=Rv(n);return o.fullPath=t.path,o.size=e.size(),o.contentType||(o.contentType=(i=e,(r=null)&&r.contentType||i&&i.type()||"application/octet-stream")),o}var wb=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function _b(t,e){var n;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){pb(!1)}return pb(lb(e||["active"],n)),n}function Eb(t,a,e,s,n,u,r,i){var c=new wb(0,0);if(c.total=r?(c.current=r.current,r.total):(c.current=0,s.size()),s.size()!==c.total)throw new ev(nv.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw av();var y=a.maxUploadRetryTime(),m=new fb(e,"POST",function(t,e){var n,r=_b(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?db(a,u)(t,e):null,new wb(i,o,"final"===r,n)},y);return m.headers=p,m.body=d.uploadData(),m.progressCallback=i||null,m.errorHandler=mb(t),m}var Tb=function(t,e,n){if(Lv(t)||Mv(e)||Mv(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},Sb=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function Cb(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Pv(!0).then(function(){n.apply(null,t)})}}var Ib=function(){function t(t,e,n,r,i,o){void 0===o&&(o=null);var a=this;this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=_v,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(nv.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(Nv))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(nv.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(Nv))},this.promise_=Ov(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}return t.prototype.makeProgressCallback_=function(){var n=this,r=this.transferred_;return function(t,e){n.updateProgress_(r+t)}},t.prototype.shouldDoResumable_=function(t){return 262144<t.size()},t.prototype.start_=function(){this.state_===_v&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},t.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case _v:e(t);break;case Cv:n.transition_(Iv);break;case Ev:n.transition_(Tv)}})},t.prototype.createResumable_=function(){var m=this;this.resolveToken_(function(t){var e,n,r,i,o,a,s,u,c,h,l,f,p,d=(e=m.authWrapper_,n=m.location_,r=m.mappings_,i=m.blob_,o=m.metadata_,a=n.bucketOnlyServerUrl(),s=bb(n,i,o),u={name:s.fullPath},c=Hv(a),h={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":i.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},l=tb(s,r),f=e.maxUploadRetryTime(),(p=new fb(c,"POST",function(t,e){var n;_b(t);try{n=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){pb(!1)}return pb(Uv(n)),n},f)).urlParams=u,p.headers=h,p.body=l,p.errorHandler=mb(n),p),y=m.authWrapper_.makeRequest(d,t);(m.request_=y).getPromise().then(function(t){m.request_=null,m.uploadUrl_=t,m.needToFetchStatus_=!1,m.completeTransitions_()},m.errorHandler_)})},t.prototype.fetchStatus_=function(){var c=this,h=this.uploadUrl_;this.resolveToken_(function(t){var e,n,r,o,i,a,s=(e=c.authWrapper_,n=c.location_,r=h,o=c.blob_,i=e.maxUploadRetryTime(),(a=new fb(r,"POST",function(t,e){var n,r=_b(t,["active","final"]);try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){pb(!1)}var i=parseInt(n,10);return pb(!isNaN(i)),new wb(i,o.size(),"final"===r)},i)).headers={"X-Goog-Upload-Command":"query"},a.errorHandler=mb(n),a),u=c.authWrapper_.makeRequest(s,t);(c.request_=u).getPromise().then(function(t){t=t,c.request_=null,c.updateProgress_(t.current),c.needToFetchStatus_=!1,t.finalized&&(c.needToFetchMetadata_=!0),c.completeTransitions_()},c.errorHandler_)})},t.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new wb(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=Eb(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(Nv)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(Sv)):r.completeTransitions_()},r.errorHandler_)})},t.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},t.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=vb(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(Sv)},r.metadataErrorHandler_)})},t.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=bb(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+tb(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=hb.getBlob(c,r,h);if(null===l)throw av();var f={name:u.fullPath},p=Hv(o),d=t.maxUploadRetryTime(),y=new fb(p,"POST",db(t,n),d);return y.urlParams=f,y.headers=a,y.body=l.uploadData(),y.errorHandler=mb(e),y}(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(Sv)},r.errorHandler_)})},t.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},t.prototype.transition_=function(t){if(this.state_!==t)switch(t){case Cv:case Ev:this.state_=t,null!==this.request_&&this.request_.cancel();break;case _v:var e=this.state_===Tv;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case Tv:this.state_=t,this.notifyObservers_();break;case Iv:this.error_=ov(),this.state_=t,this.notifyObservers_();break;case Nv:case Sv:this.state_=t,this.notifyObservers_()}},t.prototype.completeTransitions_=function(){switch(this.state_){case Ev:this.transition_(Tv);break;case Cv:this.transition_(Iv);break;case _v:this.start_()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=Av(this.state_);return new Sb(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),t.prototype.on=function(e,t,n,o){void 0===t&&(t=void 0),void 0===n&&(n=void 0),void 0===o&&(o=void 0);var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=ub(!0).validator,a=sb(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(xv(t.next)||xv(t.error)||xv(t.complete)))throw"";return}catch(t){throw r}}nb("on",[ib(function(t){if(e!==wv.STATE_CHANGED)throw"Expected one of the event types: ["+wv.STATE_CHANGED+"]."}),sb(s,!0),ub(!0),ub(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&nb("on",i,arguments);var r=new Tb(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[sb(function(t){if(null===t)throw r;s(t)}),ub(!0),ub(!0)];return!(xv(t)||xv(n)||xv(o))?c(h):c(null)(t,n,o)},t.prototype.then=function(t,e){return this.promise_.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},t.prototype.removeObserver_=function(t){var e,n,r;e=this.observers_,n=t,-1!==(r=e.indexOf(n))&&e.splice(r,1)},t.prototype.notifyObservers_=function(){var t,e=this;this.finishPromise_(),(t=this.observers_,Array.prototype.slice.call(t)).forEach(function(t){e.notifyObserver_(t)})},t.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(Av(this.state_)){case Dv.SUCCESS:Cb(this.resolve_.bind(null,this.snapshot))();break;case Dv.CANCELED:case Dv.ERROR:Cb(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},t.prototype.notifyObserver_=function(t){switch(Av(this.state_)){case Dv.RUNNING:case Dv.PAUSED:null!==t.next&&Cb(t.next.bind(t,this.snapshot))();break;case Dv.SUCCESS:null!==t.complete&&Cb(t.complete.bind(t))();break;case Dv.CANCELED:case Dv.ERROR:null!==t.error&&Cb(t.error.bind(t,this.error_))();break;default:null!==t.error&&Cb(t.error.bind(t,this.error_))()}},t.prototype.resume=function(){nb("resume",[],arguments);var t=this.state_===Tv||this.state_===Ev;return t&&this.transition_(_v),t},t.prototype.pause=function(){nb("pause",[],arguments);var t=this.state_===_v;return t&&this.transition_(Ev),t},t.prototype.cancel=function(){nb("cancel",[],arguments);var t=this.state_===_v||this.state_===Ev;return t&&this.transition_(Cv),t},t}(),Nb=function(){function n(t,e){this.authWrapper=t,this.location=e instanceof Qv?e:Qv.makeFromUrl(e)}return n.prototype.toString=function(){return nb("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},n.prototype.newRef=function(t,e){return new n(t,e)},n.prototype.mappings=function(){return Jv()},n.prototype.child=function(t){nb("child",[ib()],arguments);var e,n,r=(e=this.location.path,n=t.split("/").filter(function(t){return 0<t.length}).join("/"),0===e.length?n:e+"/"+n),i=new Qv(this.location.bucket,r);return this.newRef(this.authWrapper,i)},Object.defineProperty(n.prototype,"parent",{get:function(){var t=function(t){if(0==t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new Qv(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"root",{get:function(){var t=new Qv(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return Kv(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),n.prototype.put=function(t,e){return void 0===e&&(e=null),nb("put",[new rb(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||Vv()&&t instanceof Blob))throw"Expected Blob or File."}),ob(!0)],arguments),this.throwIfRoot_("put"),new Ib(this,this.authWrapper,this.location,this.mappings(),new hb(t),e)},n.prototype.putString=function(t,e,n){void 0===e&&(e=lv.RAW),nb("putString",[ib(),ib(fv,!0),ob(!0)],arguments),this.throwIfRoot_("putString");var r=dv(e,t),i=Rv(n);return!Mv(i.contentType)&&Mv(r.contentType)&&(i.contentType=r.contentType),new Ib(this,this.authWrapper,this.location,this.mappings(),new hb(r.data,!0),i)},n.prototype.delete=function(){nb("delete",[],arguments),this.throwIfRoot_("delete");var s=this;return this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a=(e=s.authWrapper,n=s.location,r=Hv(n.fullServerUrl()),i=e.maxOperationRetryTime(),(o=new fb(r,"DELETE",function(t,e){},i)).successCodes=[200,204],o.errorHandler=gb(n),o);return s.authWrapper.makeRequest(a,t).getPromise()})},n.prototype.getMetadata=function(){nb("getMetadata",[],arguments),this.throwIfRoot_("getMetadata");var n=this;return this.authWrapper.getAuthToken().then(function(t){var e=vb(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},n.prototype.updateMetadata=function(h){nb("updateMetadata",[ob()],arguments),this.throwIfRoot_("updateMetadata");var l=this;return this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a,s,u,c=(e=l.authWrapper,n=l.location,r=h,i=l.mappings(),o=Hv(n.fullServerUrl()),a=tb(r,i),s=e.maxOperationRetryTime(),(u=new fb(o,"PATCH",db(e,i),s)).headers={"Content-Type":"application/json; charset=utf-8"},u.body=a,u.errorHandler=gb(n),u);return l.authWrapper.makeRequest(c,t).getPromise()})},n.prototype.getDownloadURL=function(){nb("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL");var u=this;return this.authWrapper.getAuthToken().then(function(t){var e,n,r,i,o,a,s=(e=u.authWrapper,n=u.location,r=u.mappings(),i=Hv(n.fullServerUrl()),o=e.maxOperationRetryTime(),(a=new fb(i,"GET",yb(e,r),o)).errorHandler=gb(n),a);return u.authWrapper.makeRequest(s,t).getPromise().then(function(t){if(null===t)throw new ev(nv.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},n.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw e=t,new ev(nv.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').");var e},n}(),Db=function(){function t(t){var e;this.promise_=(e=t,Promise.reject(e))}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){void 0===t&&(t=!1)},t}(),Ab=function(){function t(){this.map_={},this.id_=-9007199254740991}return t.prototype.addRequest=function(t){var e=this.id_;this.id_++,this.map_[e]=t;var n=this;function r(){delete n.map_[e]}t.getPromise().then(r,r)},t.prototype.clear=function(){kv(this.map_,function(t,e){e&&e.cancel(!0)}),this.map_={}},t}(),kb=function(){function a(t,e,n,r,i){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var o=this.app_.options;Mv(o)&&(this.bucket_=a.extractBucket_(o))}this.storageRefMaker_=e,this.requestMaker_=n,this.pool_=i,this.service_=r,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e4,this.requestMap_=new Ab}return a.extractBucket_=function(t){var e=t.storageBucket||null;return null==e?null:Qv.makeFromBucketSpec(e).bucket},a.prototype.getAuthToken=function(){return null!==this.app_&&Mv(this.app_.INTERNAL)&&Mv(this.app_.INTERNAL.getToken)?this.app_.INTERNAL.getToken().then(function(t){return null!==t?t.accessToken:null},function(t){return null}):Pv(null)},a.prototype.bucket=function(){if(this.deleted_)throw uv();return this.bucket_},a.prototype.service=function(){return this.service_},a.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},a.prototype.makeRequest=function(t,e){if(this.deleted_)return new Db(uv());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},a.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},a.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},a.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},a.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},a.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},a}();var Rb=function(){function t(t,e,n,r,i,o,a,s,u,c,h){this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h;var l=this;this.promise_=Ov(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}return t.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());xv(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=iv()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?uv():ov()):i(n=new ev(nv.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new Ob(!1,null,!0)):this.backoffId_=function(e,t,n){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){u||(u=!0,t.apply(null,arguments))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.apply(null,arguments):s()||o?c.apply(null,arguments):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},n),p}(function(o,t){if(t)o(!1,new Ob(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===vv.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=lb(s.successCodes_,n);o(!0,new Ob(r,t))}else{var i=t.getErrorCode()===vv.ABORT;o(!1,new Ob(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingXhr_&&this.pendingXhr_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=lb([408,429],t),r=lb(this.additionalRetryCodes_,t);return e||n||r},t}(),Ob=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function Pb(t,e,n){var r,i,o,a,s=Gv(t.urlParams),u=t.url+s,c=Rv(t.headers);return r=c,null!==(i=e)&&0<i.length&&(r.Authorization="Firebase "+i),o=c,a=void 0!==Fh?Fh.SDK_VERSION:"AppManager",o["X-Firebase-Storage-Version"]="webjs/"+a,new Rb(u,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var Mb,xb=function(){function t(t,e,n){if(this.bucket_=null,this.authWrapper_=new kb(t,function(t,e){return new Nb(t,e)},Pb,this,e),this.app_=t,null!=n)this.bucket_=Qv.makeFromBucketSpec(n);else{var r=this.authWrapper_.bucket();null!=r&&(this.bucket_=new Qv(r,""))}this.internals_=new Lb(this)}return t.prototype.ref=function(t){if(nb("ref",[ib(function(t){if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new Nb(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},t.prototype.refFromURL=function(t){return nb("refFromURL",[ib(function(t){if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{Qv.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new Nb(this.authWrapper_,t)},Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),t.prototype.setMaxUploadRetryTime=function(t){nb("setMaxUploadRetryTime",[ab()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},t.prototype.setMaxOperationRetryTime=function(t){nb("setMaxOperationRetryTime",[ab()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(t.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),t}(),Lb=function(){function t(t){this.service_=t}return t.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Pv(void 0)},t}();function Fb(t,e,n){return new xb(t,new jv,n)}return Mb={TaskState:Dv,TaskEvent:wv,StringFormat:lv,Storage:xb,Reference:Nb},Fh.INTERNAL.registerService("storage",Fb,Mb,void 0,!0),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),Fh});
//# sourceMappingURL=firebase.js.map
